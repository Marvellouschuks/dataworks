(window.webpackJsonp = window.webpackJsonp || []).push([[11], {
    665: function(g, I, C) {
        var A = C(673);
        g.exports = function(g, I) {
            if (null == g)
                return {};
            var C, e, o = A(g, I);
            if (Object.getOwnPropertySymbols) {
                var i = Object.getOwnPropertySymbols(g);
                for (e = 0; e < i.length; e++)
                    C = i[e],
                    I.indexOf(C) >= 0 || Object.prototype.propertyIsEnumerable.call(g, C) && (o[C] = g[C])
            }
            return o
        }
        ,
        g.exports.__esModule = !0,
        g.exports.default = g.exports
    },
    667: function(g, I, C) {
        "use strict";
        var A = C(3)
          , e = C.n(A)
          , o = C(665)
          , i = C.n(o)
          , t = C(0)
          , n = C(10)
          , l = C(12)
          , c = C(15)
          , a = C.n(c)
          , s = function(g) {
            var I = {
                root: {
                    opacity: 0
                }
            };
            return I[g.mediaInverse.sm] = {
                root: {}
            },
            I
        }
          , d = C(1)
          , b = ["className", "children", "duration", "ease", "delay", "visible", "inview", "tag"];
        function G(g, I) {
            var C = Object.keys(g);
            if (Object.getOwnPropertySymbols) {
                var A = Object.getOwnPropertySymbols(g);
                I && (A = A.filter((function(I) {
                    return Object.getOwnPropertyDescriptor(g, I).enumerable
                }
                ))),
                C.push.apply(C, A)
            }
            return C
        }
        function r(g) {
            for (var I = 1; I < arguments.length; I++) {
                var C = null != arguments[I] ? arguments[I] : {};
                I % 2 ? G(Object(C), !0).forEach((function(I) {
                    e()(g, I, C[I])
                }
                )) : Object.getOwnPropertyDescriptors ? Object.defineProperties(g, Object.getOwnPropertyDescriptors(C)) : G(Object(C)).forEach((function(I) {
                    Object.defineProperty(g, I, Object.getOwnPropertyDescriptor(C, I))
                }
                ))
            }
            return g
        }
        var u = Object(l.b)(s)
          , B = function(g) {
            var I = g.className
              , C = g.children
              , A = g.duration
              , o = g.ease
              , l = g.delay
              , c = g.visible
              , s = g.inview
              , G = g.tag
              , B = i()(g, b)
              , Z = u()
              , m = Object(t.useRef)()
              , h = G;
            return Object(t.useEffect)((function() {
                n.a.to(m.current, {
                    opacity: c || s ? 1 : 0,
                    duration: A,
                    ease: o,
                    delay: l
                })
            }
            ), [c, s]),
            Object(d.jsx)(h, r(r({
                className: a()(e()(e()({}, I, I), Z.root, !0)),
                ref: m
            }, B), {}, {
                children: C
            }))
        };
        B.defaultProps = {
            className: "",
            tag: "div",
            duration: 1,
            delay: 0,
            ease: "power3.inOut",
            visible: !1,
            inview: !1
        };
        I.a = B
    },
    669: function(g, I, C) {
        "use strict";
        var A = C(3)
          , e = C.n(A)
          , o = C(6)
          , i = C.n(o)
          , t = C(0)
          , n = C(12)
          , l = C(15)
          , c = C.n(l)
          , a = C(10)
          , s = C(204)
          , d = C(76)
          , b = C(77)
          , G = C(683)
          , r = function(g) {
            var I = {
                root: {
                    position: "relative",
                    opacity: 0,
                    "& p": {
                        marginBottom: 0
                    },
                    "& *": {
                        lineHeight: 1.25
                    }
                },
                wrap: {
                    overflow: "hidden",
                    "& div.line:not(:last-child)": {
                        marginBottom: function(g) {
                            return "".concat(g.linesMargin, "em")
                        },
                        overflow: "hidden",
                        "& div": {
                            verticalAlign: "middle"
                        }
                    }
                },
                hidden: {
                    visibility: "hidden"
                }
            };
            return I[g.mediaInverse.md] = {
                wrap: {
                    "& div.line:not(:last-child)": {
                        overflow: "hidden",
                        "& div": {
                            overflow: "hidden"
                        }
                    }
                }
            },
            I
        }
          , u = C(1);
        a.a.registerPlugin(G.a);
        var B = Object(n.b)(r)
          , Z = function(g) {
            var I = g.className
              , C = g.delayEnter
              , A = g.delayLeave
              , o = g.duration
              , n = g.ease
              , l = g.inview
              , r = g.lineHeight
              , Z = g.link
              , m = g.onComplete
              , h = g.stagger
              , p = g.tag
              , y = g.type
              , W = g.value
              , v = g.visible
              , V = B({
                linesMargin: -1.25 + r
            })
              , X = Object(t.useRef)()
              , Y = Object(t.useRef)(0)
              , K = Object(t.useRef)()
              , R = p
              , w = Object(t.useState)(!1)
              , H = i()(w, 2)
              , F = H[0]
              , N = H[1];
            return Object(t.useEffect)((function() {
                "" !== W && (Y.current = window.innerWidth,
                N(new G.a(K.current,{
                    type: y
                })))
            }
            ), []),
            Object(t.useEffect)((function() {
                !0 === F.isSplit && (a.a.set(X.current, {
                    opacity: 1
                }),
                a.a.set(F[y], {
                    y: "120%",
                    transformOrigin: "center top"
                }),
                "lines" === y && F.lines.forEach((function(g) {
                    var I, C;
                    I = g,
                    C = document.createElement("div"),
                    I.parentNode.insertBefore(C, I),
                    C.classList.add("line"),
                    C.appendChild(I)
                }
                )))
            }
            ), [F, y]),
            Object(b.c)((function() {
                Y.current !== window.innerWidth && F.isSplit && (F.revert(),
                N(!1),
                setTimeout((function() {
                    N(new G.a(K.current,{
                        type: y
                    })),
                    Y.current = window.innerWidth
                }
                ), 200))
            }
            ), [F]),
            Object(t.useEffect)((function() {
                !0 === F.isSplit && a.a.to(F[y], {
                    y: v || l ? "0%" : "120%",
                    duration: o,
                    stagger: h,
                    ease: n,
                    delay: v || l ? C : A,
                    onComplete: m
                })
            }
            ), [F, y, v, l, C, A, m]),
            Object(u.jsx)(R, {
                ref: X,
                className: c()(e()(e()(e()(e()({}, I, I), V.hidden, !F), V.root, !0), V.visible, v)),
                children: Object(u.jsx)(s.a, {
                    condition: Z,
                    wrapper: function(g) {
                        return Object(u.jsx)(d.a, {
                            className: V.link,
                            to: Z,
                            children: g
                        })
                    },
                    children: Object(u.jsx)("div", {
                        className: V.wrap,
                        dangerouslySetInnerHTML: {
                            __html: W
                        },
                        ref: K
                    })
                })
            })
        };
        Z.defaultProps = {
            className: "",
            value: "",
            type: "chars",
            delayEnter: 0,
            delayLeave: 0,
            lineHeight: 1.25,
            tag: "div",
            stagger: .1,
            duration: 1.2,
            ease: "power3.inOut",
            link: !1,
            visible: !1,
            inview: !1
        };
        I.a = Z
    },
    670: function(g, I, C) {
        "use strict";
        var A = C(3)
          , e = C.n(A)
          , o = C(6)
          , i = C.n(o)
          , t = C(665)
          , n = C.n(t)
          , l = C(0)
          , c = C(10)
          , a = C(96)
          , s = C(94)
          , d = C(1)
          , b = ["children", "offset", "once", "className"];
        function G(g, I) {
            var C = Object.keys(g);
            if (Object.getOwnPropertySymbols) {
                var A = Object.getOwnPropertySymbols(g);
                I && (A = A.filter((function(I) {
                    return Object.getOwnPropertyDescriptor(g, I).enumerable
                }
                ))),
                C.push.apply(C, A)
            }
            return C
        }
        function r(g) {
            for (var I = 1; I < arguments.length; I++) {
                var C = null != arguments[I] ? arguments[I] : {};
                I % 2 ? G(Object(C), !0).forEach((function(I) {
                    e()(g, I, C[I])
                }
                )) : Object.getOwnPropertyDescriptors ? Object.defineProperties(g, Object.getOwnPropertyDescriptors(C)) : G(Object(C)).forEach((function(I) {
                    Object.defineProperty(g, I, Object.getOwnPropertyDescriptor(C, I))
                }
                ))
            }
            return g
        }
        c.a.registerPlugin(a.b);
        var u = function(g) {
            var I = g.children
              , C = g.offset
              , A = g.once
              , e = g.className
              , o = n()(g, b)
              , t = Object(l.useRef)()
              , c = Object(l.useRef)()
              , G = Object(l.useState)(!1)
              , u = i()(G, 2)
              , B = u[0]
              , Z = u[1]
              , m = Object(l.useContext)(s.a).scrollElement;
            return Object(l.useEffect)((function() {
                return m && (c.current = a.b.create({
                    trigger: t.current,
                    scroller: m,
                    start: "top ".concat(C),
                    once: A,
                    onEnter: function() {
                        return A && Z(!0)
                    },
                    onToggle: function(g) {
                        return !A && Z(g.isActive)
                    }
                })),
                function() {
                    m && c.current.kill()
                }
            }
            ), [m]),
            Object(d.jsx)("div", r(r({
                ref: t,
                className: e
            }, o), {}, {
                children: l.Children.map(I, (function(g) {
                    return Object(l.cloneElement)(g, {
                        inview: "string" == typeof g.type ? void 0 : B
                    })
                }
                ))
            }))
        };
        u.defaultProps = {
            offset: "95%",
            once: !0
        },
        I.a = Object(l.memo)(u)
    },
    671: function(g, I, C) {
        "use strict";
        var A = C(3)
          , e = C.n(A)
          , o = C(665)
          , i = C.n(o)
          , t = C(0)
          , n = C(12)
          , l = C(10)
          , c = function(g) {
            var I = {
                root: {
                    willChange: "opacity",
                    overflow: "hidden",
                    display: "block",
                    opacity: 0,
                    "& span": {
                        display: "block",
                        willChange: "transform"
                    }
                },
                image: {
                    "& img": {
                        willChange: "transform",
                        transform: "scale(1)",
                        height: "auto"
                    }
                }
            };
            return I[g.mediaInverse.sm] = {},
            I
        }
          , a = C(1)
          , s = ["className", "image", "width", "height", "label", "visible", "inview", "delayEnter", "delayLeave"];
        function d(g, I) {
            var C = Object.keys(g);
            if (Object.getOwnPropertySymbols) {
                var A = Object.getOwnPropertySymbols(g);
                I && (A = A.filter((function(I) {
                    return Object.getOwnPropertyDescriptor(g, I).enumerable
                }
                ))),
                C.push.apply(C, A)
            }
            return C
        }
        function b(g) {
            for (var I = 1; I < arguments.length; I++) {
                var C = null != arguments[I] ? arguments[I] : {};
                I % 2 ? d(Object(C), !0).forEach((function(I) {
                    e()(g, I, C[I])
                }
                )) : Object.getOwnPropertyDescriptors ? Object.defineProperties(g, Object.getOwnPropertyDescriptors(C)) : d(Object(C)).forEach((function(I) {
                    Object.defineProperty(g, I, Object.getOwnPropertyDescriptor(C, I))
                }
                ))
            }
            return g
        }
        var G = Object(n.b)(c)
          , r = function(g) {
            var I = g.className
              , C = g.image
              , A = g.width
              , e = g.height
              , o = g.label
              , n = g.visible
              , c = g.inview
              , d = g.delayEnter
              , r = g.delayLeave
              , u = i()(g, s)
              , B = G()
              , Z = Object(t.useRef)()
              , m = Object(t.useRef)();
            return Object(t.useEffect)((function() {
                l.a.to(Z.current, {
                    opacity: n || c ? 1 : 0,
                    duration: 1,
                    ease: "power3.inOut",
                    delay: n || c ? d : r
                })
            }
            ), [n, c]),
            Object(a.jsx)("picture", b(b({
                ref: Z,
                className: "".concat(B.root, " ").concat(I)
            }, u), {}, {
                children: Object(a.jsx)("span", {
                    className: B.image,
                    children: Object(a.jsx)("img", {
                        ref: m,
                        src: C,
                        alt: o,
                        width: A,
                        height: e
                    })
                })
            }))
        };
        r.defaultProps = {
            className: "",
            image: "",
            label: "",
            visible: !1,
            inview: !1,
            delay: 0
        };
        I.a = r
    },
    672: function(g, I, C) {
        "use strict";
        var A = C(3)
          , e = C.n(A)
          , o = C(0)
          , i = C(15)
          , t = C.n(i)
          , n = C(325)
          , l = C(74)
          , c = C(682)
          , a = C(94)
          , s = C(1)
          , d = Object(o.forwardRef)((function(g, I) {
            var C = g.children
              , A = g.className
              , i = g.direction
              , d = g.init
              , b = g.lerp
              , G = g.smooth
              , r = Object(o.useRef)(null)
              , u = Object(l.c)()
              , B = Object(o.useRef)()
              , Z = Object(o.useRef)()
              , m = Object(o.useContext)(a.a).setScrollbar;
            return Object(o.useEffect)((function() {
                return r.current && (Z.current = new n.default((function() {
                    var g;
                    r.current && (null === (g = B.current) || void 0 === g || g.update())
                }
                )),
                Z.current.observe(r.current)),
                function() {
                    r.current && Z.current.disconnect(r.current)
                }
            }
            ), [r]),
            Object(o.useEffect)((function() {
                return r.current && d && !u.detect.isIE11 && (B.current = new c.a({
                    el: r.current,
                    direction: i,
                    smooth: G,
                    lerp: b,
                    getDirection: !0,
                    getSpeed: !0,
                    repeat: !1,
                    touchMultiplier: 2
                }),
                m(B.current)),
                function() {
                    d && B.current && B.current.destroy()
                }
            }
            ), [r, d]),
            Object(o.useImperativeHandle)(I, (function() {
                return {
                    ref: r.current
                }
            }
            )),
            Object(s.jsx)("div", {
                className: t()(e()(e()({}, A, A), "smooth-scroll", !0)),
                ref: r,
                "data-scroll-container": !0,
                children: C
            })
        }
        ));
        d.defaultProps = {
            smooth: !0,
            lerp: .1
        },
        I.a = d
    },
    673: function(g, I) {
        g.exports = function(g, I) {
            if (null == g)
                return {};
            var C = {};
            for (var A in g)
                if (Object.prototype.hasOwnProperty.call(g, A)) {
                    if (I.indexOf(A) >= 0)
                        continue;
                    C[A] = g[A]
                }
            return C
        }
        ,
        g.exports.__esModule = !0,
        g.exports.default = g.exports
    },
    674: function(g, I, C) {
        "use strict";
        var A = C(684)
          , e = C(11)
          , o = C(131)
          , i = C(1)
          , t = function(g) {
            var I = g.title
              , C = Object(e.f)((function(g) {
                return g.options.strings
            }
            ));
            return Object(i.jsx)(A.a, {
                title: "".concat(Object(o.decodeEntities)(I), " - ").concat(C.site_title)
            })
        };
        t.defaultProps = {
            title: ""
        },
        I.a = t
    },
    675: function(g, I, C) {
        "use strict";
        var A = C(3)
          , e = C.n(A)
          , o = C(0)
          , i = C(12)
          , t = C(15)
          , n = C.n(t)
          , l = C(10)
          , c = function(g) {
            var I = {
                root: {
                    width: 62,
                    height: 62,
                    border: "1px solid ".concat(g.getRgba(g.colors[1], .22)),
                    borderRadius: "50%",
                    display: "flex",
                    justifyContent: "center",
                    alignItems: "center",
                    paddingTop: 3,
                    cursor: "pointer",
                    opacity: 0,
                    "& svg": {
                        fill: function(I) {
                            return I.color ? I.color : g.colors[3]
                        },
                        width: 17,
                        height: 31
                    }
                },
                mouse: {
                    animation: "$scroll 1s ease-out infinite alternate"
                },
                arrow: {
                    animation: "$pulse 1s ease-out infinite alternate",
                    transformOrigin: "center 70%"
                },
                "@keyframes scroll": {
                    "0%": {
                        transform: "translateY(0px)"
                    },
                    "100%": {
                        transform: "translateY(15px)"
                    }
                },
                "@keyframes pulse": {
                    "0%": {
                        transform: "scale(1)"
                    },
                    "100%": {
                        transform: "scale(1.2)"
                    }
                }
            };
            return I[g.mediaInverse.sm] = {},
            I
        }
          , a = C(1)
          , s = Object(i.b)(c)
          , d = function(g) {
            var I = g.className
              , C = g.visible
              , A = g.color
              , i = g.event
              , t = s({
                color: A
            })
              , c = Object(o.useRef)();
            return Object(o.useEffect)((function() {
                C ? l.a.to(c.current, {
                    duration: 1.3,
                    opacity: 1,
                    y: "0%",
                    ease: "power3.out",
                    delay: .6
                }) : l.a.to(c.current, {
                    duration: 1.3,
                    opacity: 0,
                    y: "100%",
                    ease: "power3.inOut"
                })
            }
            ), [C]),
            Object(a.jsx)("button", {
                className: n()(e()(e()(e()({}, t.root, !0), I, I), t.visible, C)),
                ref: c,
                onClick: i,
                children: Object(a.jsxs)("svg", {
                    viewBox: "0 0 36 80",
                    children: [Object(a.jsx)("path", {
                        d: "M0,18v18c0,9.9,8.1,18,18,18s18-8.1,18-18V18c0-9.9-8.1-18-18-18S0,8.1,0,18z M18,4c7.7,0,14,6.3,14,14v18 c0,7.7-6.3,14-14,14S4,43.7,4,36V18C4,10.3,10.3,4,18,4z"
                    }), Object(a.jsx)("path", {
                        className: t.mouse,
                        d: "M18,21c1.1,0,2-0.9,2-2v-6c0-1.1-0.9-2-2-2s-2,0.9-2,2v6C16,20.1,16.9,21,18,21z"
                    }), Object(a.jsx)("path", {
                        className: t.arrow,
                        d: "M16.6,69.4C17,69.8,17.5,70,18,70s1-0.2,1.4-0.6l5-5c0.8-0.8,0.8-2,0-2.8s-2-0.8-2.8,0L18,65.2l-3.6-3.6 c-0.8-0.8-2-0.8-2.8,0s-0.8,2,0,2.8L16.6,69.4z"
                    })]
                })
            })
        };
        d.defaultProps = {
            className: "",
            visible: !0,
            event: function() {}
        };
        I.a = d
    },
    676: function(g, I, C) {
        "use strict";
        var A = C(3)
          , e = C.n(A)
          , o = C(15)
          , i = C.n(o)
          , t = C(11)
          , n = C(12)
          , l = C(76)
          , c = function(g) {
            var I = {
                root: {
                    lineHeight: 1.5,
                    color: function(I) {
                        return I.inverse ? g.getRgba(g.colors[0], .5) : g.getRgba(g.colors[1], .5)
                    },
                    textTransform: "uppercase",
                    fontSize: 10,
                    letterSpacing: "0.22em",
                    paddingBottom: 48,
                    paddingTop: 50
                },
                wrapper: {
                    display: "flex",
                    flexWrap: "wrap"
                },
                text: {
                    textAlign: "left",
                    flex: "1 0 auto",
                    paddingTop: 7,
                    paddingBottom: 7,
                    paddingRight: 40
                },
                nav: {
                    flex: "0 0 auto",
                    textAlign: "right",
                    display: "flex",
                    marginRight: -20,
                    "& a": {
                        display: "inline-block",
                        marginRight: 20,
                        extend: g.link,
                        lineHeight: 1.5,
                        color: function(I) {
                            return I.inverse ? g.colors[0] : g.colors[1]
                        }
                    }
                }
            };
            return I[g.mediaInverse.md] = {
                root: {
                    paddingBottom: 24
                },
                wrapper: {
                    display: "block"
                }
            },
            I
        }
          , a = C(1)
          , s = Object(n.b)(c)
          , d = function(g) {
            var I = g.inverse
              , C = s({
                inverse: I
            })
              , A = Object(t.f)((function(g) {
                return {
                    footerNav: g.nav.footer_menu || [],
                    strings: g.options.strings
                }
            }
            ), t.d)
              , o = A.footerNav
              , n = A.strings;
            return Object(a.jsx)("footer", {
                className: i()(e()(e()({}, C.root, !0), "footer__root", !0)),
                children: Object(a.jsxs)("div", {
                    className: i()(e()(e()({}, C.wrapper, !0), "footer__wrapper", !0)),
                    children: [Object(a.jsx)("div", {
                        className: i()(e()(e()({}, C.text, !0), "footer__text", !0)),
                        children: n.footer_string_1
                    }), Object(a.jsx)("div", {
                        className: i()(e()(e()({}, C.nav, !0), "footer__nav", !0)),
                        children: o.length && o.map((function(g, I) {
                            return Object(a.jsx)(l.a, {
                                to: g.url,
                                children: g.title
                            }, I.toString())
                        }
                        ))
                    })]
                })
            })
        };
        d.defaultProps = {
            storeLocator: !1
        };
        I.a = d
    },
    680: function(g, I, C) {
        "use strict";
        var A = C(3)
          , e = C.n(A)
          , o = C(15)
          , i = C.n(o)
          , t = C(12)
          , n = C(76)
          , l = function(g) {
            var I = {
                root: {
                    overflow: "hidden",
                    position: "relative",
                    zIndex: 1,
                    padding: [35, 40, 105],
                    borderRadius: 10,
                    "&:hover": {
                        "& $image": {
                            transform: "scale(1.2)"
                        },
                        "& $link": {
                            transform: "scale(1.2)"
                        }
                    }
                },
                image: {
                    position: "absolute",
                    zIndex: 1,
                    top: 0,
                    left: 0,
                    opacity: .3,
                    width: "100%",
                    height: "100%",
                    backgroundSize: "cover",
                    transition: "transform 1s ".concat(g.easings["power3.out"])
                },
                link: {
                    position: "absolute",
                    zIndex: 2,
                    bottom: 40,
                    left: 35,
                    borderRadius: 20,
                    width: 40,
                    height: 40,
                    display: "flex",
                    justifyContent: "center",
                    alignItems: "center",
                    background: g.colors[1],
                    transition: "transform 1s ".concat(g.easings["power3.out"]),
                    "& svg": {
                        fill: g.colors[0],
                        width: 7
                    }
                },
                title: {
                    position: "relative",
                    zIndex: 2,
                    color: g.colors[1],
                    fontFamily: g.fonts[1],
                    fontSize: 28,
                    marginBottom: 10,
                    background: "linear-gradient(to-bottom, red, black)"
                },
                text: {
                    position: "relative",
                    zIndex: 2,
                    fontFamily: g.fonts[0],
                    color: g.colors[1],
                    opacity: .45,
                    maxWidth: 330,
                    fontSize: 19
                }
            };
            return I[g.mediaInverse.sm] = {
                root: {
                    padding: [25, 20, 80],
                    borderRadius: 10
                },
                link: {
                    bottom: 25,
                    left: 20
                },
                title: {
                    fontSize: 22
                },
                text: {
                    fontSize: 18
                }
            },
            I
        }
          , c = C(1)
          , a = Object(t.b)(l);
        I.a = function(g) {
            var I = g.className
              , C = g.title
              , A = g.text
              , o = g.image
              , t = g.link
              , s = g.color
              , d = a(l);
            return Object(c.jsxs)(n.a, {
                to: t,
                className: i()(e()(e()({}, d.root, !0), I, I)),
                style: {
                    backgroundColor: o ? "#382e63" : s
                },
                children: [o && Object(c.jsx)("div", {
                    className: d.image,
                    style: {
                        backgroundImage: "url(".concat(o, ")")
                    }
                }), Object(c.jsx)("div", {
                    className: d.title,
                    dangerouslySetInnerHTML: {
                        __html: C
                    }
                }), Object(c.jsx)("div", {
                    className: d.text,
                    children: A
                }), Object(c.jsx)("button", {
                    className: d.link,
                    children: Object(c.jsx)("svg", {
                        children: Object(c.jsx)("use", {
                            xlinkHref: "#ico-arrow"
                        })
                    })
                })]
            })
        }
    },
    689: function(g, I, C) {
        "use strict";
        var A = C(3)
          , e = C.n(A)
          , o = C(15)
          , i = C.n(o)
          , t = C(12)
          , n = C(669)
          , l = C(671)
          , c = C(667)
          , a = C(670)
          , s = C(76)
          , d = function(g) {
            var I = {
                root: {
                    display: "flex",
                    position: "relative",
                    zIndex: 1,
                    margin: [100, "auto"]
                },
                box: {
                    flex: "0 0 50%",
                    paddingLeft: 60,
                    paddingTop: 80
                },
                title: {
                    color: g.colors[1],
                    fontFamily: g.fonts[1],
                    fontSize: 55,
                    marginBottom: 17
                },
                text: {
                    color: g.colors[1],
                    fontFamily: g.fonts[0],
                    opacity: .45,
                    fontSize: 19,
                    marginBottom: 62,
                    maxWidth: 380
                },
                link: {
                    background: g.colors[1],
                    display: "flex",
                    justifyContent: "center",
                    alignItems: "center",
                    width: 45,
                    height: 45,
                    borderRadius: "50%",
                    cursor: "pointer",
                    "& svg": {
                        fill: g.colors[0],
                        width: 6,
                        height: 9
                    }
                },
                img: {
                    flex: "0 0 50%",
                    overflow: "hidden",
                    "& picture": {
                        borderRadius: 20
                    },
                    "& img": {
                        maxWidth: "none",
                        width: "100%"
                    }
                }
            };
            return I[g.mediaInverse.lg] = {
                title: {
                    fontSize: 44
                }
            },
            I[g.mediaInverse.md] = {
                box: {
                    bottom: -70,
                    right: "5.5vw",
                    padding: [38, 40],
                    width: 470
                },
                title: {
                    fontSize: 32,
                    marginBottom: 17
                },
                text: {
                    fontSize: 18,
                    marginBottom: 30
                }
            },
            I[g.mediaInverse.sm] = {
                root: {
                    display: "block"
                },
                box: {
                    paddingLeft: 0,
                    width: "100%"
                },
                title: {
                    fontSize: 32
                }
            },
            I
        }
          , b = C(1)
          , G = Object(t.b)(d);
        I.a = function(g) {
            var I = g.className
              , C = g.title
              , A = g.text
              , o = g.image
              , t = g.link
              , r = g.visible
              , u = G(d);
            return Object(b.jsxs)("div", {
                className: i()(e()(e()({}, u.root, !0), I, I)),
                children: [o && Object(b.jsx)(a.a, {
                    className: u.img,
                    children: Object(b.jsx)(l.a, {
                        image: o.sizes.large,
                        width: o.width,
                        height: o.height,
                        delayEnter: 0,
                        visible: r
                    })
                }), Object(b.jsxs)(a.a, {
                    className: u.box,
                    children: [Object(b.jsx)(n.a, {
                        className: u.title,
                        value: C,
                        tag: "h3",
                        type: "lines",
                        stagger: .03,
                        duration: 1.1,
                        visible: r
                    }), Object(b.jsx)(n.a, {
                        className: u.text,
                        value: A,
                        tag: "div",
                        type: "lines",
                        stagger: .03,
                        duration: 1.3,
                        delayEnter: .2,
                        visible: r
                    }), Object(b.jsx)(c.a, {
                        delay: .8,
                        visible: r,
                        children: Object(b.jsx)(s.a, {
                            to: t,
                            className: u.link,
                            children: Object(b.jsx)("svg", {
                                children: Object(b.jsx)("use", {
                                    xlinkHref: "#ico-arrow"
                                })
                            })
                        })
                    })]
                })]
            })
        }
    },
    690: function(g, I, C) {
        "use strict";
        C.d(I, "a", (function() {
            return hg
        }
        )),
        C.d(I, "b", (function() {
            return Xg
        }
        ));
        var A = C(0)
          , e = C.n(A);
        function o(g, I) {
            return g.map((function(g, C) {
                return g + I[C]
            }
            ))
        }
        function i(g, I) {
            return g.map((function(g, C) {
                return g - I[C]
            }
            ))
        }
        function t(g) {
            return Math.hypot.apply(Math, g)
        }
        function n(g, I) {
            void 0 === I && (I = g);
            var C = t(I)
              , A = 0 === C ? 0 : 1 / C
              , e = I.map((function(g) {
                return A * g
            }
            ));
            return {
                distance: t(g),
                direction: e
            }
        }
        function l(g, I, C) {
            var A = t(I)
              , e = 0 === A ? 0 : 1 / A
              , o = 0 === C ? 0 : 1 / C
              , i = o * A
              , n = I.map((function(g) {
                return o * g
            }
            ))
              , l = I.map((function(g) {
                return e * g
            }
            ));
            return {
                velocities: n,
                velocity: i,
                distance: t(g),
                direction: l
            }
        }
        function c(g) {
            return Math.sign ? Math.sign(g) : Number(g > 0) - Number(g < 0) || +g
        }
        function a(g, I, C) {
            return 0 === I || Math.abs(I) === 1 / 0 ? function(g, I) {
                return Math.pow(g, 5 * I)
            }(g, C) : g * I * C / (I + C * g)
        }
        function s(g, I, C, A) {
            return void 0 === A && (A = .15),
            0 === A ? function(g, I, C) {
                return Math.max(I, Math.min(g, C))
            }(g, I, C) : g < I ? -a(I - g, C - I, A) + I : g > C ? +a(g - C, C - I, A) + C : g
        }
        function d(g, I) {
            for (var C = 0; C < I.length; C++) {
                var A = I[C];
                A.enumerable = A.enumerable || !1,
                A.configurable = !0,
                "value"in A && (A.writable = !0),
                Object.defineProperty(g, A.key, A)
            }
        }
        function b() {
            return (b = Object.assign || function(g) {
                for (var I = 1; I < arguments.length; I++) {
                    var C = arguments[I];
                    for (var A in C)
                        Object.prototype.hasOwnProperty.call(C, A) && (g[A] = C[A])
                }
                return g
            }
            ).apply(this, arguments)
        }
        function G(g, I) {
            g.prototype = Object.create(I.prototype),
            g.prototype.constructor = g,
            g.__proto__ = I
        }
        function r(g, I) {
            if (null == g)
                return {};
            var C, A, e = {}, o = Object.keys(g);
            for (A = 0; A < o.length; A++)
                C = o[A],
                I.indexOf(C) >= 0 || (e[C] = g[C]);
            return e
        }
        function u(g) {
            if (void 0 === g)
                throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
            return g
        }
        function B(g, I) {
            (null == I || I > g.length) && (I = g.length);
            for (var C = 0, A = new Array(I); C < I; C++)
                A[C] = g[C];
            return A
        }
        function Z(g, I) {
            var C;
            if ("undefined" == typeof Symbol || null == g[Symbol.iterator]) {
                if (Array.isArray(g) || (C = function(g, I) {
                    if (g) {
                        if ("string" == typeof g)
                            return B(g, I);
                        var C = Object.prototype.toString.call(g).slice(8, -1);
                        return "Object" === C && g.constructor && (C = g.constructor.name),
                        "Map" === C || "Set" === C ? Array.from(g) : "Arguments" === C || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(C) ? B(g, I) : void 0
                    }
                }(g)) || I && g && "number" == typeof g.length) {
                    C && (g = C);
                    var A = 0;
                    return function() {
                        return A >= g.length ? {
                            done: !0
                        } : {
                            done: !1,
                            value: g[A++]
                        }
                    }
                }
                throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")
            }
            return (C = g[Symbol.iterator]()).next.bind(C)
        }
        function m() {}
        function h() {
            for (var g = arguments.length, I = new Array(g), C = 0; C < g; C++)
                I[C] = arguments[C];
            return 0 === I.length ? m : 1 === I.length ? I[0] : function() {
                for (var g, C, A = Z(I); !(C = A()).done; ) {
                    var e = C.value;
                    g = e.apply(this, arguments) || g
                }
                return g
            }
        }
        function p(g, I) {
            if (void 0 === g) {
                if (void 0 === I)
                    throw new Error("Must define fallback value if undefined is expected");
                g = I
            }
            return Array.isArray(g) ? g : [g, g]
        }
        function y(g, I) {
            return Object.assign({}, I, g || {})
        }
        function W(g) {
            if ("function" == typeof g) {
                for (var I = arguments.length, C = new Array(I > 1 ? I - 1 : 0), A = 1; A < I; A++)
                    C[A - 1] = arguments[A];
                return g.apply(void 0, C)
            }
            return g
        }
        function v(g, I) {
            void 0 === g && (g = {});
            for (var C = {}, A = 0, e = Object.entries(I); A < e.length; A++) {
                var o = e[A]
                  , i = o[0]
                  , t = o[1];
                switch (typeof t) {
                case "function":
                    C[i] = t.call(C, g[i], i, g);
                    break;
                case "object":
                    C[i] = v(g[i], t);
                    break;
                case "boolean":
                    t && (C[i] = g[i])
                }
            }
            return C
        }
        function V() {
            return "undefined" != typeof window && "ontouchstart"in window
        }
        function X(g) {
            return "pointerId"in g ? null : "touchend" === g.type ? g.changedTouches : g.targetTouches
        }
        function Y(g) {
            return Array.from(X(g)).map((function(g) {
                return g.identifier
            }
            ))
        }
        function K(g) {
            return {
                buttons: "buttons"in g ? g.buttons : 0,
                shiftKey: g.shiftKey,
                altKey: g.altKey,
                metaKey: g.metaKey,
                ctrlKey: g.ctrlKey
            }
        }
        var R = function(g) {
            return g
        };
        function w(g, I) {
            void 0 === I && (I = R);
            var C = X(g)
              , A = C ? C[0] : g;
            return I([A.clientX, A.clientY])
        }
        function H(g, I, C) {
            void 0 === C && (C = R);
            var A = Array.from(g.touches).filter((function(g) {
                return I.includes(g.identifier)
            }
            ))
              , e = A[0]
              , o = A[1];
            if (!e || !o)
                throw Error("The event doesn't have two pointers matching the pointerIds");
            var i = o.clientX - e.clientX
              , t = o.clientY - e.clientY
              , n = (o.clientX + e.clientX) / 2
              , l = (o.clientY + e.clientY) / 2;
            return {
                values: C([Math.hypot(i, t), -180 * Math.atan2(i, t) / Math.PI]),
                origin: C([n, l])
            }
        }
        function F(g, I) {
            void 0 === I && (I = R);
            var C = g.currentTarget
              , A = C.scrollX
              , e = C.scrollY
              , o = C.scrollLeft
              , i = C.scrollTop;
            return I([A || o || 0, e || i || 0])
        }
        function N(g, I) {
            void 0 === I && (I = R);
            var C = g.deltaX
              , A = g.deltaY
              , e = g.deltaMode;
            return 1 === e ? (C *= 40,
            A *= 40) : 2 === e && (C *= 800,
            A *= 800),
            I([C, A])
        }
        function S(g, I) {
            return void 0 === I && (I = R),
            I([g.scale, g.rotation])
        }
        var z = {
            threshold: function(g) {
                return void 0 === g && (g = 0),
                p(g)
            },
            rubberband: function(g) {
                switch (void 0 === g && (g = 0),
                g) {
                case !0:
                    return p(.15);
                case !1:
                    return p(0);
                default:
                    return p(g)
                }
            },
            enabled: function(g) {
                return void 0 === g && (g = !0),
                g
            },
            triggerAllEvents: function(g) {
                return void 0 === g && (g = !1),
                g
            },
            initial: function(g) {
                return void 0 === g && (g = 0),
                "function" == typeof g ? g : p(g)
            },
            transform: !0
        }
          , f = b({}, z, {
            axis: !0,
            lockDirection: function(g) {
                return void 0 === g && (g = !1),
                g
            },
            bounds: function(g) {
                if (void 0 === g && (g = {}),
                "function" == typeof g)
                    return function(I) {
                        return f.bounds(g(I))
                    }
                    ;
                var I = g
                  , C = I.left
                  , A = void 0 === C ? -1 / 0 : C
                  , e = I.right
                  , o = void 0 === e ? 1 / 0 : e
                  , i = I.top
                  , t = void 0 === i ? -1 / 0 : i
                  , n = I.bottom;
                return [[A, o], [t, void 0 === n ? 1 / 0 : n]]
            }
        })
          , k = "undefined" != typeof window && window.document && window.document.createElement
          , J = {
            enabled: function(g) {
                return void 0 === g && (g = !0),
                g
            },
            domTarget: !0,
            window: function(g) {
                function I(I) {
                    return g.apply(this, arguments)
                }
                return I.toString = function() {
                    return g.toString()
                }
                ,
                I
            }((function(g) {
                return void 0 === g && (g = k ? window : void 0),
                g
            }
            )),
            eventOptions: function(g) {
                var I = void 0 === g ? {} : g
                  , C = I.passive
                  , A = void 0 === C || C
                  , e = I.capture;
                return {
                    passive: A,
                    capture: void 0 !== e && e
                }
            },
            transform: !0
        }
          , L = b({}, z, {
            bounds: function(g, I, C) {
                var A = C.distanceBounds
                  , e = void 0 === A ? {} : A
                  , o = C.angleBounds
                  , i = void 0 === o ? {} : o
                  , t = function(g) {
                    var I = y(W(e, g), {
                        min: -1 / 0,
                        max: 1 / 0
                    });
                    return [I.min, I.max]
                }
                  , n = function(g) {
                    var I = y(W(i, g), {
                        min: -1 / 0,
                        max: 1 / 0
                    });
                    return [I.min, I.max]
                };
                return "function" != typeof e && "function" != typeof i ? [t(), n()] : function(g) {
                    return [t(g), n(g)]
                }
            }
        })
          , x = b({}, f, {
            useTouch: function(g) {
                void 0 === g && (g = !1);
                var I = V()
                  , C = "undefined" != typeof window && "onpointerdown"in window;
                return !(!g || !I) || !(!I || C)
            },
            experimental_preventWindowScrollY: function(g) {
                return void 0 === g && (g = !1),
                g
            },
            threshold: function(g, I, C) {
                var A = C.filterTaps
                  , e = void 0 !== A && A
                  , o = C.lockDirection
                  , i = void 0 !== o && o
                  , t = C.axis
                  , n = p(g, e ? 3 : i || (void 0 === t ? void 0 : t) ? 1 : 0);
                return this.filterTaps = e,
                n
            },
            swipeVelocity: function(g) {
                return void 0 === g && (g = .5),
                p(g)
            },
            swipeDistance: function(g) {
                return void 0 === g && (g = 50),
                p(g)
            },
            swipeDuration: function(g) {
                return void 0 === g && (g = 250),
                g
            },
            delay: function(g) {
                switch (void 0 === g && (g = 0),
                g) {
                case !0:
                    return 180;
                case !1:
                    return 0;
                default:
                    return g
                }
            }
        });
        function M(g) {
            return void 0 === g && (g = {}),
            v(g, J)
        }
        function Q(g) {
            return void 0 === g && (g = {}),
            v(g, f)
        }
        function j(g) {
            return void 0 === g && (g = {}),
            v(g, L)
        }
        function U(g) {
            return void 0 === g && (g = {}),
            v(g, x)
        }
        function D(g) {
            var I = g.domTarget
              , C = g.eventOptions
              , A = g.window
              , e = g.enabled
              , o = r(g, ["domTarget", "eventOptions", "window", "enabled"])
              , i = M({
                domTarget: I,
                eventOptions: C,
                window: A,
                enabled: e
            });
            return i.drag = U(o),
            i
        }
        function T(g) {
            return b({
                _active: !1,
                _blocked: !1,
                _intentional: [!1, !1],
                _movement: [0, 0],
                _initial: [0, 0],
                _bounds: [[-1 / 0, 1 / 0], [-1 / 0, 1 / 0]],
                _threshold: [0, 0],
                _lastEventType: void 0,
                _dragStarted: !1,
                _dragPreventScroll: !1,
                _dragIsTap: !0,
                _dragDelayed: !1,
                event: void 0,
                intentional: !1,
                values: [0, 0],
                velocities: [0, 0],
                delta: [0, 0],
                movement: [0, 0],
                offset: [0, 0],
                lastOffset: [0, 0],
                direction: [0, 0],
                initial: [0, 0],
                previous: [0, 0],
                first: !1,
                last: !1,
                active: !1,
                timeStamp: 0,
                startTime: 0,
                elapsedTime: 0,
                cancel: m,
                canceled: !1,
                memo: void 0,
                args: void 0
            }, g)
        }
        function O() {
            return {
                shared: {
                    hovering: !1,
                    scrolling: !1,
                    wheeling: !1,
                    dragging: !1,
                    moving: !1,
                    pinching: !1,
                    touches: 0,
                    buttons: 0,
                    down: !1,
                    shiftKey: !1,
                    altKey: !1,
                    metaKey: !1,
                    ctrlKey: !1,
                    locked: !1
                },
                drag: T({
                    _pointerId: void 0,
                    axis: void 0,
                    xy: [0, 0],
                    vxvy: [0, 0],
                    velocity: 0,
                    distance: 0,
                    tap: !1,
                    swipe: [0, 0]
                }),
                pinch: T({
                    _pointerIds: [],
                    da: [0, 0],
                    vdva: [0, 0],
                    origin: void 0,
                    turns: 0
                }),
                wheel: T({
                    axis: void 0,
                    xy: [0, 0],
                    vxvy: [0, 0],
                    velocity: 0,
                    distance: 0
                }),
                move: T({
                    axis: void 0,
                    xy: [0, 0],
                    vxvy: [0, 0],
                    velocity: 0,
                    distance: 0
                }),
                scroll: T({
                    axis: void 0,
                    xy: [0, 0],
                    vxvy: [0, 0],
                    velocity: 0,
                    distance: 0
                })
            }
        }
        var E = new Map
          , P = function(g) {
            return g
        }
          , q = function() {
            function g(g, I) {
                var C = this;
                void 0 === I && (I = []),
                this.controller = g,
                this.args = I,
                this.debounced = !0,
                this.setTimeout = function(g, I) {
                    var A;
                    void 0 === I && (I = 140),
                    clearTimeout(C.controller.timeouts[C.stateKey]);
                    for (var e = arguments.length, o = new Array(e > 2 ? e - 2 : 0), i = 2; i < e; i++)
                        o[i - 2] = arguments[i];
                    C.controller.timeouts[C.stateKey] = (A = window).setTimeout.apply(A, [g, I].concat(o))
                }
                ,
                this.clearTimeout = function() {
                    clearTimeout(C.controller.timeouts[C.stateKey])
                }
                ,
                this.fireGestureHandler = function(g) {
                    if (void 0 === g && (g = !1),
                    C.state._blocked)
                        return C.debounced || (C.state._active = !1,
                        C.clean()),
                        null;
                    if (!g && !C.state.intentional && !C.config.triggerAllEvents)
                        return null;
                    if (C.state.intentional) {
                        var I = C.state.active
                          , A = C.state._active;
                        C.state.active = A,
                        C.state.first = A && !I,
                        C.state.last = I && !A,
                        C.controller.state.shared[C.ingKey] = A
                    }
                    var e = C.controller.pointerIds.size || C.controller.touchIds.size
                      , o = C.controller.state.shared.buttons > 0 || e > 0
                      , i = b({}, C.controller.state.shared, C.state, C.mapStateValues(C.state), {
                        locked: !!document.pointerLockElement,
                        touches: e,
                        down: o
                    })
                      , t = C.handler(i);
                    return C.state.memo = void 0 !== t ? t : C.state.memo,
                    i
                }
                ,
                this.controller = g,
                this.args = I
            }
            var I, C, A, e = g.prototype;
            return e.updateSharedState = function(g) {
                Object.assign(this.controller.state.shared, g)
            }
            ,
            e.updateGestureState = function(g) {
                Object.assign(this.state, g)
            }
            ,
            e.checkIntentionality = function(g, I) {
                return {
                    _intentional: g,
                    _blocked: !1
                }
            }
            ,
            e.getMovement = function(g) {
                var I = this.config.rubberband
                  , C = this.state
                  , A = C._bounds
                  , e = C._initial
                  , t = C._active
                  , n = C._intentional
                  , l = C.lastOffset
                  , c = C.movement
                  , a = C._threshold
                  , s = this.getInternalMovement(g, this.state)
                  , d = !1 === n[0] ? _(s[0], a[0]) : n[0]
                  , G = !1 === n[1] ? _(s[1], a[1]) : n[1]
                  , r = this.checkIntentionality([d, G], s);
                if (r._blocked)
                    return b({}, r, {
                        _movement: s,
                        delta: [0, 0]
                    });
                var u = r._intentional
                  , B = s
                  , Z = [!1 !== u[0] ? s[0] - u[0] : 0, !1 !== u[1] ? s[1] - u[1] : 0]
                  , m = o(Z, l)
                  , h = t ? I : [0, 0];
                return Z = $(A, o(Z, e), h),
                b({}, r, {
                    intentional: !1 !== u[0] || !1 !== u[1],
                    _initial: e,
                    _movement: B,
                    movement: Z,
                    values: g,
                    offset: $(A, m, h),
                    delta: i(Z, c)
                })
            }
            ,
            e.clean = function() {
                this.clearTimeout()
            }
            ,
            I = g,
            (C = [{
                key: "config",
                get: function() {
                    return this.controller.config[this.stateKey]
                }
            }, {
                key: "enabled",
                get: function() {
                    return this.controller.config.enabled && this.config.enabled
                }
            }, {
                key: "state",
                get: function() {
                    return this.controller.state[this.stateKey]
                }
            }, {
                key: "handler",
                get: function() {
                    return this.controller.handlers[this.stateKey]
                }
            }, {
                key: "transform",
                get: function() {
                    return this.config.transform || this.controller.config.transform || P
                }
            }]) && d(I.prototype, C),
            A && d(I, A),
            g
        }();
        function _(g, I) {
            return Math.abs(g) >= I && c(g) * I
        }
        function $(g, I, C) {
            var A = I[0]
              , e = I[1]
              , o = C[0]
              , i = C[1]
              , t = g[0]
              , n = t[0]
              , l = t[1]
              , c = g[1]
              , a = c[0]
              , d = c[1];
            return [s(A, n, l, o), s(e, a, d, i)]
        }
        function gg(g, I, C) {
            var A = g.state
              , e = I.timeStamp
              , o = I.type
              , i = A.values;
            return {
                _lastEventType: o,
                event: I,
                timeStamp: e,
                elapsedTime: C ? 0 : e - A.startTime,
                previous: i
            }
        }
        function Ig(g, I, C, A) {
            var e = g.state
              , o = g.config
              , t = g.stateKey
              , n = g.args
              , l = g.transform
              , c = e.offset
              , a = C.timeStamp
              , s = o.initial
              , d = o.bounds
              , G = i(l(o.threshold), l([0, 0])).map(Math.abs)
              , r = b({}, O()[t], {
                _active: !0,
                args: n,
                values: I,
                initial: null != A ? A : I,
                _threshold: G,
                offset: c,
                lastOffset: c,
                startTime: a
            });
            return b({}, r, {
                _initial: W(s, r),
                _bounds: W(d, r)
            })
        }
        var Cg = function(g) {
            var I = this;
            this.classes = g,
            this.pointerIds = new Set,
            this.touchIds = new Set,
            this.supportsTouchEvents = V(),
            this.supportsGestureEvents = function() {
                try {
                    return "constructor"in GestureEvent
                } catch (g) {
                    return !1
                }
            }(),
            this.bind = function() {
                for (var g = arguments.length, C = new Array(g), A = 0; A < g; A++)
                    C[A] = arguments[A];
                for (var e, o = {}, i = Z(I.classes); !(e = i()).done; ) {
                    var t = e.value;
                    new t(I,C).addBindings(o)
                }
                var n = function(g) {
                    ag(o, g, (function(A) {
                        return I.nativeRefs[g](b({}, I.state.shared, {
                            event: A,
                            args: C
                        }))
                    }
                    ))
                };
                for (var l in I.nativeRefs)
                    n(l);
                return I.config.domTarget ? tg(I, o) : ng(I, o)
            }
            ,
            this.effect = function() {
                return I.config.domTarget && I.bind(),
                I.clean
            }
            ,
            this.clean = function() {
                var g = cg(I.config)
                  , C = I.config.eventOptions;
                g && dg(g, lg(I.domListeners), C),
                Object.values(I.timeouts).forEach(clearTimeout),
                function(g) {
                    var I = g.config
                      , C = I.window
                      , A = I.eventOptions
                      , e = g.windowListeners;
                    if (!C)
                        return;
                    for (var o in e) {
                        var i = e[o];
                        dg(C, i, A)
                    }
                    g.windowListeners = {}
                }(I)
            }
            ,
            this.classes = g,
            this.state = O(),
            this.timeouts = {},
            this.domListeners = [],
            this.windowListeners = {}
        };
        function Ag(g, I) {
            "pointerId"in I ? g.pointerIds.add(I.pointerId) : g.touchIds = new Set(Y(I))
        }
        function eg(g, I) {
            "pointerId"in I ? g.pointerIds.delete(I.pointerId) : Y(I).forEach((function(I) {
                return g.touchIds.delete(I)
            }
            ))
        }
        function og(g, I, C) {
            var A = g.config
              , e = g.windowListeners;
            void 0 === C && (C = A.eventOptions),
            A.window && (dg(A.window, e[I], C),
            delete e[I])
        }
        function ig(g, I, C, A) {
            var e = g.config
              , o = g.windowListeners;
            void 0 === C && (C = []),
            void 0 === A && (A = e.eventOptions),
            e.window && (dg(e.window, o[I], A),
            sg(e.window, o[I] = C, A))
        }
        function tg(g, I) {
            var C = g.config
              , A = g.domListeners
              , e = cg(C);
            if (!e)
                throw new Error("domTarget must be defined");
            var o = C.eventOptions;
            dg(e, lg(A), o);
            for (var i = 0, t = Object.entries(I); i < t.length; i++) {
                var n = t[i]
                  , l = n[0]
                  , c = n[1]
                  , a = l.slice(2).toLowerCase();
                A.push([a, h.apply(void 0, c)])
            }
            sg(e, A, o)
        }
        function ng(g, I) {
            for (var C = {}, A = g.config.eventOptions.capture ? "Capture" : "", e = 0, o = Object.entries(I); e < o.length; e++) {
                var i = o[e]
                  , t = i[0]
                  , n = i[1]
                  , l = Array.isArray(n) ? n : [n];
                C[t + A] = h.apply(void 0, l)
            }
            return C
        }
        function lg(g) {
            return void 0 === g && (g = []),
            g.splice(0, g.length)
        }
        function cg(g) {
            var I = g.domTarget;
            return I && "current"in I ? I.current : I
        }
        function ag(g, I, C) {
            g[I] || (g[I] = []),
            g[I].push(C)
        }
        function sg(g, I, C) {
            void 0 === I && (I = []),
            void 0 === C && (C = {});
            for (var A, e = Z(I); !(A = e()).done; ) {
                var o = A.value
                  , i = o[0]
                  , t = o[1];
                g.addEventListener(i, t, C)
            }
        }
        function dg(g, I, C) {
            void 0 === I && (I = []),
            void 0 === C && (C = {});
            for (var A, e = Z(I); !(A = e()).done; ) {
                var o = A.value
                  , i = o[0]
                  , t = o[1];
                g.removeEventListener(i, t, C)
            }
        }
        function bg(g, I, C) {
            void 0 === C && (C = {});
            var A = function(g) {
                var I = new Set;
                g.drag && I.add(E.get("drag"));
                g.wheel && I.add(E.get("wheel"));
                g.scroll && I.add(E.get("scroll"));
                g.move && I.add(E.get("move"));
                g.pinch && I.add(E.get("pinch"));
                g.hover && I.add(E.get("hover"));
                return I
            }(g)
              , o = e.a.useMemo((function() {
                return new Cg(A)
            }
            ), []);
            return o.config = I,
            o.handlers = g,
            o.nativeRefs = C,
            e.a.useEffect(o.effect, []),
            o.config.domTarget ? Gg : o.bind
        }
        function Gg() {
            0
        }
        var rg = function(g) {
            function I() {
                return g.apply(this, arguments) || this
            }
            G(I, g);
            var C = I.prototype;
            return C.getInternalMovement = function(g, I) {
                return i(g, I.initial)
            }
            ,
            C.checkIntentionality = function(g, I) {
                if (!1 === g[0] && !1 === g[1])
                    return {
                        _intentional: g,
                        axis: this.state.axis
                    };
                var C = I.map(Math.abs)
                  , A = C[0]
                  , e = C[1]
                  , o = this.state.axis || (A > e ? "x" : A < e ? "y" : void 0);
                return this.config.axis || this.config.lockDirection ? o ? this.config.axis && o !== this.config.axis ? {
                    _intentional: g,
                    _blocked: !0,
                    axis: o
                } : (g["x" === o ? 1 : 0] = !1,
                {
                    _intentional: g,
                    _blocked: !1,
                    axis: o
                }) : {
                    _intentional: [!1, !1],
                    _blocked: !1,
                    axis: o
                } : {
                    _intentional: g,
                    _blocked: !1,
                    axis: o
                }
            }
            ,
            C.getKinematics = function(g, I) {
                var C = this.getMovement(g);
                if (!C._blocked) {
                    var A = I.timeStamp - this.state.timeStamp;
                    Object.assign(C, l(C.movement, C.delta, A))
                }
                return C
            }
            ,
            C.mapStateValues = function(g) {
                return {
                    xy: g.values,
                    vxvy: g.velocities
                }
            }
            ,
            I
        }(q);
        function ug(g) {
            "persist"in g && "function" == typeof g.persist && g.persist()
        }
        var Bg = function(g) {
            function I() {
                var I;
                return (I = g.apply(this, arguments) || this).ingKey = "dragging",
                I.stateKey = "drag",
                I.setPointerCapture = function(g) {
                    if (!I.config.useTouch && !document.pointerLockElement) {
                        var C = g.target
                          , A = g.pointerId;
                        C && "setPointerCapture"in C && C.setPointerCapture(A),
                        I.updateGestureState({
                            _dragTarget: C,
                            _dragPointerId: A
                        })
                    }
                }
                ,
                I.releasePointerCapture = function() {
                    if (!I.config.useTouch && !document.pointerLockElement) {
                        var g = I.state
                          , C = g._dragTarget
                          , A = g._dragPointerId;
                        if (A && C && "releasePointerCapture"in C && (!("hasPointerCapture"in C) || C.hasPointerCapture(A)))
                            try {
                                C.releasePointerCapture(A)
                            } catch (g) {}
                    }
                }
                ,
                I.preventScroll = function(g) {
                    I.state._dragPreventScroll && g.cancelable && g.preventDefault()
                }
                ,
                I.getEventId = function(g) {
                    return I.config.useTouch ? g.changedTouches[0].identifier : g.pointerId
                }
                ,
                I.isValidEvent = function(g) {
                    return I.state._pointerId === I.getEventId(g)
                }
                ,
                I.shouldPreventWindowScrollY = I.config.experimental_preventWindowScrollY && I.controller.supportsTouchEvents,
                I.setUpWindowScrollDetection = function(g) {
                    ug(g),
                    ig(I.controller, I.stateKey, [["touchmove", I.preventScroll], ["touchend", I.clean.bind(u(I))], ["touchcancel", I.clean.bind(u(I))]], {
                        passive: !1
                    }),
                    I.setTimeout(I.startDrag.bind(u(I)), 250, g)
                }
                ,
                I.setUpDelayedDragTrigger = function(g) {
                    I.state._dragDelayed = !0,
                    ug(g),
                    I.setTimeout(I.startDrag.bind(u(I)), I.config.delay, g)
                }
                ,
                I.setStartState = function(g) {
                    var C = w(g, I.transform);
                    I.updateSharedState(K(g)),
                    I.updateGestureState(b({}, Ig(u(I), C, g), gg(u(I), g, !0), {
                        _pointerId: I.getEventId(g)
                    })),
                    I.updateGestureState(I.getMovement(C))
                }
                ,
                I.onDragStart = function(g) {
                    Ag(I.controller, g),
                    I.enabled && !I.state._active && (I.setStartState(g),
                    I.setPointerCapture(g),
                    I.shouldPreventWindowScrollY ? I.setUpWindowScrollDetection(g) : I.config.delay > 0 ? I.setUpDelayedDragTrigger(g) : I.startDrag(g, !0))
                }
                ,
                I.onDragChange = function(g) {
                    if (!I.state.canceled && I.state._active && I.isValidEvent(g) && (I.state._lastEventType !== g.type || g.timeStamp !== I.state.timeStamp)) {
                        var C;
                        if (document.pointerLockElement) {
                            var A = g.movementX
                              , e = g.movementY;
                            C = o(I.transform([A, e]), I.state.values)
                        } else
                            C = w(g, I.transform);
                        var i = I.getKinematics(C, g);
                        if (!I.state._dragStarted) {
                            if (I.state._dragDelayed)
                                return void I.startDrag(g);
                            if (!I.shouldPreventWindowScrollY)
                                return;
                            if (I.state._dragPreventScroll || !i.axis)
                                return;
                            if ("x" !== i.axis)
                                return void (I.state._active = !1);
                            I.startDrag(g)
                        }
                        var n = K(g);
                        I.updateSharedState(n);
                        var l = gg(u(I), g)
                          , c = t(i._movement)
                          , a = I.state._dragIsTap;
                        a && c >= 3 && (a = !1),
                        I.updateGestureState(b({}, l, i, {
                            _dragIsTap: a
                        })),
                        I.fireGestureHandler()
                    }
                }
                ,
                I.onDragEnd = function(g) {
                    if (eg(I.controller, g),
                    I.isValidEvent(g) && (I.clean(),
                    I.state._active)) {
                        I.state._active = !1;
                        var C = I.state._dragIsTap
                          , A = I.state.velocities
                          , e = A[0]
                          , o = A[1]
                          , i = I.state.movement
                          , t = i[0]
                          , n = i[1]
                          , l = I.state._intentional
                          , a = l[0]
                          , s = l[1]
                          , d = I.config.swipeVelocity
                          , G = d[0]
                          , r = d[1]
                          , B = I.config.swipeDistance
                          , Z = B[0]
                          , m = B[1]
                          , h = I.config.swipeDuration
                          , p = b({}, gg(u(I), g), I.getMovement(I.state.values))
                          , y = [0, 0];
                        p.elapsedTime < h && (!1 !== a && Math.abs(e) > G && Math.abs(t) > Z && (y[0] = c(e)),
                        !1 !== s && Math.abs(o) > r && Math.abs(n) > m && (y[1] = c(o))),
                        I.updateSharedState({
                            buttons: 0
                        }),
                        I.updateGestureState(b({}, p, {
                            tap: C,
                            swipe: y
                        })),
                        I.fireGestureHandler(I.config.filterTaps && !0 === C)
                    }
                }
                ,
                I.clean = function() {
                    g.prototype.clean.call(u(I)),
                    I.state._dragStarted = !1,
                    I.releasePointerCapture(),
                    og(I.controller, I.stateKey)
                }
                ,
                I.onCancel = function() {
                    I.state.canceled || (I.updateGestureState({
                        canceled: !0,
                        _active: !1
                    }),
                    I.updateSharedState({
                        buttons: 0
                    }),
                    setTimeout((function() {
                        return I.fireGestureHandler()
                    }
                    ), 0))
                }
                ,
                I.onClick = function(g) {
                    I.state._dragIsTap || g.stopPropagation()
                }
                ,
                I
            }
            G(I, g);
            var C = I.prototype;
            return C.startDrag = function(g, I) {
                void 0 === I && (I = !1),
                this.state._active && !this.state._dragStarted && (I || this.setStartState(g),
                this.updateGestureState({
                    _dragStarted: !0,
                    _dragPreventScroll: !0,
                    cancel: this.onCancel
                }),
                this.clearTimeout(),
                this.fireGestureHandler())
            }
            ,
            C.addBindings = function(g) {
                (this.config.useTouch ? (ag(g, "onTouchStart", this.onDragStart),
                ag(g, "onTouchMove", this.onDragChange),
                ag(g, "onTouchEnd", this.onDragEnd),
                ag(g, "onTouchCancel", this.onDragEnd)) : (ag(g, "onPointerDown", this.onDragStart),
                ag(g, "onPointerMove", this.onDragChange),
                ag(g, "onPointerUp", this.onDragEnd),
                ag(g, "onPointerCancel", this.onDragEnd)),
                this.config.filterTaps) && ag(g, this.controller.config.eventOptions.capture ? "onClick" : "onClickCapture", this.onClick)
            }
            ,
            I
        }(rg);
        function Zg(g, I) {
            var C, A, e = [], o = !1;
            return function() {
                for (var i = arguments.length, t = new Array(i), n = 0; n < i; n++)
                    t[n] = arguments[n];
                return o && C === this && I(t, e) || (A = g.apply(this, t),
                o = !0,
                C = this,
                e = t),
                A
            }
        }
        function mg(g, I) {
            try {
                return function g(I, C) {
                    if (I === C)
                        return !0;
                    if (I && C && "object" == typeof I && "object" == typeof C) {
                        if (I.constructor !== C.constructor)
                            return !1;
                        var A, e, o, i;
                        if (Array.isArray(I)) {
                            if ((A = I.length) !== C.length)
                                return !1;
                            for (e = A; 0 != e--; )
                                if (!g(I[e], C[e]))
                                    return !1;
                            return !0
                        }
                        if ("function" == typeof Map && I instanceof Map && C instanceof Map) {
                            if (I.size !== C.size)
                                return !1;
                            for (i = I.entries(); !(e = i.next()).done; )
                                if (!C.has(e.value[0]))
                                    return !1;
                            for (i = I.entries(); !(e = i.next()).done; )
                                if (!g(e.value[1], C.get(e.value[0])))
                                    return !1;
                            return !0
                        }
                        if ("function" == typeof Set && I instanceof Set && C instanceof Set) {
                            if (I.size !== C.size)
                                return !1;
                            for (i = I.entries(); !(e = i.next()).done; )
                                if (!C.has(e.value[0]))
                                    return !1;
                            return !0
                        }
                        if (I.constructor === RegExp)
                            return I.source === C.source && I.flags === C.flags;
                        if (I.valueOf !== Object.prototype.valueOf)
                            return I.valueOf() === C.valueOf();
                        if (I.toString !== Object.prototype.toString)
                            return I.toString() === C.toString();
                        if ((A = (o = Object.keys(I)).length) !== Object.keys(C).length)
                            return !1;
                        for (e = A; 0 != e--; )
                            if (!Object.prototype.hasOwnProperty.call(C, o[e]))
                                return !1;
                        if ("undefined" != typeof Element && I instanceof Element)
                            return !1;
                        for (e = A; 0 != e--; )
                            if (!("_owner" === o[e] && I.$$typeof || g(I[o[e]], C[o[e]])))
                                return !1;
                        return !0
                    }
                    return I != I && C != C
                }(g, I)
            } catch (g) {
                if ((g.message || "").match(/stack|recursion/i))
                    return console.warn("react-fast-compare cannot handle circular refs"),
                    !1;
                throw g
            }
        }
        function hg(g, I) {
            void 0 === I && (I = {}),
            E.set("drag", Bg);
            var C = Object(A.useRef)();
            return C.current || (C.current = Zg(D, mg)),
            bg({
                drag: g
            }, C.current(I))
        }
        var pg = function(g) {
            function I() {
                var I;
                return (I = g.apply(this, arguments) || this).ingKey = "pinching",
                I.stateKey = "pinch",
                I.onPinchStart = function(g) {
                    Ag(I.controller, g);
                    var C = I.controller.touchIds;
                    if (I.enabled && !(I.state._active && I.state._pointerIds.every((function(g) {
                        return C.has(g)
                    }
                    )) || C.size < 2)) {
                        var A = Array.from(C).slice(0, 2)
                          , e = H(g, A, I.transform)
                          , o = e.values
                          , i = e.origin;
                        I.updateSharedState(K(g)),
                        I.updateGestureState(b({}, Ig(u(I), o, g), gg(u(I), g, !0), {
                            _pointerIds: A,
                            cancel: I.onCancel,
                            origin: i
                        })),
                        I.updateGestureState(I.getMovement(o)),
                        I.fireGestureHandler()
                    }
                }
                ,
                I.onPinchChange = function(g) {
                    var C = I.state
                      , A = C.canceled
                      , e = C._active;
                    if (!A && e && g.timeStamp !== I.state.timeStamp) {
                        var o = K(g);
                        I.updateSharedState(o);
                        try {
                            var i = H(g, I.state._pointerIds, I.transform)
                              , t = i.values
                              , n = i.origin
                              , l = I.getKinematics(t, g);
                            I.updateGestureState(b({}, gg(u(I), g), l, {
                                origin: n
                            })),
                            I.fireGestureHandler()
                        } catch (C) {
                            I.onPinchEnd(g)
                        }
                    }
                }
                ,
                I.onPinchEnd = function(g) {
                    eg(I.controller, g);
                    var C = Y(g);
                    I.state._pointerIds.every((function(g) {
                        return !C.includes(g)
                    }
                    )) || (I.clean(),
                    I.state._active && (I.updateGestureState(b({}, gg(u(I), g), I.getMovement(I.state.values), {
                        _active: !1
                    })),
                    I.fireGestureHandler()))
                }
                ,
                I.onCancel = function() {
                    I.state.canceled || (I.updateGestureState({
                        _active: !1,
                        canceled: !0
                    }),
                    setTimeout((function() {
                        return I.fireGestureHandler()
                    }
                    ), 0))
                }
                ,
                I.onGestureStart = function(g) {
                    if (I.enabled) {
                        g.preventDefault();
                        var C = S(g, I.transform);
                        I.updateSharedState(K(g)),
                        I.updateGestureState(b({}, Ig(u(I), C, g), gg(u(I), g, !0), {
                            origin: [g.clientX, g.clientY],
                            cancel: I.onCancel
                        })),
                        I.updateGestureState(I.getMovement(C)),
                        I.fireGestureHandler()
                    }
                }
                ,
                I.onGestureChange = function(g) {
                    var C = I.state
                      , A = C.canceled
                      , e = C._active;
                    if (!A && e) {
                        g.preventDefault();
                        var o = K(g);
                        I.updateSharedState(o);
                        var i = S(g, I.transform);
                        i[0] = 260 * (i[0] - I.state.event.scale) + I.state.values[0];
                        var t = I.getKinematics(i, g);
                        I.updateGestureState(b({}, gg(u(I), g), t, {
                            origin: [g.clientX, g.clientY]
                        })),
                        I.fireGestureHandler()
                    }
                }
                ,
                I.onGestureEnd = function(g) {
                    I.clean(),
                    I.state._active && (I.updateGestureState(b({}, gg(u(I), g), I.getMovement(I.state.values), {
                        _active: !1,
                        origin: [g.clientX, g.clientY]
                    })),
                    I.fireGestureHandler())
                }
                ,
                I.wheelShouldRun = function(g) {
                    return I.enabled && g.ctrlKey
                }
                ,
                I.getWheelValuesFromEvent = function(g) {
                    var C = N(g, I.transform)[1]
                      , A = I.state.values
                      , e = A[0]
                      , o = A[1]
                      , i = 7 * -C
                      , t = void 0 !== o ? o : 0;
                    return {
                        values: [e + i, t],
                        origin: [g.clientX, g.clientY],
                        delta: [i, t]
                    }
                }
                ,
                I.onWheel = function(g) {
                    I.wheelShouldRun(g) && (I.setTimeout(I.onWheelEnd),
                    I.state._active ? I.onWheelChange(g) : I.onWheelStart(g))
                }
                ,
                I.onWheelStart = function(g) {
                    var C = I.getWheelValuesFromEvent(g)
                      , A = C.values
                      , e = C.delta
                      , o = C.origin;
                    g.cancelable && g.preventDefault(),
                    I.updateSharedState(K(g)),
                    I.updateGestureState(b({}, Ig(u(I), A, g, I.state.values), gg(u(I), g, !0), {
                        offset: A,
                        delta: e,
                        origin: o
                    })),
                    I.updateGestureState(I.getMovement(A)),
                    I.fireGestureHandler()
                }
                ,
                I.onWheelChange = function(g) {
                    g.cancelable && g.preventDefault(),
                    I.updateSharedState(K(g));
                    var C = I.getWheelValuesFromEvent(g)
                      , A = C.values
                      , e = C.origin
                      , o = C.delta;
                    I.updateGestureState(b({}, gg(u(I), g), I.getKinematics(A, g), {
                        origin: e,
                        delta: o
                    })),
                    I.fireGestureHandler()
                }
                ,
                I.onWheelEnd = function() {
                    I.clean(),
                    I.state._active && (I.state._active = !1,
                    I.updateGestureState(I.getMovement(I.state.values)),
                    I.fireGestureHandler())
                }
                ,
                I
            }
            return G(I, g),
            I.prototype.addBindings = function(g) {
                this.controller.config.domTarget && !this.controller.supportsTouchEvents && this.controller.supportsGestureEvents ? (ag(g, "onGestureStart", this.onGestureStart),
                ag(g, "onGestureChange", this.onGestureChange),
                ag(g, "onGestureEnd", this.onGestureEnd)) : (ag(g, "onTouchStart", this.onPinchStart),
                ag(g, "onTouchMove", this.onPinchChange),
                ag(g, "onTouchEnd", this.onPinchEnd),
                ag(g, "onTouchCancel", this.onPinchEnd),
                ag(g, "onWheel", this.onWheel))
            }
            ,
            I
        }(function(g) {
            function I() {
                return g.apply(this, arguments) || this
            }
            G(I, g);
            var C = I.prototype;
            return C.getInternalMovement = function(g, I) {
                var C = I.values[1]
                  , A = g[0]
                  , e = g[1]
                  , o = void 0 === e ? C : e
                  , t = o - C
                  , n = I.turns;
                return Math.abs(t) > 270 && (n += c(t)),
                i([A, o - 360 * n], I.initial)
            }
            ,
            C.getKinematics = function(g, I) {
                var C = this.getMovement(g)
                  , A = (g[1] - C._movement[1] - this.state.initial[1]) / 360
                  , e = I.timeStamp - this.state.timeStamp;
                return b({
                    turns: A
                }, C, r(l(C.movement, C.delta, e), ["distance", "velocity"]))
            }
            ,
            C.mapStateValues = function(g) {
                return {
                    da: g.values,
                    vdva: g.velocities
                }
            }
            ,
            I
        }(q));
        var yg = function(g) {
            function I() {
                var I;
                return (I = g.apply(this, arguments) || this).ingKey = "wheeling",
                I.stateKey = "wheel",
                I.debounced = !0,
                I.handleEvent = function(g) {
                    if ((!g.ctrlKey || !("pinch"in I.controller.handlers)) && I.enabled) {
                        I.setTimeout(I.onEnd),
                        I.updateSharedState(K(g));
                        var C = o(N(g, I.transform), I.state.values);
                        if (I.state._active)
                            I.updateGestureState(b({}, gg(u(I), g), I.getKinematics(C, g)));
                        else {
                            I.updateGestureState(b({}, Ig(u(I), C, g, I.state.values), gg(u(I), g, !0)));
                            var A = I.getMovement(C)
                              , e = n(A.delta);
                            I.updateGestureState(A),
                            I.updateGestureState(e)
                        }
                        I.fireGestureHandler()
                    }
                }
                ,
                I.onEnd = function() {
                    if (I.clean(),
                    I.state._active) {
                        var g = I.getMovement(I.state.values);
                        I.updateGestureState(g),
                        I.updateGestureState({
                            _active: !1,
                            velocities: [0, 0],
                            velocity: 0
                        }),
                        I.fireGestureHandler()
                    }
                }
                ,
                I
            }
            return G(I, g),
            I.prototype.addBindings = function(g) {
                ag(g, "onWheel", this.handleEvent)
            }
            ,
            I
        }(rg);
        var Wg = function(g) {
            function I() {
                var I;
                return (I = g.apply(this, arguments) || this).ingKey = "moving",
                I.stateKey = "move",
                I.debounced = !0,
                I.onMove = function(g) {
                    I.enabled && (I.setTimeout(I.onMoveEnd),
                    I.state._active ? I.onMoveChange(g) : I.onMoveStart(g))
                }
                ,
                I.onMoveStart = function(g) {
                    I.updateSharedState(K(g));
                    var C = w(g, I.transform);
                    I.updateGestureState(b({}, Ig(u(I), C, g), gg(u(I), g, !0))),
                    I.updateGestureState(I.getMovement(C)),
                    I.fireGestureHandler()
                }
                ,
                I.onMoveChange = function(g) {
                    I.updateSharedState(K(g));
                    var C = w(g, I.transform);
                    I.updateGestureState(b({}, gg(u(I), g), I.getKinematics(C, g))),
                    I.fireGestureHandler()
                }
                ,
                I.onMoveEnd = function() {
                    if (I.clean(),
                    I.state._active) {
                        var g = I.state.values;
                        I.updateGestureState(I.getMovement(g)),
                        I.updateGestureState({
                            velocities: [0, 0],
                            velocity: 0,
                            _active: !1
                        }),
                        I.fireGestureHandler()
                    }
                }
                ,
                I.hoverTransform = function() {
                    return I.controller.config.hover.transform || I.controller.config.transform
                }
                ,
                I.onPointerEnter = function(g) {
                    if (I.controller.state.shared.hovering = !0,
                    I.controller.config.enabled) {
                        if (I.controller.config.hover.enabled) {
                            var C = w(g, I.hoverTransform())
                              , A = b({}, I.controller.state.shared, I.state, gg(u(I), g, !0), {
                                args: I.args,
                                values: C,
                                active: !0,
                                hovering: !0
                            });
                            I.controller.handlers.hover(b({}, A, I.mapStateValues(A)))
                        }
                        "move"in I.controller.handlers && I.onMoveStart(g)
                    }
                }
                ,
                I.onPointerLeave = function(g) {
                    if (I.controller.state.shared.hovering = !1,
                    "move"in I.controller.handlers && I.onMoveEnd(),
                    I.controller.config.hover.enabled) {
                        var C = w(g, I.hoverTransform())
                          , A = b({}, I.controller.state.shared, I.state, gg(u(I), g), {
                            args: I.args,
                            values: C,
                            active: !1
                        });
                        I.controller.handlers.hover(b({}, A, I.mapStateValues(A)))
                    }
                }
                ,
                I
            }
            return G(I, g),
            I.prototype.addBindings = function(g) {
                "move"in this.controller.handlers && ag(g, "onPointerMove", this.onMove),
                "hover"in this.controller.handlers && (ag(g, "onPointerEnter", this.onPointerEnter),
                ag(g, "onPointerLeave", this.onPointerLeave))
            }
            ,
            I
        }(rg);
        var vg = function(g) {
            function I() {
                var I;
                return (I = g.apply(this, arguments) || this).ingKey = "scrolling",
                I.stateKey = "scroll",
                I.debounced = !0,
                I.handleEvent = function(g) {
                    if (I.enabled) {
                        I.clearTimeout(),
                        I.setTimeout(I.onEnd);
                        var C = F(g, I.transform);
                        if (I.updateSharedState(K(g)),
                        I.state._active)
                            I.updateGestureState(b({}, gg(u(I), g), I.getKinematics(C, g)));
                        else {
                            I.updateGestureState(b({}, Ig(u(I), C, g, I.state.values), gg(u(I), g, !0)));
                            var A = I.getMovement(C)
                              , e = n(A.delta);
                            I.updateGestureState(A),
                            I.updateGestureState(e)
                        }
                        I.fireGestureHandler()
                    }
                }
                ,
                I.onEnd = function() {
                    I.clean(),
                    I.state._active && (I.updateGestureState(b({}, I.getMovement(I.state.values), {
                        _active: !1,
                        velocities: [0, 0],
                        velocity: 0
                    })),
                    I.fireGestureHandler())
                }
                ,
                I
            }
            return G(I, g),
            I.prototype.addBindings = function(g) {
                ag(g, "onScroll", this.handleEvent)
            }
            ,
            I
        }(rg);
        var Vg = /^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;
        function Xg(g, I) {
            void 0 === I && (I = {});
            var C = function(g) {
                var I = {}
                  , C = {}
                  , A = new Set;
                for (var e in g)
                    Vg.test(e) ? (A.add(RegExp.lastMatch),
                    C[e] = g[e]) : I[e] = g[e];
                return [C, I, A]
            }(g)
              , A = C[0]
              , e = C[1]
              , o = C[2];
            E.set("drag", Bg),
            E.set("hover", Wg),
            E.set("move", Wg),
            E.set("pinch", pg),
            E.set("scroll", vg),
            E.set("wheel", yg);
            var i = function(g, I) {
                void 0 === g && (g = {}),
                void 0 === I && (I = new Set);
                var C = g
                  , A = C.drag
                  , e = C.wheel
                  , o = C.move
                  , i = C.scroll
                  , t = C.pinch
                  , n = C.hover
                  , l = C.eventOptions
                  , c = C.window
                  , a = C.transform
                  , s = M({
                    domTarget: C.domTarget,
                    eventOptions: l,
                    transform: a,
                    window: c,
                    enabled: C.enabled
                });
                return I.has("onDrag") && (s.drag = U(A)),
                I.has("onWheel") && (s.wheel = Q(e)),
                I.has("onScroll") && (s.scroll = Q(i)),
                I.has("onMove") && (s.move = Q(o)),
                I.has("onPinch") && (s.pinch = j(t)),
                I.has("onHover") && (s.hover = b({
                    enabled: !0
                }, n)),
                s
            }(I, o)
              , t = {};
            return o.has("onDrag") && (t.drag = Yg(A, "onDrag")),
            o.has("onWheel") && (t.wheel = Yg(A, "onWheel")),
            o.has("onScroll") && (t.scroll = Yg(A, "onScroll")),
            o.has("onMove") && (t.move = Yg(A, "onMove")),
            o.has("onPinch") && (t.pinch = Yg(A, "onPinch")),
            o.has("onHover") && (t.hover = A.onHover),
            bg(t, i, e)
        }
        function Yg(g, I) {
            var C = I + "Start"
              , A = I + "End";
            return function(e) {
                var o = void 0;
                return e.first && C in g && g[C](e),
                I in g && (o = g[I](e)),
                e.last && A in g && g[A](e),
                o
            }
        }
    },
    702: function(g, I, C) {
        (function() {
            (null !== I ? I : this).Lethargy = function() {
                function g(g, I, C, A) {
                    this.stability = null != g ? Math.abs(g) : 8,
                    this.sensitivity = null != I ? 1 + Math.abs(I) : 100,
                    this.tolerance = null != C ? 1 + Math.abs(C) : 1.1,
                    this.delay = null != A ? A : 150,
                    this.lastUpDeltas = function() {
                        var g, I, C;
                        for (C = [],
                        g = 1,
                        I = 2 * this.stability; 1 <= I ? g <= I : g >= I; 1 <= I ? g++ : g--)
                            C.push(null);
                        return C
                    }
                    .call(this),
                    this.lastDownDeltas = function() {
                        var g, I, C;
                        for (C = [],
                        g = 1,
                        I = 2 * this.stability; 1 <= I ? g <= I : g >= I; 1 <= I ? g++ : g--)
                            C.push(null);
                        return C
                    }
                    .call(this),
                    this.deltasTimestamp = function() {
                        var g, I, C;
                        for (C = [],
                        g = 1,
                        I = 2 * this.stability; 1 <= I ? g <= I : g >= I; 1 <= I ? g++ : g--)
                            C.push(null);
                        return C
                    }
                    .call(this)
                }
                return g.prototype.check = function(g) {
                    var I;
                    return null != (g = g.originalEvent || g).wheelDelta ? I = g.wheelDelta : null != g.deltaY ? I = -40 * g.deltaY : null == g.detail && 0 !== g.detail || (I = -40 * g.detail),
                    this.deltasTimestamp.push(Date.now()),
                    this.deltasTimestamp.shift(),
                    I > 0 ? (this.lastUpDeltas.push(I),
                    this.lastUpDeltas.shift(),
                    this.isInertia(1)) : (this.lastDownDeltas.push(I),
                    this.lastDownDeltas.shift(),
                    this.isInertia(-1))
                }
                ,
                g.prototype.isInertia = function(g) {
                    var I, C, A, e, o, i, t;
                    return null === (I = -1 === g ? this.lastDownDeltas : this.lastUpDeltas)[0] ? g : !(this.deltasTimestamp[2 * this.stability - 2] + this.delay > Date.now() && I[0] === I[2 * this.stability - 1]) && (A = I.slice(0, this.stability),
                    C = I.slice(this.stability, 2 * this.stability),
                    t = A.reduce((function(g, I) {
                        return g + I
                    }
                    )),
                    o = C.reduce((function(g, I) {
                        return g + I
                    }
                    )),
                    i = t / A.length,
                    e = o / C.length,
                    Math.abs(i) < Math.abs(e * this.tolerance) && this.sensitivity < Math.abs(e) && g)
                }
                ,
                g.prototype.showLastUpDeltas = function() {
                    return this.lastUpDeltas
                }
                ,
                g.prototype.showLastDownDeltas = function() {
                    return this.lastDownDeltas
                }
                ,
                g
            }()
        }
        ).call(this)
    },
    737: function(g, I) {
        g.exports = function(g) {
            if (null == g)
                throw new TypeError("Cannot destructure " + g)
        }
        ,
        g.exports.__esModule = !0,
        g.exports.default = g.exports
    },
    771: function(g, I, C) {
        g.exports = function(g, I) {
            "use strict";
            function C(g) {
                if (g && g.__esModule)
                    return g;
                var I = Object.create(null);
                return g && Object.keys(g).forEach((function(C) {
                    if ("default" !== C) {
                        var A = Object.getOwnPropertyDescriptor(g, C);
                        Object.defineProperty(I, C, A.get ? A : {
                            enumerable: !0,
                            get: function() {
                                return g[C]
                            }
                        })
                    }
                }
                )),
                I.default = g,
                Object.freeze(I)
            }
            var A, e = C(g), o = {
                React: void 0,
                options: void 0,
                origCreateElement: void 0,
                origCreateFactory: void 0,
                origCloneElement: void 0,
                componentsMap: new WeakMap,
                ownerDataMap: new WeakMap,
                hooksPerRender: []
            };
            function i(g, I) {
                var C = Object.keys(g);
                if (Object.getOwnPropertySymbols) {
                    var A = Object.getOwnPropertySymbols(g);
                    I && (A = A.filter((function(I) {
                        return Object.getOwnPropertyDescriptor(g, I).enumerable
                    }
                    ))),
                    C.push.apply(C, A)
                }
                return C
            }
            function t(g) {
                for (var I = 1; I < arguments.length; I++) {
                    var C = null != arguments[I] ? arguments[I] : {};
                    I % 2 ? i(Object(C), !0).forEach((function(I) {
                        c(g, I, C[I])
                    }
                    )) : Object.getOwnPropertyDescriptors ? Object.defineProperties(g, Object.getOwnPropertyDescriptors(C)) : i(Object(C)).forEach((function(I) {
                        Object.defineProperty(g, I, Object.getOwnPropertyDescriptor(C, I))
                    }
                    ))
                }
                return g
            }
            function n(g) {
                return (n = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(g) {
                    return typeof g
                }
                : function(g) {
                    return g && "function" == typeof Symbol && g.constructor === Symbol && g !== Symbol.prototype ? "symbol" : typeof g
                }
                )(g)
            }
            function l(g, I) {
                for (var C = 0; C < I.length; C++) {
                    var A = I[C];
                    A.enumerable = A.enumerable || !1,
                    A.configurable = !0,
                    "value"in A && (A.writable = !0),
                    Object.defineProperty(g, A.key, A)
                }
            }
            function c(g, I, C) {
                return I in g ? Object.defineProperty(g, I, {
                    value: C,
                    enumerable: !0,
                    configurable: !0,
                    writable: !0
                }) : g[I] = C,
                g
            }
            function a(g) {
                return (a = Object.setPrototypeOf ? Object.getPrototypeOf : function(g) {
                    return g.__proto__ || Object.getPrototypeOf(g)
                }
                )(g)
            }
            function s(g, I) {
                return (s = Object.setPrototypeOf || function(g, I) {
                    return g.__proto__ = I,
                    g
                }
                )(g, I)
            }
            function d(g) {
                if (void 0 === g)
                    throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return g
            }
            function b(g, I) {
                if (I && ("object" == typeof I || "function" == typeof I))
                    return I;
                if (void 0 !== I)
                    throw new TypeError("Derived constructors may only return object or undefined");
                return d(g)
            }
            function G(g) {
                var I = function() {
                    if ("undefined" == typeof Reflect || !Reflect.construct)
                        return !1;
                    if (Reflect.construct.sham)
                        return !1;
                    if ("function" == typeof Proxy)
                        return !0;
                    try {
                        return Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], (function() {}
                        ))),
                        !0
                    } catch (g) {
                        return !1
                    }
                }();
                return function() {
                    var C, A = a(g);
                    if (I) {
                        var e = a(this).constructor;
                        C = Reflect.construct(A, arguments, e)
                    } else
                        C = A.apply(this, arguments);
                    return b(this, C)
                }
            }
            function r(g, I) {
                for (; !Object.prototype.hasOwnProperty.call(g, I) && null !== (g = a(g)); )
                    ;
                return g
            }
            function u() {
                return (u = "undefined" != typeof Reflect && Reflect.get ? Reflect.get : function(g, I, C) {
                    var A = r(g, I);
                    if (A) {
                        var e = Object.getOwnPropertyDescriptor(A, I);
                        return e.get ? e.get.call(arguments.length < 3 ? g : C) : e.value
                    }
                }
                ).apply(this, arguments)
            }
            function B(g, I) {
                return function(g) {
                    if (Array.isArray(g))
                        return g
                }(g) || function(g, I) {
                    var C = null == g ? null : "undefined" != typeof Symbol && g[Symbol.iterator] || g["@@iterator"];
                    if (null != C) {
                        var A, e, o = [], i = !0, t = !1;
                        try {
                            for (C = C.call(g); !(i = (A = C.next()).done) && (o.push(A.value),
                            !I || o.length !== I); i = !0)
                                ;
                        } catch (g) {
                            t = !0,
                            e = g
                        } finally {
                            try {
                                i || null == C.return || C.return()
                            } finally {
                                if (t)
                                    throw e
                            }
                        }
                        return o
                    }
                }(g, I) || m(g, I) || function() {
                    throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")
                }()
            }
            function Z(g) {
                return function(g) {
                    if (Array.isArray(g))
                        return h(g)
                }(g) || function(g) {
                    if ("undefined" != typeof Symbol && null != g[Symbol.iterator] || null != g["@@iterator"])
                        return Array.from(g)
                }(g) || m(g) || function() {
                    throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")
                }()
            }
            function m(g, I) {
                if (g) {
                    if ("string" == typeof g)
                        return h(g, I);
                    var C = Object.prototype.toString.call(g).slice(8, -1);
                    return "Object" === C && g.constructor && (C = g.constructor.name),
                    "Map" === C || "Set" === C ? Array.from(g) : "Arguments" === C || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(C) ? h(g, I) : void 0
                }
            }
            function h(g, I) {
                (null == I || I > g.length) && (I = g.length);
                for (var C = 0, A = new Array(I); C < I; C++)
                    A[C] = g[C];
                return A
            }
            function p(g, I) {
                var C = "undefined" != typeof Symbol && g[Symbol.iterator] || g["@@iterator"];
                if (!C) {
                    if (Array.isArray(g) || (C = m(g)) || I && g && "number" == typeof g.length) {
                        C && (g = C);
                        var A = 0
                          , e = function() {};
                        return {
                            s: e,
                            n: function() {
                                return A >= g.length ? {
                                    done: !0
                                } : {
                                    done: !1,
                                    value: g[A++]
                                }
                            },
                            e: function(g) {
                                throw g
                            },
                            f: e
                        }
                    }
                    throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")
                }
                var o, i = !0, t = !1;
                return {
                    s: function() {
                        C = C.call(g)
                    },
                    n: function() {
                        var g = C.next();
                        return i = g.done,
                        g
                    },
                    e: function(g) {
                        t = !0,
                        o = g
                    },
                    f: function() {
                        try {
                            i || null == C.return || C.return()
                        } finally {
                            if (t)
                                throw o
                        }
                    }
                }
            }
            var y = "different"
              , W = "deepEquals"
              , v = "date"
              , V = "regex"
              , X = "reactElement"
              , Y = "function"
              , K = "same"
              , R = (c(A = {}, y, "different objects"),
            c(A, W, "different objects that are equal by value"),
            c(A, v, "different date objects with the same value"),
            c(A, V, "different regular expressions with the same value"),
            c(A, X, "different React elements (remember that the <jsx/> syntax always produces a *NEW* immutable React element so a component that receives <jsx/> as props always re-renders)"),
            c(A, Y, "different functions with the same name"),
            c(A, K, "same objects by ref (===)"),
            A)
              , w = "function" == typeof Symbol && Symbol.for
              , H = w ? Symbol.for("react.memo") : 60115
              , F = w ? Symbol.for("react.forward_ref") : 60112
              , N = "undefined" != typeof Element
              , S = "function" == typeof Symbol && Symbol.for ? Symbol.for("react.element") : 60103
              , z = function(g) {
                return g.$$typeof === S
            };
            function f(g, I, C, A, e) {
                return C.push({
                    diffType: e,
                    pathString: A,
                    prevValue: g,
                    nextValue: I
                }),
                e !== y
            }
            function k(g, I) {
                return !!Object.getOwnPropertyDescriptor(g, I).get
            }
            var J = new WeakMap;
            function L(g, C, A) {
                var e = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : ""
                  , o = arguments.length > 4 ? arguments[4] : void 0
                  , i = o.detailed;
                if (g === C)
                    return i && f(g, C, A, e, K),
                    !0;
                if (!g || !C)
                    return f(g, C, A, e, y);
                if (I.isArray(g) && I.isArray(C)) {
                    var l = g.length;
                    if (l !== C.length)
                        return f(Z(g), Z(C), A, e, y);
                    for (var c = [], a = 0, s = l; s--; s > 0) {
                        var d = L(g[s], C[s], c, "".concat(e, "[").concat(s, "]"), {
                            detailed: i
                        });
                        d && a++
                    }
                    return (i || a !== l) && A.push.apply(A, c),
                    f(Z(g), Z(C), A, e, a === l ? W : y)
                }
                if (I.isSet(g) && I.isSet(C)) {
                    if (g.size !== C.size)
                        return f(new Set(g), new Set(C), A, e, y);
                    var b, G = p(g);
                    try {
                        for (G.s(); !(b = G.n()).done; ) {
                            var r = b.value;
                            if (!C.has(r))
                                return f(new Set(g), new Set(C), A, e, y)
                        }
                    } catch (g) {
                        G.e(g)
                    } finally {
                        G.f()
                    }
                    return f(new Set(g), new Set(C), A, e, W)
                }
                if (I.isDate(g) && I.isDate(C))
                    return g.getTime() === C.getTime() ? f(new Date(g), new Date(C), A, e, v) : f(new Date(g), new Date(C), A, e, y);
                if (I.isRegExp(g) && I.isRegExp(C))
                    return g.toString() === C.toString() ? f(g, C, A, e, V) : f(g, C, A, e, y);
                if (N && g instanceof Element && C instanceof Element)
                    return f(g, C, A, e, y);
                if (z(g) && z(C)) {
                    if (g.type !== C.type)
                        return f(g, C, A, e, y);
                    var u = L(g.props, C.props, [], "".concat(e, ".props"), {
                        detailed: i
                    });
                    return f(g, C, A, e, u ? X : y)
                }
                if (I.isFunction(g) && I.isFunction(C)) {
                    if (g.name !== C.name)
                        return f(g, C, A, e, y);
                    var B = J.get(g)
                      , m = J.get(C);
                    if (B && m) {
                        var h = L(B.deps, m.deps, A, "".concat(e, ":parent-hook-").concat(B.hookName, "-deps"), {
                            detailed: i
                        });
                        return f(g, C, A, e, h ? Y : y)
                    }
                    return f(g, C, A, e, Y)
                }
                if ("object" === n(g) && "object" === n(C) && Object.getPrototypeOf(g) === Object.getPrototypeOf(C)) {
                    var R = Object.getOwnPropertyNames(g)
                      , w = Object.getOwnPropertyNames(C)
                      , H = I.uniq([].concat(Z(R), Z(w)))
                      , F = I.isPlainObject(g) ? t({}, g) : g
                      , S = I.isPlainObject(C) ? t({}, C) : C;
                    if (H.length !== R.length || H.length !== w.length)
                        return f(F, S, A, e, y);
                    for (var x = H.filter((function(C) {
                        return !("stack" === C && I.isError(g) || k(g, C))
                    }
                    )), M = x.length, Q = M; Q--; Q > 0)
                        if (!I.has(C, x[Q]))
                            return f(F, S, A, e, y);
                    for (var j = [], U = 0, D = M; D--; D > 0) {
                        var T = x[D]
                          , O = L(g[T], C[T], j, "".concat(e, ".").concat(T), {
                            detailed: i
                        });
                        O && U++
                    }
                    return (i || U !== M) && A.push.apply(A, j),
                    f(F, S, A, e, U === M ? W : y)
                }
                return f(g, C, A, e, y)
            }
            function x(g, I, C) {
                var A = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : {}
                  , e = A.detailed
                  , o = void 0 !== e && e;
                try {
                    var i = [];
                    return L(g, I, i, C, {
                        detailed: o
                    }),
                    i
                } catch (g) {
                    if (g.message && g.message.match(/stack|recursion/i) || -2146828260 === g.number)
                        return console.warn("Warning: why-did-you-render couldn't handle circular references in props.", g.name, g.message),
                        !1;
                    throw g
                }
            }
            function M(g) {
                var C = g.Component
                  , A = g.displayName
                  , e = g.hookName
                  , i = g.prefixMessage
                  , t = g.diffObjType
                  , n = g.differences
                  , l = g.values;
                n && n.length > 0 ? (o.options.consoleLog(c({}, A, C), "".concat(i, " of ").concat(t, " changes:")),
                n.forEach((function(g) {
                    var C = g.pathString
                      , A = g.diffType
                      , i = g.prevValue
                      , n = g.nextValue;
                    o.options.consoleGroup("%c".concat("hook" === t ? "[hook ".concat(e, " result]") : "".concat(t, "."), "%c").concat(C, "%c"), "color:".concat(o.options.diffNameColor, ";"), "color:".concat(o.options.diffPathColor, ";"), "color:default;"),
                    o.options.consoleLog("".concat(R[A], ". (more info at ").concat(e ? "http://bit.ly/wdyr3" : "http://bit.ly/wdyr02", ")")),
                    o.options.consoleLog(c({}, "prev ".concat(C), i), "!==", c({}, "next ".concat(C), n)),
                    A === W && o.options.consoleLog({
                        "For detailed diff, right click the following fn, save as global, and run: ": function() {
                            !function(g, C, A) {
                                var e = A.pathString
                                  , o = A.consoleLog
                                  , i = x(g, C, e, {
                                    detailed: !0
                                })
                                  , t = Math.max.apply(Math, Z(i.map((function(g) {
                                    return g.pathString.length
                                }
                                )))) + 2;
                                Object.entries(I.groupBy(I.sortBy(i, "pathString"), "diffType")).forEach((function(g) {
                                    var I = B(g, 2)
                                      , C = I[0]
                                      , A = I[1];
                                    o("%c".concat(R[C], ":"), "text-decoration: underline; color: blue;"),
                                    A.forEach((function(g) {
                                        o("".concat(g.pathString, ":").padEnd(t, " "), g.prevValue)
                                    }
                                    ))
                                }
                                ))
                            }(i, n, {
                                pathString: C,
                                consoleLog: o.options.consoleLog
                            })
                        }
                    }),
                    o.options.consoleGroupEnd()
                }
                ))) : n && (o.options.consoleLog(c({}, A, C), "".concat(i, " the ").concat(t, " object itself changed but its values are all equal."), "props" === t ? "This could have been avoided by making the component pure, or by preventing its father from re-rendering." : "This usually means this component called setState when no changes in its state actually occurred.", "More info at ".concat("http://bit.ly/wdyr02")),
                o.options.consoleLog("prev ".concat(t, ":"), l.prev, " !== ", l.next, ":next ".concat(t)))
            }
            function Q(g) {
                var I = g.Component
                  , C = g.displayName
                  , A = g.hookName
                  , e = g.prevProps
                  , i = g.prevState
                  , t = g.prevHook
                  , n = g.nextProps
                  , l = g.nextState
                  , a = g.nextHook
                  , s = g.reason;
                if (function(g, I) {
                    return !!o.options.logOnDifferentValues || !(!I.whyDidYouRender || !I.whyDidYouRender.logOnDifferentValues) || !(g.propsDifferences && g.propsDifferences.some((function(g) {
                        return g.diffType === y
                    }
                    )) || g.stateDifferences && g.stateDifferences.some((function(g) {
                        return g.diffType === y
                    }
                    )) || g.hookDifferences && g.hookDifferences.some((function(g) {
                        return g.diffType === y
                    }
                    )))
                }(s, I, o.options)) {
                    o.options.consoleGroup("%c".concat(C), "color: ".concat(o.options.titleColor, ";"));
                    var d = "Re-rendered because";
                    if (s.propsDifferences && (M({
                        Component: I,
                        displayName: C,
                        prefixMessage: d,
                        diffObjType: "props",
                        differences: s.propsDifferences,
                        values: {
                            prev: e,
                            next: n
                        }
                    }),
                    d = "And because"),
                    s.stateDifferences && M({
                        Component: I,
                        displayName: C,
                        prefixMessage: d,
                        diffObjType: "state",
                        differences: s.stateDifferences,
                        values: {
                            prev: i,
                            next: l
                        }
                    }),
                    s.hookDifferences && M({
                        Component: I,
                        displayName: C,
                        prefixMessage: d,
                        diffObjType: "hook",
                        differences: s.hookDifferences,
                        values: {
                            prev: t,
                            next: a
                        },
                        hookName: A
                    }),
                    s.propsDifferences && s.ownerDifferences) {
                        var b = o.ownerDataMap.get(e)
                          , G = o.ownerDataMap.get(n);
                        o.options.consoleGroup("Rendered by ".concat(G.displayName));
                        var r = "Re-rendered because";
                        s.ownerDifferences.propsDifferences && (M({
                            Component: G.Component,
                            displayName: G.displayName,
                            prefixMessage: r,
                            diffObjType: "props",
                            differences: s.ownerDifferences.propsDifferences,
                            values: {
                                prev: b.props,
                                next: G.props
                            }
                        }),
                        r = "And because"),
                        s.ownerDifferences.stateDifferences && M({
                            Component: G.Component,
                            displayName: G.displayName,
                            prefixMessage: r,
                            diffObjType: "state",
                            differences: s.ownerDifferences.stateDifferences,
                            values: {
                                prev: b.state,
                                next: G.state
                            }
                        }),
                        s.ownerDifferences.hookDifferences && s.ownerDifferences.hookDifferences.forEach((function(g, I) {
                            var C = g.hookName
                              , A = g.differences;
                            return M({
                                Component: G.Component,
                                displayName: G.displayName,
                                prefixMessage: r,
                                diffObjType: "hook",
                                differences: A,
                                values: {
                                    prev: b.hooks[I].result,
                                    next: G.hooks[I].result
                                },
                                hookName: C
                            })
                        }
                        )),
                        o.options.consoleGroupEnd()
                    }
                    s.propsDifferences || s.stateDifferences || s.hookDifferences || o.options.consoleLog(c({}, C, I), "Re-rendered although props and state objects are the same.", "This usually means there was a call to this.forceUpdate() inside the component.", "more info at ".concat("http://bit.ly/wdyr02")),
                    o.options.consoleGroupEnd()
                }
            }
            function j(g) {
                return Q
            }
            var U = function() {};
            function D() {
                var g = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}
                  , I = console.group
                  , C = console.groupEnd;
                g.collapseGroups ? I = console.groupCollapsed : g.onlyLogs && (I = console.log,
                C = U);
                var A = g.notifier || j("hotReloadBufferMs"in g && g.hotReloadBufferMs);
                return t({
                    include: null,
                    exclude: null,
                    notifier: A,
                    onlyLogs: !1,
                    consoleLog: console.log,
                    consoleGroup: I,
                    consoleGroupEnd: C,
                    logOnDifferentValues: !1,
                    logOwnerReasons: !0,
                    trackHooks: !0,
                    titleColor: "#058",
                    diffNameColor: "blue",
                    diffPathColor: "red",
                    trackExtraHooks: [],
                    trackAllPureComponents: !1
                }, g)
            }
            function T(g) {
                return g.displayName || g.name || g.type && T(g.type) || g.render && T(g.render) || (I.isString(g) ? g : "Unknown")
            }
            var O = {};
            function E(g, C) {
                var A = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {}
                  , e = A.shallow
                  , o = void 0 === e || e;
                if (g === C)
                    return !1;
                if (!o)
                    return x(g, C);
                var i = g || O
                  , n = C || O
                  , l = Object.keys(t(t({}, i), n));
                return I.reduce(l, (function(g, I) {
                    var C = x(i[I], n[I], I);
                    return C && (g = [].concat(Z(g), Z(C))),
                    g
                }
                ), [])
            }
            function P(g) {
                var I = g.prevOwnerData
                  , C = g.nextOwnerData;
                if (!I || !C)
                    return !1;
                var A = (I.hooks.length === 2 * C.hooks.length ? I.hooks.slice(I.hooks.length / 2) : I.hooks).map((function(g, I) {
                    return {
                        hookName: g.hookName,
                        differences: E(g.result, C.hooks[I].result, {
                            shallow: !1
                        })
                    }
                }
                ));
                return {
                    propsDifferences: E(I.props, C.props),
                    stateDifferences: E(I.state, C.state),
                    hookDifferences: A.length > 0 && A
                }
            }
            function q(g, I, C, A, e, i) {
                var t = o.ownerDataMap.get(g)
                  , n = o.ownerDataMap.get(A);
                return {
                    propsDifferences: E(g, A),
                    stateDifferences: E(I, e),
                    hookDifferences: E(C, i, {
                        shallow: !1
                    }),
                    ownerDifferences: P({
                        prevOwnerData: t,
                        nextOwnerData: n
                    })
                }
            }
            function _(g) {
                var I = g.Component
                  , C = g.displayName
                  , A = g.hookName
                  , e = g.prevProps
                  , o = g.prevState
                  , i = g.prevHook
                  , t = g.nextProps
                  , n = g.nextState
                  , l = g.nextHook;
                return {
                    Component: I,
                    displayName: C,
                    hookName: A,
                    prevProps: e,
                    prevState: o,
                    prevHook: i,
                    nextProps: t,
                    nextState: n,
                    nextHook: l,
                    reason: q(e, o, i, t, n, l)
                }
            }
            function $(g) {
                return g.prototype && !!g.prototype.isReactComponent
            }
            function gg(g) {
                return g.$$typeof === H
            }
            function Ig(g) {
                return g.$$typeof === F
            }
            function Cg(g, I) {
                var C = I.isHookChange
                  , A = T(g);
                return !(function(g) {
                    return o.options.exclude && o.options.exclude.length > 0 && o.options.exclude.some((function(I) {
                        return I.test(g)
                    }
                    ))
                }(A) || !1 === g.whyDidYouRender || C && g.whyDidYouRender && !1 === g.whyDidYouRender.trackHooks || !(g.whyDidYouRender || o.options.trackAllPureComponents && (g && g.prototype instanceof o.React.PureComponent || gg(g)) || function(g) {
                    return o.options.include && o.options.include.length > 0 && o.options.include.some((function(I) {
                        return I.test(g)
                    }
                    ))
                }(A)))
            }
            function Ag(g, C) {
                var A = C.displayName
                  , e = C.defaultProps
                  , i = function(I) {
                    !function(g, I) {
                        if ("function" != typeof I && null !== I)
                            throw new TypeError("Super expression must either be null or a function");
                        g.prototype = Object.create(I && I.prototype, {
                            constructor: {
                                value: g,
                                writable: !0,
                                configurable: !0
                            }
                        }),
                        I && s(g, I)
                    }(n, I);
                    var C, e, i, t = G(n);
                    function n(I, C) {
                        var A, e;
                        !function(g, I) {
                            if (!(g instanceof I))
                                throw new TypeError("Cannot call a class as a function")
                        }(this, n),
                        (e = t.call(this, I, C))._WDYR = {
                            renderNumber: 0
                        };
                        var o = u((A = d(e),
                        a(n.prototype)), "render", A) || e.render;
                        return o !== g.prototype.render && (e.render = function() {
                            return n.prototype.render.apply(d(e)),
                            o()
                        }
                        ),
                        e
                    }
                    return C = n,
                    (e = [{
                        key: "render",
                        value: function() {
                            if (this._WDYR.renderNumber++,
                            "isStrictMode"in this._WDYR || (this._WDYR.isStrictMode = function(g) {
                                for (var I = g && (g._reactInternalFiber || g._reactInternals); I; ) {
                                    if (1 & I.mode)
                                        return !0;
                                    I = I.return
                                }
                                return !1
                            }(this)),
                            !this._WDYR.isStrictMode || this._WDYR.renderNumber % 2 != 1) {
                                if (this._WDYR.prevProps) {
                                    var I = _({
                                        Component: g,
                                        displayName: A,
                                        prevProps: this._WDYR.prevProps,
                                        prevState: this._WDYR.prevState,
                                        nextProps: this.props,
                                        nextState: this.state
                                    });
                                    o.options.notifier(I)
                                }
                                this._WDYR.prevProps = this.props,
                                this._WDYR.prevState = this.state
                            }
                            return u(a(n.prototype), "render", this) ? u(a(n.prototype), "render", this).call(this) : null
                        }
                    }]) && l(C.prototype, e),
                    i && l(C, i),
                    n
                }(g);
                try {
                    i.displayName = A
                } catch (g) {}
                return i.defaultProps = e,
                I.defaults(i, g),
                i
            }
            function eg(g, C) {
                var A, e = C.isPure, i = C.displayName, t = C.defaultProps, n = "string" == typeof g ? (A = g,
                function(g) {
                    return o.React.createElement(A, g)
                }
                ) : g;
                function l() {
                    var g = arguments[0]
                      , I = o.React.useRef()
                      , C = I.current;
                    if (I.current = g,
                    C) {
                        var A = _({
                            Component: n,
                            displayName: i,
                            prevProps: C,
                            nextProps: g
                        })
                          , t = !A.reason.propsDifferences || e && 0 === A.reason.propsDifferences.length;
                        t || o.options.notifier(A)
                    }
                    return n.apply(void 0, arguments)
                }
                try {
                    l.displayName = i
                } catch (g) {}
                return l.defaultProps = t,
                l.ComponentForHooksTracking = n,
                I.defaults(l, n),
                l
            }
            var og = Symbol("initial-hook-value");
            function ig(g, C, A) {
                var e = C.path
                  , i = e ? I.get(A, e) : A
                  , t = o.React.useRef(!0);
                o.hooksPerRender[0] && o.hooksPerRender[0].renderNumberForTheHook !== t.current && (o.hooksPerRender = []),
                o.hooksPerRender.push({
                    hookName: g,
                    result: i,
                    renderNumberForTheHook: t.current
                }),
                t.current++;
                var n = o.React.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED && o.React.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner.current
                  , l = o.React.useRef(og);
                if (!n)
                    return A;
                var c = n.type.ComponentForHooksTracking || n.type
                  , a = T(c);
                if (!Cg(c, {
                    isHookChange: !0
                }))
                    return A;
                var s = l.current;
                if (l.current = A,
                s !== og) {
                    var d = _({
                        Component: c,
                        displayName: a,
                        hookName: g,
                        prevHook: e ? I.get(s, e) : s,
                        nextHook: i
                    });
                    d.reason.hookDifferences && o.options.notifier(d)
                }
                return A
            }
            function tg(g, C) {
                var A = C.displayName
                  , e = C.defaultProps;
                return gg(g) ? function g(C, A) {
                    var e = A.displayName
                      , i = A.defaultProps
                      , t = C.type
                      , n = $(t)
                      , l = Ig(t)
                      , c = gg(t)
                      , a = l ? t.render : t
                      , s = n ? Ag(a, {
                        displayName: e,
                        defaultProps: i
                    }) : c ? g(a, {
                        displayName: e,
                        defaultProps: i
                    }) : eg(a, {
                        displayName: e,
                        isPure: !0
                    });
                    try {
                        s.displayName = T(a)
                    } catch (g) {}
                    s.ComponentForHooksTracking = C,
                    I.defaults(s, a);
                    var d = o.React.memo(l ? o.React.forwardRef(s) : s, C.compare);
                    try {
                        d.displayName = e
                    } catch (g) {}
                    return d.defaultProps = i,
                    I.defaults(d, C),
                    d
                }(g, {
                    displayName: A,
                    defaultProps: e
                }) : Ig(g) ? function(g, C) {
                    var A = C.displayName
                      , e = C.defaultProps
                      , i = g.render
                      , t = gg(i)
                      , n = t ? i.type : i
                      , l = eg(n, {
                        isPure: t,
                        displayName: A
                    });
                    l.displayName = T(n),
                    l.ComponentForHooksTracking = n,
                    I.defaults(l, n);
                    var c = o.React.forwardRef(t ? o.React.memo(l, i.compare) : l);
                    try {
                        c.displayName = A
                    } catch (g) {}
                    return c.defaultProps = e,
                    I.defaults(c, g),
                    c
                }(g, {
                    displayName: A,
                    defaultProps: e
                }) : $(g) ? Ag(g, {
                    displayName: A,
                    defaultProps: e
                }) : eg(g, {
                    displayName: A,
                    defaultProps: e,
                    isPure: !1
                })
            }
            var ng = {
                useState: {
                    path: "0"
                },
                useReducer: {
                    path: "0"
                },
                useContext: void 0,
                useMemo: {
                    dependenciesPath: "1",
                    dontReport: !0
                },
                useCallback: {
                    dependenciesPath: "1",
                    dontReport: !0
                }
            };
            function lg(g) {
                var I = o.React.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner.current;
                if (I) {
                    var C = I.type.ComponentForHooksTracking || I.type
                      , A = T(C)
                      , e = {};
                    o.options.getAdditionalOwnerData && (e = o.options.getAdditionalOwnerData(g)),
                    o.ownerDataMap.set(g.props, {
                        Component: C,
                        displayName: A,
                        props: I.pendingProps,
                        state: I.stateNode ? I.stateNode.state : null,
                        hooks: o.hooksPerRender,
                        additionalOwnerData: e
                    })
                }
            }
            function cg(g) {
                return function g(I) {
                    return !!I && (gg(I) ? g(I.type) : Ig(I) ? g(I.render) : "function" == typeof I || void 0)
                }(g) && Cg(g, {
                    isHookChange: !1
                }) ? function(g, I) {
                    var C = I.displayName
                      , A = I.defaultProps;
                    if (o.componentsMap.has(g))
                        return o.componentsMap.get(g);
                    var e = tg(g, {
                        displayName: C,
                        defaultProps: A
                    });
                    return o.componentsMap.set(g, e),
                    e
                }(g, {
                    displayName: g && g.whyDidYouRender && g.whyDidYouRender.customName || T(g),
                    defaultProps: function g(I) {
                        return I.defaultProps || I.type && g(I.type) || I.render && g(I.render) || {}
                    }(g)
                }) : null
            }
            function ag(g, C) {
                var A;
                if (!g.isWDYR)
                    return Object.assign(o, {
                        React: g,
                        options: D(C),
                        origCreateElement: g.createElement,
                        origCreateFactory: g.createFactory,
                        origCloneElement: g.cloneElement,
                        componentsMap: new WeakMap
                    }),
                    A = null,
                    o.React.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED && Object.defineProperty(o.React.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner, "current", {
                        get: function() {
                            return A
                        },
                        set: function(g) {
                            A = g,
                            o.hooksPerRender = []
                        }
                    }),
                    g.createElement = function(I) {
                        for (var C = cg(I), A = arguments.length, e = new Array(A > 1 ? A - 1 : 0), i = 1; i < A; i++)
                            e[i - 1] = arguments[i];
                        if (C)
                            try {
                                var t = o.origCreateElement.apply(g, [C].concat(e));
                                return o.options.logOwnerReasons && lg(t),
                                t
                            } catch (g) {
                                o.options.consoleLog("whyDidYouRender error. Please file a bug at https://github.com/welldone-software/why-did-you-render/issues.", {
                                    errorInfo: {
                                        error: g,
                                        componentNameOrComponent: I,
                                        rest: e,
                                        options: o.options
                                    }
                                })
                            }
                        return o.origCreateElement.apply(g, [I].concat(e))
                    }
                    ,
                    Object.assign(g.createElement, o.origCreateElement),
                    g.createFactory = function(I) {
                        var C = g.createElement.bind(null, I);
                        return C.type = I,
                        C
                    }
                    ,
                    Object.assign(g.createFactory, o.origCreateFactory),
                    g.cloneElement = function() {
                        for (var I = arguments.length, C = new Array(I), A = 0; A < I; A++)
                            C[A] = arguments[A];
                        var e = o.origCloneElement.apply(g, C);
                        return o.options.logOwnerReasons && lg(e),
                        e
                    }
                    ,
                    Object.assign(g.cloneElement, o.origCloneElement),
                    function() {
                        var g = !!o.React.useState;
                        if (o.options.trackHooks && g) {
                            var C = Object.entries(ng).map((function(g) {
                                var I = B(g, 2)
                                  , C = I[0]
                                  , A = I[1];
                                return [o.React, C, A]
                            }
                            ));
                            [].concat(Z(C), Z(o.options.trackExtraHooks)).forEach((function(g) {
                                var C = B(g, 3)
                                  , A = C[0]
                                  , e = C[1]
                                  , o = C[2]
                                  , i = void 0 === o ? {} : o
                                  , t = A[e]
                                  , n = e[0].toUpperCase() + e.slice(1)
                                  , l = function() {
                                    for (var g = arguments.length, C = new Array(g), A = 0; A < g; A++)
                                        C[A] = arguments[A];
                                    var o = t.call.apply(t, [this].concat(C))
                                      , n = i.dependenciesPath
                                      , l = i.dontReport;
                                    return n && I.isFunction(o) && J.set(o, {
                                        hookName: e,
                                        deps: I.get(C, n)
                                    }),
                                    l || ig(e, i, o),
                                    o
                                };
                                Object.defineProperty(l, "name", {
                                    value: n,
                                    writable: !1
                                }),
                                Object.assign(l, {
                                    originalHook: t
                                }),
                                A[e] = l
                            }
                            ))
                        }
                    }(),
                    g.isWDYR = !0,
                    g.__REVERT_WHY_DID_YOU_RENDER__ = function() {
                        Object.assign(g, {
                            createElement: o.origCreateElement,
                            createFactory: o.origCreateFactory,
                            cloneElement: o.origCloneElement
                        }),
                        o.componentsMap = null,
                        [].concat(Z(Object.keys(ng).map((function(I) {
                            return [g, I]
                        }
                        ))), Z(o.options.trackExtraHooks)).forEach((function(g) {
                            var I = B(g, 2)
                              , C = I[0]
                              , A = I[1];
                            C[A].originalHook && (C[A] = C[A].originalHook)
                        }
                        )),
                        delete g.__REVERT_WHY_DID_YOU_RENDER__,
                        delete g.isWDYR
                    }
                    ,
                    g
            }
            return ag.defaultNotifier = Q,
            ag.wdyrStore = o,
            ag.storeOwnerData = lg,
            ag.getWDYRType = cg,
            Object.assign(ag, e),
            ag
        }(C(0), C(772))
    },
    772: function(g, I, C) {
        (function(g, A) {
            var e;
            (function() {
                var o = "Expected a function"
                  , i = "__lodash_placeholder__"
                  , t = [["ary", 128], ["bind", 1], ["bindKey", 2], ["curry", 8], ["curryRight", 16], ["flip", 512], ["partial", 32], ["partialRight", 64], ["rearg", 256]]
                  , n = "[object Arguments]"
                  , l = "[object Array]"
                  , c = "[object Boolean]"
                  , a = "[object Date]"
                  , s = "[object Error]"
                  , d = "[object Function]"
                  , b = "[object GeneratorFunction]"
                  , G = "[object Map]"
                  , r = "[object Number]"
                  , u = "[object Object]"
                  , B = "[object RegExp]"
                  , Z = "[object Set]"
                  , m = "[object String]"
                  , h = "[object Symbol]"
                  , p = "[object WeakMap]"
                  , y = "[object ArrayBuffer]"
                  , W = "[object DataView]"
                  , v = "[object Float32Array]"
                  , V = "[object Float64Array]"
                  , X = "[object Int8Array]"
                  , Y = "[object Int16Array]"
                  , K = "[object Int32Array]"
                  , R = "[object Uint8Array]"
                  , w = "[object Uint16Array]"
                  , H = "[object Uint32Array]"
                  , F = /\b__p \+= '';/g
                  , N = /\b(__p \+=) '' \+/g
                  , S = /(__e\(.*?\)|\b__t\)) \+\n'';/g
                  , z = /&(?:amp|lt|gt|quot|#39);/g
                  , f = /[&<>"']/g
                  , k = RegExp(z.source)
                  , J = RegExp(f.source)
                  , L = /<%-([\s\S]+?)%>/g
                  , x = /<%([\s\S]+?)%>/g
                  , M = /<%=([\s\S]+?)%>/g
                  , Q = /\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/
                  , j = /^\w*$/
                  , U = /[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g
                  , D = /[\\^$.*+?()[\]{}|]/g
                  , T = RegExp(D.source)
                  , O = /^\s+/
                  , E = /\s/
                  , P = /\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/
                  , q = /\{\n\/\* \[wrapped with (.+)\] \*/
                  , _ = /,? & /
                  , $ = /[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g
                  , gg = /[()=,{}\[\]\/\s]/
                  , Ig = /\\(\\)?/g
                  , Cg = /\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g
                  , Ag = /\w*$/
                  , eg = /^[-+]0x[0-9a-f]+$/i
                  , og = /^0b[01]+$/i
                  , ig = /^\[object .+?Constructor\]$/
                  , tg = /^0o[0-7]+$/i
                  , ng = /^(?:0|[1-9]\d*)$/
                  , lg = /[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g
                  , cg = /($^)/
                  , ag = /['\n\r\u2028\u2029\\]/g
                  , sg = "\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff"
                  , dg = "\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000"
                  , bg = "[\\ud800-\\udfff]"
                  , Gg = "[" + dg + "]"
                  , rg = "[" + sg + "]"
                  , ug = "\\d+"
                  , Bg = "[\\u2700-\\u27bf]"
                  , Zg = "[a-z\\xdf-\\xf6\\xf8-\\xff]"
                  , mg = "[^\\ud800-\\udfff" + dg + ug + "\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde]"
                  , hg = "\\ud83c[\\udffb-\\udfff]"
                  , pg = "[^\\ud800-\\udfff]"
                  , yg = "(?:\\ud83c[\\udde6-\\uddff]){2}"
                  , Wg = "[\\ud800-\\udbff][\\udc00-\\udfff]"
                  , vg = "[A-Z\\xc0-\\xd6\\xd8-\\xde]"
                  , Vg = "(?:" + Zg + "|" + mg + ")"
                  , Xg = "(?:" + vg + "|" + mg + ")"
                  , Yg = "(?:" + rg + "|" + hg + ")" + "?"
                  , Kg = "[\\ufe0e\\ufe0f]?" + Yg + ("(?:\\u200d(?:" + [pg, yg, Wg].join("|") + ")[\\ufe0e\\ufe0f]?" + Yg + ")*")
                  , Rg = "(?:" + [Bg, yg, Wg].join("|") + ")" + Kg
                  , wg = "(?:" + [pg + rg + "?", rg, yg, Wg, bg].join("|") + ")"
                  , Hg = RegExp("['’]", "g")
                  , Fg = RegExp(rg, "g")
                  , Ng = RegExp(hg + "(?=" + hg + ")|" + wg + Kg, "g")
                  , Sg = RegExp([vg + "?" + Zg + "+(?:['’](?:d|ll|m|re|s|t|ve))?(?=" + [Gg, vg, "$"].join("|") + ")", Xg + "+(?:['’](?:D|LL|M|RE|S|T|VE))?(?=" + [Gg, vg + Vg, "$"].join("|") + ")", vg + "?" + Vg + "+(?:['’](?:d|ll|m|re|s|t|ve))?", vg + "+(?:['’](?:D|LL|M|RE|S|T|VE))?", "\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])", "\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])", ug, Rg].join("|"), "g")
                  , zg = RegExp("[\\u200d\\ud800-\\udfff" + sg + "\\ufe0e\\ufe0f]")
                  , fg = /[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/
                  , kg = ["Array", "Buffer", "DataView", "Date", "Error", "Float32Array", "Float64Array", "Function", "Int8Array", "Int16Array", "Int32Array", "Map", "Math", "Object", "Promise", "RegExp", "Set", "String", "Symbol", "TypeError", "Uint8Array", "Uint8ClampedArray", "Uint16Array", "Uint32Array", "WeakMap", "_", "clearTimeout", "isFinite", "parseInt", "setTimeout"]
                  , Jg = -1
                  , Lg = {};
                Lg[v] = Lg[V] = Lg[X] = Lg[Y] = Lg[K] = Lg[R] = Lg["[object Uint8ClampedArray]"] = Lg[w] = Lg[H] = !0,
                Lg[n] = Lg[l] = Lg[y] = Lg[c] = Lg[W] = Lg[a] = Lg[s] = Lg[d] = Lg[G] = Lg[r] = Lg[u] = Lg[B] = Lg[Z] = Lg[m] = Lg[p] = !1;
                var xg = {};
                xg[n] = xg[l] = xg[y] = xg[W] = xg[c] = xg[a] = xg[v] = xg[V] = xg[X] = xg[Y] = xg[K] = xg[G] = xg[r] = xg[u] = xg[B] = xg[Z] = xg[m] = xg[h] = xg[R] = xg["[object Uint8ClampedArray]"] = xg[w] = xg[H] = !0,
                xg[s] = xg[d] = xg[p] = !1;
                var Mg = {
                    "\\": "\\",
                    "'": "'",
                    "\n": "n",
                    "\r": "r",
                    "\u2028": "u2028",
                    "\u2029": "u2029"
                }
                  , Qg = parseFloat
                  , jg = parseInt
                  , Ug = "object" == typeof g && g && g.Object === Object && g
                  , Dg = "object" == typeof self && self && self.Object === Object && self
                  , Tg = Ug || Dg || Function("return this")()
                  , Og = I && !I.nodeType && I
                  , Eg = Og && "object" == typeof A && A && !A.nodeType && A
                  , Pg = Eg && Eg.exports === Og
                  , qg = Pg && Ug.process
                  , _g = function() {
                    try {
                        var g = Eg && Eg.require && Eg.require("util").types;
                        return g || qg && qg.binding && qg.binding("util")
                    } catch (g) {}
                }()
                  , $g = _g && _g.isArrayBuffer
                  , gI = _g && _g.isDate
                  , II = _g && _g.isMap
                  , CI = _g && _g.isRegExp
                  , AI = _g && _g.isSet
                  , eI = _g && _g.isTypedArray;
                function oI(g, I, C) {
                    switch (C.length) {
                    case 0:
                        return g.call(I);
                    case 1:
                        return g.call(I, C[0]);
                    case 2:
                        return g.call(I, C[0], C[1]);
                    case 3:
                        return g.call(I, C[0], C[1], C[2])
                    }
                    return g.apply(I, C)
                }
                function iI(g, I, C, A) {
                    for (var e = -1, o = null == g ? 0 : g.length; ++e < o; ) {
                        var i = g[e];
                        I(A, i, C(i), g)
                    }
                    return A
                }
                function tI(g, I) {
                    for (var C = -1, A = null == g ? 0 : g.length; ++C < A && !1 !== I(g[C], C, g); )
                        ;
                    return g
                }
                function nI(g, I) {
                    for (var C = null == g ? 0 : g.length; C-- && !1 !== I(g[C], C, g); )
                        ;
                    return g
                }
                function lI(g, I) {
                    for (var C = -1, A = null == g ? 0 : g.length; ++C < A; )
                        if (!I(g[C], C, g))
                            return !1;
                    return !0
                }
                function cI(g, I) {
                    for (var C = -1, A = null == g ? 0 : g.length, e = 0, o = []; ++C < A; ) {
                        var i = g[C];
                        I(i, C, g) && (o[e++] = i)
                    }
                    return o
                }
                function aI(g, I) {
                    return !!(null == g ? 0 : g.length) && hI(g, I, 0) > -1
                }
                function sI(g, I, C) {
                    for (var A = -1, e = null == g ? 0 : g.length; ++A < e; )
                        if (C(I, g[A]))
                            return !0;
                    return !1
                }
                function dI(g, I) {
                    for (var C = -1, A = null == g ? 0 : g.length, e = Array(A); ++C < A; )
                        e[C] = I(g[C], C, g);
                    return e
                }
                function bI(g, I) {
                    for (var C = -1, A = I.length, e = g.length; ++C < A; )
                        g[e + C] = I[C];
                    return g
                }
                function GI(g, I, C, A) {
                    var e = -1
                      , o = null == g ? 0 : g.length;
                    for (A && o && (C = g[++e]); ++e < o; )
                        C = I(C, g[e], e, g);
                    return C
                }
                function rI(g, I, C, A) {
                    var e = null == g ? 0 : g.length;
                    for (A && e && (C = g[--e]); e--; )
                        C = I(C, g[e], e, g);
                    return C
                }
                function uI(g, I) {
                    for (var C = -1, A = null == g ? 0 : g.length; ++C < A; )
                        if (I(g[C], C, g))
                            return !0;
                    return !1
                }
                var BI = vI("length");
                function ZI(g, I, C) {
                    var A;
                    return C(g, (function(g, C, e) {
                        if (I(g, C, e))
                            return A = C,
                            !1
                    }
                    )),
                    A
                }
                function mI(g, I, C, A) {
                    for (var e = g.length, o = C + (A ? 1 : -1); A ? o-- : ++o < e; )
                        if (I(g[o], o, g))
                            return o;
                    return -1
                }
                function hI(g, I, C) {
                    return I == I ? function(g, I, C) {
                        var A = C - 1
                          , e = g.length;
                        for (; ++A < e; )
                            if (g[A] === I)
                                return A;
                        return -1
                    }(g, I, C) : mI(g, yI, C)
                }
                function pI(g, I, C, A) {
                    for (var e = C - 1, o = g.length; ++e < o; )
                        if (A(g[e], I))
                            return e;
                    return -1
                }
                function yI(g) {
                    return g != g
                }
                function WI(g, I) {
                    var C = null == g ? 0 : g.length;
                    return C ? YI(g, I) / C : NaN
                }
                function vI(g) {
                    return function(I) {
                        return null == I ? void 0 : I[g]
                    }
                }
                function VI(g) {
                    return function(I) {
                        return null == g ? void 0 : g[I]
                    }
                }
                function XI(g, I, C, A, e) {
                    return e(g, (function(g, e, o) {
                        C = A ? (A = !1,
                        g) : I(C, g, e, o)
                    }
                    )),
                    C
                }
                function YI(g, I) {
                    for (var C, A = -1, e = g.length; ++A < e; ) {
                        var o = I(g[A]);
                        void 0 !== o && (C = void 0 === C ? o : C + o)
                    }
                    return C
                }
                function KI(g, I) {
                    for (var C = -1, A = Array(g); ++C < g; )
                        A[C] = I(C);
                    return A
                }
                function RI(g) {
                    return g ? g.slice(0, OI(g) + 1).replace(O, "") : g
                }
                function wI(g) {
                    return function(I) {
                        return g(I)
                    }
                }
                function HI(g, I) {
                    return dI(I, (function(I) {
                        return g[I]
                    }
                    ))
                }
                function FI(g, I) {
                    return g.has(I)
                }
                function NI(g, I) {
                    for (var C = -1, A = g.length; ++C < A && hI(I, g[C], 0) > -1; )
                        ;
                    return C
                }
                function SI(g, I) {
                    for (var C = g.length; C-- && hI(I, g[C], 0) > -1; )
                        ;
                    return C
                }
                function zI(g, I) {
                    for (var C = g.length, A = 0; C--; )
                        g[C] === I && ++A;
                    return A
                }
                var fI = VI({
                    "À": "A",
                    "Á": "A",
                    "Â": "A",
                    "Ã": "A",
                    "Ä": "A",
                    "Å": "A",
                    "à": "a",
                    "á": "a",
                    "â": "a",
                    "ã": "a",
                    "ä": "a",
                    "å": "a",
                    "Ç": "C",
                    "ç": "c",
                    "Ð": "D",
                    "ð": "d",
                    "È": "E",
                    "É": "E",
                    "Ê": "E",
                    "Ë": "E",
                    "è": "e",
                    "é": "e",
                    "ê": "e",
                    "ë": "e",
                    "Ì": "I",
                    "Í": "I",
                    "Î": "I",
                    "Ï": "I",
                    "ì": "i",
                    "í": "i",
                    "î": "i",
                    "ï": "i",
                    "Ñ": "N",
                    "ñ": "n",
                    "Ò": "O",
                    "Ó": "O",
                    "Ô": "O",
                    "Õ": "O",
                    "Ö": "O",
                    "Ø": "O",
                    "ò": "o",
                    "ó": "o",
                    "ô": "o",
                    "õ": "o",
                    "ö": "o",
                    "ø": "o",
                    "Ù": "U",
                    "Ú": "U",
                    "Û": "U",
                    "Ü": "U",
                    "ù": "u",
                    "ú": "u",
                    "û": "u",
                    "ü": "u",
                    "Ý": "Y",
                    "ý": "y",
                    "ÿ": "y",
                    "Æ": "Ae",
                    "æ": "ae",
                    "Þ": "Th",
                    "þ": "th",
                    "ß": "ss",
                    "Ā": "A",
                    "Ă": "A",
                    "Ą": "A",
                    "ā": "a",
                    "ă": "a",
                    "ą": "a",
                    "Ć": "C",
                    "Ĉ": "C",
                    "Ċ": "C",
                    "Č": "C",
                    "ć": "c",
                    "ĉ": "c",
                    "ċ": "c",
                    "č": "c",
                    "Ď": "D",
                    "Đ": "D",
                    "ď": "d",
                    "đ": "d",
                    "Ē": "E",
                    "Ĕ": "E",
                    "Ė": "E",
                    "Ę": "E",
                    "Ě": "E",
                    "ē": "e",
                    "ĕ": "e",
                    "ė": "e",
                    "ę": "e",
                    "ě": "e",
                    "Ĝ": "G",
                    "Ğ": "G",
                    "Ġ": "G",
                    "Ģ": "G",
                    "ĝ": "g",
                    "ğ": "g",
                    "ġ": "g",
                    "ģ": "g",
                    "Ĥ": "H",
                    "Ħ": "H",
                    "ĥ": "h",
                    "ħ": "h",
                    "Ĩ": "I",
                    "Ī": "I",
                    "Ĭ": "I",
                    "Į": "I",
                    "İ": "I",
                    "ĩ": "i",
                    "ī": "i",
                    "ĭ": "i",
                    "į": "i",
                    "ı": "i",
                    "Ĵ": "J",
                    "ĵ": "j",
                    "Ķ": "K",
                    "ķ": "k",
                    "ĸ": "k",
                    "Ĺ": "L",
                    "Ļ": "L",
                    "Ľ": "L",
                    "Ŀ": "L",
                    "Ł": "L",
                    "ĺ": "l",
                    "ļ": "l",
                    "ľ": "l",
                    "ŀ": "l",
                    "ł": "l",
                    "Ń": "N",
                    "Ņ": "N",
                    "Ň": "N",
                    "Ŋ": "N",
                    "ń": "n",
                    "ņ": "n",
                    "ň": "n",
                    "ŋ": "n",
                    "Ō": "O",
                    "Ŏ": "O",
                    "Ő": "O",
                    "ō": "o",
                    "ŏ": "o",
                    "ő": "o",
                    "Ŕ": "R",
                    "Ŗ": "R",
                    "Ř": "R",
                    "ŕ": "r",
                    "ŗ": "r",
                    "ř": "r",
                    "Ś": "S",
                    "Ŝ": "S",
                    "Ş": "S",
                    "Š": "S",
                    "ś": "s",
                    "ŝ": "s",
                    "ş": "s",
                    "š": "s",
                    "Ţ": "T",
                    "Ť": "T",
                    "Ŧ": "T",
                    "ţ": "t",
                    "ť": "t",
                    "ŧ": "t",
                    "Ũ": "U",
                    "Ū": "U",
                    "Ŭ": "U",
                    "Ů": "U",
                    "Ű": "U",
                    "Ų": "U",
                    "ũ": "u",
                    "ū": "u",
                    "ŭ": "u",
                    "ů": "u",
                    "ű": "u",
                    "ų": "u",
                    "Ŵ": "W",
                    "ŵ": "w",
                    "Ŷ": "Y",
                    "ŷ": "y",
                    "Ÿ": "Y",
                    "Ź": "Z",
                    "Ż": "Z",
                    "Ž": "Z",
                    "ź": "z",
                    "ż": "z",
                    "ž": "z",
                    "Ĳ": "IJ",
                    "ĳ": "ij",
                    "Œ": "Oe",
                    "œ": "oe",
                    "ŉ": "'n",
                    "ſ": "s"
                })
                  , kI = VI({
                    "&": "&amp;",
                    "<": "&lt;",
                    ">": "&gt;",
                    '"': "&quot;",
                    "'": "&#39;"
                });
                function JI(g) {
                    return "\\" + Mg[g]
                }
                function LI(g) {
                    return zg.test(g)
                }
                function xI(g) {
                    var I = -1
                      , C = Array(g.size);
                    return g.forEach((function(g, A) {
                        C[++I] = [A, g]
                    }
                    )),
                    C
                }
                function MI(g, I) {
                    return function(C) {
                        return g(I(C))
                    }
                }
                function QI(g, I) {
                    for (var C = -1, A = g.length, e = 0, o = []; ++C < A; ) {
                        var t = g[C];
                        t !== I && t !== i || (g[C] = i,
                        o[e++] = C)
                    }
                    return o
                }
                function jI(g) {
                    var I = -1
                      , C = Array(g.size);
                    return g.forEach((function(g) {
                        C[++I] = g
                    }
                    )),
                    C
                }
                function UI(g) {
                    var I = -1
                      , C = Array(g.size);
                    return g.forEach((function(g) {
                        C[++I] = [g, g]
                    }
                    )),
                    C
                }
                function DI(g) {
                    return LI(g) ? function(g) {
                        var I = Ng.lastIndex = 0;
                        for (; Ng.test(g); )
                            ++I;
                        return I
                    }(g) : BI(g)
                }
                function TI(g) {
                    return LI(g) ? function(g) {
                        return g.match(Ng) || []
                    }(g) : function(g) {
                        return g.split("")
                    }(g)
                }
                function OI(g) {
                    for (var I = g.length; I-- && E.test(g.charAt(I)); )
                        ;
                    return I
                }
                var EI = VI({
                    "&amp;": "&",
                    "&lt;": "<",
                    "&gt;": ">",
                    "&quot;": '"',
                    "&#39;": "'"
                });
                var PI = function g(I) {
                    var C, A = (I = null == I ? Tg : PI.defaults(Tg.Object(), I, PI.pick(Tg, kg))).Array, e = I.Date, E = I.Error, sg = I.Function, dg = I.Math, bg = I.Object, Gg = I.RegExp, rg = I.String, ug = I.TypeError, Bg = A.prototype, Zg = sg.prototype, mg = bg.prototype, hg = I["__core-js_shared__"], pg = Zg.toString, yg = mg.hasOwnProperty, Wg = 0, vg = (C = /[^.]+$/.exec(hg && hg.keys && hg.keys.IE_PROTO || "")) ? "Symbol(src)_1." + C : "", Vg = mg.toString, Xg = pg.call(bg), Yg = Tg._, Kg = Gg("^" + pg.call(yg).replace(D, "\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g, "$1.*?") + "$"), Rg = Pg ? I.Buffer : void 0, wg = I.Symbol, Ng = I.Uint8Array, zg = Rg ? Rg.allocUnsafe : void 0, Mg = MI(bg.getPrototypeOf, bg), Ug = bg.create, Dg = mg.propertyIsEnumerable, Og = Bg.splice, Eg = wg ? wg.isConcatSpreadable : void 0, qg = wg ? wg.iterator : void 0, _g = wg ? wg.toStringTag : void 0, BI = function() {
                        try {
                            var g = $e(bg, "defineProperty");
                            return g({}, "", {}),
                            g
                        } catch (g) {}
                    }(), VI = I.clearTimeout !== Tg.clearTimeout && I.clearTimeout, qI = e && e.now !== Tg.Date.now && e.now, _I = I.setTimeout !== Tg.setTimeout && I.setTimeout, $I = dg.ceil, gC = dg.floor, IC = bg.getOwnPropertySymbols, CC = Rg ? Rg.isBuffer : void 0, AC = I.isFinite, eC = Bg.join, oC = MI(bg.keys, bg), iC = dg.max, tC = dg.min, nC = e.now, lC = I.parseInt, cC = dg.random, aC = Bg.reverse, sC = $e(I, "DataView"), dC = $e(I, "Map"), bC = $e(I, "Promise"), GC = $e(I, "Set"), rC = $e(I, "WeakMap"), uC = $e(bg, "create"), BC = rC && new rC, ZC = {}, mC = Xo(sC), hC = Xo(dC), pC = Xo(bC), yC = Xo(GC), WC = Xo(rC), vC = wg ? wg.prototype : void 0, VC = vC ? vC.valueOf : void 0, XC = vC ? vC.toString : void 0;
                    function YC(g) {
                        if (ji(g) && !Fi(g) && !(g instanceof HC)) {
                            if (g instanceof wC)
                                return g;
                            if (yg.call(g, "__wrapped__"))
                                return Yo(g)
                        }
                        return new wC(g)
                    }
                    var KC = function() {
                        function g() {}
                        return function(I) {
                            if (!Qi(I))
                                return {};
                            if (Ug)
                                return Ug(I);
                            g.prototype = I;
                            var C = new g;
                            return g.prototype = void 0,
                            C
                        }
                    }();
                    function RC() {}
                    function wC(g, I) {
                        this.__wrapped__ = g,
                        this.__actions__ = [],
                        this.__chain__ = !!I,
                        this.__index__ = 0,
                        this.__values__ = void 0
                    }
                    function HC(g) {
                        this.__wrapped__ = g,
                        this.__actions__ = [],
                        this.__dir__ = 1,
                        this.__filtered__ = !1,
                        this.__iteratees__ = [],
                        this.__takeCount__ = 4294967295,
                        this.__views__ = []
                    }
                    function FC(g) {
                        var I = -1
                          , C = null == g ? 0 : g.length;
                        for (this.clear(); ++I < C; ) {
                            var A = g[I];
                            this.set(A[0], A[1])
                        }
                    }
                    function NC(g) {
                        var I = -1
                          , C = null == g ? 0 : g.length;
                        for (this.clear(); ++I < C; ) {
                            var A = g[I];
                            this.set(A[0], A[1])
                        }
                    }
                    function SC(g) {
                        var I = -1
                          , C = null == g ? 0 : g.length;
                        for (this.clear(); ++I < C; ) {
                            var A = g[I];
                            this.set(A[0], A[1])
                        }
                    }
                    function zC(g) {
                        var I = -1
                          , C = null == g ? 0 : g.length;
                        for (this.__data__ = new SC; ++I < C; )
                            this.add(g[I])
                    }
                    function fC(g) {
                        var I = this.__data__ = new NC(g);
                        this.size = I.size
                    }
                    function kC(g, I) {
                        var C = Fi(g)
                          , A = !C && Hi(g)
                          , e = !C && !A && fi(g)
                          , o = !C && !A && !e && _i(g)
                          , i = C || A || e || o
                          , t = i ? KI(g.length, rg) : []
                          , n = t.length;
                        for (var l in g)
                            !I && !yg.call(g, l) || i && ("length" == l || e && ("offset" == l || "parent" == l) || o && ("buffer" == l || "byteLength" == l || "byteOffset" == l) || io(l, n)) || t.push(l);
                        return t
                    }
                    function JC(g) {
                        var I = g.length;
                        return I ? g[zA(0, I - 1)] : void 0
                    }
                    function LC(g, I) {
                        return Wo(ue(g), EC(I, 0, g.length))
                    }
                    function xC(g) {
                        return Wo(ue(g))
                    }
                    function MC(g, I, C) {
                        (void 0 !== C && !Ki(g[I], C) || void 0 === C && !(I in g)) && TC(g, I, C)
                    }
                    function QC(g, I, C) {
                        var A = g[I];
                        yg.call(g, I) && Ki(A, C) && (void 0 !== C || I in g) || TC(g, I, C)
                    }
                    function jC(g, I) {
                        for (var C = g.length; C--; )
                            if (Ki(g[C][0], I))
                                return C;
                        return -1
                    }
                    function UC(g, I, C, A) {
                        return gA(g, (function(g, e, o) {
                            I(A, g, C(g), o)
                        }
                        )),
                        A
                    }
                    function DC(g, I) {
                        return g && Be(I, mt(I), g)
                    }
                    function TC(g, I, C) {
                        "__proto__" == I && BI ? BI(g, I, {
                            configurable: !0,
                            enumerable: !0,
                            value: C,
                            writable: !0
                        }) : g[I] = C
                    }
                    function OC(g, I) {
                        for (var C = -1, e = I.length, o = A(e), i = null == g; ++C < e; )
                            o[C] = i ? void 0 : Gt(g, I[C]);
                        return o
                    }
                    function EC(g, I, C) {
                        return g == g && (void 0 !== C && (g = g <= C ? g : C),
                        void 0 !== I && (g = g >= I ? g : I)),
                        g
                    }
                    function PC(g, I, C, A, e, o) {
                        var i, t = 1 & I, l = 2 & I, s = 4 & I;
                        if (C && (i = e ? C(g, A, e, o) : C(g)),
                        void 0 !== i)
                            return i;
                        if (!Qi(g))
                            return g;
                        var p = Fi(g);
                        if (p) {
                            if (i = function(g) {
                                var I = g.length
                                  , C = new g.constructor(I);
                                I && "string" == typeof g[0] && yg.call(g, "index") && (C.index = g.index,
                                C.input = g.input);
                                return C
                            }(g),
                            !t)
                                return ue(g, i)
                        } else {
                            var F = Co(g)
                              , N = F == d || F == b;
                            if (fi(g))
                                return ae(g, t);
                            if (F == u || F == n || N && !e) {
                                if (i = l || N ? {} : eo(g),
                                !t)
                                    return l ? function(g, I) {
                                        return Be(g, Io(g), I)
                                    }(g, function(g, I) {
                                        return g && Be(I, ht(I), g)
                                    }(i, g)) : function(g, I) {
                                        return Be(g, go(g), I)
                                    }(g, DC(i, g))
                            } else {
                                if (!xg[F])
                                    return e ? g : {};
                                i = function(g, I, C) {
                                    var A = g.constructor;
                                    switch (I) {
                                    case y:
                                        return se(g);
                                    case c:
                                    case a:
                                        return new A(+g);
                                    case W:
                                        return function(g, I) {
                                            var C = I ? se(g.buffer) : g.buffer;
                                            return new g.constructor(C,g.byteOffset,g.byteLength)
                                        }(g, C);
                                    case v:
                                    case V:
                                    case X:
                                    case Y:
                                    case K:
                                    case R:
                                    case "[object Uint8ClampedArray]":
                                    case w:
                                    case H:
                                        return de(g, C);
                                    case G:
                                        return new A;
                                    case r:
                                    case m:
                                        return new A(g);
                                    case B:
                                        return function(g) {
                                            var I = new g.constructor(g.source,Ag.exec(g));
                                            return I.lastIndex = g.lastIndex,
                                            I
                                        }(g);
                                    case Z:
                                        return new A;
                                    case h:
                                        return e = g,
                                        VC ? bg(VC.call(e)) : {}
                                    }
                                    var e
                                }(g, F, t)
                            }
                        }
                        o || (o = new fC);
                        var S = o.get(g);
                        if (S)
                            return S;
                        o.set(g, i),
                        Ei(g) ? g.forEach((function(A) {
                            i.add(PC(A, I, C, A, g, o))
                        }
                        )) : Ui(g) && g.forEach((function(A, e) {
                            i.set(e, PC(A, I, C, e, g, o))
                        }
                        ));
                        var z = p ? void 0 : (s ? l ? De : Ue : l ? ht : mt)(g);
                        return tI(z || g, (function(A, e) {
                            z && (A = g[e = A]),
                            QC(i, e, PC(A, I, C, e, g, o))
                        }
                        )),
                        i
                    }
                    function qC(g, I, C) {
                        var A = C.length;
                        if (null == g)
                            return !A;
                        for (g = bg(g); A--; ) {
                            var e = C[A]
                              , o = I[e]
                              , i = g[e];
                            if (void 0 === i && !(e in g) || !o(i))
                                return !1
                        }
                        return !0
                    }
                    function _C(g, I, C) {
                        if ("function" != typeof g)
                            throw new ug(o);
                        return mo((function() {
                            g.apply(void 0, C)
                        }
                        ), I)
                    }
                    function $C(g, I, C, A) {
                        var e = -1
                          , o = aI
                          , i = !0
                          , t = g.length
                          , n = []
                          , l = I.length;
                        if (!t)
                            return n;
                        C && (I = dI(I, wI(C))),
                        A ? (o = sI,
                        i = !1) : I.length >= 200 && (o = FI,
                        i = !1,
                        I = new zC(I));
                        g: for (; ++e < t; ) {
                            var c = g[e]
                              , a = null == C ? c : C(c);
                            if (c = A || 0 !== c ? c : 0,
                            i && a == a) {
                                for (var s = l; s--; )
                                    if (I[s] === a)
                                        continue g;
                                n.push(c)
                            } else
                                o(I, a, A) || n.push(c)
                        }
                        return n
                    }
                    YC.templateSettings = {
                        escape: L,
                        evaluate: x,
                        interpolate: M,
                        variable: "",
                        imports: {
                            _: YC
                        }
                    },
                    YC.prototype = RC.prototype,
                    YC.prototype.constructor = YC,
                    wC.prototype = KC(RC.prototype),
                    wC.prototype.constructor = wC,
                    HC.prototype = KC(RC.prototype),
                    HC.prototype.constructor = HC,
                    FC.prototype.clear = function() {
                        this.__data__ = uC ? uC(null) : {},
                        this.size = 0
                    }
                    ,
                    FC.prototype.delete = function(g) {
                        var I = this.has(g) && delete this.__data__[g];
                        return this.size -= I ? 1 : 0,
                        I
                    }
                    ,
                    FC.prototype.get = function(g) {
                        var I = this.__data__;
                        if (uC) {
                            var C = I[g];
                            return "__lodash_hash_undefined__" === C ? void 0 : C
                        }
                        return yg.call(I, g) ? I[g] : void 0
                    }
                    ,
                    FC.prototype.has = function(g) {
                        var I = this.__data__;
                        return uC ? void 0 !== I[g] : yg.call(I, g)
                    }
                    ,
                    FC.prototype.set = function(g, I) {
                        var C = this.__data__;
                        return this.size += this.has(g) ? 0 : 1,
                        C[g] = uC && void 0 === I ? "__lodash_hash_undefined__" : I,
                        this
                    }
                    ,
                    NC.prototype.clear = function() {
                        this.__data__ = [],
                        this.size = 0
                    }
                    ,
                    NC.prototype.delete = function(g) {
                        var I = this.__data__
                          , C = jC(I, g);
                        return !(C < 0) && (C == I.length - 1 ? I.pop() : Og.call(I, C, 1),
                        --this.size,
                        !0)
                    }
                    ,
                    NC.prototype.get = function(g) {
                        var I = this.__data__
                          , C = jC(I, g);
                        return C < 0 ? void 0 : I[C][1]
                    }
                    ,
                    NC.prototype.has = function(g) {
                        return jC(this.__data__, g) > -1
                    }
                    ,
                    NC.prototype.set = function(g, I) {
                        var C = this.__data__
                          , A = jC(C, g);
                        return A < 0 ? (++this.size,
                        C.push([g, I])) : C[A][1] = I,
                        this
                    }
                    ,
                    SC.prototype.clear = function() {
                        this.size = 0,
                        this.__data__ = {
                            hash: new FC,
                            map: new (dC || NC),
                            string: new FC
                        }
                    }
                    ,
                    SC.prototype.delete = function(g) {
                        var I = qe(this, g).delete(g);
                        return this.size -= I ? 1 : 0,
                        I
                    }
                    ,
                    SC.prototype.get = function(g) {
                        return qe(this, g).get(g)
                    }
                    ,
                    SC.prototype.has = function(g) {
                        return qe(this, g).has(g)
                    }
                    ,
                    SC.prototype.set = function(g, I) {
                        var C = qe(this, g)
                          , A = C.size;
                        return C.set(g, I),
                        this.size += C.size == A ? 0 : 1,
                        this
                    }
                    ,
                    zC.prototype.add = zC.prototype.push = function(g) {
                        return this.__data__.set(g, "__lodash_hash_undefined__"),
                        this
                    }
                    ,
                    zC.prototype.has = function(g) {
                        return this.__data__.has(g)
                    }
                    ,
                    fC.prototype.clear = function() {
                        this.__data__ = new NC,
                        this.size = 0
                    }
                    ,
                    fC.prototype.delete = function(g) {
                        var I = this.__data__
                          , C = I.delete(g);
                        return this.size = I.size,
                        C
                    }
                    ,
                    fC.prototype.get = function(g) {
                        return this.__data__.get(g)
                    }
                    ,
                    fC.prototype.has = function(g) {
                        return this.__data__.has(g)
                    }
                    ,
                    fC.prototype.set = function(g, I) {
                        var C = this.__data__;
                        if (C instanceof NC) {
                            var A = C.__data__;
                            if (!dC || A.length < 199)
                                return A.push([g, I]),
                                this.size = ++C.size,
                                this;
                            C = this.__data__ = new SC(A)
                        }
                        return C.set(g, I),
                        this.size = C.size,
                        this
                    }
                    ;
                    var gA = he(nA)
                      , IA = he(lA, !0);
                    function CA(g, I) {
                        var C = !0;
                        return gA(g, (function(g, A, e) {
                            return C = !!I(g, A, e)
                        }
                        )),
                        C
                    }
                    function AA(g, I, C) {
                        for (var A = -1, e = g.length; ++A < e; ) {
                            var o = g[A]
                              , i = I(o);
                            if (null != i && (void 0 === t ? i == i && !qi(i) : C(i, t)))
                                var t = i
                                  , n = o
                        }
                        return n
                    }
                    function eA(g, I) {
                        var C = [];
                        return gA(g, (function(g, A, e) {
                            I(g, A, e) && C.push(g)
                        }
                        )),
                        C
                    }
                    function oA(g, I, C, A, e) {
                        var o = -1
                          , i = g.length;
                        for (C || (C = oo),
                        e || (e = []); ++o < i; ) {
                            var t = g[o];
                            I > 0 && C(t) ? I > 1 ? oA(t, I - 1, C, A, e) : bI(e, t) : A || (e[e.length] = t)
                        }
                        return e
                    }
                    var iA = pe()
                      , tA = pe(!0);
                    function nA(g, I) {
                        return g && iA(g, I, mt)
                    }
                    function lA(g, I) {
                        return g && tA(g, I, mt)
                    }
                    function cA(g, I) {
                        return cI(I, (function(I) {
                            return Li(g[I])
                        }
                        ))
                    }
                    function aA(g, I) {
                        for (var C = 0, A = (I = te(I, g)).length; null != g && C < A; )
                            g = g[Vo(I[C++])];
                        return C && C == A ? g : void 0
                    }
                    function sA(g, I, C) {
                        var A = I(g);
                        return Fi(g) ? A : bI(A, C(g))
                    }
                    function dA(g) {
                        return null == g ? void 0 === g ? "[object Undefined]" : "[object Null]" : _g && _g in bg(g) ? function(g) {
                            var I = yg.call(g, _g)
                              , C = g[_g];
                            try {
                                g[_g] = void 0;
                                var A = !0
                            } catch (g) {}
                            var e = Vg.call(g);
                            A && (I ? g[_g] = C : delete g[_g]);
                            return e
                        }(g) : function(g) {
                            return Vg.call(g)
                        }(g)
                    }
                    function bA(g, I) {
                        return g > I
                    }
                    function GA(g, I) {
                        return null != g && yg.call(g, I)
                    }
                    function rA(g, I) {
                        return null != g && I in bg(g)
                    }
                    function uA(g, I, C) {
                        for (var e = C ? sI : aI, o = g[0].length, i = g.length, t = i, n = A(i), l = 1 / 0, c = []; t--; ) {
                            var a = g[t];
                            t && I && (a = dI(a, wI(I))),
                            l = tC(a.length, l),
                            n[t] = !C && (I || o >= 120 && a.length >= 120) ? new zC(t && a) : void 0
                        }
                        a = g[0];
                        var s = -1
                          , d = n[0];
                        g: for (; ++s < o && c.length < l; ) {
                            var b = a[s]
                              , G = I ? I(b) : b;
                            if (b = C || 0 !== b ? b : 0,
                            !(d ? FI(d, G) : e(c, G, C))) {
                                for (t = i; --t; ) {
                                    var r = n[t];
                                    if (!(r ? FI(r, G) : e(g[t], G, C)))
                                        continue g
                                }
                                d && d.push(G),
                                c.push(b)
                            }
                        }
                        return c
                    }
                    function BA(g, I, C) {
                        var A = null == (g = ro(g, I = te(I, g))) ? g : g[Vo(Jo(I))];
                        return null == A ? void 0 : oI(A, g, C)
                    }
                    function ZA(g) {
                        return ji(g) && dA(g) == n
                    }
                    function mA(g, I, C, A, e) {
                        return g === I || (null == g || null == I || !ji(g) && !ji(I) ? g != g && I != I : function(g, I, C, A, e, o) {
                            var i = Fi(g)
                              , t = Fi(I)
                              , d = i ? l : Co(g)
                              , b = t ? l : Co(I)
                              , p = (d = d == n ? u : d) == u
                              , v = (b = b == n ? u : b) == u
                              , V = d == b;
                            if (V && fi(g)) {
                                if (!fi(I))
                                    return !1;
                                i = !0,
                                p = !1
                            }
                            if (V && !p)
                                return o || (o = new fC),
                                i || _i(g) ? Qe(g, I, C, A, e, o) : function(g, I, C, A, e, o, i) {
                                    switch (C) {
                                    case W:
                                        if (g.byteLength != I.byteLength || g.byteOffset != I.byteOffset)
                                            return !1;
                                        g = g.buffer,
                                        I = I.buffer;
                                    case y:
                                        return !(g.byteLength != I.byteLength || !o(new Ng(g), new Ng(I)));
                                    case c:
                                    case a:
                                    case r:
                                        return Ki(+g, +I);
                                    case s:
                                        return g.name == I.name && g.message == I.message;
                                    case B:
                                    case m:
                                        return g == I + "";
                                    case G:
                                        var t = xI;
                                    case Z:
                                        var n = 1 & A;
                                        if (t || (t = jI),
                                        g.size != I.size && !n)
                                            return !1;
                                        var l = i.get(g);
                                        if (l)
                                            return l == I;
                                        A |= 2,
                                        i.set(g, I);
                                        var d = Qe(t(g), t(I), A, e, o, i);
                                        return i.delete(g),
                                        d;
                                    case h:
                                        if (VC)
                                            return VC.call(g) == VC.call(I)
                                    }
                                    return !1
                                }(g, I, d, C, A, e, o);
                            if (!(1 & C)) {
                                var X = p && yg.call(g, "__wrapped__")
                                  , Y = v && yg.call(I, "__wrapped__");
                                if (X || Y) {
                                    var K = X ? g.value() : g
                                      , R = Y ? I.value() : I;
                                    return o || (o = new fC),
                                    e(K, R, C, A, o)
                                }
                            }
                            if (!V)
                                return !1;
                            return o || (o = new fC),
                            function(g, I, C, A, e, o) {
                                var i = 1 & C
                                  , t = Ue(g)
                                  , n = t.length
                                  , l = Ue(I).length;
                                if (n != l && !i)
                                    return !1;
                                var c = n;
                                for (; c--; ) {
                                    var a = t[c];
                                    if (!(i ? a in I : yg.call(I, a)))
                                        return !1
                                }
                                var s = o.get(g)
                                  , d = o.get(I);
                                if (s && d)
                                    return s == I && d == g;
                                var b = !0;
                                o.set(g, I),
                                o.set(I, g);
                                var G = i;
                                for (; ++c < n; ) {
                                    a = t[c];
                                    var r = g[a]
                                      , u = I[a];
                                    if (A)
                                        var B = i ? A(u, r, a, I, g, o) : A(r, u, a, g, I, o);
                                    if (!(void 0 === B ? r === u || e(r, u, C, A, o) : B)) {
                                        b = !1;
                                        break
                                    }
                                    G || (G = "constructor" == a)
                                }
                                if (b && !G) {
                                    var Z = g.constructor
                                      , m = I.constructor;
                                    Z == m || !("constructor"in g) || !("constructor"in I) || "function" == typeof Z && Z instanceof Z && "function" == typeof m && m instanceof m || (b = !1)
                                }
                                return o.delete(g),
                                o.delete(I),
                                b
                            }(g, I, C, A, e, o)
                        }(g, I, C, A, mA, e))
                    }
                    function hA(g, I, C, A) {
                        var e = C.length
                          , o = e
                          , i = !A;
                        if (null == g)
                            return !o;
                        for (g = bg(g); e--; ) {
                            var t = C[e];
                            if (i && t[2] ? t[1] !== g[t[0]] : !(t[0]in g))
                                return !1
                        }
                        for (; ++e < o; ) {
                            var n = (t = C[e])[0]
                              , l = g[n]
                              , c = t[1];
                            if (i && t[2]) {
                                if (void 0 === l && !(n in g))
                                    return !1
                            } else {
                                var a = new fC;
                                if (A)
                                    var s = A(l, c, n, g, I, a);
                                if (!(void 0 === s ? mA(c, l, 3, A, a) : s))
                                    return !1
                            }
                        }
                        return !0
                    }
                    function pA(g) {
                        return !(!Qi(g) || (I = g,
                        vg && vg in I)) && (Li(g) ? Kg : ig).test(Xo(g));
                        var I
                    }
                    function yA(g) {
                        return "function" == typeof g ? g : null == g ? Dt : "object" == typeof g ? Fi(g) ? KA(g[0], g[1]) : YA(g) : In(g)
                    }
                    function WA(g) {
                        if (!ao(g))
                            return oC(g);
                        var I = [];
                        for (var C in bg(g))
                            yg.call(g, C) && "constructor" != C && I.push(C);
                        return I
                    }
                    function vA(g) {
                        if (!Qi(g))
                            return function(g) {
                                var I = [];
                                if (null != g)
                                    for (var C in bg(g))
                                        I.push(C);
                                return I
                            }(g);
                        var I = ao(g)
                          , C = [];
                        for (var A in g)
                            ("constructor" != A || !I && yg.call(g, A)) && C.push(A);
                        return C
                    }
                    function VA(g, I) {
                        return g < I
                    }
                    function XA(g, I) {
                        var C = -1
                          , e = Si(g) ? A(g.length) : [];
                        return gA(g, (function(g, A, o) {
                            e[++C] = I(g, A, o)
                        }
                        )),
                        e
                    }
                    function YA(g) {
                        var I = _e(g);
                        return 1 == I.length && I[0][2] ? bo(I[0][0], I[0][1]) : function(C) {
                            return C === g || hA(C, g, I)
                        }
                    }
                    function KA(g, I) {
                        return no(g) && so(I) ? bo(Vo(g), I) : function(C) {
                            var A = Gt(C, g);
                            return void 0 === A && A === I ? rt(C, g) : mA(I, A, 3)
                        }
                    }
                    function RA(g, I, C, A, e) {
                        g !== I && iA(I, (function(o, i) {
                            if (e || (e = new fC),
                            Qi(o))
                                !function(g, I, C, A, e, o, i) {
                                    var t = Bo(g, C)
                                      , n = Bo(I, C)
                                      , l = i.get(n);
                                    if (l)
                                        return void MC(g, C, l);
                                    var c = o ? o(t, n, C + "", g, I, i) : void 0
                                      , a = void 0 === c;
                                    if (a) {
                                        var s = Fi(n)
                                          , d = !s && fi(n)
                                          , b = !s && !d && _i(n);
                                        c = n,
                                        s || d || b ? Fi(t) ? c = t : zi(t) ? c = ue(t) : d ? (a = !1,
                                        c = ae(n, !0)) : b ? (a = !1,
                                        c = de(n, !0)) : c = [] : Ti(n) || Hi(n) ? (c = t,
                                        Hi(t) ? c = it(t) : Qi(t) && !Li(t) || (c = eo(n))) : a = !1
                                    }
                                    a && (i.set(n, c),
                                    e(c, n, A, o, i),
                                    i.delete(n));
                                    MC(g, C, c)
                                }(g, I, i, C, RA, A, e);
                            else {
                                var t = A ? A(Bo(g, i), o, i + "", g, I, e) : void 0;
                                void 0 === t && (t = o),
                                MC(g, i, t)
                            }
                        }
                        ), ht)
                    }
                    function wA(g, I) {
                        var C = g.length;
                        if (C)
                            return io(I += I < 0 ? C : 0, C) ? g[I] : void 0
                    }
                    function HA(g, I, C) {
                        I = I.length ? dI(I, (function(g) {
                            return Fi(g) ? function(I) {
                                return aA(I, 1 === g.length ? g[0] : g)
                            }
                            : g
                        }
                        )) : [Dt];
                        var A = -1;
                        return I = dI(I, wI(Pe())),
                        function(g, I) {
                            var C = g.length;
                            for (g.sort(I); C--; )
                                g[C] = g[C].value;
                            return g
                        }(XA(g, (function(g, C, e) {
                            return {
                                criteria: dI(I, (function(I) {
                                    return I(g)
                                }
                                )),
                                index: ++A,
                                value: g
                            }
                        }
                        )), (function(g, I) {
                            return function(g, I, C) {
                                var A = -1
                                  , e = g.criteria
                                  , o = I.criteria
                                  , i = e.length
                                  , t = C.length;
                                for (; ++A < i; ) {
                                    var n = be(e[A], o[A]);
                                    if (n) {
                                        if (A >= t)
                                            return n;
                                        var l = C[A];
                                        return n * ("desc" == l ? -1 : 1)
                                    }
                                }
                                return g.index - I.index
                            }(g, I, C)
                        }
                        ))
                    }
                    function FA(g, I, C) {
                        for (var A = -1, e = I.length, o = {}; ++A < e; ) {
                            var i = I[A]
                              , t = aA(g, i);
                            C(t, i) && xA(o, te(i, g), t)
                        }
                        return o
                    }
                    function NA(g, I, C, A) {
                        var e = A ? pI : hI
                          , o = -1
                          , i = I.length
                          , t = g;
                        for (g === I && (I = ue(I)),
                        C && (t = dI(g, wI(C))); ++o < i; )
                            for (var n = 0, l = I[o], c = C ? C(l) : l; (n = e(t, c, n, A)) > -1; )
                                t !== g && Og.call(t, n, 1),
                                Og.call(g, n, 1);
                        return g
                    }
                    function SA(g, I) {
                        for (var C = g ? I.length : 0, A = C - 1; C--; ) {
                            var e = I[C];
                            if (C == A || e !== o) {
                                var o = e;
                                io(e) ? Og.call(g, e, 1) : $A(g, e)
                            }
                        }
                        return g
                    }
                    function zA(g, I) {
                        return g + gC(cC() * (I - g + 1))
                    }
                    function fA(g, I) {
                        var C = "";
                        if (!g || I < 1 || I > 9007199254740991)
                            return C;
                        do {
                            I % 2 && (C += g),
                            (I = gC(I / 2)) && (g += g)
                        } while (I);
                        return C
                    }
                    function kA(g, I) {
                        return ho(Go(g, I, Dt), g + "")
                    }
                    function JA(g) {
                        return JC(Kt(g))
                    }
                    function LA(g, I) {
                        var C = Kt(g);
                        return Wo(C, EC(I, 0, C.length))
                    }
                    function xA(g, I, C, A) {
                        if (!Qi(g))
                            return g;
                        for (var e = -1, o = (I = te(I, g)).length, i = o - 1, t = g; null != t && ++e < o; ) {
                            var n = Vo(I[e])
                              , l = C;
                            if ("__proto__" === n || "constructor" === n || "prototype" === n)
                                return g;
                            if (e != i) {
                                var c = t[n];
                                void 0 === (l = A ? A(c, n, t) : void 0) && (l = Qi(c) ? c : io(I[e + 1]) ? [] : {})
                            }
                            QC(t, n, l),
                            t = t[n]
                        }
                        return g
                    }
                    var MA = BC ? function(g, I) {
                        return BC.set(g, I),
                        g
                    }
                    : Dt
                      , QA = BI ? function(g, I) {
                        return BI(g, "toString", {
                            configurable: !0,
                            enumerable: !1,
                            value: Qt(I),
                            writable: !0
                        })
                    }
                    : Dt;
                    function jA(g) {
                        return Wo(Kt(g))
                    }
                    function UA(g, I, C) {
                        var e = -1
                          , o = g.length;
                        I < 0 && (I = -I > o ? 0 : o + I),
                        (C = C > o ? o : C) < 0 && (C += o),
                        o = I > C ? 0 : C - I >>> 0,
                        I >>>= 0;
                        for (var i = A(o); ++e < o; )
                            i[e] = g[e + I];
                        return i
                    }
                    function DA(g, I) {
                        var C;
                        return gA(g, (function(g, A, e) {
                            return !(C = I(g, A, e))
                        }
                        )),
                        !!C
                    }
                    function TA(g, I, C) {
                        var A = 0
                          , e = null == g ? A : g.length;
                        if ("number" == typeof I && I == I && e <= 2147483647) {
                            for (; A < e; ) {
                                var o = A + e >>> 1
                                  , i = g[o];
                                null !== i && !qi(i) && (C ? i <= I : i < I) ? A = o + 1 : e = o
                            }
                            return e
                        }
                        return OA(g, I, Dt, C)
                    }
                    function OA(g, I, C, A) {
                        var e = 0
                          , o = null == g ? 0 : g.length;
                        if (0 === o)
                            return 0;
                        for (var i = (I = C(I)) != I, t = null === I, n = qi(I), l = void 0 === I; e < o; ) {
                            var c = gC((e + o) / 2)
                              , a = C(g[c])
                              , s = void 0 !== a
                              , d = null === a
                              , b = a == a
                              , G = qi(a);
                            if (i)
                                var r = A || b;
                            else
                                r = l ? b && (A || s) : t ? b && s && (A || !d) : n ? b && s && !d && (A || !G) : !d && !G && (A ? a <= I : a < I);
                            r ? e = c + 1 : o = c
                        }
                        return tC(o, 4294967294)
                    }
                    function EA(g, I) {
                        for (var C = -1, A = g.length, e = 0, o = []; ++C < A; ) {
                            var i = g[C]
                              , t = I ? I(i) : i;
                            if (!C || !Ki(t, n)) {
                                var n = t;
                                o[e++] = 0 === i ? 0 : i
                            }
                        }
                        return o
                    }
                    function PA(g) {
                        return "number" == typeof g ? g : qi(g) ? NaN : +g
                    }
                    function qA(g) {
                        if ("string" == typeof g)
                            return g;
                        if (Fi(g))
                            return dI(g, qA) + "";
                        if (qi(g))
                            return XC ? XC.call(g) : "";
                        var I = g + "";
                        return "0" == I && 1 / g == -1 / 0 ? "-0" : I
                    }
                    function _A(g, I, C) {
                        var A = -1
                          , e = aI
                          , o = g.length
                          , i = !0
                          , t = []
                          , n = t;
                        if (C)
                            i = !1,
                            e = sI;
                        else if (o >= 200) {
                            var l = I ? null : fe(g);
                            if (l)
                                return jI(l);
                            i = !1,
                            e = FI,
                            n = new zC
                        } else
                            n = I ? [] : t;
                        g: for (; ++A < o; ) {
                            var c = g[A]
                              , a = I ? I(c) : c;
                            if (c = C || 0 !== c ? c : 0,
                            i && a == a) {
                                for (var s = n.length; s--; )
                                    if (n[s] === a)
                                        continue g;
                                I && n.push(a),
                                t.push(c)
                            } else
                                e(n, a, C) || (n !== t && n.push(a),
                                t.push(c))
                        }
                        return t
                    }
                    function $A(g, I) {
                        return null == (g = ro(g, I = te(I, g))) || delete g[Vo(Jo(I))]
                    }
                    function ge(g, I, C, A) {
                        return xA(g, I, C(aA(g, I)), A)
                    }
                    function Ie(g, I, C, A) {
                        for (var e = g.length, o = A ? e : -1; (A ? o-- : ++o < e) && I(g[o], o, g); )
                            ;
                        return C ? UA(g, A ? 0 : o, A ? o + 1 : e) : UA(g, A ? o + 1 : 0, A ? e : o)
                    }
                    function Ce(g, I) {
                        var C = g;
                        return C instanceof HC && (C = C.value()),
                        GI(I, (function(g, I) {
                            return I.func.apply(I.thisArg, bI([g], I.args))
                        }
                        ), C)
                    }
                    function Ae(g, I, C) {
                        var e = g.length;
                        if (e < 2)
                            return e ? _A(g[0]) : [];
                        for (var o = -1, i = A(e); ++o < e; )
                            for (var t = g[o], n = -1; ++n < e; )
                                n != o && (i[o] = $C(i[o] || t, g[n], I, C));
                        return _A(oA(i, 1), I, C)
                    }
                    function ee(g, I, C) {
                        for (var A = -1, e = g.length, o = I.length, i = {}; ++A < e; ) {
                            var t = A < o ? I[A] : void 0;
                            C(i, g[A], t)
                        }
                        return i
                    }
                    function oe(g) {
                        return zi(g) ? g : []
                    }
                    function ie(g) {
                        return "function" == typeof g ? g : Dt
                    }
                    function te(g, I) {
                        return Fi(g) ? g : no(g, I) ? [g] : vo(tt(g))
                    }
                    var ne = kA;
                    function le(g, I, C) {
                        var A = g.length;
                        return C = void 0 === C ? A : C,
                        !I && C >= A ? g : UA(g, I, C)
                    }
                    var ce = VI || function(g) {
                        return Tg.clearTimeout(g)
                    }
                    ;
                    function ae(g, I) {
                        if (I)
                            return g.slice();
                        var C = g.length
                          , A = zg ? zg(C) : new g.constructor(C);
                        return g.copy(A),
                        A
                    }
                    function se(g) {
                        var I = new g.constructor(g.byteLength);
                        return new Ng(I).set(new Ng(g)),
                        I
                    }
                    function de(g, I) {
                        var C = I ? se(g.buffer) : g.buffer;
                        return new g.constructor(C,g.byteOffset,g.length)
                    }
                    function be(g, I) {
                        if (g !== I) {
                            var C = void 0 !== g
                              , A = null === g
                              , e = g == g
                              , o = qi(g)
                              , i = void 0 !== I
                              , t = null === I
                              , n = I == I
                              , l = qi(I);
                            if (!t && !l && !o && g > I || o && i && n && !t && !l || A && i && n || !C && n || !e)
                                return 1;
                            if (!A && !o && !l && g < I || l && C && e && !A && !o || t && C && e || !i && e || !n)
                                return -1
                        }
                        return 0
                    }
                    function Ge(g, I, C, e) {
                        for (var o = -1, i = g.length, t = C.length, n = -1, l = I.length, c = iC(i - t, 0), a = A(l + c), s = !e; ++n < l; )
                            a[n] = I[n];
                        for (; ++o < t; )
                            (s || o < i) && (a[C[o]] = g[o]);
                        for (; c--; )
                            a[n++] = g[o++];
                        return a
                    }
                    function re(g, I, C, e) {
                        for (var o = -1, i = g.length, t = -1, n = C.length, l = -1, c = I.length, a = iC(i - n, 0), s = A(a + c), d = !e; ++o < a; )
                            s[o] = g[o];
                        for (var b = o; ++l < c; )
                            s[b + l] = I[l];
                        for (; ++t < n; )
                            (d || o < i) && (s[b + C[t]] = g[o++]);
                        return s
                    }
                    function ue(g, I) {
                        var C = -1
                          , e = g.length;
                        for (I || (I = A(e)); ++C < e; )
                            I[C] = g[C];
                        return I
                    }
                    function Be(g, I, C, A) {
                        var e = !C;
                        C || (C = {});
                        for (var o = -1, i = I.length; ++o < i; ) {
                            var t = I[o]
                              , n = A ? A(C[t], g[t], t, C, g) : void 0;
                            void 0 === n && (n = g[t]),
                            e ? TC(C, t, n) : QC(C, t, n)
                        }
                        return C
                    }
                    function Ze(g, I) {
                        return function(C, A) {
                            var e = Fi(C) ? iI : UC
                              , o = I ? I() : {};
                            return e(C, g, Pe(A, 2), o)
                        }
                    }
                    function me(g) {
                        return kA((function(I, C) {
                            var A = -1
                              , e = C.length
                              , o = e > 1 ? C[e - 1] : void 0
                              , i = e > 2 ? C[2] : void 0;
                            for (o = g.length > 3 && "function" == typeof o ? (e--,
                            o) : void 0,
                            i && to(C[0], C[1], i) && (o = e < 3 ? void 0 : o,
                            e = 1),
                            I = bg(I); ++A < e; ) {
                                var t = C[A];
                                t && g(I, t, A, o)
                            }
                            return I
                        }
                        ))
                    }
                    function he(g, I) {
                        return function(C, A) {
                            if (null == C)
                                return C;
                            if (!Si(C))
                                return g(C, A);
                            for (var e = C.length, o = I ? e : -1, i = bg(C); (I ? o-- : ++o < e) && !1 !== A(i[o], o, i); )
                                ;
                            return C
                        }
                    }
                    function pe(g) {
                        return function(I, C, A) {
                            for (var e = -1, o = bg(I), i = A(I), t = i.length; t--; ) {
                                var n = i[g ? t : ++e];
                                if (!1 === C(o[n], n, o))
                                    break
                            }
                            return I
                        }
                    }
                    function ye(g) {
                        return function(I) {
                            var C = LI(I = tt(I)) ? TI(I) : void 0
                              , A = C ? C[0] : I.charAt(0)
                              , e = C ? le(C, 1).join("") : I.slice(1);
                            return A[g]() + e
                        }
                    }
                    function We(g) {
                        return function(I) {
                            return GI(Lt(Ht(I).replace(Hg, "")), g, "")
                        }
                    }
                    function ve(g) {
                        return function() {
                            var I = arguments;
                            switch (I.length) {
                            case 0:
                                return new g;
                            case 1:
                                return new g(I[0]);
                            case 2:
                                return new g(I[0],I[1]);
                            case 3:
                                return new g(I[0],I[1],I[2]);
                            case 4:
                                return new g(I[0],I[1],I[2],I[3]);
                            case 5:
                                return new g(I[0],I[1],I[2],I[3],I[4]);
                            case 6:
                                return new g(I[0],I[1],I[2],I[3],I[4],I[5]);
                            case 7:
                                return new g(I[0],I[1],I[2],I[3],I[4],I[5],I[6])
                            }
                            var C = KC(g.prototype)
                              , A = g.apply(C, I);
                            return Qi(A) ? A : C
                        }
                    }
                    function Ve(g) {
                        return function(I, C, A) {
                            var e = bg(I);
                            if (!Si(I)) {
                                var o = Pe(C, 3);
                                I = mt(I),
                                C = function(g) {
                                    return o(e[g], g, e)
                                }
                            }
                            var i = g(I, C, A);
                            return i > -1 ? e[o ? I[i] : i] : void 0
                        }
                    }
                    function Xe(g) {
                        return je((function(I) {
                            var C = I.length
                              , A = C
                              , e = wC.prototype.thru;
                            for (g && I.reverse(); A--; ) {
                                var i = I[A];
                                if ("function" != typeof i)
                                    throw new ug(o);
                                if (e && !t && "wrapper" == Oe(i))
                                    var t = new wC([],!0)
                            }
                            for (A = t ? A : C; ++A < C; ) {
                                var n = Oe(i = I[A])
                                  , l = "wrapper" == n ? Te(i) : void 0;
                                t = l && lo(l[0]) && 424 == l[1] && !l[4].length && 1 == l[9] ? t[Oe(l[0])].apply(t, l[3]) : 1 == i.length && lo(i) ? t[n]() : t.thru(i)
                            }
                            return function() {
                                var g = arguments
                                  , A = g[0];
                                if (t && 1 == g.length && Fi(A))
                                    return t.plant(A).value();
                                for (var e = 0, o = C ? I[e].apply(this, g) : A; ++e < C; )
                                    o = I[e].call(this, o);
                                return o
                            }
                        }
                        ))
                    }
                    function Ye(g, I, C, e, o, i, t, n, l, c) {
                        var a = 128 & I
                          , s = 1 & I
                          , d = 2 & I
                          , b = 24 & I
                          , G = 512 & I
                          , r = d ? void 0 : ve(g);
                        return function u() {
                            for (var B = arguments.length, Z = A(B), m = B; m--; )
                                Z[m] = arguments[m];
                            if (b)
                                var h = Ee(u)
                                  , p = zI(Z, h);
                            if (e && (Z = Ge(Z, e, o, b)),
                            i && (Z = re(Z, i, t, b)),
                            B -= p,
                            b && B < c) {
                                var y = QI(Z, h);
                                return Se(g, I, Ye, u.placeholder, C, Z, y, n, l, c - B)
                            }
                            var W = s ? C : this
                              , v = d ? W[g] : g;
                            return B = Z.length,
                            n ? Z = uo(Z, n) : G && B > 1 && Z.reverse(),
                            a && l < B && (Z.length = l),
                            this && this !== Tg && this instanceof u && (v = r || ve(v)),
                            v.apply(W, Z)
                        }
                    }
                    function Ke(g, I) {
                        return function(C, A) {
                            return function(g, I, C, A) {
                                return nA(g, (function(g, e, o) {
                                    I(A, C(g), e, o)
                                }
                                )),
                                A
                            }(C, g, I(A), {})
                        }
                    }
                    function Re(g, I) {
                        return function(C, A) {
                            var e;
                            if (void 0 === C && void 0 === A)
                                return I;
                            if (void 0 !== C && (e = C),
                            void 0 !== A) {
                                if (void 0 === e)
                                    return A;
                                "string" == typeof C || "string" == typeof A ? (C = qA(C),
                                A = qA(A)) : (C = PA(C),
                                A = PA(A)),
                                e = g(C, A)
                            }
                            return e
                        }
                    }
                    function we(g) {
                        return je((function(I) {
                            return I = dI(I, wI(Pe())),
                            kA((function(C) {
                                var A = this;
                                return g(I, (function(g) {
                                    return oI(g, A, C)
                                }
                                ))
                            }
                            ))
                        }
                        ))
                    }
                    function He(g, I) {
                        var C = (I = void 0 === I ? " " : qA(I)).length;
                        if (C < 2)
                            return C ? fA(I, g) : I;
                        var A = fA(I, $I(g / DI(I)));
                        return LI(I) ? le(TI(A), 0, g).join("") : A.slice(0, g)
                    }
                    function Fe(g) {
                        return function(I, C, e) {
                            return e && "number" != typeof e && to(I, C, e) && (C = e = void 0),
                            I = Ct(I),
                            void 0 === C ? (C = I,
                            I = 0) : C = Ct(C),
                            function(g, I, C, e) {
                                for (var o = -1, i = iC($I((I - g) / (C || 1)), 0), t = A(i); i--; )
                                    t[e ? i : ++o] = g,
                                    g += C;
                                return t
                            }(I, C, e = void 0 === e ? I < C ? 1 : -1 : Ct(e), g)
                        }
                    }
                    function Ne(g) {
                        return function(I, C) {
                            return "string" == typeof I && "string" == typeof C || (I = ot(I),
                            C = ot(C)),
                            g(I, C)
                        }
                    }
                    function Se(g, I, C, A, e, o, i, t, n, l) {
                        var c = 8 & I;
                        I |= c ? 32 : 64,
                        4 & (I &= ~(c ? 64 : 32)) || (I &= -4);
                        var a = [g, I, e, c ? o : void 0, c ? i : void 0, c ? void 0 : o, c ? void 0 : i, t, n, l]
                          , s = C.apply(void 0, a);
                        return lo(g) && Zo(s, a),
                        s.placeholder = A,
                        po(s, g, I)
                    }
                    function ze(g) {
                        var I = dg[g];
                        return function(g, C) {
                            if (g = ot(g),
                            (C = null == C ? 0 : tC(At(C), 292)) && AC(g)) {
                                var A = (tt(g) + "e").split("e");
                                return +((A = (tt(I(A[0] + "e" + (+A[1] + C))) + "e").split("e"))[0] + "e" + (+A[1] - C))
                            }
                            return I(g)
                        }
                    }
                    var fe = GC && 1 / jI(new GC([, -0]))[1] == 1 / 0 ? function(g) {
                        return new GC(g)
                    }
                    : qt;
                    function ke(g) {
                        return function(I) {
                            var C = Co(I);
                            return C == G ? xI(I) : C == Z ? UI(I) : function(g, I) {
                                return dI(I, (function(I) {
                                    return [I, g[I]]
                                }
                                ))
                            }(I, g(I))
                        }
                    }
                    function Je(g, I, C, e, t, n, l, c) {
                        var a = 2 & I;
                        if (!a && "function" != typeof g)
                            throw new ug(o);
                        var s = e ? e.length : 0;
                        if (s || (I &= -97,
                        e = t = void 0),
                        l = void 0 === l ? l : iC(At(l), 0),
                        c = void 0 === c ? c : At(c),
                        s -= t ? t.length : 0,
                        64 & I) {
                            var d = e
                              , b = t;
                            e = t = void 0
                        }
                        var G = a ? void 0 : Te(g)
                          , r = [g, I, C, e, t, d, b, n, l, c];
                        if (G && function(g, I) {
                            var C = g[1]
                              , A = I[1]
                              , e = C | A
                              , o = e < 131
                              , t = 128 == A && 8 == C || 128 == A && 256 == C && g[7].length <= I[8] || 384 == A && I[7].length <= I[8] && 8 == C;
                            if (!o && !t)
                                return g;
                            1 & A && (g[2] = I[2],
                            e |= 1 & C ? 0 : 4);
                            var n = I[3];
                            if (n) {
                                var l = g[3];
                                g[3] = l ? Ge(l, n, I[4]) : n,
                                g[4] = l ? QI(g[3], i) : I[4]
                            }
                            (n = I[5]) && (l = g[5],
                            g[5] = l ? re(l, n, I[6]) : n,
                            g[6] = l ? QI(g[5], i) : I[6]);
                            (n = I[7]) && (g[7] = n);
                            128 & A && (g[8] = null == g[8] ? I[8] : tC(g[8], I[8]));
                            null == g[9] && (g[9] = I[9]);
                            g[0] = I[0],
                            g[1] = e
                        }(r, G),
                        g = r[0],
                        I = r[1],
                        C = r[2],
                        e = r[3],
                        t = r[4],
                        !(c = r[9] = void 0 === r[9] ? a ? 0 : g.length : iC(r[9] - s, 0)) && 24 & I && (I &= -25),
                        I && 1 != I)
                            u = 8 == I || 16 == I ? function(g, I, C) {
                                var e = ve(g);
                                return function o() {
                                    for (var i = arguments.length, t = A(i), n = i, l = Ee(o); n--; )
                                        t[n] = arguments[n];
                                    var c = i < 3 && t[0] !== l && t[i - 1] !== l ? [] : QI(t, l);
                                    if ((i -= c.length) < C)
                                        return Se(g, I, Ye, o.placeholder, void 0, t, c, void 0, void 0, C - i);
                                    var a = this && this !== Tg && this instanceof o ? e : g;
                                    return oI(a, this, t)
                                }
                            }(g, I, c) : 32 != I && 33 != I || t.length ? Ye.apply(void 0, r) : function(g, I, C, e) {
                                var o = 1 & I
                                  , i = ve(g);
                                return function I() {
                                    for (var t = -1, n = arguments.length, l = -1, c = e.length, a = A(c + n), s = this && this !== Tg && this instanceof I ? i : g; ++l < c; )
                                        a[l] = e[l];
                                    for (; n--; )
                                        a[l++] = arguments[++t];
                                    return oI(s, o ? C : this, a)
                                }
                            }(g, I, C, e);
                        else
                            var u = function(g, I, C) {
                                var A = 1 & I
                                  , e = ve(g);
                                return function I() {
                                    var o = this && this !== Tg && this instanceof I ? e : g;
                                    return o.apply(A ? C : this, arguments)
                                }
                            }(g, I, C);
                        return po((G ? MA : Zo)(u, r), g, I)
                    }
                    function Le(g, I, C, A) {
                        return void 0 === g || Ki(g, mg[C]) && !yg.call(A, C) ? I : g
                    }
                    function xe(g, I, C, A, e, o) {
                        return Qi(g) && Qi(I) && (o.set(I, g),
                        RA(g, I, void 0, xe, o),
                        o.delete(I)),
                        g
                    }
                    function Me(g) {
                        return Ti(g) ? void 0 : g
                    }
                    function Qe(g, I, C, A, e, o) {
                        var i = 1 & C
                          , t = g.length
                          , n = I.length;
                        if (t != n && !(i && n > t))
                            return !1;
                        var l = o.get(g)
                          , c = o.get(I);
                        if (l && c)
                            return l == I && c == g;
                        var a = -1
                          , s = !0
                          , d = 2 & C ? new zC : void 0;
                        for (o.set(g, I),
                        o.set(I, g); ++a < t; ) {
                            var b = g[a]
                              , G = I[a];
                            if (A)
                                var r = i ? A(G, b, a, I, g, o) : A(b, G, a, g, I, o);
                            if (void 0 !== r) {
                                if (r)
                                    continue;
                                s = !1;
                                break
                            }
                            if (d) {
                                if (!uI(I, (function(g, I) {
                                    if (!FI(d, I) && (b === g || e(b, g, C, A, o)))
                                        return d.push(I)
                                }
                                ))) {
                                    s = !1;
                                    break
                                }
                            } else if (b !== G && !e(b, G, C, A, o)) {
                                s = !1;
                                break
                            }
                        }
                        return o.delete(g),
                        o.delete(I),
                        s
                    }
                    function je(g) {
                        return ho(Go(g, void 0, No), g + "")
                    }
                    function Ue(g) {
                        return sA(g, mt, go)
                    }
                    function De(g) {
                        return sA(g, ht, Io)
                    }
                    var Te = BC ? function(g) {
                        return BC.get(g)
                    }
                    : qt;
                    function Oe(g) {
                        for (var I = g.name + "", C = ZC[I], A = yg.call(ZC, I) ? C.length : 0; A--; ) {
                            var e = C[A]
                              , o = e.func;
                            if (null == o || o == g)
                                return e.name
                        }
                        return I
                    }
                    function Ee(g) {
                        return (yg.call(YC, "placeholder") ? YC : g).placeholder
                    }
                    function Pe() {
                        var g = YC.iteratee || Tt;
                        return g = g === Tt ? yA : g,
                        arguments.length ? g(arguments[0], arguments[1]) : g
                    }
                    function qe(g, I) {
                        var C, A, e = g.__data__;
                        return ("string" == (A = typeof (C = I)) || "number" == A || "symbol" == A || "boolean" == A ? "__proto__" !== C : null === C) ? e["string" == typeof I ? "string" : "hash"] : e.map
                    }
                    function _e(g) {
                        for (var I = mt(g), C = I.length; C--; ) {
                            var A = I[C]
                              , e = g[A];
                            I[C] = [A, e, so(e)]
                        }
                        return I
                    }
                    function $e(g, I) {
                        var C = function(g, I) {
                            return null == g ? void 0 : g[I]
                        }(g, I);
                        return pA(C) ? C : void 0
                    }
                    var go = IC ? function(g) {
                        return null == g ? [] : (g = bg(g),
                        cI(IC(g), (function(I) {
                            return Dg.call(g, I)
                        }
                        )))
                    }
                    : en
                      , Io = IC ? function(g) {
                        for (var I = []; g; )
                            bI(I, go(g)),
                            g = Mg(g);
                        return I
                    }
                    : en
                      , Co = dA;
                    function Ao(g, I, C) {
                        for (var A = -1, e = (I = te(I, g)).length, o = !1; ++A < e; ) {
                            var i = Vo(I[A]);
                            if (!(o = null != g && C(g, i)))
                                break;
                            g = g[i]
                        }
                        return o || ++A != e ? o : !!(e = null == g ? 0 : g.length) && Mi(e) && io(i, e) && (Fi(g) || Hi(g))
                    }
                    function eo(g) {
                        return "function" != typeof g.constructor || ao(g) ? {} : KC(Mg(g))
                    }
                    function oo(g) {
                        return Fi(g) || Hi(g) || !!(Eg && g && g[Eg])
                    }
                    function io(g, I) {
                        var C = typeof g;
                        return !!(I = null == I ? 9007199254740991 : I) && ("number" == C || "symbol" != C && ng.test(g)) && g > -1 && g % 1 == 0 && g < I
                    }
                    function to(g, I, C) {
                        if (!Qi(C))
                            return !1;
                        var A = typeof I;
                        return !!("number" == A ? Si(C) && io(I, C.length) : "string" == A && I in C) && Ki(C[I], g)
                    }
                    function no(g, I) {
                        if (Fi(g))
                            return !1;
                        var C = typeof g;
                        return !("number" != C && "symbol" != C && "boolean" != C && null != g && !qi(g)) || (j.test(g) || !Q.test(g) || null != I && g in bg(I))
                    }
                    function lo(g) {
                        var I = Oe(g)
                          , C = YC[I];
                        if ("function" != typeof C || !(I in HC.prototype))
                            return !1;
                        if (g === C)
                            return !0;
                        var A = Te(C);
                        return !!A && g === A[0]
                    }
                    (sC && Co(new sC(new ArrayBuffer(1))) != W || dC && Co(new dC) != G || bC && "[object Promise]" != Co(bC.resolve()) || GC && Co(new GC) != Z || rC && Co(new rC) != p) && (Co = function(g) {
                        var I = dA(g)
                          , C = I == u ? g.constructor : void 0
                          , A = C ? Xo(C) : "";
                        if (A)
                            switch (A) {
                            case mC:
                                return W;
                            case hC:
                                return G;
                            case pC:
                                return "[object Promise]";
                            case yC:
                                return Z;
                            case WC:
                                return p
                            }
                        return I
                    }
                    );
                    var co = hg ? Li : on;
                    function ao(g) {
                        var I = g && g.constructor;
                        return g === ("function" == typeof I && I.prototype || mg)
                    }
                    function so(g) {
                        return g == g && !Qi(g)
                    }
                    function bo(g, I) {
                        return function(C) {
                            return null != C && (C[g] === I && (void 0 !== I || g in bg(C)))
                        }
                    }
                    function Go(g, I, C) {
                        return I = iC(void 0 === I ? g.length - 1 : I, 0),
                        function() {
                            for (var e = arguments, o = -1, i = iC(e.length - I, 0), t = A(i); ++o < i; )
                                t[o] = e[I + o];
                            o = -1;
                            for (var n = A(I + 1); ++o < I; )
                                n[o] = e[o];
                            return n[I] = C(t),
                            oI(g, this, n)
                        }
                    }
                    function ro(g, I) {
                        return I.length < 2 ? g : aA(g, UA(I, 0, -1))
                    }
                    function uo(g, I) {
                        for (var C = g.length, A = tC(I.length, C), e = ue(g); A--; ) {
                            var o = I[A];
                            g[A] = io(o, C) ? e[o] : void 0
                        }
                        return g
                    }
                    function Bo(g, I) {
                        if (("constructor" !== I || "function" != typeof g[I]) && "__proto__" != I)
                            return g[I]
                    }
                    var Zo = yo(MA)
                      , mo = _I || function(g, I) {
                        return Tg.setTimeout(g, I)
                    }
                      , ho = yo(QA);
                    function po(g, I, C) {
                        var A = I + "";
                        return ho(g, function(g, I) {
                            var C = I.length;
                            if (!C)
                                return g;
                            var A = C - 1;
                            return I[A] = (C > 1 ? "& " : "") + I[A],
                            I = I.join(C > 2 ? ", " : " "),
                            g.replace(P, "{\n/* [wrapped with " + I + "] */\n")
                        }(A, function(g, I) {
                            return tI(t, (function(C) {
                                var A = "_." + C[0];
                                I & C[1] && !aI(g, A) && g.push(A)
                            }
                            )),
                            g.sort()
                        }(function(g) {
                            var I = g.match(q);
                            return I ? I[1].split(_) : []
                        }(A), C)))
                    }
                    function yo(g) {
                        var I = 0
                          , C = 0;
                        return function() {
                            var A = nC()
                              , e = 16 - (A - C);
                            if (C = A,
                            e > 0) {
                                if (++I >= 800)
                                    return arguments[0]
                            } else
                                I = 0;
                            return g.apply(void 0, arguments)
                        }
                    }
                    function Wo(g, I) {
                        var C = -1
                          , A = g.length
                          , e = A - 1;
                        for (I = void 0 === I ? A : I; ++C < I; ) {
                            var o = zA(C, e)
                              , i = g[o];
                            g[o] = g[C],
                            g[C] = i
                        }
                        return g.length = I,
                        g
                    }
                    var vo = function(g) {
                        var I = yi(g, (function(g) {
                            return 500 === C.size && C.clear(),
                            g
                        }
                        ))
                          , C = I.cache;
                        return I
                    }((function(g) {
                        var I = [];
                        return 46 === g.charCodeAt(0) && I.push(""),
                        g.replace(U, (function(g, C, A, e) {
                            I.push(A ? e.replace(Ig, "$1") : C || g)
                        }
                        )),
                        I
                    }
                    ));
                    function Vo(g) {
                        if ("string" == typeof g || qi(g))
                            return g;
                        var I = g + "";
                        return "0" == I && 1 / g == -1 / 0 ? "-0" : I
                    }
                    function Xo(g) {
                        if (null != g) {
                            try {
                                return pg.call(g)
                            } catch (g) {}
                            try {
                                return g + ""
                            } catch (g) {}
                        }
                        return ""
                    }
                    function Yo(g) {
                        if (g instanceof HC)
                            return g.clone();
                        var I = new wC(g.__wrapped__,g.__chain__);
                        return I.__actions__ = ue(g.__actions__),
                        I.__index__ = g.__index__,
                        I.__values__ = g.__values__,
                        I
                    }
                    var Ko = kA((function(g, I) {
                        return zi(g) ? $C(g, oA(I, 1, zi, !0)) : []
                    }
                    ))
                      , Ro = kA((function(g, I) {
                        var C = Jo(I);
                        return zi(C) && (C = void 0),
                        zi(g) ? $C(g, oA(I, 1, zi, !0), Pe(C, 2)) : []
                    }
                    ))
                      , wo = kA((function(g, I) {
                        var C = Jo(I);
                        return zi(C) && (C = void 0),
                        zi(g) ? $C(g, oA(I, 1, zi, !0), void 0, C) : []
                    }
                    ));
                    function Ho(g, I, C) {
                        var A = null == g ? 0 : g.length;
                        if (!A)
                            return -1;
                        var e = null == C ? 0 : At(C);
                        return e < 0 && (e = iC(A + e, 0)),
                        mI(g, Pe(I, 3), e)
                    }
                    function Fo(g, I, C) {
                        var A = null == g ? 0 : g.length;
                        if (!A)
                            return -1;
                        var e = A - 1;
                        return void 0 !== C && (e = At(C),
                        e = C < 0 ? iC(A + e, 0) : tC(e, A - 1)),
                        mI(g, Pe(I, 3), e, !0)
                    }
                    function No(g) {
                        return (null == g ? 0 : g.length) ? oA(g, 1) : []
                    }
                    function So(g) {
                        return g && g.length ? g[0] : void 0
                    }
                    var zo = kA((function(g) {
                        var I = dI(g, oe);
                        return I.length && I[0] === g[0] ? uA(I) : []
                    }
                    ))
                      , fo = kA((function(g) {
                        var I = Jo(g)
                          , C = dI(g, oe);
                        return I === Jo(C) ? I = void 0 : C.pop(),
                        C.length && C[0] === g[0] ? uA(C, Pe(I, 2)) : []
                    }
                    ))
                      , ko = kA((function(g) {
                        var I = Jo(g)
                          , C = dI(g, oe);
                        return (I = "function" == typeof I ? I : void 0) && C.pop(),
                        C.length && C[0] === g[0] ? uA(C, void 0, I) : []
                    }
                    ));
                    function Jo(g) {
                        var I = null == g ? 0 : g.length;
                        return I ? g[I - 1] : void 0
                    }
                    var Lo = kA(xo);
                    function xo(g, I) {
                        return g && g.length && I && I.length ? NA(g, I) : g
                    }
                    var Mo = je((function(g, I) {
                        var C = null == g ? 0 : g.length
                          , A = OC(g, I);
                        return SA(g, dI(I, (function(g) {
                            return io(g, C) ? +g : g
                        }
                        )).sort(be)),
                        A
                    }
                    ));
                    function Qo(g) {
                        return null == g ? g : aC.call(g)
                    }
                    var jo = kA((function(g) {
                        return _A(oA(g, 1, zi, !0))
                    }
                    ))
                      , Uo = kA((function(g) {
                        var I = Jo(g);
                        return zi(I) && (I = void 0),
                        _A(oA(g, 1, zi, !0), Pe(I, 2))
                    }
                    ))
                      , Do = kA((function(g) {
                        var I = Jo(g);
                        return I = "function" == typeof I ? I : void 0,
                        _A(oA(g, 1, zi, !0), void 0, I)
                    }
                    ));
                    function To(g) {
                        if (!g || !g.length)
                            return [];
                        var I = 0;
                        return g = cI(g, (function(g) {
                            if (zi(g))
                                return I = iC(g.length, I),
                                !0
                        }
                        )),
                        KI(I, (function(I) {
                            return dI(g, vI(I))
                        }
                        ))
                    }
                    function Oo(g, I) {
                        if (!g || !g.length)
                            return [];
                        var C = To(g);
                        return null == I ? C : dI(C, (function(g) {
                            return oI(I, void 0, g)
                        }
                        ))
                    }
                    var Eo = kA((function(g, I) {
                        return zi(g) ? $C(g, I) : []
                    }
                    ))
                      , Po = kA((function(g) {
                        return Ae(cI(g, zi))
                    }
                    ))
                      , qo = kA((function(g) {
                        var I = Jo(g);
                        return zi(I) && (I = void 0),
                        Ae(cI(g, zi), Pe(I, 2))
                    }
                    ))
                      , _o = kA((function(g) {
                        var I = Jo(g);
                        return I = "function" == typeof I ? I : void 0,
                        Ae(cI(g, zi), void 0, I)
                    }
                    ))
                      , $o = kA(To);
                    var gi = kA((function(g) {
                        var I = g.length
                          , C = I > 1 ? g[I - 1] : void 0;
                        return C = "function" == typeof C ? (g.pop(),
                        C) : void 0,
                        Oo(g, C)
                    }
                    ));
                    function Ii(g) {
                        var I = YC(g);
                        return I.__chain__ = !0,
                        I
                    }
                    function Ci(g, I) {
                        return I(g)
                    }
                    var Ai = je((function(g) {
                        var I = g.length
                          , C = I ? g[0] : 0
                          , A = this.__wrapped__
                          , e = function(I) {
                            return OC(I, g)
                        };
                        return !(I > 1 || this.__actions__.length) && A instanceof HC && io(C) ? ((A = A.slice(C, +C + (I ? 1 : 0))).__actions__.push({
                            func: Ci,
                            args: [e],
                            thisArg: void 0
                        }),
                        new wC(A,this.__chain__).thru((function(g) {
                            return I && !g.length && g.push(void 0),
                            g
                        }
                        ))) : this.thru(e)
                    }
                    ));
                    var ei = Ze((function(g, I, C) {
                        yg.call(g, C) ? ++g[C] : TC(g, C, 1)
                    }
                    ));
                    var oi = Ve(Ho)
                      , ii = Ve(Fo);
                    function ti(g, I) {
                        return (Fi(g) ? tI : gA)(g, Pe(I, 3))
                    }
                    function ni(g, I) {
                        return (Fi(g) ? nI : IA)(g, Pe(I, 3))
                    }
                    var li = Ze((function(g, I, C) {
                        yg.call(g, C) ? g[C].push(I) : TC(g, C, [I])
                    }
                    ));
                    var ci = kA((function(g, I, C) {
                        var e = -1
                          , o = "function" == typeof I
                          , i = Si(g) ? A(g.length) : [];
                        return gA(g, (function(g) {
                            i[++e] = o ? oI(I, g, C) : BA(g, I, C)
                        }
                        )),
                        i
                    }
                    ))
                      , ai = Ze((function(g, I, C) {
                        TC(g, C, I)
                    }
                    ));
                    function si(g, I) {
                        return (Fi(g) ? dI : XA)(g, Pe(I, 3))
                    }
                    var di = Ze((function(g, I, C) {
                        g[C ? 0 : 1].push(I)
                    }
                    ), (function() {
                        return [[], []]
                    }
                    ));
                    var bi = kA((function(g, I) {
                        if (null == g)
                            return [];
                        var C = I.length;
                        return C > 1 && to(g, I[0], I[1]) ? I = [] : C > 2 && to(I[0], I[1], I[2]) && (I = [I[0]]),
                        HA(g, oA(I, 1), [])
                    }
                    ))
                      , Gi = qI || function() {
                        return Tg.Date.now()
                    }
                    ;
                    function ri(g, I, C) {
                        return I = C ? void 0 : I,
                        Je(g, 128, void 0, void 0, void 0, void 0, I = g && null == I ? g.length : I)
                    }
                    function ui(g, I) {
                        var C;
                        if ("function" != typeof I)
                            throw new ug(o);
                        return g = At(g),
                        function() {
                            return --g > 0 && (C = I.apply(this, arguments)),
                            g <= 1 && (I = void 0),
                            C
                        }
                    }
                    var Bi = kA((function(g, I, C) {
                        var A = 1;
                        if (C.length) {
                            var e = QI(C, Ee(Bi));
                            A |= 32
                        }
                        return Je(g, A, I, C, e)
                    }
                    ))
                      , Zi = kA((function(g, I, C) {
                        var A = 3;
                        if (C.length) {
                            var e = QI(C, Ee(Zi));
                            A |= 32
                        }
                        return Je(I, A, g, C, e)
                    }
                    ));
                    function mi(g, I, C) {
                        var A, e, i, t, n, l, c = 0, a = !1, s = !1, d = !0;
                        if ("function" != typeof g)
                            throw new ug(o);
                        function b(I) {
                            var C = A
                              , o = e;
                            return A = e = void 0,
                            c = I,
                            t = g.apply(o, C)
                        }
                        function G(g) {
                            return c = g,
                            n = mo(u, I),
                            a ? b(g) : t
                        }
                        function r(g) {
                            var C = g - l;
                            return void 0 === l || C >= I || C < 0 || s && g - c >= i
                        }
                        function u() {
                            var g = Gi();
                            if (r(g))
                                return B(g);
                            n = mo(u, function(g) {
                                var C = I - (g - l);
                                return s ? tC(C, i - (g - c)) : C
                            }(g))
                        }
                        function B(g) {
                            return n = void 0,
                            d && A ? b(g) : (A = e = void 0,
                            t)
                        }
                        function Z() {
                            var g = Gi()
                              , C = r(g);
                            if (A = arguments,
                            e = this,
                            l = g,
                            C) {
                                if (void 0 === n)
                                    return G(l);
                                if (s)
                                    return ce(n),
                                    n = mo(u, I),
                                    b(l)
                            }
                            return void 0 === n && (n = mo(u, I)),
                            t
                        }
                        return I = ot(I) || 0,
                        Qi(C) && (a = !!C.leading,
                        i = (s = "maxWait"in C) ? iC(ot(C.maxWait) || 0, I) : i,
                        d = "trailing"in C ? !!C.trailing : d),
                        Z.cancel = function() {
                            void 0 !== n && ce(n),
                            c = 0,
                            A = l = e = n = void 0
                        }
                        ,
                        Z.flush = function() {
                            return void 0 === n ? t : B(Gi())
                        }
                        ,
                        Z
                    }
                    var hi = kA((function(g, I) {
                        return _C(g, 1, I)
                    }
                    ))
                      , pi = kA((function(g, I, C) {
                        return _C(g, ot(I) || 0, C)
                    }
                    ));
                    function yi(g, I) {
                        if ("function" != typeof g || null != I && "function" != typeof I)
                            throw new ug(o);
                        var C = function() {
                            var A = arguments
                              , e = I ? I.apply(this, A) : A[0]
                              , o = C.cache;
                            if (o.has(e))
                                return o.get(e);
                            var i = g.apply(this, A);
                            return C.cache = o.set(e, i) || o,
                            i
                        };
                        return C.cache = new (yi.Cache || SC),
                        C
                    }
                    function Wi(g) {
                        if ("function" != typeof g)
                            throw new ug(o);
                        return function() {
                            var I = arguments;
                            switch (I.length) {
                            case 0:
                                return !g.call(this);
                            case 1:
                                return !g.call(this, I[0]);
                            case 2:
                                return !g.call(this, I[0], I[1]);
                            case 3:
                                return !g.call(this, I[0], I[1], I[2])
                            }
                            return !g.apply(this, I)
                        }
                    }
                    yi.Cache = SC;
                    var vi = ne((function(g, I) {
                        var C = (I = 1 == I.length && Fi(I[0]) ? dI(I[0], wI(Pe())) : dI(oA(I, 1), wI(Pe()))).length;
                        return kA((function(A) {
                            for (var e = -1, o = tC(A.length, C); ++e < o; )
                                A[e] = I[e].call(this, A[e]);
                            return oI(g, this, A)
                        }
                        ))
                    }
                    ))
                      , Vi = kA((function(g, I) {
                        return Je(g, 32, void 0, I, QI(I, Ee(Vi)))
                    }
                    ))
                      , Xi = kA((function(g, I) {
                        return Je(g, 64, void 0, I, QI(I, Ee(Xi)))
                    }
                    ))
                      , Yi = je((function(g, I) {
                        return Je(g, 256, void 0, void 0, void 0, I)
                    }
                    ));
                    function Ki(g, I) {
                        return g === I || g != g && I != I
                    }
                    var Ri = Ne(bA)
                      , wi = Ne((function(g, I) {
                        return g >= I
                    }
                    ))
                      , Hi = ZA(function() {
                        return arguments
                    }()) ? ZA : function(g) {
                        return ji(g) && yg.call(g, "callee") && !Dg.call(g, "callee")
                    }
                      , Fi = A.isArray
                      , Ni = $g ? wI($g) : function(g) {
                        return ji(g) && dA(g) == y
                    }
                    ;
                    function Si(g) {
                        return null != g && Mi(g.length) && !Li(g)
                    }
                    function zi(g) {
                        return ji(g) && Si(g)
                    }
                    var fi = CC || on
                      , ki = gI ? wI(gI) : function(g) {
                        return ji(g) && dA(g) == a
                    }
                    ;
                    function Ji(g) {
                        if (!ji(g))
                            return !1;
                        var I = dA(g);
                        return I == s || "[object DOMException]" == I || "string" == typeof g.message && "string" == typeof g.name && !Ti(g)
                    }
                    function Li(g) {
                        if (!Qi(g))
                            return !1;
                        var I = dA(g);
                        return I == d || I == b || "[object AsyncFunction]" == I || "[object Proxy]" == I
                    }
                    function xi(g) {
                        return "number" == typeof g && g == At(g)
                    }
                    function Mi(g) {
                        return "number" == typeof g && g > -1 && g % 1 == 0 && g <= 9007199254740991
                    }
                    function Qi(g) {
                        var I = typeof g;
                        return null != g && ("object" == I || "function" == I)
                    }
                    function ji(g) {
                        return null != g && "object" == typeof g
                    }
                    var Ui = II ? wI(II) : function(g) {
                        return ji(g) && Co(g) == G
                    }
                    ;
                    function Di(g) {
                        return "number" == typeof g || ji(g) && dA(g) == r
                    }
                    function Ti(g) {
                        if (!ji(g) || dA(g) != u)
                            return !1;
                        var I = Mg(g);
                        if (null === I)
                            return !0;
                        var C = yg.call(I, "constructor") && I.constructor;
                        return "function" == typeof C && C instanceof C && pg.call(C) == Xg
                    }
                    var Oi = CI ? wI(CI) : function(g) {
                        return ji(g) && dA(g) == B
                    }
                    ;
                    var Ei = AI ? wI(AI) : function(g) {
                        return ji(g) && Co(g) == Z
                    }
                    ;
                    function Pi(g) {
                        return "string" == typeof g || !Fi(g) && ji(g) && dA(g) == m
                    }
                    function qi(g) {
                        return "symbol" == typeof g || ji(g) && dA(g) == h
                    }
                    var _i = eI ? wI(eI) : function(g) {
                        return ji(g) && Mi(g.length) && !!Lg[dA(g)]
                    }
                    ;
                    var $i = Ne(VA)
                      , gt = Ne((function(g, I) {
                        return g <= I
                    }
                    ));
                    function It(g) {
                        if (!g)
                            return [];
                        if (Si(g))
                            return Pi(g) ? TI(g) : ue(g);
                        if (qg && g[qg])
                            return function(g) {
                                for (var I, C = []; !(I = g.next()).done; )
                                    C.push(I.value);
                                return C
                            }(g[qg]());
                        var I = Co(g);
                        return (I == G ? xI : I == Z ? jI : Kt)(g)
                    }
                    function Ct(g) {
                        return g ? (g = ot(g)) === 1 / 0 || g === -1 / 0 ? 17976931348623157e292 * (g < 0 ? -1 : 1) : g == g ? g : 0 : 0 === g ? g : 0
                    }
                    function At(g) {
                        var I = Ct(g)
                          , C = I % 1;
                        return I == I ? C ? I - C : I : 0
                    }
                    function et(g) {
                        return g ? EC(At(g), 0, 4294967295) : 0
                    }
                    function ot(g) {
                        if ("number" == typeof g)
                            return g;
                        if (qi(g))
                            return NaN;
                        if (Qi(g)) {
                            var I = "function" == typeof g.valueOf ? g.valueOf() : g;
                            g = Qi(I) ? I + "" : I
                        }
                        if ("string" != typeof g)
                            return 0 === g ? g : +g;
                        g = RI(g);
                        var C = og.test(g);
                        return C || tg.test(g) ? jg(g.slice(2), C ? 2 : 8) : eg.test(g) ? NaN : +g
                    }
                    function it(g) {
                        return Be(g, ht(g))
                    }
                    function tt(g) {
                        return null == g ? "" : qA(g)
                    }
                    var nt = me((function(g, I) {
                        if (ao(I) || Si(I))
                            Be(I, mt(I), g);
                        else
                            for (var C in I)
                                yg.call(I, C) && QC(g, C, I[C])
                    }
                    ))
                      , lt = me((function(g, I) {
                        Be(I, ht(I), g)
                    }
                    ))
                      , ct = me((function(g, I, C, A) {
                        Be(I, ht(I), g, A)
                    }
                    ))
                      , at = me((function(g, I, C, A) {
                        Be(I, mt(I), g, A)
                    }
                    ))
                      , st = je(OC);
                    var dt = kA((function(g, I) {
                        g = bg(g);
                        var C = -1
                          , A = I.length
                          , e = A > 2 ? I[2] : void 0;
                        for (e && to(I[0], I[1], e) && (A = 1); ++C < A; )
                            for (var o = I[C], i = ht(o), t = -1, n = i.length; ++t < n; ) {
                                var l = i[t]
                                  , c = g[l];
                                (void 0 === c || Ki(c, mg[l]) && !yg.call(g, l)) && (g[l] = o[l])
                            }
                        return g
                    }
                    ))
                      , bt = kA((function(g) {
                        return g.push(void 0, xe),
                        oI(yt, void 0, g)
                    }
                    ));
                    function Gt(g, I, C) {
                        var A = null == g ? void 0 : aA(g, I);
                        return void 0 === A ? C : A
                    }
                    function rt(g, I) {
                        return null != g && Ao(g, I, rA)
                    }
                    var ut = Ke((function(g, I, C) {
                        null != I && "function" != typeof I.toString && (I = Vg.call(I)),
                        g[I] = C
                    }
                    ), Qt(Dt))
                      , Bt = Ke((function(g, I, C) {
                        null != I && "function" != typeof I.toString && (I = Vg.call(I)),
                        yg.call(g, I) ? g[I].push(C) : g[I] = [C]
                    }
                    ), Pe)
                      , Zt = kA(BA);
                    function mt(g) {
                        return Si(g) ? kC(g) : WA(g)
                    }
                    function ht(g) {
                        return Si(g) ? kC(g, !0) : vA(g)
                    }
                    var pt = me((function(g, I, C) {
                        RA(g, I, C)
                    }
                    ))
                      , yt = me((function(g, I, C, A) {
                        RA(g, I, C, A)
                    }
                    ))
                      , Wt = je((function(g, I) {
                        var C = {};
                        if (null == g)
                            return C;
                        var A = !1;
                        I = dI(I, (function(I) {
                            return I = te(I, g),
                            A || (A = I.length > 1),
                            I
                        }
                        )),
                        Be(g, De(g), C),
                        A && (C = PC(C, 7, Me));
                        for (var e = I.length; e--; )
                            $A(C, I[e]);
                        return C
                    }
                    ));
                    var vt = je((function(g, I) {
                        return null == g ? {} : function(g, I) {
                            return FA(g, I, (function(I, C) {
                                return rt(g, C)
                            }
                            ))
                        }(g, I)
                    }
                    ));
                    function Vt(g, I) {
                        if (null == g)
                            return {};
                        var C = dI(De(g), (function(g) {
                            return [g]
                        }
                        ));
                        return I = Pe(I),
                        FA(g, C, (function(g, C) {
                            return I(g, C[0])
                        }
                        ))
                    }
                    var Xt = ke(mt)
                      , Yt = ke(ht);
                    function Kt(g) {
                        return null == g ? [] : HI(g, mt(g))
                    }
                    var Rt = We((function(g, I, C) {
                        return I = I.toLowerCase(),
                        g + (C ? wt(I) : I)
                    }
                    ));
                    function wt(g) {
                        return Jt(tt(g).toLowerCase())
                    }
                    function Ht(g) {
                        return (g = tt(g)) && g.replace(lg, fI).replace(Fg, "")
                    }
                    var Ft = We((function(g, I, C) {
                        return g + (C ? "-" : "") + I.toLowerCase()
                    }
                    ))
                      , Nt = We((function(g, I, C) {
                        return g + (C ? " " : "") + I.toLowerCase()
                    }
                    ))
                      , St = ye("toLowerCase");
                    var zt = We((function(g, I, C) {
                        return g + (C ? "_" : "") + I.toLowerCase()
                    }
                    ));
                    var ft = We((function(g, I, C) {
                        return g + (C ? " " : "") + Jt(I)
                    }
                    ));
                    var kt = We((function(g, I, C) {
                        return g + (C ? " " : "") + I.toUpperCase()
                    }
                    ))
                      , Jt = ye("toUpperCase");
                    function Lt(g, I, C) {
                        return g = tt(g),
                        void 0 === (I = C ? void 0 : I) ? function(g) {
                            return fg.test(g)
                        }(g) ? function(g) {
                            return g.match(Sg) || []
                        }(g) : function(g) {
                            return g.match($) || []
                        }(g) : g.match(I) || []
                    }
                    var xt = kA((function(g, I) {
                        try {
                            return oI(g, void 0, I)
                        } catch (g) {
                            return Ji(g) ? g : new E(g)
                        }
                    }
                    ))
                      , Mt = je((function(g, I) {
                        return tI(I, (function(I) {
                            I = Vo(I),
                            TC(g, I, Bi(g[I], g))
                        }
                        )),
                        g
                    }
                    ));
                    function Qt(g) {
                        return function() {
                            return g
                        }
                    }
                    var jt = Xe()
                      , Ut = Xe(!0);
                    function Dt(g) {
                        return g
                    }
                    function Tt(g) {
                        return yA("function" == typeof g ? g : PC(g, 1))
                    }
                    var Ot = kA((function(g, I) {
                        return function(C) {
                            return BA(C, g, I)
                        }
                    }
                    ))
                      , Et = kA((function(g, I) {
                        return function(C) {
                            return BA(g, C, I)
                        }
                    }
                    ));
                    function Pt(g, I, C) {
                        var A = mt(I)
                          , e = cA(I, A);
                        null != C || Qi(I) && (e.length || !A.length) || (C = I,
                        I = g,
                        g = this,
                        e = cA(I, mt(I)));
                        var o = !(Qi(C) && "chain"in C && !C.chain)
                          , i = Li(g);
                        return tI(e, (function(C) {
                            var A = I[C];
                            g[C] = A,
                            i && (g.prototype[C] = function() {
                                var I = this.__chain__;
                                if (o || I) {
                                    var C = g(this.__wrapped__)
                                      , e = C.__actions__ = ue(this.__actions__);
                                    return e.push({
                                        func: A,
                                        args: arguments,
                                        thisArg: g
                                    }),
                                    C.__chain__ = I,
                                    C
                                }
                                return A.apply(g, bI([this.value()], arguments))
                            }
                            )
                        }
                        )),
                        g
                    }
                    function qt() {}
                    var _t = we(dI)
                      , $t = we(lI)
                      , gn = we(uI);
                    function In(g) {
                        return no(g) ? vI(Vo(g)) : function(g) {
                            return function(I) {
                                return aA(I, g)
                            }
                        }(g)
                    }
                    var Cn = Fe()
                      , An = Fe(!0);
                    function en() {
                        return []
                    }
                    function on() {
                        return !1
                    }
                    var tn = Re((function(g, I) {
                        return g + I
                    }
                    ), 0)
                      , nn = ze("ceil")
                      , ln = Re((function(g, I) {
                        return g / I
                    }
                    ), 1)
                      , cn = ze("floor");
                    var an, sn = Re((function(g, I) {
                        return g * I
                    }
                    ), 1), dn = ze("round"), bn = Re((function(g, I) {
                        return g - I
                    }
                    ), 0);
                    return YC.after = function(g, I) {
                        if ("function" != typeof I)
                            throw new ug(o);
                        return g = At(g),
                        function() {
                            if (--g < 1)
                                return I.apply(this, arguments)
                        }
                    }
                    ,
                    YC.ary = ri,
                    YC.assign = nt,
                    YC.assignIn = lt,
                    YC.assignInWith = ct,
                    YC.assignWith = at,
                    YC.at = st,
                    YC.before = ui,
                    YC.bind = Bi,
                    YC.bindAll = Mt,
                    YC.bindKey = Zi,
                    YC.castArray = function() {
                        if (!arguments.length)
                            return [];
                        var g = arguments[0];
                        return Fi(g) ? g : [g]
                    }
                    ,
                    YC.chain = Ii,
                    YC.chunk = function(g, I, C) {
                        I = (C ? to(g, I, C) : void 0 === I) ? 1 : iC(At(I), 0);
                        var e = null == g ? 0 : g.length;
                        if (!e || I < 1)
                            return [];
                        for (var o = 0, i = 0, t = A($I(e / I)); o < e; )
                            t[i++] = UA(g, o, o += I);
                        return t
                    }
                    ,
                    YC.compact = function(g) {
                        for (var I = -1, C = null == g ? 0 : g.length, A = 0, e = []; ++I < C; ) {
                            var o = g[I];
                            o && (e[A++] = o)
                        }
                        return e
                    }
                    ,
                    YC.concat = function() {
                        var g = arguments.length;
                        if (!g)
                            return [];
                        for (var I = A(g - 1), C = arguments[0], e = g; e--; )
                            I[e - 1] = arguments[e];
                        return bI(Fi(C) ? ue(C) : [C], oA(I, 1))
                    }
                    ,
                    YC.cond = function(g) {
                        var I = null == g ? 0 : g.length
                          , C = Pe();
                        return g = I ? dI(g, (function(g) {
                            if ("function" != typeof g[1])
                                throw new ug(o);
                            return [C(g[0]), g[1]]
                        }
                        )) : [],
                        kA((function(C) {
                            for (var A = -1; ++A < I; ) {
                                var e = g[A];
                                if (oI(e[0], this, C))
                                    return oI(e[1], this, C)
                            }
                        }
                        ))
                    }
                    ,
                    YC.conforms = function(g) {
                        return function(g) {
                            var I = mt(g);
                            return function(C) {
                                return qC(C, g, I)
                            }
                        }(PC(g, 1))
                    }
                    ,
                    YC.constant = Qt,
                    YC.countBy = ei,
                    YC.create = function(g, I) {
                        var C = KC(g);
                        return null == I ? C : DC(C, I)
                    }
                    ,
                    YC.curry = function g(I, C, A) {
                        var e = Je(I, 8, void 0, void 0, void 0, void 0, void 0, C = A ? void 0 : C);
                        return e.placeholder = g.placeholder,
                        e
                    }
                    ,
                    YC.curryRight = function g(I, C, A) {
                        var e = Je(I, 16, void 0, void 0, void 0, void 0, void 0, C = A ? void 0 : C);
                        return e.placeholder = g.placeholder,
                        e
                    }
                    ,
                    YC.debounce = mi,
                    YC.defaults = dt,
                    YC.defaultsDeep = bt,
                    YC.defer = hi,
                    YC.delay = pi,
                    YC.difference = Ko,
                    YC.differenceBy = Ro,
                    YC.differenceWith = wo,
                    YC.drop = function(g, I, C) {
                        var A = null == g ? 0 : g.length;
                        return A ? UA(g, (I = C || void 0 === I ? 1 : At(I)) < 0 ? 0 : I, A) : []
                    }
                    ,
                    YC.dropRight = function(g, I, C) {
                        var A = null == g ? 0 : g.length;
                        return A ? UA(g, 0, (I = A - (I = C || void 0 === I ? 1 : At(I))) < 0 ? 0 : I) : []
                    }
                    ,
                    YC.dropRightWhile = function(g, I) {
                        return g && g.length ? Ie(g, Pe(I, 3), !0, !0) : []
                    }
                    ,
                    YC.dropWhile = function(g, I) {
                        return g && g.length ? Ie(g, Pe(I, 3), !0) : []
                    }
                    ,
                    YC.fill = function(g, I, C, A) {
                        var e = null == g ? 0 : g.length;
                        return e ? (C && "number" != typeof C && to(g, I, C) && (C = 0,
                        A = e),
                        function(g, I, C, A) {
                            var e = g.length;
                            for ((C = At(C)) < 0 && (C = -C > e ? 0 : e + C),
                            (A = void 0 === A || A > e ? e : At(A)) < 0 && (A += e),
                            A = C > A ? 0 : et(A); C < A; )
                                g[C++] = I;
                            return g
                        }(g, I, C, A)) : []
                    }
                    ,
                    YC.filter = function(g, I) {
                        return (Fi(g) ? cI : eA)(g, Pe(I, 3))
                    }
                    ,
                    YC.flatMap = function(g, I) {
                        return oA(si(g, I), 1)
                    }
                    ,
                    YC.flatMapDeep = function(g, I) {
                        return oA(si(g, I), 1 / 0)
                    }
                    ,
                    YC.flatMapDepth = function(g, I, C) {
                        return C = void 0 === C ? 1 : At(C),
                        oA(si(g, I), C)
                    }
                    ,
                    YC.flatten = No,
                    YC.flattenDeep = function(g) {
                        return (null == g ? 0 : g.length) ? oA(g, 1 / 0) : []
                    }
                    ,
                    YC.flattenDepth = function(g, I) {
                        return (null == g ? 0 : g.length) ? oA(g, I = void 0 === I ? 1 : At(I)) : []
                    }
                    ,
                    YC.flip = function(g) {
                        return Je(g, 512)
                    }
                    ,
                    YC.flow = jt,
                    YC.flowRight = Ut,
                    YC.fromPairs = function(g) {
                        for (var I = -1, C = null == g ? 0 : g.length, A = {}; ++I < C; ) {
                            var e = g[I];
                            A[e[0]] = e[1]
                        }
                        return A
                    }
                    ,
                    YC.functions = function(g) {
                        return null == g ? [] : cA(g, mt(g))
                    }
                    ,
                    YC.functionsIn = function(g) {
                        return null == g ? [] : cA(g, ht(g))
                    }
                    ,
                    YC.groupBy = li,
                    YC.initial = function(g) {
                        return (null == g ? 0 : g.length) ? UA(g, 0, -1) : []
                    }
                    ,
                    YC.intersection = zo,
                    YC.intersectionBy = fo,
                    YC.intersectionWith = ko,
                    YC.invert = ut,
                    YC.invertBy = Bt,
                    YC.invokeMap = ci,
                    YC.iteratee = Tt,
                    YC.keyBy = ai,
                    YC.keys = mt,
                    YC.keysIn = ht,
                    YC.map = si,
                    YC.mapKeys = function(g, I) {
                        var C = {};
                        return I = Pe(I, 3),
                        nA(g, (function(g, A, e) {
                            TC(C, I(g, A, e), g)
                        }
                        )),
                        C
                    }
                    ,
                    YC.mapValues = function(g, I) {
                        var C = {};
                        return I = Pe(I, 3),
                        nA(g, (function(g, A, e) {
                            TC(C, A, I(g, A, e))
                        }
                        )),
                        C
                    }
                    ,
                    YC.matches = function(g) {
                        return YA(PC(g, 1))
                    }
                    ,
                    YC.matchesProperty = function(g, I) {
                        return KA(g, PC(I, 1))
                    }
                    ,
                    YC.memoize = yi,
                    YC.merge = pt,
                    YC.mergeWith = yt,
                    YC.method = Ot,
                    YC.methodOf = Et,
                    YC.mixin = Pt,
                    YC.negate = Wi,
                    YC.nthArg = function(g) {
                        return g = At(g),
                        kA((function(I) {
                            return wA(I, g)
                        }
                        ))
                    }
                    ,
                    YC.omit = Wt,
                    YC.omitBy = function(g, I) {
                        return Vt(g, Wi(Pe(I)))
                    }
                    ,
                    YC.once = function(g) {
                        return ui(2, g)
                    }
                    ,
                    YC.orderBy = function(g, I, C, A) {
                        return null == g ? [] : (Fi(I) || (I = null == I ? [] : [I]),
                        Fi(C = A ? void 0 : C) || (C = null == C ? [] : [C]),
                        HA(g, I, C))
                    }
                    ,
                    YC.over = _t,
                    YC.overArgs = vi,
                    YC.overEvery = $t,
                    YC.overSome = gn,
                    YC.partial = Vi,
                    YC.partialRight = Xi,
                    YC.partition = di,
                    YC.pick = vt,
                    YC.pickBy = Vt,
                    YC.property = In,
                    YC.propertyOf = function(g) {
                        return function(I) {
                            return null == g ? void 0 : aA(g, I)
                        }
                    }
                    ,
                    YC.pull = Lo,
                    YC.pullAll = xo,
                    YC.pullAllBy = function(g, I, C) {
                        return g && g.length && I && I.length ? NA(g, I, Pe(C, 2)) : g
                    }
                    ,
                    YC.pullAllWith = function(g, I, C) {
                        return g && g.length && I && I.length ? NA(g, I, void 0, C) : g
                    }
                    ,
                    YC.pullAt = Mo,
                    YC.range = Cn,
                    YC.rangeRight = An,
                    YC.rearg = Yi,
                    YC.reject = function(g, I) {
                        return (Fi(g) ? cI : eA)(g, Wi(Pe(I, 3)))
                    }
                    ,
                    YC.remove = function(g, I) {
                        var C = [];
                        if (!g || !g.length)
                            return C;
                        var A = -1
                          , e = []
                          , o = g.length;
                        for (I = Pe(I, 3); ++A < o; ) {
                            var i = g[A];
                            I(i, A, g) && (C.push(i),
                            e.push(A))
                        }
                        return SA(g, e),
                        C
                    }
                    ,
                    YC.rest = function(g, I) {
                        if ("function" != typeof g)
                            throw new ug(o);
                        return kA(g, I = void 0 === I ? I : At(I))
                    }
                    ,
                    YC.reverse = Qo,
                    YC.sampleSize = function(g, I, C) {
                        return I = (C ? to(g, I, C) : void 0 === I) ? 1 : At(I),
                        (Fi(g) ? LC : LA)(g, I)
                    }
                    ,
                    YC.set = function(g, I, C) {
                        return null == g ? g : xA(g, I, C)
                    }
                    ,
                    YC.setWith = function(g, I, C, A) {
                        return A = "function" == typeof A ? A : void 0,
                        null == g ? g : xA(g, I, C, A)
                    }
                    ,
                    YC.shuffle = function(g) {
                        return (Fi(g) ? xC : jA)(g)
                    }
                    ,
                    YC.slice = function(g, I, C) {
                        var A = null == g ? 0 : g.length;
                        return A ? (C && "number" != typeof C && to(g, I, C) ? (I = 0,
                        C = A) : (I = null == I ? 0 : At(I),
                        C = void 0 === C ? A : At(C)),
                        UA(g, I, C)) : []
                    }
                    ,
                    YC.sortBy = bi,
                    YC.sortedUniq = function(g) {
                        return g && g.length ? EA(g) : []
                    }
                    ,
                    YC.sortedUniqBy = function(g, I) {
                        return g && g.length ? EA(g, Pe(I, 2)) : []
                    }
                    ,
                    YC.split = function(g, I, C) {
                        return C && "number" != typeof C && to(g, I, C) && (I = C = void 0),
                        (C = void 0 === C ? 4294967295 : C >>> 0) ? (g = tt(g)) && ("string" == typeof I || null != I && !Oi(I)) && !(I = qA(I)) && LI(g) ? le(TI(g), 0, C) : g.split(I, C) : []
                    }
                    ,
                    YC.spread = function(g, I) {
                        if ("function" != typeof g)
                            throw new ug(o);
                        return I = null == I ? 0 : iC(At(I), 0),
                        kA((function(C) {
                            var A = C[I]
                              , e = le(C, 0, I);
                            return A && bI(e, A),
                            oI(g, this, e)
                        }
                        ))
                    }
                    ,
                    YC.tail = function(g) {
                        var I = null == g ? 0 : g.length;
                        return I ? UA(g, 1, I) : []
                    }
                    ,
                    YC.take = function(g, I, C) {
                        return g && g.length ? UA(g, 0, (I = C || void 0 === I ? 1 : At(I)) < 0 ? 0 : I) : []
                    }
                    ,
                    YC.takeRight = function(g, I, C) {
                        var A = null == g ? 0 : g.length;
                        return A ? UA(g, (I = A - (I = C || void 0 === I ? 1 : At(I))) < 0 ? 0 : I, A) : []
                    }
                    ,
                    YC.takeRightWhile = function(g, I) {
                        return g && g.length ? Ie(g, Pe(I, 3), !1, !0) : []
                    }
                    ,
                    YC.takeWhile = function(g, I) {
                        return g && g.length ? Ie(g, Pe(I, 3)) : []
                    }
                    ,
                    YC.tap = function(g, I) {
                        return I(g),
                        g
                    }
                    ,
                    YC.throttle = function(g, I, C) {
                        var A = !0
                          , e = !0;
                        if ("function" != typeof g)
                            throw new ug(o);
                        return Qi(C) && (A = "leading"in C ? !!C.leading : A,
                        e = "trailing"in C ? !!C.trailing : e),
                        mi(g, I, {
                            leading: A,
                            maxWait: I,
                            trailing: e
                        })
                    }
                    ,
                    YC.thru = Ci,
                    YC.toArray = It,
                    YC.toPairs = Xt,
                    YC.toPairsIn = Yt,
                    YC.toPath = function(g) {
                        return Fi(g) ? dI(g, Vo) : qi(g) ? [g] : ue(vo(tt(g)))
                    }
                    ,
                    YC.toPlainObject = it,
                    YC.transform = function(g, I, C) {
                        var A = Fi(g)
                          , e = A || fi(g) || _i(g);
                        if (I = Pe(I, 4),
                        null == C) {
                            var o = g && g.constructor;
                            C = e ? A ? new o : [] : Qi(g) && Li(o) ? KC(Mg(g)) : {}
                        }
                        return (e ? tI : nA)(g, (function(g, A, e) {
                            return I(C, g, A, e)
                        }
                        )),
                        C
                    }
                    ,
                    YC.unary = function(g) {
                        return ri(g, 1)
                    }
                    ,
                    YC.union = jo,
                    YC.unionBy = Uo,
                    YC.unionWith = Do,
                    YC.uniq = function(g) {
                        return g && g.length ? _A(g) : []
                    }
                    ,
                    YC.uniqBy = function(g, I) {
                        return g && g.length ? _A(g, Pe(I, 2)) : []
                    }
                    ,
                    YC.uniqWith = function(g, I) {
                        return I = "function" == typeof I ? I : void 0,
                        g && g.length ? _A(g, void 0, I) : []
                    }
                    ,
                    YC.unset = function(g, I) {
                        return null == g || $A(g, I)
                    }
                    ,
                    YC.unzip = To,
                    YC.unzipWith = Oo,
                    YC.update = function(g, I, C) {
                        return null == g ? g : ge(g, I, ie(C))
                    }
                    ,
                    YC.updateWith = function(g, I, C, A) {
                        return A = "function" == typeof A ? A : void 0,
                        null == g ? g : ge(g, I, ie(C), A)
                    }
                    ,
                    YC.values = Kt,
                    YC.valuesIn = function(g) {
                        return null == g ? [] : HI(g, ht(g))
                    }
                    ,
                    YC.without = Eo,
                    YC.words = Lt,
                    YC.wrap = function(g, I) {
                        return Vi(ie(I), g)
                    }
                    ,
                    YC.xor = Po,
                    YC.xorBy = qo,
                    YC.xorWith = _o,
                    YC.zip = $o,
                    YC.zipObject = function(g, I) {
                        return ee(g || [], I || [], QC)
                    }
                    ,
                    YC.zipObjectDeep = function(g, I) {
                        return ee(g || [], I || [], xA)
                    }
                    ,
                    YC.zipWith = gi,
                    YC.entries = Xt,
                    YC.entriesIn = Yt,
                    YC.extend = lt,
                    YC.extendWith = ct,
                    Pt(YC, YC),
                    YC.add = tn,
                    YC.attempt = xt,
                    YC.camelCase = Rt,
                    YC.capitalize = wt,
                    YC.ceil = nn,
                    YC.clamp = function(g, I, C) {
                        return void 0 === C && (C = I,
                        I = void 0),
                        void 0 !== C && (C = (C = ot(C)) == C ? C : 0),
                        void 0 !== I && (I = (I = ot(I)) == I ? I : 0),
                        EC(ot(g), I, C)
                    }
                    ,
                    YC.clone = function(g) {
                        return PC(g, 4)
                    }
                    ,
                    YC.cloneDeep = function(g) {
                        return PC(g, 5)
                    }
                    ,
                    YC.cloneDeepWith = function(g, I) {
                        return PC(g, 5, I = "function" == typeof I ? I : void 0)
                    }
                    ,
                    YC.cloneWith = function(g, I) {
                        return PC(g, 4, I = "function" == typeof I ? I : void 0)
                    }
                    ,
                    YC.conformsTo = function(g, I) {
                        return null == I || qC(g, I, mt(I))
                    }
                    ,
                    YC.deburr = Ht,
                    YC.defaultTo = function(g, I) {
                        return null == g || g != g ? I : g
                    }
                    ,
                    YC.divide = ln,
                    YC.endsWith = function(g, I, C) {
                        g = tt(g),
                        I = qA(I);
                        var A = g.length
                          , e = C = void 0 === C ? A : EC(At(C), 0, A);
                        return (C -= I.length) >= 0 && g.slice(C, e) == I
                    }
                    ,
                    YC.eq = Ki,
                    YC.escape = function(g) {
                        return (g = tt(g)) && J.test(g) ? g.replace(f, kI) : g
                    }
                    ,
                    YC.escapeRegExp = function(g) {
                        return (g = tt(g)) && T.test(g) ? g.replace(D, "\\$&") : g
                    }
                    ,
                    YC.every = function(g, I, C) {
                        var A = Fi(g) ? lI : CA;
                        return C && to(g, I, C) && (I = void 0),
                        A(g, Pe(I, 3))
                    }
                    ,
                    YC.find = oi,
                    YC.findIndex = Ho,
                    YC.findKey = function(g, I) {
                        return ZI(g, Pe(I, 3), nA)
                    }
                    ,
                    YC.findLast = ii,
                    YC.findLastIndex = Fo,
                    YC.findLastKey = function(g, I) {
                        return ZI(g, Pe(I, 3), lA)
                    }
                    ,
                    YC.floor = cn,
                    YC.forEach = ti,
                    YC.forEachRight = ni,
                    YC.forIn = function(g, I) {
                        return null == g ? g : iA(g, Pe(I, 3), ht)
                    }
                    ,
                    YC.forInRight = function(g, I) {
                        return null == g ? g : tA(g, Pe(I, 3), ht)
                    }
                    ,
                    YC.forOwn = function(g, I) {
                        return g && nA(g, Pe(I, 3))
                    }
                    ,
                    YC.forOwnRight = function(g, I) {
                        return g && lA(g, Pe(I, 3))
                    }
                    ,
                    YC.get = Gt,
                    YC.gt = Ri,
                    YC.gte = wi,
                    YC.has = function(g, I) {
                        return null != g && Ao(g, I, GA)
                    }
                    ,
                    YC.hasIn = rt,
                    YC.head = So,
                    YC.identity = Dt,
                    YC.includes = function(g, I, C, A) {
                        g = Si(g) ? g : Kt(g),
                        C = C && !A ? At(C) : 0;
                        var e = g.length;
                        return C < 0 && (C = iC(e + C, 0)),
                        Pi(g) ? C <= e && g.indexOf(I, C) > -1 : !!e && hI(g, I, C) > -1
                    }
                    ,
                    YC.indexOf = function(g, I, C) {
                        var A = null == g ? 0 : g.length;
                        if (!A)
                            return -1;
                        var e = null == C ? 0 : At(C);
                        return e < 0 && (e = iC(A + e, 0)),
                        hI(g, I, e)
                    }
                    ,
                    YC.inRange = function(g, I, C) {
                        return I = Ct(I),
                        void 0 === C ? (C = I,
                        I = 0) : C = Ct(C),
                        function(g, I, C) {
                            return g >= tC(I, C) && g < iC(I, C)
                        }(g = ot(g), I, C)
                    }
                    ,
                    YC.invoke = Zt,
                    YC.isArguments = Hi,
                    YC.isArray = Fi,
                    YC.isArrayBuffer = Ni,
                    YC.isArrayLike = Si,
                    YC.isArrayLikeObject = zi,
                    YC.isBoolean = function(g) {
                        return !0 === g || !1 === g || ji(g) && dA(g) == c
                    }
                    ,
                    YC.isBuffer = fi,
                    YC.isDate = ki,
                    YC.isElement = function(g) {
                        return ji(g) && 1 === g.nodeType && !Ti(g)
                    }
                    ,
                    YC.isEmpty = function(g) {
                        if (null == g)
                            return !0;
                        if (Si(g) && (Fi(g) || "string" == typeof g || "function" == typeof g.splice || fi(g) || _i(g) || Hi(g)))
                            return !g.length;
                        var I = Co(g);
                        if (I == G || I == Z)
                            return !g.size;
                        if (ao(g))
                            return !WA(g).length;
                        for (var C in g)
                            if (yg.call(g, C))
                                return !1;
                        return !0
                    }
                    ,
                    YC.isEqual = function(g, I) {
                        return mA(g, I)
                    }
                    ,
                    YC.isEqualWith = function(g, I, C) {
                        var A = (C = "function" == typeof C ? C : void 0) ? C(g, I) : void 0;
                        return void 0 === A ? mA(g, I, void 0, C) : !!A
                    }
                    ,
                    YC.isError = Ji,
                    YC.isFinite = function(g) {
                        return "number" == typeof g && AC(g)
                    }
                    ,
                    YC.isFunction = Li,
                    YC.isInteger = xi,
                    YC.isLength = Mi,
                    YC.isMap = Ui,
                    YC.isMatch = function(g, I) {
                        return g === I || hA(g, I, _e(I))
                    }
                    ,
                    YC.isMatchWith = function(g, I, C) {
                        return C = "function" == typeof C ? C : void 0,
                        hA(g, I, _e(I), C)
                    }
                    ,
                    YC.isNaN = function(g) {
                        return Di(g) && g != +g
                    }
                    ,
                    YC.isNative = function(g) {
                        if (co(g))
                            throw new E("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");
                        return pA(g)
                    }
                    ,
                    YC.isNil = function(g) {
                        return null == g
                    }
                    ,
                    YC.isNull = function(g) {
                        return null === g
                    }
                    ,
                    YC.isNumber = Di,
                    YC.isObject = Qi,
                    YC.isObjectLike = ji,
                    YC.isPlainObject = Ti,
                    YC.isRegExp = Oi,
                    YC.isSafeInteger = function(g) {
                        return xi(g) && g >= -9007199254740991 && g <= 9007199254740991
                    }
                    ,
                    YC.isSet = Ei,
                    YC.isString = Pi,
                    YC.isSymbol = qi,
                    YC.isTypedArray = _i,
                    YC.isUndefined = function(g) {
                        return void 0 === g
                    }
                    ,
                    YC.isWeakMap = function(g) {
                        return ji(g) && Co(g) == p
                    }
                    ,
                    YC.isWeakSet = function(g) {
                        return ji(g) && "[object WeakSet]" == dA(g)
                    }
                    ,
                    YC.join = function(g, I) {
                        return null == g ? "" : eC.call(g, I)
                    }
                    ,
                    YC.kebabCase = Ft,
                    YC.last = Jo,
                    YC.lastIndexOf = function(g, I, C) {
                        var A = null == g ? 0 : g.length;
                        if (!A)
                            return -1;
                        var e = A;
                        return void 0 !== C && (e = (e = At(C)) < 0 ? iC(A + e, 0) : tC(e, A - 1)),
                        I == I ? function(g, I, C) {
                            for (var A = C + 1; A--; )
                                if (g[A] === I)
                                    return A;
                            return A
                        }(g, I, e) : mI(g, yI, e, !0)
                    }
                    ,
                    YC.lowerCase = Nt,
                    YC.lowerFirst = St,
                    YC.lt = $i,
                    YC.lte = gt,
                    YC.max = function(g) {
                        return g && g.length ? AA(g, Dt, bA) : void 0
                    }
                    ,
                    YC.maxBy = function(g, I) {
                        return g && g.length ? AA(g, Pe(I, 2), bA) : void 0
                    }
                    ,
                    YC.mean = function(g) {
                        return WI(g, Dt)
                    }
                    ,
                    YC.meanBy = function(g, I) {
                        return WI(g, Pe(I, 2))
                    }
                    ,
                    YC.min = function(g) {
                        return g && g.length ? AA(g, Dt, VA) : void 0
                    }
                    ,
                    YC.minBy = function(g, I) {
                        return g && g.length ? AA(g, Pe(I, 2), VA) : void 0
                    }
                    ,
                    YC.stubArray = en,
                    YC.stubFalse = on,
                    YC.stubObject = function() {
                        return {}
                    }
                    ,
                    YC.stubString = function() {
                        return ""
                    }
                    ,
                    YC.stubTrue = function() {
                        return !0
                    }
                    ,
                    YC.multiply = sn,
                    YC.nth = function(g, I) {
                        return g && g.length ? wA(g, At(I)) : void 0
                    }
                    ,
                    YC.noConflict = function() {
                        return Tg._ === this && (Tg._ = Yg),
                        this
                    }
                    ,
                    YC.noop = qt,
                    YC.now = Gi,
                    YC.pad = function(g, I, C) {
                        g = tt(g);
                        var A = (I = At(I)) ? DI(g) : 0;
                        if (!I || A >= I)
                            return g;
                        var e = (I - A) / 2;
                        return He(gC(e), C) + g + He($I(e), C)
                    }
                    ,
                    YC.padEnd = function(g, I, C) {
                        g = tt(g);
                        var A = (I = At(I)) ? DI(g) : 0;
                        return I && A < I ? g + He(I - A, C) : g
                    }
                    ,
                    YC.padStart = function(g, I, C) {
                        g = tt(g);
                        var A = (I = At(I)) ? DI(g) : 0;
                        return I && A < I ? He(I - A, C) + g : g
                    }
                    ,
                    YC.parseInt = function(g, I, C) {
                        return C || null == I ? I = 0 : I && (I = +I),
                        lC(tt(g).replace(O, ""), I || 0)
                    }
                    ,
                    YC.random = function(g, I, C) {
                        if (C && "boolean" != typeof C && to(g, I, C) && (I = C = void 0),
                        void 0 === C && ("boolean" == typeof I ? (C = I,
                        I = void 0) : "boolean" == typeof g && (C = g,
                        g = void 0)),
                        void 0 === g && void 0 === I ? (g = 0,
                        I = 1) : (g = Ct(g),
                        void 0 === I ? (I = g,
                        g = 0) : I = Ct(I)),
                        g > I) {
                            var A = g;
                            g = I,
                            I = A
                        }
                        if (C || g % 1 || I % 1) {
                            var e = cC();
                            return tC(g + e * (I - g + Qg("1e-" + ((e + "").length - 1))), I)
                        }
                        return zA(g, I)
                    }
                    ,
                    YC.reduce = function(g, I, C) {
                        var A = Fi(g) ? GI : XI
                          , e = arguments.length < 3;
                        return A(g, Pe(I, 4), C, e, gA)
                    }
                    ,
                    YC.reduceRight = function(g, I, C) {
                        var A = Fi(g) ? rI : XI
                          , e = arguments.length < 3;
                        return A(g, Pe(I, 4), C, e, IA)
                    }
                    ,
                    YC.repeat = function(g, I, C) {
                        return I = (C ? to(g, I, C) : void 0 === I) ? 1 : At(I),
                        fA(tt(g), I)
                    }
                    ,
                    YC.replace = function() {
                        var g = arguments
                          , I = tt(g[0]);
                        return g.length < 3 ? I : I.replace(g[1], g[2])
                    }
                    ,
                    YC.result = function(g, I, C) {
                        var A = -1
                          , e = (I = te(I, g)).length;
                        for (e || (e = 1,
                        g = void 0); ++A < e; ) {
                            var o = null == g ? void 0 : g[Vo(I[A])];
                            void 0 === o && (A = e,
                            o = C),
                            g = Li(o) ? o.call(g) : o
                        }
                        return g
                    }
                    ,
                    YC.round = dn,
                    YC.runInContext = g,
                    YC.sample = function(g) {
                        return (Fi(g) ? JC : JA)(g)
                    }
                    ,
                    YC.size = function(g) {
                        if (null == g)
                            return 0;
                        if (Si(g))
                            return Pi(g) ? DI(g) : g.length;
                        var I = Co(g);
                        return I == G || I == Z ? g.size : WA(g).length
                    }
                    ,
                    YC.snakeCase = zt,
                    YC.some = function(g, I, C) {
                        var A = Fi(g) ? uI : DA;
                        return C && to(g, I, C) && (I = void 0),
                        A(g, Pe(I, 3))
                    }
                    ,
                    YC.sortedIndex = function(g, I) {
                        return TA(g, I)
                    }
                    ,
                    YC.sortedIndexBy = function(g, I, C) {
                        return OA(g, I, Pe(C, 2))
                    }
                    ,
                    YC.sortedIndexOf = function(g, I) {
                        var C = null == g ? 0 : g.length;
                        if (C) {
                            var A = TA(g, I);
                            if (A < C && Ki(g[A], I))
                                return A
                        }
                        return -1
                    }
                    ,
                    YC.sortedLastIndex = function(g, I) {
                        return TA(g, I, !0)
                    }
                    ,
                    YC.sortedLastIndexBy = function(g, I, C) {
                        return OA(g, I, Pe(C, 2), !0)
                    }
                    ,
                    YC.sortedLastIndexOf = function(g, I) {
                        if (null == g ? 0 : g.length) {
                            var C = TA(g, I, !0) - 1;
                            if (Ki(g[C], I))
                                return C
                        }
                        return -1
                    }
                    ,
                    YC.startCase = ft,
                    YC.startsWith = function(g, I, C) {
                        return g = tt(g),
                        C = null == C ? 0 : EC(At(C), 0, g.length),
                        I = qA(I),
                        g.slice(C, C + I.length) == I
                    }
                    ,
                    YC.subtract = bn,
                    YC.sum = function(g) {
                        return g && g.length ? YI(g, Dt) : 0
                    }
                    ,
                    YC.sumBy = function(g, I) {
                        return g && g.length ? YI(g, Pe(I, 2)) : 0
                    }
                    ,
                    YC.template = function(g, I, C) {
                        var A = YC.templateSettings;
                        C && to(g, I, C) && (I = void 0),
                        g = tt(g),
                        I = ct({}, I, A, Le);
                        var e, o, i = ct({}, I.imports, A.imports, Le), t = mt(i), n = HI(i, t), l = 0, c = I.interpolate || cg, a = "__p += '", s = Gg((I.escape || cg).source + "|" + c.source + "|" + (c === M ? Cg : cg).source + "|" + (I.evaluate || cg).source + "|$", "g"), d = "//# sourceURL=" + (yg.call(I, "sourceURL") ? (I.sourceURL + "").replace(/\s/g, " ") : "lodash.templateSources[" + ++Jg + "]") + "\n";
                        g.replace(s, (function(I, C, A, i, t, n) {
                            return A || (A = i),
                            a += g.slice(l, n).replace(ag, JI),
                            C && (e = !0,
                            a += "' +\n__e(" + C + ") +\n'"),
                            t && (o = !0,
                            a += "';\n" + t + ";\n__p += '"),
                            A && (a += "' +\n((__t = (" + A + ")) == null ? '' : __t) +\n'"),
                            l = n + I.length,
                            I
                        }
                        )),
                        a += "';\n";
                        var b = yg.call(I, "variable") && I.variable;
                        if (b) {
                            if (gg.test(b))
                                throw new E("Invalid `variable` option passed into `_.template`")
                        } else
                            a = "with (obj) {\n" + a + "\n}\n";
                        a = (o ? a.replace(F, "") : a).replace(N, "$1").replace(S, "$1;"),
                        a = "function(" + (b || "obj") + ") {\n" + (b ? "" : "obj || (obj = {});\n") + "var __t, __p = ''" + (e ? ", __e = _.escape" : "") + (o ? ", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n" : ";\n") + a + "return __p\n}";
                        var G = xt((function() {
                            return sg(t, d + "return " + a).apply(void 0, n)
                        }
                        ));
                        if (G.source = a,
                        Ji(G))
                            throw G;
                        return G
                    }
                    ,
                    YC.times = function(g, I) {
                        if ((g = At(g)) < 1 || g > 9007199254740991)
                            return [];
                        var C = 4294967295
                          , A = tC(g, 4294967295);
                        g -= 4294967295;
                        for (var e = KI(A, I = Pe(I)); ++C < g; )
                            I(C);
                        return e
                    }
                    ,
                    YC.toFinite = Ct,
                    YC.toInteger = At,
                    YC.toLength = et,
                    YC.toLower = function(g) {
                        return tt(g).toLowerCase()
                    }
                    ,
                    YC.toNumber = ot,
                    YC.toSafeInteger = function(g) {
                        return g ? EC(At(g), -9007199254740991, 9007199254740991) : 0 === g ? g : 0
                    }
                    ,
                    YC.toString = tt,
                    YC.toUpper = function(g) {
                        return tt(g).toUpperCase()
                    }
                    ,
                    YC.trim = function(g, I, C) {
                        if ((g = tt(g)) && (C || void 0 === I))
                            return RI(g);
                        if (!g || !(I = qA(I)))
                            return g;
                        var A = TI(g)
                          , e = TI(I);
                        return le(A, NI(A, e), SI(A, e) + 1).join("")
                    }
                    ,
                    YC.trimEnd = function(g, I, C) {
                        if ((g = tt(g)) && (C || void 0 === I))
                            return g.slice(0, OI(g) + 1);
                        if (!g || !(I = qA(I)))
                            return g;
                        var A = TI(g);
                        return le(A, 0, SI(A, TI(I)) + 1).join("")
                    }
                    ,
                    YC.trimStart = function(g, I, C) {
                        if ((g = tt(g)) && (C || void 0 === I))
                            return g.replace(O, "");
                        if (!g || !(I = qA(I)))
                            return g;
                        var A = TI(g);
                        return le(A, NI(A, TI(I))).join("")
                    }
                    ,
                    YC.truncate = function(g, I) {
                        var C = 30
                          , A = "...";
                        if (Qi(I)) {
                            var e = "separator"in I ? I.separator : e;
                            C = "length"in I ? At(I.length) : C,
                            A = "omission"in I ? qA(I.omission) : A
                        }
                        var o = (g = tt(g)).length;
                        if (LI(g)) {
                            var i = TI(g);
                            o = i.length
                        }
                        if (C >= o)
                            return g;
                        var t = C - DI(A);
                        if (t < 1)
                            return A;
                        var n = i ? le(i, 0, t).join("") : g.slice(0, t);
                        if (void 0 === e)
                            return n + A;
                        if (i && (t += n.length - t),
                        Oi(e)) {
                            if (g.slice(t).search(e)) {
                                var l, c = n;
                                for (e.global || (e = Gg(e.source, tt(Ag.exec(e)) + "g")),
                                e.lastIndex = 0; l = e.exec(c); )
                                    var a = l.index;
                                n = n.slice(0, void 0 === a ? t : a)
                            }
                        } else if (g.indexOf(qA(e), t) != t) {
                            var s = n.lastIndexOf(e);
                            s > -1 && (n = n.slice(0, s))
                        }
                        return n + A
                    }
                    ,
                    YC.unescape = function(g) {
                        return (g = tt(g)) && k.test(g) ? g.replace(z, EI) : g
                    }
                    ,
                    YC.uniqueId = function(g) {
                        var I = ++Wg;
                        return tt(g) + I
                    }
                    ,
                    YC.upperCase = kt,
                    YC.upperFirst = Jt,
                    YC.each = ti,
                    YC.eachRight = ni,
                    YC.first = So,
                    Pt(YC, (an = {},
                    nA(YC, (function(g, I) {
                        yg.call(YC.prototype, I) || (an[I] = g)
                    }
                    )),
                    an), {
                        chain: !1
                    }),
                    YC.VERSION = "4.17.21",
                    tI(["bind", "bindKey", "curry", "curryRight", "partial", "partialRight"], (function(g) {
                        YC[g].placeholder = YC
                    }
                    )),
                    tI(["drop", "take"], (function(g, I) {
                        HC.prototype[g] = function(C) {
                            C = void 0 === C ? 1 : iC(At(C), 0);
                            var A = this.__filtered__ && !I ? new HC(this) : this.clone();
                            return A.__filtered__ ? A.__takeCount__ = tC(C, A.__takeCount__) : A.__views__.push({
                                size: tC(C, 4294967295),
                                type: g + (A.__dir__ < 0 ? "Right" : "")
                            }),
                            A
                        }
                        ,
                        HC.prototype[g + "Right"] = function(I) {
                            return this.reverse()[g](I).reverse()
                        }
                    }
                    )),
                    tI(["filter", "map", "takeWhile"], (function(g, I) {
                        var C = I + 1
                          , A = 1 == C || 3 == C;
                        HC.prototype[g] = function(g) {
                            var I = this.clone();
                            return I.__iteratees__.push({
                                iteratee: Pe(g, 3),
                                type: C
                            }),
                            I.__filtered__ = I.__filtered__ || A,
                            I
                        }
                    }
                    )),
                    tI(["head", "last"], (function(g, I) {
                        var C = "take" + (I ? "Right" : "");
                        HC.prototype[g] = function() {
                            return this[C](1).value()[0]
                        }
                    }
                    )),
                    tI(["initial", "tail"], (function(g, I) {
                        var C = "drop" + (I ? "" : "Right");
                        HC.prototype[g] = function() {
                            return this.__filtered__ ? new HC(this) : this[C](1)
                        }
                    }
                    )),
                    HC.prototype.compact = function() {
                        return this.filter(Dt)
                    }
                    ,
                    HC.prototype.find = function(g) {
                        return this.filter(g).head()
                    }
                    ,
                    HC.prototype.findLast = function(g) {
                        return this.reverse().find(g)
                    }
                    ,
                    HC.prototype.invokeMap = kA((function(g, I) {
                        return "function" == typeof g ? new HC(this) : this.map((function(C) {
                            return BA(C, g, I)
                        }
                        ))
                    }
                    )),
                    HC.prototype.reject = function(g) {
                        return this.filter(Wi(Pe(g)))
                    }
                    ,
                    HC.prototype.slice = function(g, I) {
                        g = At(g);
                        var C = this;
                        return C.__filtered__ && (g > 0 || I < 0) ? new HC(C) : (g < 0 ? C = C.takeRight(-g) : g && (C = C.drop(g)),
                        void 0 !== I && (C = (I = At(I)) < 0 ? C.dropRight(-I) : C.take(I - g)),
                        C)
                    }
                    ,
                    HC.prototype.takeRightWhile = function(g) {
                        return this.reverse().takeWhile(g).reverse()
                    }
                    ,
                    HC.prototype.toArray = function() {
                        return this.take(4294967295)
                    }
                    ,
                    nA(HC.prototype, (function(g, I) {
                        var C = /^(?:filter|find|map|reject)|While$/.test(I)
                          , A = /^(?:head|last)$/.test(I)
                          , e = YC[A ? "take" + ("last" == I ? "Right" : "") : I]
                          , o = A || /^find/.test(I);
                        e && (YC.prototype[I] = function() {
                            var I = this.__wrapped__
                              , i = A ? [1] : arguments
                              , t = I instanceof HC
                              , n = i[0]
                              , l = t || Fi(I)
                              , c = function(g) {
                                var I = e.apply(YC, bI([g], i));
                                return A && a ? I[0] : I
                            };
                            l && C && "function" == typeof n && 1 != n.length && (t = l = !1);
                            var a = this.__chain__
                              , s = !!this.__actions__.length
                              , d = o && !a
                              , b = t && !s;
                            if (!o && l) {
                                I = b ? I : new HC(this);
                                var G = g.apply(I, i);
                                return G.__actions__.push({
                                    func: Ci,
                                    args: [c],
                                    thisArg: void 0
                                }),
                                new wC(G,a)
                            }
                            return d && b ? g.apply(this, i) : (G = this.thru(c),
                            d ? A ? G.value()[0] : G.value() : G)
                        }
                        )
                    }
                    )),
                    tI(["pop", "push", "shift", "sort", "splice", "unshift"], (function(g) {
                        var I = Bg[g]
                          , C = /^(?:push|sort|unshift)$/.test(g) ? "tap" : "thru"
                          , A = /^(?:pop|shift)$/.test(g);
                        YC.prototype[g] = function() {
                            var g = arguments;
                            if (A && !this.__chain__) {
                                var e = this.value();
                                return I.apply(Fi(e) ? e : [], g)
                            }
                            return this[C]((function(C) {
                                return I.apply(Fi(C) ? C : [], g)
                            }
                            ))
                        }
                    }
                    )),
                    nA(HC.prototype, (function(g, I) {
                        var C = YC[I];
                        if (C) {
                            var A = C.name + "";
                            yg.call(ZC, A) || (ZC[A] = []),
                            ZC[A].push({
                                name: I,
                                func: C
                            })
                        }
                    }
                    )),
                    ZC[Ye(void 0, 2).name] = [{
                        name: "wrapper",
                        func: void 0
                    }],
                    HC.prototype.clone = function() {
                        var g = new HC(this.__wrapped__);
                        return g.__actions__ = ue(this.__actions__),
                        g.__dir__ = this.__dir__,
                        g.__filtered__ = this.__filtered__,
                        g.__iteratees__ = ue(this.__iteratees__),
                        g.__takeCount__ = this.__takeCount__,
                        g.__views__ = ue(this.__views__),
                        g
                    }
                    ,
                    HC.prototype.reverse = function() {
                        if (this.__filtered__) {
                            var g = new HC(this);
                            g.__dir__ = -1,
                            g.__filtered__ = !0
                        } else
                            (g = this.clone()).__dir__ *= -1;
                        return g
                    }
                    ,
                    HC.prototype.value = function() {
                        var g = this.__wrapped__.value()
                          , I = this.__dir__
                          , C = Fi(g)
                          , A = I < 0
                          , e = C ? g.length : 0
                          , o = function(g, I, C) {
                            var A = -1
                              , e = C.length;
                            for (; ++A < e; ) {
                                var o = C[A]
                                  , i = o.size;
                                switch (o.type) {
                                case "drop":
                                    g += i;
                                    break;
                                case "dropRight":
                                    I -= i;
                                    break;
                                case "take":
                                    I = tC(I, g + i);
                                    break;
                                case "takeRight":
                                    g = iC(g, I - i)
                                }
                            }
                            return {
                                start: g,
                                end: I
                            }
                        }(0, e, this.__views__)
                          , i = o.start
                          , t = o.end
                          , n = t - i
                          , l = A ? t : i - 1
                          , c = this.__iteratees__
                          , a = c.length
                          , s = 0
                          , d = tC(n, this.__takeCount__);
                        if (!C || !A && e == n && d == n)
                            return Ce(g, this.__actions__);
                        var b = [];
                        g: for (; n-- && s < d; ) {
                            for (var G = -1, r = g[l += I]; ++G < a; ) {
                                var u = c[G]
                                  , B = u.iteratee
                                  , Z = u.type
                                  , m = B(r);
                                if (2 == Z)
                                    r = m;
                                else if (!m) {
                                    if (1 == Z)
                                        continue g;
                                    break g
                                }
                            }
                            b[s++] = r
                        }
                        return b
                    }
                    ,
                    YC.prototype.at = Ai,
                    YC.prototype.chain = function() {
                        return Ii(this)
                    }
                    ,
                    YC.prototype.commit = function() {
                        return new wC(this.value(),this.__chain__)
                    }
                    ,
                    YC.prototype.next = function() {
                        void 0 === this.__values__ && (this.__values__ = It(this.value()));
                        var g = this.__index__ >= this.__values__.length;
                        return {
                            done: g,
                            value: g ? void 0 : this.__values__[this.__index__++]
                        }
                    }
                    ,
                    YC.prototype.plant = function(g) {
                        for (var I, C = this; C instanceof RC; ) {
                            var A = Yo(C);
                            A.__index__ = 0,
                            A.__values__ = void 0,
                            I ? e.__wrapped__ = A : I = A;
                            var e = A;
                            C = C.__wrapped__
                        }
                        return e.__wrapped__ = g,
                        I
                    }
                    ,
                    YC.prototype.reverse = function() {
                        var g = this.__wrapped__;
                        if (g instanceof HC) {
                            var I = g;
                            return this.__actions__.length && (I = new HC(this)),
                            (I = I.reverse()).__actions__.push({
                                func: Ci,
                                args: [Qo],
                                thisArg: void 0
                            }),
                            new wC(I,this.__chain__)
                        }
                        return this.thru(Qo)
                    }
                    ,
                    YC.prototype.toJSON = YC.prototype.valueOf = YC.prototype.value = function() {
                        return Ce(this.__wrapped__, this.__actions__)
                    }
                    ,
                    YC.prototype.first = YC.prototype.head,
                    qg && (YC.prototype[qg] = function() {
                        return this
                    }
                    ),
                    YC
                }();
                Tg._ = PI,
                void 0 === (e = function() {
                    return PI
                }
                .call(I, C, I, A)) || (A.exports = e)
            }
            ).call(this)
        }
        ).call(this, C(54), C(691)(g))
    },
    883: function(g, I, C) {
        "use strict";
        C.r(I);
        var A = C(6)
          , e = C.n(A)
          , o = C(0)
          , i = C(11)
          , t = C(3)
          , n = C.n(t)
          , l = C(12)
          , c = C(74)
          , a = C(10)
          , s = C(702)
          , d = C(53)
          , b = C(78)
          , G = C(94)
          , r = C(666)
          , u = C(690)
          , B = C(15)
          , Z = C.n(B)
          , m = C(669)
          , h = C(76)
          , p = C(27)
          , y = C(95)
          , W = C(77)
          , v = C(91)
          , V = (C(680),
        function(g) {
            var I = {
                root: {
                    position: "relative",
                    zIndex: 1,
                    paddingBottom: 140,
                    cursor: "grab"
                },
                isDragging: {
                    cursor: "grabbing",
                    "& *": {
                        cursor: "grabbing"
                    }
                },
                slider: {
                    overflow: "visible",
                    touchAction: "pan-y",
                    userSelect: "none",
                    display: "inline-flex",
                    paddingLeft: 190,
                    paddingRight: "calc(5.5vw - 20px)"
                },
                slide: {
                    padding: [0, 20]
                },
                slideContent: {
                    width: 400,
                    height: 500,
                    position: "relative",
                    padding: [35, 40, 105],
                    borderRadius: 30,
                    overflow: "hidden",
                    "&:hover": {
                        "& $image": {
                            transform: "scale(1.2)"
                        },
                        "& $link": {
                            transform: "scale(1.2)"
                        }
                    }
                },
                image: {
                    position: "absolute",
                    zIndex: 1,
                    top: 0,
                    left: 0,
                    opacity: .3,
                    width: "100%",
                    height: "100%",
                    backgroundSize: "cover",
                    transition: "transform 1s ".concat(g.easings["power3.out"])
                },
                link: {
                    position: "absolute",
                    zIndex: 2,
                    bottom: 40,
                    left: 35,
                    borderRadius: 20,
                    width: 40,
                    height: 40,
                    display: "flex",
                    justifyContent: "center",
                    alignItems: "center",
                    cursor: "pointer",
                    background: g.colors[1],
                    transition: "transform 1s ".concat(g.easings["power3.out"]),
                    "& svg": {
                        fill: g.colors[0],
                        width: 7
                    }
                },
                title: {
                    position: "relative",
                    zIndex: 2,
                    color: g.colors[1],
                    fontFamily: g.fonts[1],
                    fontSize: 28,
                    marginBottom: 10,
                    background: "linear-gradient(to-bottom, red, black)"
                },
                galleryControls: {
                    position: "absolute",
                    zIndex: 1,
                    bottom: -4,
                    right: "5.5vw",
                    display: "flex",
                    alignItems: "center"
                },
                arrowWrapper: {
                    position: "relative",
                    display: "flex",
                    "& .disabled": {
                        opacity: "0.4",
                        cursor: "default"
                    },
                    "& .arrow": {
                        position: "relative",
                        top: 0,
                        zIndex: 10,
                        clear: "both",
                        width: "44px",
                        height: "44px",
                        display: "inline-flex",
                        justifyContent: "center",
                        alignItems: "center",
                        background: g.colors[1],
                        borderRadius: "100%",
                        cursor: "pointer",
                        textAlign: "center",
                        fontSize: 10,
                        margin: "8px 0",
                        padding: "0",
                        transition: "opacity 0.3s ease-out",
                        "& svg": {
                            width: "auto",
                            height: "11px",
                            "& path": {
                                stroke: g.colors[0],
                                fill: g.colors[0]
                            }
                        },
                        "&:not(:last-child)": {
                            marginRight: "20px"
                        }
                    }
                },
                touchDown: {},
                scrollbar: {
                    position: "absolute",
                    zIndex: 1,
                    left: 210,
                    bottom: 25,
                    width: "calc(96.5% - 445px)",
                    height: 1,
                    background: g.getRgba(g.colors[1], .15),
                    display: "flex"
                },
                scrollThumbPre: {
                    background: g.colors[1]
                },
                scrollthumb: {
                    flex: "1 0 auto",
                    background: g.colors[1],
                    transform: "scaleX(var(--progress))",
                    transformOrigin: "0 0"
                },
                cta: {
                    position: "absolute",
                    left: 0,
                    bottom: -4,
                    "& a": {
                        extend: g.button
                    }
                }
            };
            return I[g.mediaInverse.lg] = {
                scrollbar: {
                    width: "calc(100% - 365px)"
                },
                slider: {
                    marginLeft: -10,
                    paddingLeft: 0
                },
                galleryControls: {
                    right: 0
                }
            },
            I[g.mediaInverse.md] = {
                root: {
                    paddingBottom: 130
                },
                slider: {
                    marginLeft: -10,
                    paddingLeft: 0,
                    marginBottom: 20
                },
                slide: {
                    padding: [0, 10]
                },
                slideContent: {
                    width: 300,
                    height: 400,
                    padding: [30, 30, 35, 30],
                    cursor: "pointer"
                },
                scrollbar: {
                    display: "none"
                }
            },
            I[g.mediaInverse.sm] = {
                root: {
                    paddingBottom: 70
                },
                slider: {
                    paddingRight: 0
                },
                link: {
                    padding: [30, 30, 35, 30]
                },
                author: {
                    flex: "0 1 32%"
                },
                title: {
                    fontSize: 22,
                    marginBottom: 10
                },
                cta: {
                    bottom: -13
                }
            },
            I
        }
        )
          , X = C(128)
          , Y = C(1)
          , K = Object(l.b)(V);
        function R(g) {
            return Object(Y.jsx)("button", {
                className: "arrow",
                onClick: g.onClick,
                children: Object(Y.jsx)("svg", {
                    viewBox: "0 0 11 21",
                    children: Object(Y.jsx)("path", {
                        fillRule: "evenodd",
                        d: "M11.000,0.000 L11.000,21.000 L-0.000,10.000 L11.000,0.000 Z"
                    })
                })
            })
        }
        function w(g) {
            return Object(Y.jsx)("button", {
                className: "arrow",
                onClick: g.onClick,
                children: Object(Y.jsx)("svg", {
                    viewBox: "0 0 11 21",
                    children: Object(Y.jsx)("path", {
                        fillRule: "evenodd",
                        d: "M-0.000,0.000 L-0.000,21.000 L11.000,10.000 L-0.000,0.000 Z"
                    })
                })
            })
        }
        var H = function(g) {
            var I = g.items
              , C = g.cta
              , A = g.className
              , i = g.soap
              , t = void 0 === i ? 2 : i
              , l = (g.soapWheel,
            K())
              , c = Object(o.useRef)()
              , a = Object(o.useRef)()
              , s = Object(o.useRef)(0)
              , d = Object(o.useRef)(0)
              , b = Object(o.useRef)(0)
              , G = Object(o.useRef)(0)
              , r = Object(o.useRef)(0)
              , B = Object(o.useRef)(0)
              , m = Object(o.useRef)(0)
              , V = Object(o.useRef)(0)
              , H = Object(o.useState)(!1)
              , F = e()(H, 2)
              , N = F[0]
              , S = F[1];
            Object(p.f)();
            Object(u.b)({
                onDrag: function(g) {
                    var I = e()(g.movement, 1)[0]
                      , C = g.first
                      , A = g.last;
                    b.current = -I * t,
                    C && (G.current = B.current),
                    S(Math.abs(I) > 10),
                    A && setTimeout((function() {
                        S(!1)
                    }
                    ), 100),
                    r.current = Object(v.range)(G.current - b.current, -d.current, 0)
                },
                onWheel: function(g) {
                    "x" === g.axis && (b.current = 1 * g.movement[0],
                    r.current = Object(v.range)(G.current - b.current, -d.current, 0))
                }
            }, {
                domTarget: c,
                eventOptions: {
                    passive: !0
                }
            });
            var z = function() {
                s.current = c.current.getBoundingClientRect().width,
                d.current = a.current.getBoundingClientRect().width - s.current
            };
            return Object(o.useEffect)((function() {
                return z(),
                window.addEventListener("resize", z, !1),
                function() {
                    window.removeEventListener("resize", z, !1)
                }
            }
            ), []),
            Object(W.b)((function() {
                a.current && (B.current = Object(v.lerp)(B.current, r.current, .08),
                m.current = (B.current - r.current).toFixed(2),
                V.current = (-B.current / d.current).toFixed(3),
                c.current.style.setProperty("--speed", m.current),
                c.current.style.setProperty("--speed-abs", Math.abs(m.current)),
                c.current.style.setProperty("--progress", V.current),
                a.current.style.transform = "translateX(".concat(B.current, "px)"))
            }
            )),
            Object(Y.jsxs)("div", {
                className: Z()(n()(n()(n()({}, l.root, !0), l.isDragging, N), "className", A)),
                ref: c,
                children: [Object(Y.jsx)("div", {
                    className: l.header,
                    children: Object(Y.jsx)("div", {
                        className: l.content,
                        children: Object(Y.jsxs)("div", {
                            className: "".concat(l.galleryControls, " pretit"),
                            children: [Object(Y.jsx)("span", {
                                className: l.length,
                                children: Object(Y.jsx)("span", {
                                    className: "title__line--pre"
                                })
                            }), Object(Y.jsxs)("div", {
                                className: l.arrowWrapper,
                                children: [Object(Y.jsx)(R, {
                                    onClick: function(g) {
                                        r.current = Object(v.range)(r.current + d.current / (I.length - 2), -d.current, 0),
                                        g.stopPropagation()
                                    }
                                }), Object(Y.jsx)(w, {
                                    onClick: function(g) {
                                        r.current = Object(v.range)(r.current - d.current / (I.length - 2), -d.current, 0),
                                        g.stopPropagation()
                                    }
                                })]
                            })]
                        })
                    })
                }), Object(Y.jsx)("div", {
                    className: l.sliderWrapper,
                    children: Object(Y.jsx)("div", {
                        className: Z()(n()({}, l.slider, !0)),
                        ref: a,
                        children: I?.map((function(g, I) {
                            return void 0 === g ? null : Object(Y.jsx)("div", {
                                className: l.slide,
                                children: Object(Y.jsx)(y.a, {
                                    to: X.a.path.cleanOrigin(g.link),
                                    children: Object(Y.jsxs)("div", {
                                        className: l.slideContent,
                                        children: [g.image && Object(Y.jsx)("div", {
                                            className: l.image,
                                            style: {
                                                backgroundImage: "url(".concat(g.image, ")")
                                            }
                                        }), Object(Y.jsx)("div", {
                                            className: l.title,
                                            dangerouslySetInnerHTML: {
                                                __html: g.title
                                            }
                                        }), Object(Y.jsx)("button", {
                                            className: l.link,
                                            children: Object(Y.jsx)("svg", {
                                                children: Object(Y.jsx)("use", {
                                                    xlinkHref: "#ico-arrow"
                                                })
                                            })
                                        })]
                                    })
                                })
                            }, I.toString())
                        }
                        ))
                    })
                }), Object(Y.jsxs)("div", {
                    className: l.scrollbar,
                    children: [Object(Y.jsx)("div", {
                        className: l.scrollThumbPre,
                        style: {
                            flex: "0 0 ".concat(100 / I?.length, "%")
                        }
                    }), Object(Y.jsx)("div", {
                        className: l.scrollthumb
                    })]
                }), Object(Y.jsx)("div", {
                    className: l.cta,
                    children: Object(Y.jsx)(h.a, {
                        to: C.link,
                        children: C.label
                    })
                })]
            })
        }
          , F = C(672)
          , N = C(675)
          , S = C(674)
          , z = C(676)
          , f = C(689)
          , k = C(205)
          , J = C(203)
          , L = C(668)
          , x = function() {
            var g = Object(J.a)()
              , I = g.stage
              , C = g.model
              , A = g.stage0
              , e = g.stage1
              , i = g.stage2
              , t = g.stage3
              , n = g.model0
              , l = g.model1
              , c = g.model2
              , s = Object(r.e)()
              , d = Object(o.useRef)()
              , b = Object(o.useRef)({
                color1: A.bgColor1,
                color2: A.bgColor2
            })
              , G = function(g, I) {
                a.a.killTweensOf(b.current),
                a.a.to(b.current, {
                    color1: g,
                    color2: I,
                    duration: 2
                })
            };
            Object(o.useEffect)((function() {
                switch (I) {
                case 0:
                    G(A.bgColor1, A.bgColor2);
                    break;
                case 1:
                    G(e.bgColor1, e.bgColor2);
                    break;
                case 2:
                    G(i.bgColor1, i.bgColor2);
                    break;
                case 3:
                    G(t.bgColor1, t.bgColor2)
                }
                if (2 === I)
                    switch (C) {
                    case 0:
                        G(n.bgColor1, n.bgColor2);
                        break;
                    case 1:
                        G(l.bgColor1, l.bgColor2);
                        break;
                    case 2:
                        G(c.bgColor1, c.bgColor2)
                    }
            }
            ), [C, I]);
            var u = Object(o.useMemo)((function() {
                return {
                    uniforms: {
                        uTime: {
                            value: 0
                        },
                        uColor1: {
                            value: new L.Color(b.color1)
                        },
                        uColor2: {
                            value: new L.Color(b.color2)
                        }
                    },
                    vertexShader: "\n      varying vec2 vUv;\n      void main() {\n        vUv = uv;\n        vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n        gl_Position = projectionMatrix * mvPosition;\n      }\n      ",
                    fragmentShader: "\n      varying vec2 vUv;\n      uniform float uTime;\n      uniform vec3 uColor1;\n      uniform vec3 uColor2;\n\n      float sphere(vec2 p, vec2 offset) {\n        return 1. - length(p + offset);\n      }\n\n      void main() {\n        float t = uTime * .4;\n        vec2 uv = vUv;\n        uv -= .5;\n        float c = 0.;\n        for (float i = 0.; i < 3.; i++) {\n          c += sphere(uv * 1.5, vec2(\n            sin(t + i * 4. * i + sin(i + t * .5)) * (.5 + i * .21),\n            cos(t + i * 5. * i + sin(i + t * .3)) * (.5 + i * .21)\n          )) * .75;\n        }\n        gl_FragColor = vec4(mix(uColor2, uColor1, clamp(c, 0., 1.)), 1.);\n      }\n      "
                }
            }
            ), []);
            return Object(r.c)((function(g) {
                var I = g.clock.getElapsedTime();
                d.current.material.uniforms.uTime.value = I,
                d.current.material.uniforms.uColor1.value = new L.Color(b.current.color1),
                d.current.material.uniforms.uColor2.value = new L.Color(b.current.color2)
            }
            )),
            Object(o.useEffect)((function() {
                var g = s.aspect < 1 ? 2 : 1;
                d.current.scale.set(s.viewport.width * s.viewport.distance * 2 * g, s.viewport.height * s.viewport.distance * 2, 1)
            }
            ), [s, I]),
            Object(Y.jsxs)("mesh", {
                ref: d,
                position: [0, 0, -40],
                children: [Object(Y.jsx)("planeBufferGeometry", {
                    attach: "geometry",
                    args: [1, 1]
                }), Object(Y.jsx)("shaderMaterial", {
                    attach: "material",
                    transparent: !0,
                    args: [u]
                })]
            })
        };
        function M(g, I) {
            var C = Object.keys(g);
            if (Object.getOwnPropertySymbols) {
                var A = Object.getOwnPropertySymbols(g);
                I && (A = A.filter((function(I) {
                    return Object.getOwnPropertyDescriptor(g, I).enumerable
                }
                ))),
                C.push.apply(C, A)
            }
            return C
        }
        function Q(g) {
            for (var I = 1; I < arguments.length; I++) {
                var C = null != arguments[I] ? arguments[I] : {};
                I % 2 ? M(Object(C), !0).forEach((function(I) {
                    n()(g, I, C[I])
                }
                )) : Object.getOwnPropertyDescriptors ? Object.defineProperties(g, Object.getOwnPropertyDescriptors(C)) : M(Object(C)).forEach((function(I) {
                    Object.defineProperty(g, I, Object.getOwnPropertyDescriptor(C, I))
                }
                ))
            }
            return g
        }
        var j = function(g) {
            var I = g.s
              , C = Object(J.a)().fallback
              , A = Object(o.useRef)()
              , e = Object(o.useMemo)((function() {
                return {
                    castShadow: !C,
                    intensity: I.directionalIntensity,
                    "shadow-mapSize-width": 1024,
                    "shadow-mapSize-height": 1024,
                    "shadow-camera-far": 30,
                    "shadow-camera-left": -3,
                    "shadow-camera-right": 3,
                    "shadow-camera-top": 3,
                    "shadow-camera-bottom": -3
                }
            }
            ), [C]);
            return Object(Y.jsxs)(Y.Fragment, {
                children: [Object(Y.jsx)("ambientLight", {
                    intensity: I.ambientIntensity,
                    color: I.ambientColor
                }), Object(Y.jsx)("directionalLight", Q(Q({
                    ref: A
                }, e), {}, {
                    color: I.directionalColor,
                    position: [I.directionalX, I.directionalY, I.directionalZ],
                    intensity: I.directionalIntensity
                })), Object(Y.jsx)("pointLight", {
                    position: [I.pointX, I.pointY, I.pointZ],
                    color: I.pointColor,
                    intensity: I.pointIntensity
                })]
            })
        }
          , U = C(327)
          , D = ["onCollide", "onCollideBegin", "onCollideEnd"]
          , T = ["bi", "bj"]
          , O = ["body", "contact", "target"]
          , E = ["uuid"]
          , P = ["body", "ray"];
        function q(g, I) {
            var C = Object.keys(g);
            if (Object.getOwnPropertySymbols) {
                var A = Object.getOwnPropertySymbols(g);
                I && (A = A.filter((function(I) {
                    return Object.getOwnPropertyDescriptor(g, I).enumerable
                }
                ))),
                C.push.apply(C, A)
            }
            return C
        }
        function _(g) {
            for (var I = 1; I < arguments.length; I++) {
                var C = null != arguments[I] ? arguments[I] : {};
                I % 2 ? q(Object(C), !0).forEach((function(I) {
                    bg(g, I, C[I])
                }
                )) : Object.getOwnPropertyDescriptors ? Object.defineProperties(g, Object.getOwnPropertyDescriptors(C)) : q(Object(C)).forEach((function(I) {
                    Object.defineProperty(g, I, Object.getOwnPropertyDescriptor(C, I))
                }
                ))
            }
            return g
        }
        function $(g, I) {
            if (null == g)
                return {};
            var C, A, e = function(g, I) {
                if (null == g)
                    return {};
                var C = {};
                for (var A in g)
                    if (Object.prototype.hasOwnProperty.call(g, A)) {
                        if (I.indexOf(A) >= 0)
                            continue;
                        C[A] = g[A]
                    }
                return C
            }(g, I);
            if (Object.getOwnPropertySymbols) {
                var o = Object.getOwnPropertySymbols(g);
                for (A = 0; A < o.length; A++)
                    C = o[A],
                    I.indexOf(C) >= 0 || Object.prototype.propertyIsEnumerable.call(g, C) && (e[C] = g[C])
            }
            return e
        }
        function gg(g, I, C) {
            if (cg())
                return Reflect.construct.apply(null, arguments);
            var A = [null];
            A.push.apply(A, I);
            var e = new (g.bind.apply(g, A));
            return C && dg(e, C.prototype),
            e
        }
        function Ig(g) {
            return function(g) {
                if (Array.isArray(g))
                    return og(g)
            }(g) || function(g) {
                if ("undefined" != typeof Symbol && null != g[Symbol.iterator] || null != g["@@iterator"])
                    return Array.from(g)
            }(g) || eg(g) || function() {
                throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")
            }()
        }
        function Cg(g, I) {
            var C = "undefined" != typeof Symbol && g[Symbol.iterator] || g["@@iterator"];
            if (!C) {
                if (Array.isArray(g) || (C = eg(g)) || I && g && "number" == typeof g.length) {
                    C && (g = C);
                    var A = 0
                      , e = function() {};
                    return {
                        s: e,
                        n: function() {
                            return A >= g.length ? {
                                done: !0
                            } : {
                                done: !1,
                                value: g[A++]
                            }
                        },
                        e: function(g) {
                            throw g
                        },
                        f: e
                    }
                }
                throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")
            }
            var o, i = !0, t = !1;
            return {
                s: function() {
                    C = C.call(g)
                },
                n: function() {
                    var g = C.next();
                    return i = g.done,
                    g
                },
                e: function(g) {
                    t = !0,
                    o = g
                },
                f: function() {
                    try {
                        i || null == C.return || C.return()
                    } finally {
                        if (t)
                            throw o
                    }
                }
            }
        }
        function Ag(g, I) {
            return function(g) {
                if (Array.isArray(g))
                    return g
            }(g) || function(g, I) {
                var C = null == g ? null : "undefined" != typeof Symbol && g[Symbol.iterator] || g["@@iterator"];
                if (null != C) {
                    var A, e, o, i, t = [], n = !0, l = !1;
                    try {
                        if (o = (C = C.call(g)).next,
                        0 === I) {
                            if (Object(C) !== C)
                                return;
                            n = !1
                        } else
                            for (; !(n = (A = o.call(C)).done) && (t.push(A.value),
                            t.length !== I); n = !0)
                                ;
                    } catch (g) {
                        l = !0,
                        e = g
                    } finally {
                        try {
                            if (!n && null != C.return && (i = C.return(),
                            Object(i) !== i))
                                return
                        } finally {
                            if (l)
                                throw e
                        }
                    }
                    return t
                }
            }(g, I) || eg(g, I) || function() {
                throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")
            }()
        }
        function eg(g, I) {
            if (g) {
                if ("string" == typeof g)
                    return og(g, I);
                var C = Object.prototype.toString.call(g).slice(8, -1);
                return "Object" === C && g.constructor && (C = g.constructor.name),
                "Map" === C || "Set" === C ? Array.from(g) : "Arguments" === C || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(C) ? og(g, I) : void 0
            }
        }
        function og(g, I) {
            (null == I || I > g.length) && (I = g.length);
            for (var C = 0, A = new Array(I); C < I; C++)
                A[C] = g[C];
            return A
        }
        function ig(g, I) {
            if (!(g instanceof I))
                throw new TypeError("Cannot call a class as a function")
        }
        function tg(g, I) {
            for (var C = 0; C < I.length; C++) {
                var A = I[C];
                A.enumerable = A.enumerable || !1,
                A.configurable = !0,
                "value"in A && (A.writable = !0),
                Object.defineProperty(g, Gg(A.key), A)
            }
        }
        function ng(g, I, C) {
            return I && tg(g.prototype, I),
            C && tg(g, C),
            Object.defineProperty(g, "prototype", {
                writable: !1
            }),
            g
        }
        function lg(g, I, C) {
            return I = ag(I),
            function(g, I) {
                if (I && ("object" === rg(I) || "function" == typeof I))
                    return I;
                if (void 0 !== I)
                    throw new TypeError("Derived constructors may only return object or undefined");
                return function(g) {
                    if (void 0 === g)
                        throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return g
                }(g)
            }(g, cg() ? Reflect.construct(I, C || [], ag(g).constructor) : I.apply(g, C))
        }
        function cg() {
            try {
                var g = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], (function() {}
                )))
            } catch (g) {}
            return (cg = function() {
                return !!g
            }
            )()
        }
        function ag(g) {
            return (ag = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function(g) {
                return g.__proto__ || Object.getPrototypeOf(g)
            }
            )(g)
        }
        function sg(g, I) {
            if ("function" != typeof I && null !== I)
                throw new TypeError("Super expression must either be null or a function");
            g.prototype = Object.create(I && I.prototype, {
                constructor: {
                    value: g,
                    writable: !0,
                    configurable: !0
                }
            }),
            Object.defineProperty(g, "prototype", {
                writable: !1
            }),
            I && dg(g, I)
        }
        function dg(g, I) {
            return (dg = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function(g, I) {
                return g.__proto__ = I,
                g
            }
            )(g, I)
        }
        function bg(g, I, C) {
            return (I = Gg(I))in g ? Object.defineProperty(g, I, {
                value: C,
                enumerable: !0,
                configurable: !0,
                writable: !0
            }) : g[I] = C,
            g
        }
        function Gg(g) {
            var I = function(g, I) {
                if ("object" != rg(g) || !g)
                    return g;
                var C = g[Symbol.toPrimitive];
                if (void 0 !== C) {
                    var A = C.call(g, I || "default");
                    if ("object" != rg(A))
                        return A;
                    throw new TypeError("@@toPrimitive must return a primitive value.")
                }
                return ("string" === I ? String : Number)(g)
            }(g, "string");
            return "symbol" == rg(I) ? I : I + ""
        }
        function rg(g) {
            return (rg = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(g) {
                return typeof g
            }
            : function(g) {
                return g && "function" == typeof Symbol && g.constructor === Symbol && g !== Symbol.prototype ? "symbol" : typeof g
            }
            )(g)
        }
        var ug, Bg = {
            exports: {}
        }, Zg = "object" === ("undefined" == typeof Reflect ? "undefined" : rg(Reflect)) ? Reflect : null, mg = Zg && "function" == typeof Zg.apply ? Zg.apply : function(g, I, C) {
            return Function.prototype.apply.call(g, I, C)
        }
        ;
        ug = Zg && "function" == typeof Zg.ownKeys ? Zg.ownKeys : Object.getOwnPropertySymbols ? function(g) {
            return Object.getOwnPropertyNames(g).concat(Object.getOwnPropertySymbols(g))
        }
        : function(g) {
            return Object.getOwnPropertyNames(g)
        }
        ;
        var hg = Number.isNaN || function(g) {
            return g != g
        }
        ;
        function pg() {
            pg.init.call(this)
        }
        Bg.exports = pg,
        Bg.exports.once = function(g, I) {
            return new Promise((function(C, A) {
                function e(C) {
                    g.removeListener(I, o),
                    A(C)
                }
                function o() {
                    "function" == typeof g.removeListener && g.removeListener("error", e),
                    C([].slice.call(arguments))
                }
                Hg(g, I, o, {
                    once: !0
                }),
                "error" !== I && function(g, I, C) {
                    "function" == typeof g.on && Hg(g, "error", I, C)
                }(g, e, {
                    once: !0
                })
            }
            ))
        }
        ,
        pg.EventEmitter = pg,
        pg.prototype._events = void 0,
        pg.prototype._eventsCount = 0,
        pg.prototype._maxListeners = void 0;
        var yg = 10;
        function Wg(g) {
            if ("function" != typeof g)
                throw new TypeError('The "listener" argument must be of type Function. Received type ' + rg(g))
        }
        function vg(g) {
            return void 0 === g._maxListeners ? pg.defaultMaxListeners : g._maxListeners
        }
        function Vg(g, I, C, A) {
            var e, o, i, t;
            if (Wg(C),
            void 0 === (o = g._events) ? (o = g._events = Object.create(null),
            g._eventsCount = 0) : (void 0 !== o.newListener && (g.emit("newListener", I, C.listener ? C.listener : C),
            o = g._events),
            i = o[I]),
            void 0 === i)
                i = o[I] = C,
                ++g._eventsCount;
            else if ("function" == typeof i ? i = o[I] = A ? [C, i] : [i, C] : A ? i.unshift(C) : i.push(C),
            (e = vg(g)) > 0 && i.length > e && !i.warned) {
                i.warned = !0;
                var n = new Error("Possible EventEmitter memory leak detected. " + i.length + " " + String(I) + " listeners added. Use emitter.setMaxListeners() to increase limit");
                n.name = "MaxListenersExceededWarning",
                n.emitter = g,
                n.type = I,
                n.count = i.length,
                t = n,
                console && console.warn && console.warn(t)
            }
            return g
        }
        function Xg() {
            if (!this.fired)
                return this.target.removeListener(this.type, this.wrapFn),
                this.fired = !0,
                0 === arguments.length ? this.listener.call(this.target) : this.listener.apply(this.target, arguments)
        }
        function Yg(g, I, C) {
            var A = {
                fired: !1,
                wrapFn: void 0,
                target: g,
                type: I,
                listener: C
            }
              , e = Xg.bind(A);
            return e.listener = C,
            A.wrapFn = e,
            e
        }
        function Kg(g, I, C) {
            var A = g._events;
            if (void 0 === A)
                return [];
            var e = A[I];
            return void 0 === e ? [] : "function" == typeof e ? C ? [e.listener || e] : [e] : C ? function(g) {
                for (var I = new Array(g.length), C = 0; C < I.length; ++C)
                    I[C] = g[C].listener || g[C];
                return I
            }(e) : wg(e, e.length)
        }
        function Rg(g) {
            var I = this._events;
            if (void 0 !== I) {
                var C = I[g];
                if ("function" == typeof C)
                    return 1;
                if (void 0 !== C)
                    return C.length
            }
            return 0
        }
        function wg(g, I) {
            for (var C = new Array(I), A = 0; A < I; ++A)
                C[A] = g[A];
            return C
        }
        function Hg(g, I, C, A) {
            if ("function" == typeof g.on)
                A.once ? g.once(I, C) : g.on(I, C);
            else {
                if ("function" != typeof g.addEventListener)
                    throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type ' + rg(g));
                g.addEventListener(I, (function e(o) {
                    A.once && g.removeEventListener(I, e),
                    C(o)
                }
                ))
            }
        }
        Object.defineProperty(pg, "defaultMaxListeners", {
            enumerable: !0,
            get: function() {
                return yg
            },
            set: function(g) {
                if ("number" != typeof g || g < 0 || hg(g))
                    throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received ' + g + ".");
                yg = g
            }
        }),
        pg.init = function() {
            void 0 !== this._events && this._events !== Object.getPrototypeOf(this)._events || (this._events = Object.create(null),
            this._eventsCount = 0),
            this._maxListeners = this._maxListeners || void 0
        }
        ,
        pg.prototype.setMaxListeners = function(g) {
            if ("number" != typeof g || g < 0 || hg(g))
                throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received ' + g + ".");
            return this._maxListeners = g,
            this
        }
        ,
        pg.prototype.getMaxListeners = function() {
            return vg(this)
        }
        ,
        pg.prototype.emit = function(g) {
            for (var I = [], C = 1; C < arguments.length; C++)
                I.push(arguments[C]);
            var A = "error" === g
              , e = this._events;
            if (void 0 !== e)
                A = A && void 0 === e.error;
            else if (!A)
                return !1;
            if (A) {
                var o;
                if (I.length > 0 && (o = I[0]),
                o instanceof Error)
                    throw o;
                var i = new Error("Unhandled error." + (o ? " (" + o.message + ")" : ""));
                throw i.context = o,
                i
            }
            var t = e[g];
            if (void 0 === t)
                return !1;
            if ("function" == typeof t)
                mg(t, this, I);
            else {
                var n = t.length
                  , l = wg(t, n);
                for (C = 0; C < n; ++C)
                    mg(l[C], this, I)
            }
            return !0
        }
        ,
        pg.prototype.addListener = function(g, I) {
            return Vg(this, g, I, !1)
        }
        ,
        pg.prototype.on = pg.prototype.addListener,
        pg.prototype.prependListener = function(g, I) {
            return Vg(this, g, I, !0)
        }
        ,
        pg.prototype.once = function(g, I) {
            return Wg(I),
            this.on(g, Yg(this, g, I)),
            this
        }
        ,
        pg.prototype.prependOnceListener = function(g, I) {
            return Wg(I),
            this.prependListener(g, Yg(this, g, I)),
            this
        }
        ,
        pg.prototype.removeListener = function(g, I) {
            var C, A, e, o, i;
            if (Wg(I),
            void 0 === (A = this._events))
                return this;
            if (void 0 === (C = A[g]))
                return this;
            if (C === I || C.listener === I)
                0 == --this._eventsCount ? this._events = Object.create(null) : (delete A[g],
                A.removeListener && this.emit("removeListener", g, C.listener || I));
            else if ("function" != typeof C) {
                for (e = -1,
                o = C.length - 1; o >= 0; o--)
                    if (C[o] === I || C[o].listener === I) {
                        i = C[o].listener,
                        e = o;
                        break
                    }
                if (e < 0)
                    return this;
                0 === e ? C.shift() : function(g, I) {
                    for (; I + 1 < g.length; I++)
                        g[I] = g[I + 1];
                    g.pop()
                }(C, e),
                1 === C.length && (A[g] = C[0]),
                void 0 !== A.removeListener && this.emit("removeListener", g, i || I)
            }
            return this
        }
        ,
        pg.prototype.off = pg.prototype.removeListener,
        pg.prototype.removeAllListeners = function(g) {
            var I, C, A;
            if (void 0 === (C = this._events))
                return this;
            if (void 0 === C.removeListener)
                return 0 === arguments.length ? (this._events = Object.create(null),
                this._eventsCount = 0) : void 0 !== C[g] && (0 == --this._eventsCount ? this._events = Object.create(null) : delete C[g]),
                this;
            if (0 === arguments.length) {
                var e, o = Object.keys(C);
                for (A = 0; A < o.length; ++A)
                    "removeListener" !== (e = o[A]) && this.removeAllListeners(e);
                return this.removeAllListeners("removeListener"),
                this._events = Object.create(null),
                this._eventsCount = 0,
                this
            }
            if ("function" == typeof (I = C[g]))
                this.removeListener(g, I);
            else if (void 0 !== I)
                for (A = I.length - 1; A >= 0; A--)
                    this.removeListener(g, I[A]);
            return this
        }
        ,
        pg.prototype.listeners = function(g) {
            return Kg(this, g, !0)
        }
        ,
        pg.prototype.rawListeners = function(g) {
            return Kg(this, g, !1)
        }
        ,
        pg.listenerCount = function(g, I) {
            return "function" == typeof g.listenerCount ? g.listenerCount(I) : Rg.call(g, I)
        }
        ,
        pg.prototype.listenerCount = Rg,
        pg.prototype.eventNames = function() {
            return this._eventsCount > 0 ? ug(this._events) : []
        }
        ;
        var Fg = Bg.exports;
        function Ng(g, I, C) {
            var A = void 0 === I ? null : I
              , e = function(g, I) {
                var C = atob(g);
                if (I) {
                    for (var A = new Uint8Array(C.length), e = 0, o = C.length; e < o; ++e)
                        A[e] = C.charCodeAt(e);
                    return String.fromCharCode.apply(null, new Uint16Array(A.buffer))
                }
                return C
            }(g, void 0 !== C && C)
              , o = e.indexOf("\n", 10) + 1
              , i = e.substring(o) + (A ? "//# sourceMappingURL=" + A : "")
              , t = new Blob([i],{
                type: "application/javascript"
            });
            return URL.createObjectURL(t)
        }
        var Sg, zg, fg, kg, Jg = (Sg = "Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICd1c2Ugc3RyaWN0JzsKCiAgLyoqCiAgICogUmVjb3JkcyB3aGF0IG9iamVjdHMgYXJlIGNvbGxpZGluZyB3aXRoIGVhY2ggb3RoZXIKICAgKi8KCiAgLyoqCiAgICogQSAzeDMgbWF0cml4LgogICAqIEF1dGhvcmVkIGJ5IHtAbGluayBodHRwOi8vZ2l0aHViLmNvbS9zY2h0ZXBwZS8gc2NodGVwcGV9CiAgICovCiAgY2xhc3MgTWF0MyB7CiAgICAvKioKICAgICAqIEEgdmVjdG9yIG9mIGxlbmd0aCA5LCBjb250YWluaW5nIGFsbCBtYXRyaXggZWxlbWVudHMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBwYXJhbSBlbGVtZW50cyBBIHZlY3RvciBvZiBsZW5ndGggOSwgY29udGFpbmluZyBhbGwgbWF0cml4IGVsZW1lbnRzLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihlbGVtZW50cykgewogICAgICBpZiAoZWxlbWVudHMgPT09IHZvaWQgMCkgewogICAgICAgIGVsZW1lbnRzID0gWzAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDBdOwogICAgICB9CgogICAgICB0aGlzLmVsZW1lbnRzID0gZWxlbWVudHM7CiAgICB9CiAgICAvKioKICAgICAqIFNldHMgdGhlIG1hdHJpeCB0byBpZGVudGl0eQogICAgICogQHRvZG8gU2hvdWxkIHBlcmhhcHMgYmUgcmVuYW1lZCB0byBgc2V0SWRlbnRpdHkoKWAgdG8gYmUgbW9yZSBjbGVhci4KICAgICAqIEB0b2RvIENyZWF0ZSBhbm90aGVyIGZ1bmN0aW9uIHRoYXQgaW1tZWRpYXRlbHkgY3JlYXRlcyBhbiBpZGVudGl0eSBtYXRyaXggZWcuIGBleWUoKWAKICAgICAqLwoKCiAgICBpZGVudGl0eSgpIHsKICAgICAgY29uc3QgZSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGVbMF0gPSAxOwogICAgICBlWzFdID0gMDsKICAgICAgZVsyXSA9IDA7CiAgICAgIGVbM10gPSAwOwogICAgICBlWzRdID0gMTsKICAgICAgZVs1XSA9IDA7CiAgICAgIGVbNl0gPSAwOwogICAgICBlWzddID0gMDsKICAgICAgZVs4XSA9IDE7CiAgICB9CiAgICAvKioKICAgICAqIFNldCBhbGwgZWxlbWVudHMgdG8gemVybwogICAgICovCgoKICAgIHNldFplcm8oKSB7CiAgICAgIGNvbnN0IGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICBlWzBdID0gMDsKICAgICAgZVsxXSA9IDA7CiAgICAgIGVbMl0gPSAwOwogICAgICBlWzNdID0gMDsKICAgICAgZVs0XSA9IDA7CiAgICAgIGVbNV0gPSAwOwogICAgICBlWzZdID0gMDsKICAgICAgZVs3XSA9IDA7CiAgICAgIGVbOF0gPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIHRoZSBtYXRyaXggZGlhZ29uYWwgZWxlbWVudHMgZnJvbSBhIFZlYzMKICAgICAqLwoKCiAgICBzZXRUcmFjZSh2ZWN0b3IpIHsKICAgICAgY29uc3QgZSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGVbMF0gPSB2ZWN0b3IueDsKICAgICAgZVs0XSA9IHZlY3Rvci55OwogICAgICBlWzhdID0gdmVjdG9yLno7CiAgICB9CiAgICAvKioKICAgICAqIEdldHMgdGhlIG1hdHJpeCBkaWFnb25hbCBlbGVtZW50cwogICAgICovCgoKICAgIGdldFRyYWNlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgdGFyZ2V0LnggPSBlWzBdOwogICAgICB0YXJnZXQueSA9IGVbNF07CiAgICAgIHRhcmdldC56ID0gZVs4XTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTWF0cml4LVZlY3RvciBtdWx0aXBsaWNhdGlvbgogICAgICogQHBhcmFtIHYgVGhlIHZlY3RvciB0byBtdWx0aXBseSB3aXRoCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLCB0YXJnZXQgdG8gc2F2ZSB0aGUgcmVzdWx0IGluLgogICAgICovCgoKICAgIHZtdWx0KHYsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgY29uc3QgeCA9IHYueDsKICAgICAgY29uc3QgeSA9IHYueTsKICAgICAgY29uc3QgeiA9IHYuejsKICAgICAgdGFyZ2V0LnggPSBlWzBdICogeCArIGVbMV0gKiB5ICsgZVsyXSAqIHo7CiAgICAgIHRhcmdldC55ID0gZVszXSAqIHggKyBlWzRdICogeSArIGVbNV0gKiB6OwogICAgICB0YXJnZXQueiA9IGVbNl0gKiB4ICsgZVs3XSAqIHkgKyBlWzhdICogejsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTWF0cml4LXNjYWxhciBtdWx0aXBsaWNhdGlvbgogICAgICovCgoKICAgIHNtdWx0KHMpIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGhpcy5lbGVtZW50c1tpXSAqPSBzOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIE1hdHJpeCBtdWx0aXBsaWNhdGlvbgogICAgICogQHBhcmFtIG1hdHJpeCBNYXRyaXggdG8gbXVsdGlwbHkgd2l0aCBmcm9tIGxlZnQgc2lkZS4KICAgICAqLwoKCiAgICBtbXVsdChtYXRyaXgsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgTWF0MygpOwogICAgICB9CgogICAgICBjb25zdCBBID0gdGhpcy5lbGVtZW50czsKICAgICAgY29uc3QgQiA9IG1hdHJpeC5lbGVtZW50czsKICAgICAgY29uc3QgVCA9IHRhcmdldC5lbGVtZW50czsKICAgICAgY29uc3QgYTExID0gQVswXSwKICAgICAgICAgICAgYTEyID0gQVsxXSwKICAgICAgICAgICAgYTEzID0gQVsyXSwKICAgICAgICAgICAgYTIxID0gQVszXSwKICAgICAgICAgICAgYTIyID0gQVs0XSwKICAgICAgICAgICAgYTIzID0gQVs1XSwKICAgICAgICAgICAgYTMxID0gQVs2XSwKICAgICAgICAgICAgYTMyID0gQVs3XSwKICAgICAgICAgICAgYTMzID0gQVs4XTsKICAgICAgY29uc3QgYjExID0gQlswXSwKICAgICAgICAgICAgYjEyID0gQlsxXSwKICAgICAgICAgICAgYjEzID0gQlsyXSwKICAgICAgICAgICAgYjIxID0gQlszXSwKICAgICAgICAgICAgYjIyID0gQls0XSwKICAgICAgICAgICAgYjIzID0gQls1XSwKICAgICAgICAgICAgYjMxID0gQls2XSwKICAgICAgICAgICAgYjMyID0gQls3XSwKICAgICAgICAgICAgYjMzID0gQls4XTsKICAgICAgVFswXSA9IGExMSAqIGIxMSArIGExMiAqIGIyMSArIGExMyAqIGIzMTsKICAgICAgVFsxXSA9IGExMSAqIGIxMiArIGExMiAqIGIyMiArIGExMyAqIGIzMjsKICAgICAgVFsyXSA9IGExMSAqIGIxMyArIGExMiAqIGIyMyArIGExMyAqIGIzMzsKICAgICAgVFszXSA9IGEyMSAqIGIxMSArIGEyMiAqIGIyMSArIGEyMyAqIGIzMTsKICAgICAgVFs0XSA9IGEyMSAqIGIxMiArIGEyMiAqIGIyMiArIGEyMyAqIGIzMjsKICAgICAgVFs1XSA9IGEyMSAqIGIxMyArIGEyMiAqIGIyMyArIGEyMyAqIGIzMzsKICAgICAgVFs2XSA9IGEzMSAqIGIxMSArIGEzMiAqIGIyMSArIGEzMyAqIGIzMTsKICAgICAgVFs3XSA9IGEzMSAqIGIxMiArIGEzMiAqIGIyMiArIGEzMyAqIGIzMjsKICAgICAgVFs4XSA9IGEzMSAqIGIxMyArIGEzMiAqIGIyMyArIGEzMyAqIGIzMzsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogU2NhbGUgZWFjaCBjb2x1bW4gb2YgdGhlIG1hdHJpeAogICAgICovCgoKICAgIHNjYWxlKHZlY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBNYXQzKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICBjb25zdCB0ID0gdGFyZ2V0LmVsZW1lbnRzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDM7IGkrKykgewogICAgICAgIHRbMyAqIGkgKyAwXSA9IHZlY3Rvci54ICogZVszICogaSArIDBdOwogICAgICAgIHRbMyAqIGkgKyAxXSA9IHZlY3Rvci55ICogZVszICogaSArIDFdOwogICAgICAgIHRbMyAqIGkgKyAyXSA9IHZlY3Rvci56ICogZVszICogaSArIDJdOwogICAgICB9CgogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTb2x2ZSBBeD1iCiAgICAgKiBAcGFyYW0gYiBUaGUgcmlnaHQgaGFuZCBzaWRlCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLiBUYXJnZXQgdmVjdG9yIHRvIHNhdmUgaW4uCiAgICAgKiBAcmV0dXJuIFRoZSBzb2x1dGlvbiB4CiAgICAgKiBAdG9kbyBzaG91bGQgcmV1c2UgYXJyYXlzCiAgICAgKi8KCgogICAgc29sdmUoYiwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIC8vIENvbnN0cnVjdCBlcXVhdGlvbnMKICAgICAgY29uc3QgbnIgPSAzOyAvLyBudW0gcm93cwoKICAgICAgY29uc3QgbmMgPSA0OyAvLyBudW0gY29scwoKICAgICAgY29uc3QgZXFucyA9IFtdOwogICAgICBsZXQgaTsKICAgICAgbGV0IGo7CgogICAgICBmb3IgKGkgPSAwOyBpIDwgbnIgKiBuYzsgaSsrKSB7CiAgICAgICAgZXFucy5wdXNoKDApOwogICAgICB9CgogICAgICBmb3IgKGkgPSAwOyBpIDwgMzsgaSsrKSB7CiAgICAgICAgZm9yIChqID0gMDsgaiA8IDM7IGorKykgewogICAgICAgICAgZXFuc1tpICsgbmMgKiBqXSA9IHRoaXMuZWxlbWVudHNbaSArIDMgKiBqXTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGVxbnNbMyArIDQgKiAwXSA9IGIueDsKICAgICAgZXFuc1szICsgNCAqIDFdID0gYi55OwogICAgICBlcW5zWzMgKyA0ICogMl0gPSBiLno7IC8vIENvbXB1dGUgcmlnaHQgdXBwZXIgdHJpYW5ndWxhciB2ZXJzaW9uIG9mIHRoZSBtYXRyaXggLSBHYXVzcyBlbGltaW5hdGlvbgoKICAgICAgbGV0IG4gPSAzOwogICAgICBjb25zdCBrID0gbjsKICAgICAgbGV0IG5wOwogICAgICBjb25zdCBrcCA9IDQ7IC8vIG51bSByb3dzCgogICAgICBsZXQgcDsKCiAgICAgIGRvIHsKICAgICAgICBpID0gayAtIG47CgogICAgICAgIGlmIChlcW5zW2kgKyBuYyAqIGldID09PSAwKSB7CiAgICAgICAgICAvLyB0aGUgcGl2b3QgaXMgbnVsbCwgc3dhcCBsaW5lcwogICAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBrOyBqKyspIHsKICAgICAgICAgICAgaWYgKGVxbnNbaSArIG5jICogal0gIT09IDApIHsKICAgICAgICAgICAgICBucCA9IGtwOwoKICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAvLyBkbyBsaWduZSggaSApID0gbGlnbmUoIGkgKSArIGxpZ25lKCBrICkKICAgICAgICAgICAgICAgIHAgPSBrcCAtIG5wOwogICAgICAgICAgICAgICAgZXFuc1twICsgbmMgKiBpXSArPSBlcW5zW3AgKyBuYyAqIGpdOwogICAgICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwoKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGVxbnNbaSArIG5jICogaV0gIT09IDApIHsKICAgICAgICAgIGZvciAoaiA9IGkgKyAxOyBqIDwgazsgaisrKSB7CiAgICAgICAgICAgIGNvbnN0IG11bHRpcGxpZXIgPSBlcW5zW2kgKyBuYyAqIGpdIC8gZXFuc1tpICsgbmMgKiBpXTsKICAgICAgICAgICAgbnAgPSBrcDsKCiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAvLyBkbyBsaWduZSggayApID0gbGlnbmUoIGsgKSAtIG11bHRpcGxpZXIgKiBsaWduZSggaSApCiAgICAgICAgICAgICAgcCA9IGtwIC0gbnA7CiAgICAgICAgICAgICAgZXFuc1twICsgbmMgKiBqXSA9IHAgPD0gaSA/IDAgOiBlcW5zW3AgKyBuYyAqIGpdIC0gZXFuc1twICsgbmMgKiBpXSAqIG11bHRpcGxpZXI7CiAgICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSB3aGlsZSAoLS1uKTsgLy8gR2V0IHRoZSBzb2x1dGlvbgoKCiAgICAgIHRhcmdldC56ID0gZXFuc1syICogbmMgKyAzXSAvIGVxbnNbMiAqIG5jICsgMl07CiAgICAgIHRhcmdldC55ID0gKGVxbnNbMSAqIG5jICsgM10gLSBlcW5zWzEgKiBuYyArIDJdICogdGFyZ2V0LnopIC8gZXFuc1sxICogbmMgKyAxXTsKICAgICAgdGFyZ2V0LnggPSAoZXFuc1swICogbmMgKyAzXSAtIGVxbnNbMCAqIG5jICsgMl0gKiB0YXJnZXQueiAtIGVxbnNbMCAqIG5jICsgMV0gKiB0YXJnZXQueSkgLyBlcW5zWzAgKiBuYyArIDBdOwoKICAgICAgaWYgKGlzTmFOKHRhcmdldC54KSB8fCBpc05hTih0YXJnZXQueSkgfHwgaXNOYU4odGFyZ2V0LnopIHx8IHRhcmdldC54ID09PSBJbmZpbml0eSB8fCB0YXJnZXQueSA9PT0gSW5maW5pdHkgfHwgdGFyZ2V0LnogPT09IEluZmluaXR5KSB7CiAgICAgICAgdGhyb3cgYENvdWxkIG5vdCBzb2x2ZSBlcXVhdGlvbiEgR290IHg9WyR7dGFyZ2V0LnRvU3RyaW5nKCl9XSwgYj1bJHtiLnRvU3RyaW5nKCl9XSwgQT1bJHt0aGlzLnRvU3RyaW5nKCl9XWA7CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBlbGVtZW50IGluIHRoZSBtYXRyaXggYnkgaW5kZXguIEluZGV4IHN0YXJ0cyBhdCAwLCBub3QgMSEhIQogICAgICogQHBhcmFtIHZhbHVlIElmIHByb3ZpZGVkLCB0aGUgbWF0cml4IGVsZW1lbnQgd2lsbCBiZSBzZXQgdG8gdGhpcyB2YWx1ZS4KICAgICAqLwoKCiAgICBlKHJvdywgY29sdW1uLCB2YWx1ZSkgewogICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiB0aGlzLmVsZW1lbnRzW2NvbHVtbiArIDMgKiByb3ddOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFNldCB2YWx1ZQogICAgICAgIHRoaXMuZWxlbWVudHNbY29sdW1uICsgMyAqIHJvd10gPSB2YWx1ZTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb3B5IGFub3RoZXIgbWF0cml4IGludG8gdGhpcyBtYXRyaXggb2JqZWN0LgogICAgICovCgoKICAgIGNvcHkobWF0cml4KSB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbWF0cml4LmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGhpcy5lbGVtZW50c1tpXSA9IG1hdHJpeC5lbGVtZW50c1tpXTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgYSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIG1hdHJpeC4KICAgICAqLwoKCiAgICB0b1N0cmluZygpIHsKICAgICAgbGV0IHIgPSAnJzsKICAgICAgY29uc3Qgc2VwID0gJywnOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA5OyBpKyspIHsKICAgICAgICByICs9IHRoaXMuZWxlbWVudHNbaV0gKyBzZXA7CiAgICAgIH0KCiAgICAgIHJldHVybiByOwogICAgfQogICAgLyoqCiAgICAgKiByZXZlcnNlIHRoZSBtYXRyaXgKICAgICAqIEBwYXJhbSB0YXJnZXQgVGFyZ2V0IG1hdHJpeCB0byBzYXZlIGluLgogICAgICogQHJldHVybiBUaGUgc29sdXRpb24geAogICAgICovCgoKICAgIHJldmVyc2UodGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBNYXQzKCk7CiAgICAgIH0KCiAgICAgIC8vIENvbnN0cnVjdCBlcXVhdGlvbnMKICAgICAgY29uc3QgbnIgPSAzOyAvLyBudW0gcm93cwoKICAgICAgY29uc3QgbmMgPSA2OyAvLyBudW0gY29scwoKICAgICAgY29uc3QgZXFucyA9IHJldmVyc2VfZXFuczsKICAgICAgbGV0IGk7CiAgICAgIGxldCBqOwoKICAgICAgZm9yIChpID0gMDsgaSA8IDM7IGkrKykgewogICAgICAgIGZvciAoaiA9IDA7IGogPCAzOyBqKyspIHsKICAgICAgICAgIGVxbnNbaSArIG5jICogal0gPSB0aGlzLmVsZW1lbnRzW2kgKyAzICogal07CiAgICAgICAgfQogICAgICB9CgogICAgICBlcW5zWzMgKyA2ICogMF0gPSAxOwogICAgICBlcW5zWzMgKyA2ICogMV0gPSAwOwogICAgICBlcW5zWzMgKyA2ICogMl0gPSAwOwogICAgICBlcW5zWzQgKyA2ICogMF0gPSAwOwogICAgICBlcW5zWzQgKyA2ICogMV0gPSAxOwogICAgICBlcW5zWzQgKyA2ICogMl0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMF0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMV0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMl0gPSAxOyAvLyBDb21wdXRlIHJpZ2h0IHVwcGVyIHRyaWFuZ3VsYXIgdmVyc2lvbiBvZiB0aGUgbWF0cml4IC0gR2F1c3MgZWxpbWluYXRpb24KCiAgICAgIGxldCBuID0gMzsKICAgICAgY29uc3QgayA9IG47CiAgICAgIGxldCBucDsKICAgICAgY29uc3Qga3AgPSBuYzsgLy8gbnVtIHJvd3MKCiAgICAgIGxldCBwOwoKICAgICAgZG8gewogICAgICAgIGkgPSBrIC0gbjsKCiAgICAgICAgaWYgKGVxbnNbaSArIG5jICogaV0gPT09IDApIHsKICAgICAgICAgIC8vIHRoZSBwaXZvdCBpcyBudWxsLCBzd2FwIGxpbmVzCiAgICAgICAgICBmb3IgKGogPSBpICsgMTsgaiA8IGs7IGorKykgewogICAgICAgICAgICBpZiAoZXFuc1tpICsgbmMgKiBqXSAhPT0gMCkgewogICAgICAgICAgICAgIG5wID0ga3A7CgogICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgIC8vIGRvIGxpbmUoIGkgKSA9IGxpbmUoIGkgKSArIGxpbmUoIGsgKQogICAgICAgICAgICAgICAgcCA9IGtwIC0gbnA7CiAgICAgICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGldICs9IGVxbnNbcCArIG5jICogal07CiAgICAgICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CgogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoZXFuc1tpICsgbmMgKiBpXSAhPT0gMCkgewogICAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBrOyBqKyspIHsKICAgICAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IGVxbnNbaSArIG5jICogal0gLyBlcW5zW2kgKyBuYyAqIGldOwogICAgICAgICAgICBucCA9IGtwOwoKICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgIC8vIGRvIGxpbmUoIGsgKSA9IGxpbmUoIGsgKSAtIG11bHRpcGxpZXIgKiBsaW5lKCBpICkKICAgICAgICAgICAgICBwID0ga3AgLSBucDsKICAgICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGpdID0gcCA8PSBpID8gMCA6IGVxbnNbcCArIG5jICogal0gLSBlcW5zW3AgKyBuYyAqIGldICogbXVsdGlwbGllcjsKICAgICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IHdoaWxlICgtLW4pOyAvLyBlbGltaW5hdGUgdGhlIHVwcGVyIGxlZnQgdHJpYW5nbGUgb2YgdGhlIG1hdHJpeAoKCiAgICAgIGkgPSAyOwoKICAgICAgZG8gewogICAgICAgIGogPSBpIC0gMTsKCiAgICAgICAgZG8gewogICAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IGVxbnNbaSArIG5jICogal0gLyBlcW5zW2kgKyBuYyAqIGldOwogICAgICAgICAgbnAgPSBuYzsKCiAgICAgICAgICBkbyB7CiAgICAgICAgICAgIHAgPSBuYyAtIG5wOwogICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGpdID0gZXFuc1twICsgbmMgKiBqXSAtIGVxbnNbcCArIG5jICogaV0gKiBtdWx0aXBsaWVyOwogICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgICAgfSB3aGlsZSAoai0tKTsKICAgICAgfSB3aGlsZSAoLS1pKTsgLy8gb3BlcmF0aW9ucyBvbiB0aGUgZGlhZ29uYWwKCgogICAgICBpID0gMjsKCiAgICAgIGRvIHsKICAgICAgICBjb25zdCBtdWx0aXBsaWVyID0gMSAvIGVxbnNbaSArIG5jICogaV07CiAgICAgICAgbnAgPSBuYzsKCiAgICAgICAgZG8gewogICAgICAgICAgcCA9IG5jIC0gbnA7CiAgICAgICAgICBlcW5zW3AgKyBuYyAqIGldID0gZXFuc1twICsgbmMgKiBpXSAqIG11bHRpcGxpZXI7CiAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgIH0gd2hpbGUgKGktLSk7CgogICAgICBpID0gMjsKCiAgICAgIGRvIHsKICAgICAgICBqID0gMjsKCiAgICAgICAgZG8gewogICAgICAgICAgcCA9IGVxbnNbbnIgKyBqICsgbmMgKiBpXTsKCiAgICAgICAgICBpZiAoaXNOYU4ocCkgfHwgcCA9PT0gSW5maW5pdHkpIHsKICAgICAgICAgICAgdGhyb3cgYENvdWxkIG5vdCByZXZlcnNlISBBPVske3RoaXMudG9TdHJpbmcoKX1dYDsKICAgICAgICAgIH0KCiAgICAgICAgICB0YXJnZXQuZShpLCBqLCBwKTsKICAgICAgICB9IHdoaWxlIChqLS0pOwogICAgICB9IHdoaWxlIChpLS0pOwoKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBtYXRyaXggZnJvbSBhIHF1YXRlcmlvbgogICAgICovCgoKICAgIHNldFJvdGF0aW9uRnJvbVF1YXRlcm5pb24ocSkgewogICAgICBjb25zdCB4ID0gcS54OwogICAgICBjb25zdCB5ID0gcS55OwogICAgICBjb25zdCB6ID0gcS56OwogICAgICBjb25zdCB3ID0gcS53OwogICAgICBjb25zdCB4MiA9IHggKyB4OwogICAgICBjb25zdCB5MiA9IHkgKyB5OwogICAgICBjb25zdCB6MiA9IHogKyB6OwogICAgICBjb25zdCB4eCA9IHggKiB4MjsKICAgICAgY29uc3QgeHkgPSB4ICogeTI7CiAgICAgIGNvbnN0IHh6ID0geCAqIHoyOwogICAgICBjb25zdCB5eSA9IHkgKiB5MjsKICAgICAgY29uc3QgeXogPSB5ICogejI7CiAgICAgIGNvbnN0IHp6ID0geiAqIHoyOwogICAgICBjb25zdCB3eCA9IHcgKiB4MjsKICAgICAgY29uc3Qgd3kgPSB3ICogeTI7CiAgICAgIGNvbnN0IHd6ID0gdyAqIHoyOwogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgZVszICogMCArIDBdID0gMSAtICh5eSArIHp6KTsKICAgICAgZVszICogMCArIDFdID0geHkgLSB3ejsKICAgICAgZVszICogMCArIDJdID0geHogKyB3eTsKICAgICAgZVszICogMSArIDBdID0geHkgKyB3ejsKICAgICAgZVszICogMSArIDFdID0gMSAtICh4eCArIHp6KTsKICAgICAgZVszICogMSArIDJdID0geXogLSB3eDsKICAgICAgZVszICogMiArIDBdID0geHogLSB3eTsKICAgICAgZVszICogMiArIDFdID0geXogKyB3eDsKICAgICAgZVszICogMiArIDJdID0gMSAtICh4eCArIHl5KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFRyYW5zcG9zZSB0aGUgbWF0cml4CiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLiBXaGVyZSB0byBzdG9yZSB0aGUgcmVzdWx0LgogICAgICogQHJldHVybiBUaGUgdGFyZ2V0IE1hdDMsIG9yIGEgbmV3IE1hdDMgaWYgdGFyZ2V0IHdhcyBvbWl0dGVkLgogICAgICovCgoKICAgIHRyYW5zcG9zZSh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IE1hdDMoKTsKICAgICAgfQoKICAgICAgY29uc3QgTSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGNvbnN0IFQgPSB0YXJnZXQuZWxlbWVudHM7CiAgICAgIGxldCB0bXA7IC8vU2V0IGRpYWdvbmFscwoKICAgICAgVFswXSA9IE1bMF07CiAgICAgIFRbNF0gPSBNWzRdOwogICAgICBUWzhdID0gTVs4XTsKICAgICAgdG1wID0gTVsxXTsKICAgICAgVFsxXSA9IE1bM107CiAgICAgIFRbM10gPSB0bXA7CiAgICAgIHRtcCA9IE1bMl07CiAgICAgIFRbMl0gPSBNWzZdOwogICAgICBUWzZdID0gdG1wOwogICAgICB0bXAgPSBNWzVdOwogICAgICBUWzVdID0gTVs3XTsKICAgICAgVFs3XSA9IHRtcDsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgfQogIGNvbnN0IHJldmVyc2VfZXFucyA9IFswLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwXTsKCiAgLyoqCiAgICogMy1kaW1lbnNpb25hbCB2ZWN0b3IKICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCB2ID0gbmV3IFZlYzMoMSwgMiwgMykKICAgKiAgICAgY29uc29sZS5sb2coJ3g9JyArIHYueCkgLy8geD0xCiAgICovCgogIGNsYXNzIFZlYzMgewogICAgY29uc3RydWN0b3IoeCwgeSwgeikgewogICAgICBpZiAoeCA9PT0gdm9pZCAwKSB7CiAgICAgICAgeCA9IDAuMDsKICAgICAgfQoKICAgICAgaWYgKHkgPT09IHZvaWQgMCkgewogICAgICAgIHkgPSAwLjA7CiAgICAgIH0KCiAgICAgIGlmICh6ID09PSB2b2lkIDApIHsKICAgICAgICB6ID0gMC4wOwogICAgICB9CgogICAgICB0aGlzLnggPSB4OwogICAgICB0aGlzLnkgPSB5OwogICAgICB0aGlzLnogPSB6OwogICAgfQogICAgLyoqCiAgICAgKiBWZWN0b3IgY3Jvc3MgcHJvZHVjdAogICAgICogQHBhcmFtIHRhcmdldCBPcHRpb25hbCB0YXJnZXQgdG8gc2F2ZSBpbi4KICAgICAqLwoKCiAgICBjcm9zcyh2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB2eCA9IHZlY3Rvci54OwogICAgICBjb25zdCB2eSA9IHZlY3Rvci55OwogICAgICBjb25zdCB2eiA9IHZlY3Rvci56OwogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICB0YXJnZXQueCA9IHkgKiB2eiAtIHogKiB2eTsKICAgICAgdGFyZ2V0LnkgPSB6ICogdnggLSB4ICogdno7CiAgICAgIHRhcmdldC56ID0geCAqIHZ5IC0geSAqIHZ4OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHZlY3RvcnMnIDMgZWxlbWVudHMKICAgICAqLwoKCiAgICBzZXQoeCwgeSwgeikgewogICAgICB0aGlzLnggPSB4OwogICAgICB0aGlzLnkgPSB5OwogICAgICB0aGlzLnogPSB6OwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogU2V0IGFsbCBjb21wb25lbnRzIG9mIHRoZSB2ZWN0b3IgdG8gemVyby4KICAgICAqLwoKCiAgICBzZXRaZXJvKCkgewogICAgICB0aGlzLnggPSB0aGlzLnkgPSB0aGlzLnogPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBWZWN0b3IgYWRkaXRpb24KICAgICAqLwoKCiAgICB2YWRkKHZlY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQpIHsKICAgICAgICB0YXJnZXQueCA9IHZlY3Rvci54ICsgdGhpcy54OwogICAgICAgIHRhcmdldC55ID0gdmVjdG9yLnkgKyB0aGlzLnk7CiAgICAgICAgdGFyZ2V0LnogPSB2ZWN0b3IueiArIHRoaXMuejsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbmV3IFZlYzModGhpcy54ICsgdmVjdG9yLngsIHRoaXMueSArIHZlY3Rvci55LCB0aGlzLnogKyB2ZWN0b3Iueik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVmVjdG9yIHN1YnRyYWN0aW9uCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsIHRhcmdldCB0byBzYXZlIGluLgogICAgICovCgoKICAgIHZzdWIodmVjdG9yLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCkgewogICAgICAgIHRhcmdldC54ID0gdGhpcy54IC0gdmVjdG9yLng7CiAgICAgICAgdGFyZ2V0LnkgPSB0aGlzLnkgLSB2ZWN0b3IueTsKICAgICAgICB0YXJnZXQueiA9IHRoaXMueiAtIHZlY3Rvci56OwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBuZXcgVmVjMyh0aGlzLnggLSB2ZWN0b3IueCwgdGhpcy55IC0gdmVjdG9yLnksIHRoaXMueiAtIHZlY3Rvci56KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGNyb3NzIHByb2R1Y3QgbWF0cml4IGFfY3Jvc3MgZnJvbSBhIHZlY3Rvciwgc3VjaCB0aGF0IGEgeCBiID0gYV9jcm9zcyAqIGIgPSBjCiAgICAgKgogICAgICogU2VlIHtAbGluayBodHRwczovL3d3dzguY3MudW11LnNlL2t1cnNlci9UREJEMjQvVlQwNi9sZWN0dXJlcy9MZWN0dXJlNi5wZGYgVW1lw6UgVW5pdmVyc2l0eSBMZWN0dXJlfQogICAgICovCgoKICAgIGNyb3NzbWF0KCkgewogICAgICByZXR1cm4gbmV3IE1hdDMoWzAsIC10aGlzLnosIHRoaXMueSwgdGhpcy56LCAwLCAtdGhpcy54LCAtdGhpcy55LCB0aGlzLngsIDBdKTsKICAgIH0KICAgIC8qKgogICAgICogTm9ybWFsaXplIHRoZSB2ZWN0b3IuIE5vdGUgdGhhdCB0aGlzIGNoYW5nZXMgdGhlIHZhbHVlcyBpbiB0aGUgdmVjdG9yLgogICAgICAqIEByZXR1cm4gUmV0dXJucyB0aGUgbm9ybSBvZiB0aGUgdmVjdG9yCiAgICAgKi8KCgogICAgbm9ybWFsaXplKCkgewogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCBuID0gTWF0aC5zcXJ0KHggKiB4ICsgeSAqIHkgKyB6ICogeik7CgogICAgICBpZiAobiA+IDAuMCkgewogICAgICAgIGNvbnN0IGludk4gPSAxIC8gbjsKICAgICAgICB0aGlzLnggKj0gaW52TjsKICAgICAgICB0aGlzLnkgKj0gaW52TjsKICAgICAgICB0aGlzLnogKj0gaW52TjsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBNYWtlIHNvbWV0aGluZyB1cAogICAgICAgIHRoaXMueCA9IDA7CiAgICAgICAgdGhpcy55ID0gMDsKICAgICAgICB0aGlzLnogPSAwOwogICAgICB9CgogICAgICByZXR1cm4gbjsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSB2ZXJzaW9uIG9mIHRoaXMgdmVjdG9yIHRoYXQgaXMgb2YgbGVuZ3RoIDEuCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsIHRhcmdldCB0byBzYXZlIGluCiAgICAgKiBAcmV0dXJuIFJldHVybnMgdGhlIHVuaXQgdmVjdG9yCiAgICAgKi8KCgogICAgdW5pdCh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgY29uc3QgeCA9IHRoaXMueDsKICAgICAgY29uc3QgeSA9IHRoaXMueTsKICAgICAgY29uc3QgeiA9IHRoaXMuejsKICAgICAgbGV0IG5pbnYgPSBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSArIHogKiB6KTsKCiAgICAgIGlmIChuaW52ID4gMC4wKSB7CiAgICAgICAgbmludiA9IDEuMCAvIG5pbnY7CiAgICAgICAgdGFyZ2V0LnggPSB4ICogbmludjsKICAgICAgICB0YXJnZXQueSA9IHkgKiBuaW52OwogICAgICAgIHRhcmdldC56ID0geiAqIG5pbnY7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGFyZ2V0LnggPSAxOwogICAgICAgIHRhcmdldC55ID0gMDsKICAgICAgICB0YXJnZXQueiA9IDA7CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgbGVuZ3RoIG9mIHRoZSB2ZWN0b3IKICAgICAqLwoKCiAgICBsZW5ndGgoKSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIHJldHVybiBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSArIHogKiB6KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBzcXVhcmVkIGxlbmd0aCBvZiB0aGUgdmVjdG9yLgogICAgICovCgoKICAgIGxlbmd0aFNxdWFyZWQoKSB7CiAgICAgIHJldHVybiB0aGlzLmRvdCh0aGlzKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGRpc3RhbmNlIGZyb20gdGhpcyBwb2ludCB0byBhbm90aGVyIHBvaW50CiAgICAgKi8KCgogICAgZGlzdGFuY2VUbyhwKSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIGNvbnN0IHB4ID0gcC54OwogICAgICBjb25zdCBweSA9IHAueTsKICAgICAgY29uc3QgcHogPSBwLno7CiAgICAgIHJldHVybiBNYXRoLnNxcnQoKHB4IC0geCkgKiAocHggLSB4KSArIChweSAtIHkpICogKHB5IC0geSkgKyAocHogLSB6KSAqIChweiAtIHopKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHNxdWFyZWQgZGlzdGFuY2UgZnJvbSB0aGlzIHBvaW50IHRvIGFub3RoZXIgcG9pbnQKICAgICAqLwoKCiAgICBkaXN0YW5jZVNxdWFyZWQocCkgewogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCBweCA9IHAueDsKICAgICAgY29uc3QgcHkgPSBwLnk7CiAgICAgIGNvbnN0IHB6ID0gcC56OwogICAgICByZXR1cm4gKHB4IC0geCkgKiAocHggLSB4KSArIChweSAtIHkpICogKHB5IC0geSkgKyAocHogLSB6KSAqIChweiAtIHopOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSBhbGwgdGhlIGNvbXBvbmVudHMgb2YgdGhlIHZlY3RvciB3aXRoIGEgc2NhbGFyLgogICAgICogQHBhcmFtIHRhcmdldCBUaGUgdmVjdG9yIHRvIHNhdmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBzY2FsZShzY2FsYXIsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICB0YXJnZXQueCA9IHNjYWxhciAqIHg7CiAgICAgIHRhcmdldC55ID0gc2NhbGFyICogeTsKICAgICAgdGFyZ2V0LnogPSBzY2FsYXIgKiB6OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB0aGUgdmVjdG9yIHdpdGggYW4gb3RoZXIgdmVjdG9yLCBjb21wb25lbnQtd2lzZS4KICAgICAqIEBwYXJhbSB0YXJnZXQgVGhlIHZlY3RvciB0byBzYXZlIHRoZSByZXN1bHQgaW4uCiAgICAgKi8KCgogICAgdm11bCh2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IHZlY3Rvci54ICogdGhpcy54OwogICAgICB0YXJnZXQueSA9IHZlY3Rvci55ICogdGhpcy55OwogICAgICB0YXJnZXQueiA9IHZlY3Rvci56ICogdGhpcy56OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTY2FsZSBhIHZlY3RvciBhbmQgYWRkIGl0IHRvIHRoaXMgdmVjdG9yLiBTYXZlIHRoZSByZXN1bHQgaW4gInRhcmdldCIuICh0YXJnZXQgPSB0aGlzICsgdmVjdG9yICogc2NhbGFyKQogICAgICogQHBhcmFtIHRhcmdldCBUaGUgdmVjdG9yIHRvIHNhdmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBhZGRTY2FsZWRWZWN0b3Ioc2NhbGFyLCB2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IHRoaXMueCArIHNjYWxhciAqIHZlY3Rvci54OwogICAgICB0YXJnZXQueSA9IHRoaXMueSArIHNjYWxhciAqIHZlY3Rvci55OwogICAgICB0YXJnZXQueiA9IHRoaXMueiArIHNjYWxhciAqIHZlY3Rvci56OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBDYWxjdWxhdGUgZG90IHByb2R1Y3QKICAgICAqIEBwYXJhbSB2ZWN0b3IKICAgICAqLwoKCiAgICBkb3QodmVjdG9yKSB7CiAgICAgIHJldHVybiB0aGlzLnggKiB2ZWN0b3IueCArIHRoaXMueSAqIHZlY3Rvci55ICsgdGhpcy56ICogdmVjdG9yLno7CiAgICB9CgogICAgaXNaZXJvKCkgewogICAgICByZXR1cm4gdGhpcy54ID09PSAwICYmIHRoaXMueSA9PT0gMCAmJiB0aGlzLnogPT09IDA7CiAgICB9CiAgICAvKioKICAgICAqIE1ha2UgdGhlIHZlY3RvciBwb2ludCBpbiB0aGUgb3Bwb3NpdGUgZGlyZWN0aW9uLgogICAgICogQHBhcmFtIHRhcmdldCBPcHRpb25hbCB0YXJnZXQgdG8gc2F2ZSBpbgogICAgICovCgoKICAgIG5lZ2F0ZSh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnggPSAtdGhpcy54OwogICAgICB0YXJnZXQueSA9IC10aGlzLnk7CiAgICAgIHRhcmdldC56ID0gLXRoaXMuejsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0d28gYXJ0aWZpY2lhbCB0YW5nZW50cyB0byB0aGUgdmVjdG9yCiAgICAgKiBAcGFyYW0gdDEgVmVjdG9yIG9iamVjdCB0byBzYXZlIHRoZSBmaXJzdCB0YW5nZW50IGluCiAgICAgKiBAcGFyYW0gdDIgVmVjdG9yIG9iamVjdCB0byBzYXZlIHRoZSBzZWNvbmQgdGFuZ2VudCBpbgogICAgICovCgoKICAgIHRhbmdlbnRzKHQxLCB0MikgewogICAgICBjb25zdCBub3JtID0gdGhpcy5sZW5ndGgoKTsKCiAgICAgIGlmIChub3JtID4gMC4wKSB7CiAgICAgICAgY29uc3QgbiA9IFZlYzNfdGFuZ2VudHNfbjsKICAgICAgICBjb25zdCBpbm9ybSA9IDEgLyBub3JtOwogICAgICAgIG4uc2V0KHRoaXMueCAqIGlub3JtLCB0aGlzLnkgKiBpbm9ybSwgdGhpcy56ICogaW5vcm0pOwogICAgICAgIGNvbnN0IHJhbmRWZWMgPSBWZWMzX3RhbmdlbnRzX3JhbmRWZWM7CgogICAgICAgIGlmIChNYXRoLmFicyhuLngpIDwgMC45KSB7CiAgICAgICAgICByYW5kVmVjLnNldCgxLCAwLCAwKTsKICAgICAgICAgIG4uY3Jvc3MocmFuZFZlYywgdDEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByYW5kVmVjLnNldCgwLCAxLCAwKTsKICAgICAgICAgIG4uY3Jvc3MocmFuZFZlYywgdDEpOwogICAgICAgIH0KCiAgICAgICAgbi5jcm9zcyh0MSwgdDIpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRoZSBub3JtYWwgbGVuZ3RoIGlzIHplcm8sIG1ha2Ugc29tZXRoaW5nIHVwCiAgICAgICAgdDEuc2V0KDEsIDAsIDApOwogICAgICAgIHQyLnNldCgwLCAxLCAwKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0cyB0byBhIG1vcmUgcmVhZGFibGUgZm9ybWF0CiAgICAgKi8KCgogICAgdG9TdHJpbmcoKSB7CiAgICAgIHJldHVybiBgJHt0aGlzLnh9LCR7dGhpcy55fSwke3RoaXMuen1gOwogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0cyB0byBhbiBhcnJheQogICAgICovCgoKICAgIHRvQXJyYXkoKSB7CiAgICAgIHJldHVybiBbdGhpcy54LCB0aGlzLnksIHRoaXMuel07CiAgICB9CiAgICAvKioKICAgICAqIENvcGllcyB2YWx1ZSBvZiBzb3VyY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAgKi8KCgogICAgY29weSh2ZWN0b3IpIHsKICAgICAgdGhpcy54ID0gdmVjdG9yLng7CiAgICAgIHRoaXMueSA9IHZlY3Rvci55OwogICAgICB0aGlzLnogPSB2ZWN0b3IuejsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIERvIGEgbGluZWFyIGludGVycG9sYXRpb24gYmV0d2VlbiB0d28gdmVjdG9ycwogICAgICogQHBhcmFtIHQgQSBudW1iZXIgYmV0d2VlbiAwIGFuZCAxLiAwIHdpbGwgbWFrZSB0aGlzIGZ1bmN0aW9uIHJldHVybiB1LCBhbmQgMSB3aWxsIG1ha2UgaXQgcmV0dXJuIHYuIE51bWJlcnMgaW4gYmV0d2VlbiB3aWxsIGdlbmVyYXRlIGEgdmVjdG9yIGluIGJldHdlZW4gdGhlbS4KICAgICAqLwoKCiAgICBsZXJwKHZlY3RvciwgdCwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIHRhcmdldC54ID0geCArICh2ZWN0b3IueCAtIHgpICogdDsKICAgICAgdGFyZ2V0LnkgPSB5ICsgKHZlY3Rvci55IC0geSkgKiB0OwogICAgICB0YXJnZXQueiA9IHogKyAodmVjdG9yLnogLSB6KSAqIHQ7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgdmVjdG9yIGVxdWFscyBpcyBhbG1vc3QgZXF1YWwgdG8gYW5vdGhlciBvbmUuCiAgICAgKi8KCgogICAgYWxtb3N0RXF1YWxzKHZlY3RvciwgcHJlY2lzaW9uKSB7CiAgICAgIGlmIChwcmVjaXNpb24gPT09IHZvaWQgMCkgewogICAgICAgIHByZWNpc2lvbiA9IDFlLTY7CiAgICAgIH0KCiAgICAgIGlmIChNYXRoLmFicyh0aGlzLnggLSB2ZWN0b3IueCkgPiBwcmVjaXNpb24gfHwgTWF0aC5hYnModGhpcy55IC0gdmVjdG9yLnkpID4gcHJlY2lzaW9uIHx8IE1hdGguYWJzKHRoaXMueiAtIHZlY3Rvci56KSA+IHByZWNpc2lvbikgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgdmVjdG9yIGlzIGFsbW9zdCB6ZXJvCiAgICAgKi8KCgogICAgYWxtb3N0WmVybyhwcmVjaXNpb24pIHsKICAgICAgaWYgKHByZWNpc2lvbiA9PT0gdm9pZCAwKSB7CiAgICAgICAgcHJlY2lzaW9uID0gMWUtNjsKICAgICAgfQoKICAgICAgaWYgKE1hdGguYWJzKHRoaXMueCkgPiBwcmVjaXNpb24gfHwgTWF0aC5hYnModGhpcy55KSA+IHByZWNpc2lvbiB8fCBNYXRoLmFicyh0aGlzLnopID4gcHJlY2lzaW9uKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIHZlY3RvciBpcyBhbnRpLXBhcmFsbGVsIHRvIGFub3RoZXIgdmVjdG9yLgogICAgICogQHBhcmFtIHByZWNpc2lvbiBTZXQgdG8gemVybyBmb3IgZXhhY3QgY29tcGFyaXNvbnMKICAgICAqLwoKCiAgICBpc0FudGlwYXJhbGxlbFRvKHZlY3RvciwgcHJlY2lzaW9uKSB7CiAgICAgIHRoaXMubmVnYXRlKGFudGlwX25lZyk7CiAgICAgIHJldHVybiBhbnRpcF9uZWcuYWxtb3N0RXF1YWxzKHZlY3RvciwgcHJlY2lzaW9uKTsKICAgIH0KICAgIC8qKgogICAgICogQ2xvbmUgdGhlIHZlY3RvcgogICAgICovCgoKICAgIGNsb25lKCkgewogICAgICByZXR1cm4gbmV3IFZlYzModGhpcy54LCB0aGlzLnksIHRoaXMueik7CiAgICB9CgogIH0KICBWZWMzLlpFUk8gPSBuZXcgVmVjMygwLCAwLCAwKTsKICBWZWMzLlVOSVRfWCA9IG5ldyBWZWMzKDEsIDAsIDApOwogIFZlYzMuVU5JVF9ZID0gbmV3IFZlYzMoMCwgMSwgMCk7CiAgVmVjMy5VTklUX1ogPSBuZXcgVmVjMygwLCAwLCAxKTsKICBjb25zdCBWZWMzX3RhbmdlbnRzX24gPSBuZXcgVmVjMygpOwogIGNvbnN0IFZlYzNfdGFuZ2VudHNfcmFuZFZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYW50aXBfbmVnID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQXhpcyBhbGlnbmVkIGJvdW5kaW5nIGJveCBjbGFzcy4KICAgKi8KICBjbGFzcyBBQUJCIHsKICAgIC8qKgogICAgICogVGhlIGxvd2VyIGJvdW5kIG9mIHRoZSBib3VuZGluZyBib3gKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHVwcGVyIGJvdW5kIG9mIHRoZSBib3VuZGluZyBib3gKICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLmxvd2VyQm91bmQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnVwcGVyQm91bmQgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMubG93ZXJCb3VuZCkgewogICAgICAgIHRoaXMubG93ZXJCb3VuZC5jb3B5KG9wdGlvbnMubG93ZXJCb3VuZCk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLnVwcGVyQm91bmQpIHsKICAgICAgICB0aGlzLnVwcGVyQm91bmQuY29weShvcHRpb25zLnVwcGVyQm91bmQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgQUFCQiBib3VuZHMgZnJvbSBhIHNldCBvZiBwb2ludHMuCiAgICAgKiBAcGFyYW0gcG9pbnRzIEFuIGFycmF5IG9mIFZlYzMncy4KICAgICAqIEByZXR1cm4gVGhlIHNlbGYgb2JqZWN0CiAgICAgKi8KCgogICAgc2V0RnJvbVBvaW50cyhwb2ludHMsIHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCBza2luU2l6ZSkgewogICAgICBjb25zdCBsID0gdGhpcy5sb3dlckJvdW5kOwogICAgICBjb25zdCB1ID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBxID0gcXVhdGVybmlvbjsgLy8gU2V0IHRvIHRoZSBmaXJzdCBwb2ludAoKICAgICAgbC5jb3B5KHBvaW50c1swXSk7CgogICAgICBpZiAocSkgewogICAgICAgIHEudm11bHQobCwgbCk7CiAgICAgIH0KCiAgICAgIHUuY29weShsKTsKCiAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgcG9pbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgbGV0IHAgPSBwb2ludHNbaV07CgogICAgICAgIGlmIChxKSB7CiAgICAgICAgICBxLnZtdWx0KHAsIHRtcCQxKTsKICAgICAgICAgIHAgPSB0bXAkMTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnggPiB1LngpIHsKICAgICAgICAgIHUueCA9IHAueDsKICAgICAgICB9CgogICAgICAgIGlmIChwLnggPCBsLngpIHsKICAgICAgICAgIGwueCA9IHAueDsKICAgICAgICB9CgogICAgICAgIGlmIChwLnkgPiB1LnkpIHsKICAgICAgICAgIHUueSA9IHAueTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnkgPCBsLnkpIHsKICAgICAgICAgIGwueSA9IHAueTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnogPiB1LnopIHsKICAgICAgICAgIHUueiA9IHAuejsKICAgICAgICB9CgogICAgICAgIGlmIChwLnogPCBsLnopIHsKICAgICAgICAgIGwueiA9IHAuejsKICAgICAgICB9CiAgICAgIH0gLy8gQWRkIG9mZnNldAoKCiAgICAgIGlmIChwb3NpdGlvbikgewogICAgICAgIHBvc2l0aW9uLnZhZGQobCwgbCk7CiAgICAgICAgcG9zaXRpb24udmFkZCh1LCB1KTsKICAgICAgfQoKICAgICAgaWYgKHNraW5TaXplKSB7CiAgICAgICAgbC54IC09IHNraW5TaXplOwogICAgICAgIGwueSAtPSBza2luU2l6ZTsKICAgICAgICBsLnogLT0gc2tpblNpemU7CiAgICAgICAgdS54ICs9IHNraW5TaXplOwogICAgICAgIHUueSArPSBza2luU2l6ZTsKICAgICAgICB1LnogKz0gc2tpblNpemU7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBDb3B5IGJvdW5kcyBmcm9tIGFuIEFBQkIgdG8gdGhpcyBBQUJCCiAgICAgKiBAcGFyYW0gYWFiYiBTb3VyY2UgdG8gY29weSBmcm9tCiAgICAgKiBAcmV0dXJuIFRoZSB0aGlzIG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eQogICAgICovCgoKICAgIGNvcHkoYWFiYikgewogICAgICB0aGlzLmxvd2VyQm91bmQuY29weShhYWJiLmxvd2VyQm91bmQpOwogICAgICB0aGlzLnVwcGVyQm91bmQuY29weShhYWJiLnVwcGVyQm91bmQpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogQ2xvbmUgYW4gQUFCQgogICAgICovCgoKICAgIGNsb25lKCkgewogICAgICByZXR1cm4gbmV3IEFBQkIoKS5jb3B5KHRoaXMpOwogICAgfQogICAgLyoqCiAgICAgKiBFeHRlbmQgdGhpcyBBQUJCIHNvIHRoYXQgaXQgY292ZXJzIHRoZSBnaXZlbiBBQUJCIHRvby4KICAgICAqLwoKCiAgICBleHRlbmQoYWFiYikgewogICAgICB0aGlzLmxvd2VyQm91bmQueCA9IE1hdGgubWluKHRoaXMubG93ZXJCb3VuZC54LCBhYWJiLmxvd2VyQm91bmQueCk7CiAgICAgIHRoaXMudXBwZXJCb3VuZC54ID0gTWF0aC5tYXgodGhpcy51cHBlckJvdW5kLngsIGFhYmIudXBwZXJCb3VuZC54KTsKICAgICAgdGhpcy5sb3dlckJvdW5kLnkgPSBNYXRoLm1pbih0aGlzLmxvd2VyQm91bmQueSwgYWFiYi5sb3dlckJvdW5kLnkpOwogICAgICB0aGlzLnVwcGVyQm91bmQueSA9IE1hdGgubWF4KHRoaXMudXBwZXJCb3VuZC55LCBhYWJiLnVwcGVyQm91bmQueSk7CiAgICAgIHRoaXMubG93ZXJCb3VuZC56ID0gTWF0aC5taW4odGhpcy5sb3dlckJvdW5kLnosIGFhYmIubG93ZXJCb3VuZC56KTsKICAgICAgdGhpcy51cHBlckJvdW5kLnogPSBNYXRoLm1heCh0aGlzLnVwcGVyQm91bmQueiwgYWFiYi51cHBlckJvdW5kLnopOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIGdpdmVuIEFBQkIgb3ZlcmxhcHMgdGhpcyBBQUJCLgogICAgICovCgoKICAgIG92ZXJsYXBzKGFhYmIpIHsKICAgICAgY29uc3QgbDEgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUxID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBsMiA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdTIgPSBhYWJiLnVwcGVyQm91bmQ7IC8vICAgICAgbDIgICAgICAgIHUyCiAgICAgIC8vICAgICAgfC0tLS0tLS0tLXwKICAgICAgLy8gfC0tLS0tLS0tfAogICAgICAvLyBsMSAgICAgICB1MQoKICAgICAgY29uc3Qgb3ZlcmxhcHNYID0gbDIueCA8PSB1MS54ICYmIHUxLnggPD0gdTIueCB8fCBsMS54IDw9IHUyLnggJiYgdTIueCA8PSB1MS54OwogICAgICBjb25zdCBvdmVybGFwc1kgPSBsMi55IDw9IHUxLnkgJiYgdTEueSA8PSB1Mi55IHx8IGwxLnkgPD0gdTIueSAmJiB1Mi55IDw9IHUxLnk7CiAgICAgIGNvbnN0IG92ZXJsYXBzWiA9IGwyLnogPD0gdTEueiAmJiB1MS56IDw9IHUyLnogfHwgbDEueiA8PSB1Mi56ICYmIHUyLnogPD0gdTEuejsKICAgICAgcmV0dXJuIG92ZXJsYXBzWCAmJiBvdmVybGFwc1kgJiYgb3ZlcmxhcHNaOwogICAgfSAvLyBNb3N0bHkgZm9yIGRlYnVnZ2luZwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIGNvbnN0IGwgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSB0aGlzLnVwcGVyQm91bmQ7CiAgICAgIHJldHVybiAodS54IC0gbC54KSAqICh1LnkgLSBsLnkpICogKHUueiAtIGwueik7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgZ2l2ZW4gQUFCQiBpcyBmdWxseSBjb250YWluZWQgaW4gdGhpcyBBQUJCLgogICAgICovCgoKICAgIGNvbnRhaW5zKGFhYmIpIHsKICAgICAgY29uc3QgbDEgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUxID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBsMiA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdTIgPSBhYWJiLnVwcGVyQm91bmQ7IC8vICAgICAgbDIgICAgICAgIHUyCiAgICAgIC8vICAgICAgfC0tLS0tLS0tLXwKICAgICAgLy8gfC0tLS0tLS0tLS0tLS0tLXwKICAgICAgLy8gbDEgICAgICAgICAgICAgIHUxCgogICAgICByZXR1cm4gbDEueCA8PSBsMi54ICYmIHUxLnggPj0gdTIueCAmJiBsMS55IDw9IGwyLnkgJiYgdTEueSA+PSB1Mi55ICYmIGwxLnogPD0gbDIueiAmJiB1MS56ID49IHUyLno7CiAgICB9CgogICAgZ2V0Q29ybmVycyhhLCBiLCBjLCBkLCBlLCBmLCBnLCBoKSB7CiAgICAgIGNvbnN0IGwgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSB0aGlzLnVwcGVyQm91bmQ7CiAgICAgIGEuY29weShsKTsKICAgICAgYi5zZXQodS54LCBsLnksIGwueik7CiAgICAgIGMuc2V0KHUueCwgdS55LCBsLnopOwogICAgICBkLnNldChsLngsIHUueSwgdS56KTsKICAgICAgZS5zZXQodS54LCBsLnksIHUueik7CiAgICAgIGYuc2V0KGwueCwgdS55LCBsLnopOwogICAgICBnLnNldChsLngsIGwueSwgdS56KTsKICAgICAgaC5jb3B5KHUpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHJlcHJlc2VudGF0aW9uIG9mIGFuIEFBQkIgaW4gYW5vdGhlciBmcmFtZS4KICAgICAqIEByZXR1cm4gVGhlICJ0YXJnZXQiIEFBQkIgb2JqZWN0LgogICAgICovCgoKICAgIHRvTG9jYWxGcmFtZShmcmFtZSwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNvcm5lcnMgPSB0cmFuc2Zvcm1JbnRvRnJhbWVfY29ybmVyczsKICAgICAgY29uc3QgYSA9IGNvcm5lcnNbMF07CiAgICAgIGNvbnN0IGIgPSBjb3JuZXJzWzFdOwogICAgICBjb25zdCBjID0gY29ybmVyc1syXTsKICAgICAgY29uc3QgZCA9IGNvcm5lcnNbM107CiAgICAgIGNvbnN0IGUgPSBjb3JuZXJzWzRdOwogICAgICBjb25zdCBmID0gY29ybmVyc1s1XTsKICAgICAgY29uc3QgZyA9IGNvcm5lcnNbNl07CiAgICAgIGNvbnN0IGggPSBjb3JuZXJzWzddOyAvLyBHZXQgY29ybmVycyBpbiBjdXJyZW50IGZyYW1lCgogICAgICB0aGlzLmdldENvcm5lcnMoYSwgYiwgYywgZCwgZSwgZiwgZywgaCk7IC8vIFRyYW5zZm9ybSB0aGVtIHRvIG5ldyBsb2NhbCBmcmFtZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgIGNvbnN0IGNvcm5lciA9IGNvcm5lcnNbaV07CiAgICAgICAgZnJhbWUucG9pbnRUb0xvY2FsKGNvcm5lciwgY29ybmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRhcmdldC5zZXRGcm9tUG9pbnRzKGNvcm5lcnMpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHJlcHJlc2VudGF0aW9uIG9mIGFuIEFBQkIgaW4gdGhlIGdsb2JhbCBmcmFtZS4KICAgICAqIEByZXR1cm4gVGhlICJ0YXJnZXQiIEFBQkIgb2JqZWN0LgogICAgICovCgoKICAgIHRvV29ybGRGcmFtZShmcmFtZSwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNvcm5lcnMgPSB0cmFuc2Zvcm1JbnRvRnJhbWVfY29ybmVyczsKICAgICAgY29uc3QgYSA9IGNvcm5lcnNbMF07CiAgICAgIGNvbnN0IGIgPSBjb3JuZXJzWzFdOwogICAgICBjb25zdCBjID0gY29ybmVyc1syXTsKICAgICAgY29uc3QgZCA9IGNvcm5lcnNbM107CiAgICAgIGNvbnN0IGUgPSBjb3JuZXJzWzRdOwogICAgICBjb25zdCBmID0gY29ybmVyc1s1XTsKICAgICAgY29uc3QgZyA9IGNvcm5lcnNbNl07CiAgICAgIGNvbnN0IGggPSBjb3JuZXJzWzddOyAvLyBHZXQgY29ybmVycyBpbiBjdXJyZW50IGZyYW1lCgogICAgICB0aGlzLmdldENvcm5lcnMoYSwgYiwgYywgZCwgZSwgZiwgZywgaCk7IC8vIFRyYW5zZm9ybSB0aGVtIHRvIG5ldyBsb2NhbCBmcmFtZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgIGNvbnN0IGNvcm5lciA9IGNvcm5lcnNbaV07CiAgICAgICAgZnJhbWUucG9pbnRUb1dvcmxkKGNvcm5lciwgY29ybmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRhcmdldC5zZXRGcm9tUG9pbnRzKGNvcm5lcnMpOwogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgQUFCQiBpcyBoaXQgYnkgYSByYXkuCiAgICAgKi8KCgogICAgb3ZlcmxhcHNSYXkocmF5KSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBkaXJlY3Rpb24sCiAgICAgICAgZnJvbQogICAgICB9ID0gcmF5OyAvLyBjb25zdCB0ID0gMAogICAgICAvLyByYXkuZGlyZWN0aW9uIGlzIHVuaXQgZGlyZWN0aW9uIHZlY3RvciBvZiByYXkKCiAgICAgIGNvbnN0IGRpckZyYWNYID0gMSAvIGRpcmVjdGlvbi54OwogICAgICBjb25zdCBkaXJGcmFjWSA9IDEgLyBkaXJlY3Rpb24ueTsKICAgICAgY29uc3QgZGlyRnJhY1ogPSAxIC8gZGlyZWN0aW9uLno7IC8vIHRoaXMubG93ZXJCb3VuZCBpcyB0aGUgY29ybmVyIG9mIEFBQkIgd2l0aCBtaW5pbWFsIGNvb3JkaW5hdGVzIC0gbGVmdCBib3R0b20sIHJ0IGlzIG1heGltYWwgY29ybmVyCgogICAgICBjb25zdCB0MSA9ICh0aGlzLmxvd2VyQm91bmQueCAtIGZyb20ueCkgKiBkaXJGcmFjWDsKICAgICAgY29uc3QgdDIgPSAodGhpcy51cHBlckJvdW5kLnggLSBmcm9tLngpICogZGlyRnJhY1g7CiAgICAgIGNvbnN0IHQzID0gKHRoaXMubG93ZXJCb3VuZC55IC0gZnJvbS55KSAqIGRpckZyYWNZOwogICAgICBjb25zdCB0NCA9ICh0aGlzLnVwcGVyQm91bmQueSAtIGZyb20ueSkgKiBkaXJGcmFjWTsKICAgICAgY29uc3QgdDUgPSAodGhpcy5sb3dlckJvdW5kLnogLSBmcm9tLnopICogZGlyRnJhY1o7CiAgICAgIGNvbnN0IHQ2ID0gKHRoaXMudXBwZXJCb3VuZC56IC0gZnJvbS56KSAqIGRpckZyYWNaOyAvLyBjb25zdCB0bWluID0gTWF0aC5tYXgoTWF0aC5tYXgoTWF0aC5taW4odDEsIHQyKSwgTWF0aC5taW4odDMsIHQ0KSkpOwogICAgICAvLyBjb25zdCB0bWF4ID0gTWF0aC5taW4oTWF0aC5taW4oTWF0aC5tYXgodDEsIHQyKSwgTWF0aC5tYXgodDMsIHQ0KSkpOwoKICAgICAgY29uc3QgdG1pbiA9IE1hdGgubWF4KE1hdGgubWF4KE1hdGgubWluKHQxLCB0MiksIE1hdGgubWluKHQzLCB0NCkpLCBNYXRoLm1pbih0NSwgdDYpKTsKICAgICAgY29uc3QgdG1heCA9IE1hdGgubWluKE1hdGgubWluKE1hdGgubWF4KHQxLCB0MiksIE1hdGgubWF4KHQzLCB0NCkpLCBNYXRoLm1heCh0NSwgdDYpKTsgLy8gaWYgdG1heCA8IDAsIHJheSAobGluZSkgaXMgaW50ZXJzZWN0aW5nIEFBQkIsIGJ1dCB3aG9sZSBBQUJCIGlzIGJlaGluZyB1cwoKICAgICAgaWYgKHRtYXggPCAwKSB7CiAgICAgICAgLy90ID0gdG1heDsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0gLy8gaWYgdG1pbiA+IHRtYXgsIHJheSBkb2Vzbid0IGludGVyc2VjdCBBQUJCCgoKICAgICAgaWYgKHRtaW4gPiB0bWF4KSB7CiAgICAgICAgLy90ID0gdG1heDsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICB9CiAgY29uc3QgdG1wJDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRyYW5zZm9ybUludG9GcmFtZV9jb3JuZXJzID0gW25ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCldOwoKICAvKioKICAgKiBDb2xsaXNpb24gIm1hdHJpeCIuCiAgICogSXQncyBhY3R1YWxseSBhIHRyaWFuZ3VsYXItc2hhcGVkIGFycmF5IG9mIHdoZXRoZXIgdHdvIGJvZGllcyBhcmUgdG91Y2hpbmcgdGhpcyBzdGVwLCBmb3IgcmVmZXJlbmNlIG5leHQgc3RlcAogICAqLwogIGNsYXNzIEFycmF5Q29sbGlzaW9uTWF0cml4IHsKICAgIC8qKgogICAgICogVGhlIG1hdHJpeCBzdG9yYWdlLgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5tYXRyaXggPSBbXTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFuIGVsZW1lbnQKICAgICAqLwoKCiAgICBnZXQoYmksIGJqKSB7CiAgICAgIGxldCB7CiAgICAgICAgaW5kZXg6IGkKICAgICAgfSA9IGJpOwogICAgICBsZXQgewogICAgICAgIGluZGV4OiBqCiAgICAgIH0gPSBiajsKCiAgICAgIGlmIChqID4gaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICByZXR1cm4gdGhpcy5tYXRyaXhbKGkgKiAoaSArIDEpID4+IDEpICsgaiAtIDFdOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgYW4gZWxlbWVudAogICAgICovCgoKICAgIHNldChiaSwgYmosIHZhbHVlKSB7CiAgICAgIGxldCB7CiAgICAgICAgaW5kZXg6IGkKICAgICAgfSA9IGJpOwogICAgICBsZXQgewogICAgICAgIGluZGV4OiBqCiAgICAgIH0gPSBiajsKCiAgICAgIGlmIChqID4gaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICB0aGlzLm1hdHJpeFsoaSAqIChpICsgMSkgPj4gMSkgKyBqIC0gMV0gPSB2YWx1ZSA/IDEgOiAwOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIGFsbCBlbGVtZW50cyB0byB6ZXJvCiAgICAgKi8KCgogICAgcmVzZXQoKSB7CiAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gdGhpcy5tYXRyaXgubGVuZ3RoOyBpICE9PSBsOyBpKyspIHsKICAgICAgICB0aGlzLm1hdHJpeFtpXSA9IDA7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogU2V0cyB0aGUgbWF4IG51bWJlciBvZiBvYmplY3RzCiAgICAgKi8KCgogICAgc2V0TnVtT2JqZWN0cyhuKSB7CiAgICAgIHRoaXMubWF0cml4Lmxlbmd0aCA9IG4gKiAobiAtIDEpID4+IDE7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQmFzZSBjbGFzcyBmb3Igb2JqZWN0cyB0aGF0IGRpc3BhdGNoZXMgZXZlbnRzLgogICAqLwogIGNsYXNzIEV2ZW50VGFyZ2V0IHsKICAgIC8qKgogICAgICogQWRkIGFuIGV2ZW50IGxpc3RlbmVyCiAgICAgKiBAcmV0dXJuIFRoZSBzZWxmIG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eS4KICAgICAqLwogICAgYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICB0aGlzLl9saXN0ZW5lcnMgPSB7fTsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwoKICAgICAgaWYgKGxpc3RlbmVyc1t0eXBlXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgbGlzdGVuZXJzW3R5cGVdID0gW107CiAgICAgIH0KCiAgICAgIGlmICghbGlzdGVuZXJzW3R5cGVdLmluY2x1ZGVzKGxpc3RlbmVyKSkgewogICAgICAgIGxpc3RlbmVyc1t0eXBlXS5wdXNoKGxpc3RlbmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGFuIGV2ZW50IGxpc3RlbmVyIGlzIGFkZGVkCiAgICAgKi8KCgogICAgaGFzRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyczsKCiAgICAgIGlmIChsaXN0ZW5lcnNbdHlwZV0gIT09IHVuZGVmaW5lZCAmJiBsaXN0ZW5lcnNbdHlwZV0uaW5jbHVkZXMobGlzdGVuZXIpKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgYW55IGV2ZW50IGxpc3RlbmVyIG9mIHRoZSBnaXZlbiB0eXBlIGlzIGFkZGVkCiAgICAgKi8KCgogICAgaGFzQW55RXZlbnRMaXN0ZW5lcih0eXBlKSB7CiAgICAgIGlmICh0aGlzLl9saXN0ZW5lcnMgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwogICAgICByZXR1cm4gbGlzdGVuZXJzW3R5cGVdICE9PSB1bmRlZmluZWQ7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZSBhbiBldmVudCBsaXN0ZW5lcgogICAgICogQHJldHVybiBUaGUgc2VsZiBvYmplY3QsIGZvciBjaGFpbmFiaWxpdHkuCiAgICAgKi8KCgogICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwoKICAgICAgaWYgKGxpc3RlbmVyc1t0eXBlXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIGNvbnN0IGluZGV4ID0gbGlzdGVuZXJzW3R5cGVdLmluZGV4T2YobGlzdGVuZXIpOwoKICAgICAgaWYgKGluZGV4ICE9PSAtMSkgewogICAgICAgIGxpc3RlbmVyc1t0eXBlXS5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogRW1pdCBhbiBldmVudC4KICAgICAqIEByZXR1cm4gVGhlIHNlbGYgb2JqZWN0LCBmb3IgY2hhaW5hYmlsaXR5LgogICAgICovCgoKICAgIGRpc3BhdGNoRXZlbnQoZXZlbnQpIHsKICAgICAgaWYgKHRoaXMuX2xpc3RlbmVycyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyczsKICAgICAgY29uc3QgbGlzdGVuZXJBcnJheSA9IGxpc3RlbmVyc1tldmVudC50eXBlXTsKCiAgICAgIGlmIChsaXN0ZW5lckFycmF5ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBldmVudC50YXJnZXQgPSB0aGlzOwoKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGxpc3RlbmVyQXJyYXkubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICBsaXN0ZW5lckFycmF5W2ldLmNhbGwodGhpcywgZXZlbnQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQSBRdWF0ZXJuaW9uIGRlc2NyaWJlcyBhIHJvdGF0aW9uIGluIDNEIHNwYWNlLiBUaGUgUXVhdGVybmlvbiBpcyBtYXRoZW1hdGljYWxseSBkZWZpbmVkIGFzIFEgPSB4KmkgKyB5KmogKyB6KmsgKyB3LCB3aGVyZSAoaSxqLGspIGFyZSBpbWFnaW5hcnkgYmFzaXMgdmVjdG9ycy4gKHgseSx6KSBjYW4gYmUgc2VlbiBhcyBhIHZlY3RvciByZWxhdGVkIHRvIHRoZSBheGlzIG9mIHJvdGF0aW9uLCB3aGlsZSB0aGUgcmVhbCBtdWx0aXBsaWVyLCB3LCBpcyByZWxhdGVkIHRvIHRoZSBhbW91bnQgb2Ygcm90YXRpb24uCiAgICogQHBhcmFtIHggTXVsdGlwbGllciBvZiB0aGUgaW1hZ2luYXJ5IGJhc2lzIHZlY3RvciBpLgogICAqIEBwYXJhbSB5IE11bHRpcGxpZXIgb2YgdGhlIGltYWdpbmFyeSBiYXNpcyB2ZWN0b3Igai4KICAgKiBAcGFyYW0geiBNdWx0aXBsaWVyIG9mIHRoZSBpbWFnaW5hcnkgYmFzaXMgdmVjdG9yIGsuCiAgICogQHBhcmFtIHcgTXVsdGlwbGllciBvZiB0aGUgcmVhbCBwYXJ0LgogICAqIEBzZWUgaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9RdWF0ZXJuaW9uCiAgICovCgogIGNsYXNzIFF1YXRlcm5pb24gewogICAgY29uc3RydWN0b3IoeCwgeSwgeiwgdykgewogICAgICBpZiAoeCA9PT0gdm9pZCAwKSB7CiAgICAgICAgeCA9IDA7CiAgICAgIH0KCiAgICAgIGlmICh5ID09PSB2b2lkIDApIHsKICAgICAgICB5ID0gMDsKICAgICAgfQoKICAgICAgaWYgKHogPT09IHZvaWQgMCkgewogICAgICAgIHogPSAwOwogICAgICB9CgogICAgICBpZiAodyA9PT0gdm9pZCAwKSB7CiAgICAgICAgdyA9IDE7CiAgICAgIH0KCiAgICAgIHRoaXMueCA9IHg7CiAgICAgIHRoaXMueSA9IHk7CiAgICAgIHRoaXMueiA9IHo7CiAgICAgIHRoaXMudyA9IHc7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgdmFsdWUgb2YgdGhlIHF1YXRlcm5pb24uCiAgICAgKi8KCgogICAgc2V0KHgsIHksIHosIHcpIHsKICAgICAgdGhpcy54ID0geDsKICAgICAgdGhpcy55ID0geTsKICAgICAgdGhpcy56ID0gejsKICAgICAgdGhpcy53ID0gdzsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgdG8gYSByZWFkYWJsZSBmb3JtYXQKICAgICAqIEByZXR1cm4gIngseSx6LHciCiAgICAgKi8KCgogICAgdG9TdHJpbmcoKSB7CiAgICAgIHJldHVybiBgJHt0aGlzLnh9LCR7dGhpcy55fSwke3RoaXMuen0sJHt0aGlzLnd9YDsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCB0byBhbiBBcnJheQogICAgICogQHJldHVybiBbeCwgeSwgeiwgd10KICAgICAqLwoKCiAgICB0b0FycmF5KCkgewogICAgICByZXR1cm4gW3RoaXMueCwgdGhpcy55LCB0aGlzLnosIHRoaXMud107CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgcXVhdGVybmlvbiBjb21wb25lbnRzIGdpdmVuIGFuIGF4aXMgYW5kIGFuIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAgKi8KCgogICAgc2V0RnJvbUF4aXNBbmdsZSh2ZWN0b3IsIGFuZ2xlKSB7CiAgICAgIGNvbnN0IHMgPSBNYXRoLnNpbihhbmdsZSAqIDAuNSk7CiAgICAgIHRoaXMueCA9IHZlY3Rvci54ICogczsKICAgICAgdGhpcy55ID0gdmVjdG9yLnkgKiBzOwogICAgICB0aGlzLnogPSB2ZWN0b3IueiAqIHM7CiAgICAgIHRoaXMudyA9IE1hdGguY29zKGFuZ2xlICogMC41KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnRzIHRoZSBxdWF0ZXJuaW9uIHRvIFsgYXhpcywgYW5nbGUgXSByZXByZXNlbnRhdGlvbi4KICAgICAqIEBwYXJhbSB0YXJnZXRBeGlzIEEgdmVjdG9yIG9iamVjdCB0byByZXVzZSBmb3Igc3RvcmluZyB0aGUgYXhpcy4KICAgICAqIEByZXR1cm4gQW4gYXJyYXksIGZpcnN0IGVsZW1lbnQgaXMgdGhlIGF4aXMgYW5kIHRoZSBzZWNvbmQgaXMgdGhlIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAgKi8KCgogICAgdG9BeGlzQW5nbGUodGFyZ2V0QXhpcykgewogICAgICBpZiAodGFyZ2V0QXhpcyA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0QXhpcyA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMubm9ybWFsaXplKCk7IC8vIGlmIHc+MSBhY29zIGFuZCBzcXJ0IHdpbGwgcHJvZHVjZSBlcnJvcnMsIHRoaXMgY2FudCBoYXBwZW4gaWYgcXVhdGVybmlvbiBpcyBub3JtYWxpc2VkCgogICAgICBjb25zdCBhbmdsZSA9IDIgKiBNYXRoLmFjb3ModGhpcy53KTsKICAgICAgY29uc3QgcyA9IE1hdGguc3FydCgxIC0gdGhpcy53ICogdGhpcy53KTsgLy8gYXNzdW1pbmcgcXVhdGVybmlvbiBub3JtYWxpc2VkIHRoZW4gdyBpcyBsZXNzIHRoYW4gMSwgc28gdGVybSBhbHdheXMgcG9zaXRpdmUuCgogICAgICBpZiAocyA8IDAuMDAxKSB7CiAgICAgICAgLy8gdGVzdCB0byBhdm9pZCBkaXZpZGUgYnkgemVybywgcyBpcyBhbHdheXMgcG9zaXRpdmUgZHVlIHRvIHNxcnQKICAgICAgICAvLyBpZiBzIGNsb3NlIHRvIHplcm8gdGhlbiBkaXJlY3Rpb24gb2YgYXhpcyBub3QgaW1wb3J0YW50CiAgICAgICAgdGFyZ2V0QXhpcy54ID0gdGhpcy54OyAvLyBpZiBpdCBpcyBpbXBvcnRhbnQgdGhhdCBheGlzIGlzIG5vcm1hbGlzZWQgdGhlbiByZXBsYWNlIHdpdGggeD0xOyB5PXo9MDsKCiAgICAgICAgdGFyZ2V0QXhpcy55ID0gdGhpcy55OwogICAgICAgIHRhcmdldEF4aXMueiA9IHRoaXMuejsKICAgICAgfSBlbHNlIHsKICAgICAgICB0YXJnZXRBeGlzLnggPSB0aGlzLnggLyBzOyAvLyBub3JtYWxpc2UgYXhpcwoKICAgICAgICB0YXJnZXRBeGlzLnkgPSB0aGlzLnkgLyBzOwogICAgICAgIHRhcmdldEF4aXMueiA9IHRoaXMueiAvIHM7CiAgICAgIH0KCiAgICAgIHJldHVybiBbdGFyZ2V0QXhpcywgYW5nbGVdOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHF1YXRlcm5pb24gdmFsdWUgZ2l2ZW4gdHdvIHZlY3RvcnMuIFRoZSByZXN1bHRpbmcgcm90YXRpb24gd2lsbCBiZSB0aGUgbmVlZGVkIHJvdGF0aW9uIHRvIHJvdGF0ZSB1IHRvIHYuCiAgICAgKi8KCgogICAgc2V0RnJvbVZlY3RvcnModSwgdikgewogICAgICBpZiAodS5pc0FudGlwYXJhbGxlbFRvKHYpKSB7CiAgICAgICAgY29uc3QgdDEgPSBzZnZfdDE7CiAgICAgICAgY29uc3QgdDIgPSBzZnZfdDI7CiAgICAgICAgdS50YW5nZW50cyh0MSwgdDIpOwogICAgICAgIHRoaXMuc2V0RnJvbUF4aXNBbmdsZSh0MSwgTWF0aC5QSSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgYSA9IHUuY3Jvc3Modik7CiAgICAgICAgdGhpcy54ID0gYS54OwogICAgICAgIHRoaXMueSA9IGEueTsKICAgICAgICB0aGlzLnogPSBhLno7CiAgICAgICAgdGhpcy53ID0gTWF0aC5zcXJ0KHUubGVuZ3RoKCkgKiogMiAqIHYubGVuZ3RoKCkgKiogMikgKyB1LmRvdCh2KTsKICAgICAgICB0aGlzLm5vcm1hbGl6ZSgpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogTXVsdGlwbHkgdGhlIHF1YXRlcm5pb24gd2l0aCBhbiBvdGhlciBxdWF0ZXJuaW9uLgogICAgICovCgoKICAgIG11bHQocXVhdCwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4ID0gdGhpcy54OwogICAgICBjb25zdCBheSA9IHRoaXMueTsKICAgICAgY29uc3QgYXogPSB0aGlzLno7CiAgICAgIGNvbnN0IGF3ID0gdGhpcy53OwogICAgICBjb25zdCBieCA9IHF1YXQueDsKICAgICAgY29uc3QgYnkgPSBxdWF0Lnk7CiAgICAgIGNvbnN0IGJ6ID0gcXVhdC56OwogICAgICBjb25zdCBidyA9IHF1YXQudzsKICAgICAgdGFyZ2V0LnggPSBheCAqIGJ3ICsgYXcgKiBieCArIGF5ICogYnogLSBheiAqIGJ5OwogICAgICB0YXJnZXQueSA9IGF5ICogYncgKyBhdyAqIGJ5ICsgYXogKiBieCAtIGF4ICogYno7CiAgICAgIHRhcmdldC56ID0gYXogKiBidyArIGF3ICogYnogKyBheCAqIGJ5IC0gYXkgKiBieDsKICAgICAgdGFyZ2V0LncgPSBhdyAqIGJ3IC0gYXggKiBieCAtIGF5ICogYnkgLSBheiAqIGJ6OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGludmVyc2UgcXVhdGVybmlvbiByb3RhdGlvbi4KICAgICAqLwoKCiAgICBpbnZlcnNlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCB3ID0gdGhpcy53OwogICAgICB0aGlzLmNvbmp1Z2F0ZSh0YXJnZXQpOwogICAgICBjb25zdCBpbm9ybTIgPSAxIC8gKHggKiB4ICsgeSAqIHkgKyB6ICogeiArIHcgKiB3KTsKICAgICAgdGFyZ2V0LnggKj0gaW5vcm0yOwogICAgICB0YXJnZXQueSAqPSBpbm9ybTI7CiAgICAgIHRhcmdldC56ICo9IGlub3JtMjsKICAgICAgdGFyZ2V0LncgKj0gaW5vcm0yOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHF1YXRlcm5pb24gY29uanVnYXRlCiAgICAgKi8KCgogICAgY29uanVnYXRlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IC10aGlzLng7CiAgICAgIHRhcmdldC55ID0gLXRoaXMueTsKICAgICAgdGFyZ2V0LnogPSAtdGhpcy56OwogICAgICB0YXJnZXQudyA9IHRoaXMudzsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTm9ybWFsaXplIHRoZSBxdWF0ZXJuaW9uLiBOb3RlIHRoYXQgdGhpcyBjaGFuZ2VzIHRoZSB2YWx1ZXMgb2YgdGhlIHF1YXRlcm5pb24uCiAgICAgKi8KCgogICAgbm9ybWFsaXplKCkgewogICAgICBsZXQgbCA9IE1hdGguc3FydCh0aGlzLnggKiB0aGlzLnggKyB0aGlzLnkgKiB0aGlzLnkgKyB0aGlzLnogKiB0aGlzLnogKyB0aGlzLncgKiB0aGlzLncpOwoKICAgICAgaWYgKGwgPT09IDApIHsKICAgICAgICB0aGlzLnggPSAwOwogICAgICAgIHRoaXMueSA9IDA7CiAgICAgICAgdGhpcy56ID0gMDsKICAgICAgICB0aGlzLncgPSAwOwogICAgICB9IGVsc2UgewogICAgICAgIGwgPSAxIC8gbDsKICAgICAgICB0aGlzLnggKj0gbDsKICAgICAgICB0aGlzLnkgKj0gbDsKICAgICAgICB0aGlzLnogKj0gbDsKICAgICAgICB0aGlzLncgKj0gbDsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIEFwcHJveGltYXRpb24gb2YgcXVhdGVybmlvbiBub3JtYWxpemF0aW9uLiBXb3JrcyBiZXN0IHdoZW4gcXVhdCBpcyBhbHJlYWR5IGFsbW9zdC1ub3JtYWxpemVkLgogICAgICogQGF1dGhvciB1bnBoYXNlZCwgaHR0cHM6Ly9naXRodWIuY29tL3VucGhhc2VkCiAgICAgKi8KCgogICAgbm9ybWFsaXplRmFzdCgpIHsKICAgICAgY29uc3QgZiA9ICgzLjAgLSAodGhpcy54ICogdGhpcy54ICsgdGhpcy55ICogdGhpcy55ICsgdGhpcy56ICogdGhpcy56ICsgdGhpcy53ICogdGhpcy53KSkgLyAyLjA7CgogICAgICBpZiAoZiA9PT0gMCkgewogICAgICAgIHRoaXMueCA9IDA7CiAgICAgICAgdGhpcy55ID0gMDsKICAgICAgICB0aGlzLnogPSAwOwogICAgICAgIHRoaXMudyA9IDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy54ICo9IGY7CiAgICAgICAgdGhpcy55ICo9IGY7CiAgICAgICAgdGhpcy56ICo9IGY7CiAgICAgICAgdGhpcy53ICo9IGY7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB0aGUgcXVhdGVybmlvbiBieSBhIHZlY3RvcgogICAgICovCgoKICAgIHZtdWx0KHYsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdi54OwogICAgICBjb25zdCB5ID0gdi55OwogICAgICBjb25zdCB6ID0gdi56OwogICAgICBjb25zdCBxeCA9IHRoaXMueDsKICAgICAgY29uc3QgcXkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHF6ID0gdGhpcy56OwogICAgICBjb25zdCBxdyA9IHRoaXMudzsgLy8gcSp2CgogICAgICBjb25zdCBpeCA9IHF3ICogeCArIHF5ICogeiAtIHF6ICogeTsKICAgICAgY29uc3QgaXkgPSBxdyAqIHkgKyBxeiAqIHggLSBxeCAqIHo7CiAgICAgIGNvbnN0IGl6ID0gcXcgKiB6ICsgcXggKiB5IC0gcXkgKiB4OwogICAgICBjb25zdCBpdyA9IC1xeCAqIHggLSBxeSAqIHkgLSBxeiAqIHo7CiAgICAgIHRhcmdldC54ID0gaXggKiBxdyArIGl3ICogLXF4ICsgaXkgKiAtcXogLSBpeiAqIC1xeTsKICAgICAgdGFyZ2V0LnkgPSBpeSAqIHF3ICsgaXcgKiAtcXkgKyBpeiAqIC1xeCAtIGl4ICogLXF6OwogICAgICB0YXJnZXQueiA9IGl6ICogcXcgKyBpdyAqIC1xeiArIGl4ICogLXF5IC0gaXkgKiAtcXg7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIENvcGllcyB2YWx1ZSBvZiBzb3VyY2UgdG8gdGhpcyBxdWF0ZXJuaW9uLgogICAgICogQHJldHVybiB0aGlzCiAgICAgKi8KCgogICAgY29weShxdWF0KSB7CiAgICAgIHRoaXMueCA9IHF1YXQueDsKICAgICAgdGhpcy55ID0gcXVhdC55OwogICAgICB0aGlzLnogPSBxdWF0Lno7CiAgICAgIHRoaXMudyA9IHF1YXQudzsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHF1YXRlcm5pb24gdG8gZXVsZXIgYW5nbGUgcmVwcmVzZW50YXRpb24uIE9yZGVyOiBZWlgsIGFzIHRoaXMgcGFnZSBkZXNjcmliZXM6IGh0dHBzOi8vd3d3LmV1Y2xpZGVhbnNwYWNlLmNvbS9tYXRocy9zdGFuZGFyZHMvaW5kZXguaHRtCiAgICAgKiBAcGFyYW0gb3JkZXIgVGhyZWUtY2hhcmFjdGVyIHN0cmluZywgZGVmYXVsdHMgdG8gIllaWCIKICAgICAqLwoKCiAgICB0b0V1bGVyKHRhcmdldCwgb3JkZXIpIHsKICAgICAgaWYgKG9yZGVyID09PSB2b2lkIDApIHsKICAgICAgICBvcmRlciA9ICdZWlgnOwogICAgICB9CgogICAgICBsZXQgaGVhZGluZzsKICAgICAgbGV0IGF0dGl0dWRlOwogICAgICBsZXQgYmFuazsKICAgICAgY29uc3QgeCA9IHRoaXMueDsKICAgICAgY29uc3QgeSA9IHRoaXMueTsKICAgICAgY29uc3QgeiA9IHRoaXMuejsKICAgICAgY29uc3QgdyA9IHRoaXMudzsKCiAgICAgIHN3aXRjaCAob3JkZXIpIHsKICAgICAgICBjYXNlICdZWlgnOgogICAgICAgICAgY29uc3QgdGVzdCA9IHggKiB5ICsgeiAqIHc7CgogICAgICAgICAgaWYgKHRlc3QgPiAwLjQ5OSkgewogICAgICAgICAgICAvLyBzaW5ndWxhcml0eSBhdCBub3J0aCBwb2xlCiAgICAgICAgICAgIGhlYWRpbmcgPSAyICogTWF0aC5hdGFuMih4LCB3KTsKICAgICAgICAgICAgYXR0aXR1ZGUgPSBNYXRoLlBJIC8gMjsKICAgICAgICAgICAgYmFuayA9IDA7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRlc3QgPCAtMC40OTkpIHsKICAgICAgICAgICAgLy8gc2luZ3VsYXJpdHkgYXQgc291dGggcG9sZQogICAgICAgICAgICBoZWFkaW5nID0gLTIgKiBNYXRoLmF0YW4yKHgsIHcpOwogICAgICAgICAgICBhdHRpdHVkZSA9IC1NYXRoLlBJIC8gMjsKICAgICAgICAgICAgYmFuayA9IDA7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGhlYWRpbmcgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBjb25zdCBzcXggPSB4ICogeDsKICAgICAgICAgICAgY29uc3Qgc3F5ID0geSAqIHk7CiAgICAgICAgICAgIGNvbnN0IHNxeiA9IHogKiB6OwogICAgICAgICAgICBoZWFkaW5nID0gTWF0aC5hdGFuMigyICogeSAqIHcgLSAyICogeCAqIHosIDEgLSAyICogc3F5IC0gMiAqIHNxeik7IC8vIEhlYWRpbmcKCiAgICAgICAgICAgIGF0dGl0dWRlID0gTWF0aC5hc2luKDIgKiB0ZXN0KTsgLy8gYXR0aXR1ZGUKCiAgICAgICAgICAgIGJhbmsgPSBNYXRoLmF0YW4yKDIgKiB4ICogdyAtIDIgKiB5ICogeiwgMSAtIDIgKiBzcXggLSAyICogc3F6KTsgLy8gYmFuawogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBFdWxlciBvcmRlciAke29yZGVyfSBub3Qgc3VwcG9ydGVkIHlldC5gKTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnkgPSBoZWFkaW5nOwogICAgICB0YXJnZXQueiA9IGF0dGl0dWRlOwogICAgICB0YXJnZXQueCA9IGJhbms7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgcXVhdGVybmlvbiBjb21wb25lbnRzIGdpdmVuIEV1bGVyIGFuZ2xlIHJlcHJlc2VudGF0aW9uLgogICAgICoKICAgICAqIEBwYXJhbSBvcmRlciBUaGUgb3JkZXIgdG8gYXBwbHkgYW5nbGVzOiAnWFlaJyBvciAnWVhaJyBvciBhbnkgb3RoZXIgY29tYmluYXRpb24uCiAgICAgKgogICAgICogU2VlIHtAbGluayBodHRwczovL3d3dy5tYXRod29ya3MuY29tL21hdGxhYmNlbnRyYWwvZmlsZWV4Y2hhbmdlLzIwNjk2LWZ1bmN0aW9uLXRvLWNvbnZlcnQtYmV0d2Vlbi1kY20tZXVsZXItYW5nbGVzLXF1YXRlcm5pb25zLWFuZC1ldWxlci12ZWN0b3JzIE1hdGhXb3Jrc30gcmVmZXJlbmNlCiAgICAgKi8KCgogICAgc2V0RnJvbUV1bGVyKHgsIHksIHosIG9yZGVyKSB7CiAgICAgIGlmIChvcmRlciA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3JkZXIgPSAnWFlaJzsKICAgICAgfQoKICAgICAgY29uc3QgYzEgPSBNYXRoLmNvcyh4IC8gMik7CiAgICAgIGNvbnN0IGMyID0gTWF0aC5jb3MoeSAvIDIpOwogICAgICBjb25zdCBjMyA9IE1hdGguY29zKHogLyAyKTsKICAgICAgY29uc3QgczEgPSBNYXRoLnNpbih4IC8gMik7CiAgICAgIGNvbnN0IHMyID0gTWF0aC5zaW4oeSAvIDIpOwogICAgICBjb25zdCBzMyA9IE1hdGguc2luKHogLyAyKTsKCiAgICAgIGlmIChvcmRlciA9PT0gJ1hZWicpIHsKICAgICAgICB0aGlzLnggPSBzMSAqIGMyICogYzMgKyBjMSAqIHMyICogczM7CiAgICAgICAgdGhpcy55ID0gYzEgKiBzMiAqIGMzIC0gczEgKiBjMiAqIHMzOwogICAgICAgIHRoaXMueiA9IGMxICogYzIgKiBzMyArIHMxICogczIgKiBjMzsKICAgICAgICB0aGlzLncgPSBjMSAqIGMyICogYzMgLSBzMSAqIHMyICogczM7CiAgICAgIH0gZWxzZSBpZiAob3JkZXIgPT09ICdZWFonKSB7CiAgICAgICAgdGhpcy54ID0gczEgKiBjMiAqIGMzICsgYzEgKiBzMiAqIHMzOwogICAgICAgIHRoaXMueSA9IGMxICogczIgKiBjMyAtIHMxICogYzIgKiBzMzsKICAgICAgICB0aGlzLnogPSBjMSAqIGMyICogczMgLSBzMSAqIHMyICogYzM7CiAgICAgICAgdGhpcy53ID0gYzEgKiBjMiAqIGMzICsgczEgKiBzMiAqIHMzOwogICAgICB9IGVsc2UgaWYgKG9yZGVyID09PSAnWlhZJykgewogICAgICAgIHRoaXMueCA9IHMxICogYzIgKiBjMyAtIGMxICogczIgKiBzMzsKICAgICAgICB0aGlzLnkgPSBjMSAqIHMyICogYzMgKyBzMSAqIGMyICogczM7CiAgICAgICAgdGhpcy56ID0gYzEgKiBjMiAqIHMzICsgczEgKiBzMiAqIGMzOwogICAgICAgIHRoaXMudyA9IGMxICogYzIgKiBjMyAtIHMxICogczIgKiBzMzsKICAgICAgfSBlbHNlIGlmIChvcmRlciA9PT0gJ1pZWCcpIHsKICAgICAgICB0aGlzLnggPSBzMSAqIGMyICogYzMgLSBjMSAqIHMyICogczM7CiAgICAgICAgdGhpcy55ID0gYzEgKiBzMiAqIGMzICsgczEgKiBjMiAqIHMzOwogICAgICAgIHRoaXMueiA9IGMxICogYzIgKiBzMyAtIHMxICogczIgKiBjMzsKICAgICAgICB0aGlzLncgPSBjMSAqIGMyICogYzMgKyBzMSAqIHMyICogczM7CiAgICAgIH0gZWxzZSBpZiAob3JkZXIgPT09ICdZWlgnKSB7CiAgICAgICAgdGhpcy54ID0gczEgKiBjMiAqIGMzICsgYzEgKiBzMiAqIHMzOwogICAgICAgIHRoaXMueSA9IGMxICogczIgKiBjMyArIHMxICogYzIgKiBzMzsKICAgICAgICB0aGlzLnogPSBjMSAqIGMyICogczMgLSBzMSAqIHMyICogYzM7CiAgICAgICAgdGhpcy53ID0gYzEgKiBjMiAqIGMzIC0gczEgKiBzMiAqIHMzOwogICAgICB9IGVsc2UgaWYgKG9yZGVyID09PSAnWFpZJykgewogICAgICAgIHRoaXMueCA9IHMxICogYzIgKiBjMyAtIGMxICogczIgKiBzMzsKICAgICAgICB0aGlzLnkgPSBjMSAqIHMyICogYzMgLSBzMSAqIGMyICogczM7CiAgICAgICAgdGhpcy56ID0gYzEgKiBjMiAqIHMzICsgczEgKiBzMiAqIGMzOwogICAgICAgIHRoaXMudyA9IGMxICogYzIgKiBjMyArIHMxICogczIgKiBzMzsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgY2xvbmUoKSB7CiAgICAgIHJldHVybiBuZXcgUXVhdGVybmlvbih0aGlzLngsIHRoaXMueSwgdGhpcy56LCB0aGlzLncpOwogICAgfQogICAgLyoqCiAgICAgKiBQZXJmb3JtcyBhIHNwaGVyaWNhbCBsaW5lYXIgaW50ZXJwb2xhdGlvbiBiZXR3ZWVuIHR3byBxdWF0CiAgICAgKgogICAgICogQHBhcmFtIHRvUXVhdCBzZWNvbmQgb3BlcmFuZAogICAgICogQHBhcmFtIHQgaW50ZXJwb2xhdGlvbiBhbW91bnQgYmV0d2VlbiB0aGUgc2VsZiBxdWF0ZXJuaW9uIGFuZCB0b1F1YXQKICAgICAqIEBwYXJhbSB0YXJnZXQgQSBxdWF0ZXJuaW9uIHRvIHN0b3JlIHRoZSByZXN1bHQgaW4uIElmIG5vdCBwcm92aWRlZCwgYSBuZXcgb25lIHdpbGwgYmUgY3JlYXRlZC4KICAgICAqIEByZXR1cm5zIHtRdWF0ZXJuaW9ufSBUaGUgInRhcmdldCIgb2JqZWN0CiAgICAgKi8KCgogICAgc2xlcnAodG9RdWF0LCB0LCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgfQoKICAgICAgY29uc3QgYXggPSB0aGlzLng7CiAgICAgIGNvbnN0IGF5ID0gdGhpcy55OwogICAgICBjb25zdCBheiA9IHRoaXMuejsKICAgICAgY29uc3QgYXcgPSB0aGlzLnc7CiAgICAgIGxldCBieCA9IHRvUXVhdC54OwogICAgICBsZXQgYnkgPSB0b1F1YXQueTsKICAgICAgbGV0IGJ6ID0gdG9RdWF0Lno7CiAgICAgIGxldCBidyA9IHRvUXVhdC53OwogICAgICBsZXQgb21lZ2E7CiAgICAgIGxldCBjb3NvbTsKICAgICAgbGV0IHNpbm9tOwogICAgICBsZXQgc2NhbGUwOwogICAgICBsZXQgc2NhbGUxOyAvLyBjYWxjIGNvc2luZQoKICAgICAgY29zb20gPSBheCAqIGJ4ICsgYXkgKiBieSArIGF6ICogYnogKyBhdyAqIGJ3OyAvLyBhZGp1c3Qgc2lnbnMgKGlmIG5lY2Vzc2FyeSkKCiAgICAgIGlmIChjb3NvbSA8IDAuMCkgewogICAgICAgIGNvc29tID0gLWNvc29tOwogICAgICAgIGJ4ID0gLWJ4OwogICAgICAgIGJ5ID0gLWJ5OwogICAgICAgIGJ6ID0gLWJ6OwogICAgICAgIGJ3ID0gLWJ3OwogICAgICB9IC8vIGNhbGN1bGF0ZSBjb2VmZmljaWVudHMKCgogICAgICBpZiAoMS4wIC0gY29zb20gPiAwLjAwMDAwMSkgewogICAgICAgIC8vIHN0YW5kYXJkIGNhc2UgKHNsZXJwKQogICAgICAgIG9tZWdhID0gTWF0aC5hY29zKGNvc29tKTsKICAgICAgICBzaW5vbSA9IE1hdGguc2luKG9tZWdhKTsKICAgICAgICBzY2FsZTAgPSBNYXRoLnNpbigoMS4wIC0gdCkgKiBvbWVnYSkgLyBzaW5vbTsKICAgICAgICBzY2FsZTEgPSBNYXRoLnNpbih0ICogb21lZ2EpIC8gc2lub207CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gImZyb20iIGFuZCAidG8iIHF1YXRlcm5pb25zIGFyZSB2ZXJ5IGNsb3NlCiAgICAgICAgLy8gIC4uLiBzbyB3ZSBjYW4gZG8gYSBsaW5lYXIgaW50ZXJwb2xhdGlvbgogICAgICAgIHNjYWxlMCA9IDEuMCAtIHQ7CiAgICAgICAgc2NhbGUxID0gdDsKICAgICAgfSAvLyBjYWxjdWxhdGUgZmluYWwgdmFsdWVzCgoKICAgICAgdGFyZ2V0LnggPSBzY2FsZTAgKiBheCArIHNjYWxlMSAqIGJ4OwogICAgICB0YXJnZXQueSA9IHNjYWxlMCAqIGF5ICsgc2NhbGUxICogYnk7CiAgICAgIHRhcmdldC56ID0gc2NhbGUwICogYXogKyBzY2FsZTEgKiBiejsKICAgICAgdGFyZ2V0LncgPSBzY2FsZTAgKiBhdyArIHNjYWxlMSAqIGJ3OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBSb3RhdGUgYW4gYWJzb2x1dGUgb3JpZW50YXRpb24gcXVhdGVybmlvbiBnaXZlbiBhbiBhbmd1bGFyIHZlbG9jaXR5IGFuZCBhIHRpbWUgc3RlcC4KICAgICAqLwoKCiAgICBpbnRlZ3JhdGUoYW5ndWxhclZlbG9jaXR5LCBkdCwgYW5ndWxhckZhY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4ID0gYW5ndWxhclZlbG9jaXR5LnggKiBhbmd1bGFyRmFjdG9yLngsCiAgICAgICAgICAgIGF5ID0gYW5ndWxhclZlbG9jaXR5LnkgKiBhbmd1bGFyRmFjdG9yLnksCiAgICAgICAgICAgIGF6ID0gYW5ndWxhclZlbG9jaXR5LnogKiBhbmd1bGFyRmFjdG9yLnosCiAgICAgICAgICAgIGJ4ID0gdGhpcy54LAogICAgICAgICAgICBieSA9IHRoaXMueSwKICAgICAgICAgICAgYnogPSB0aGlzLnosCiAgICAgICAgICAgIGJ3ID0gdGhpcy53OwogICAgICBjb25zdCBoYWxmX2R0ID0gZHQgKiAwLjU7CiAgICAgIHRhcmdldC54ICs9IGhhbGZfZHQgKiAoYXggKiBidyArIGF5ICogYnogLSBheiAqIGJ5KTsKICAgICAgdGFyZ2V0LnkgKz0gaGFsZl9kdCAqIChheSAqIGJ3ICsgYXogKiBieCAtIGF4ICogYnopOwogICAgICB0YXJnZXQueiArPSBoYWxmX2R0ICogKGF6ICogYncgKyBheCAqIGJ5IC0gYXkgKiBieCk7CiAgICAgIHRhcmdldC53ICs9IGhhbGZfZHQgKiAoLWF4ICogYnggLSBheSAqIGJ5IC0gYXogKiBieik7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CgogIH0KICBjb25zdCBzZnZfdDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNmdl90MiA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIFRoZSBhdmFpbGFibGUgc2hhcGUgdHlwZXMuCiAgICovCiAgY29uc3QgU0hBUEVfVFlQRVMgPSB7CiAgICAvKiogU1BIRVJFICovCiAgICBTUEhFUkU6IDEsCgogICAgLyoqIFBMQU5FICovCiAgICBQTEFORTogMiwKCiAgICAvKiogQk9YICovCiAgICBCT1g6IDQsCgogICAgLyoqIENPTVBPVU5EICovCiAgICBDT01QT1VORDogOCwKCiAgICAvKiogQ09OVkVYUE9MWUhFRFJPTiAqLwogICAgQ09OVkVYUE9MWUhFRFJPTjogMTYsCgogICAgLyoqIEhFSUdIVEZJRUxEICovCiAgICBIRUlHSFRGSUVMRDogMzIsCgogICAgLyoqIFBBUlRJQ0xFICovCiAgICBQQVJUSUNMRTogNjQsCgogICAgLyoqIENZTElOREVSICovCiAgICBDWUxJTkRFUjogMTI4LAoKICAgIC8qKiBUUklNRVNIICovCiAgICBUUklNRVNIOiAyNTYKICB9OwogIC8qKgogICAqIFNoYXBlVHlwZQogICAqLwoKICAvKioKICAgKiBCYXNlIGNsYXNzIGZvciBzaGFwZXMKICAgKi8KICBjbGFzcyBTaGFwZSB7CiAgICAvKioKICAgICAqIElkZW50aWZpZXIgb2YgdGhlIFNoYXBlLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgdHlwZSBvZiB0aGlzIHNoYXBlLiBNdXN0IGJlIHNldCB0byBhbiBpbnQgPiAwIGJ5IHN1YmNsYXNzZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBsb2NhbCBib3VuZGluZyBzcGhlcmUgcmFkaXVzIG9mIHRoaXMgc2hhcGUuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gcHJvZHVjZSBjb250YWN0IGZvcmNlcyB3aGVuIGluIGNvbnRhY3Qgd2l0aCBvdGhlciBib2RpZXMuIE5vdGUgdGhhdCBjb250YWN0cyB3aWxsIGJlIGdlbmVyYXRlZCwgYnV0IHRoZXkgd2lsbCBiZSBkaXNhYmxlZC4KICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBAZGVmYXVsdCAtMQogICAgICovCgogICAgLyoqCiAgICAgKiBPcHRpb25hbCBtYXRlcmlhbCBvZiB0aGUgc2hhcGUgdGhhdCByZWd1bGF0ZXMgY29udGFjdCBwcm9wZXJ0aWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgYm9keSB0byB3aGljaCB0aGUgc2hhcGUgaXMgYWRkZWQgdG8uCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFsbCB0aGUgU2hhcGUgdHlwZXMuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgdGhpcy5pZCA9IFNoYXBlLmlkQ291bnRlcisrOwogICAgICB0aGlzLnR5cGUgPSBvcHRpb25zLnR5cGUgfHwgMDsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IDA7CiAgICAgIHRoaXMuY29sbGlzaW9uUmVzcG9uc2UgPSBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlID8gb3B0aW9ucy5jb2xsaXNpb25SZXNwb25zZSA6IHRydWU7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrID0gb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJNYXNrICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgOiAtMTsKICAgICAgdGhpcy5tYXRlcmlhbCA9IG9wdGlvbnMubWF0ZXJpYWwgPyBvcHRpb25zLm1hdGVyaWFsIDogbnVsbDsKICAgICAgdGhpcy5ib2R5ID0gbnVsbDsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgdGhlIGJvdW5kaW5nIHNwaGVyZSByYWRpdXMuCiAgICAgKiBUaGUgcmVzdWx0IGlzIHN0b3JlZCBpbiB0aGUgcHJvcGVydHkgYC5ib3VuZGluZ1NwaGVyZVJhZGl1c2AKICAgICAqLwoKCiAgICB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIHsKICAgICAgdGhyb3cgYGNvbXB1dGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIG5vdCBpbXBsZW1lbnRlZCBmb3Igc2hhcGUgdHlwZSAke3RoaXMudHlwZX1gOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHZvbHVtZSBvZiB0aGlzIHNoYXBlCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICB0aHJvdyBgdm9sdW1lKCkgbm90IGltcGxlbWVudGVkIGZvciBzaGFwZSB0eXBlICR7dGhpcy50eXBlfWA7CiAgICB9CiAgICAvKioKICAgICAqIENhbGN1bGF0ZXMgdGhlIGluZXJ0aWEgaW4gdGhlIGxvY2FsIGZyYW1lIGZvciB0aGlzIHNoYXBlLgogICAgICogQHNlZSBodHRwOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0xpc3Rfb2ZfbW9tZW50c19vZl9pbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICB0aHJvdyBgY2FsY3VsYXRlTG9jYWxJbmVydGlhKCkgbm90IGltcGxlbWVudGVkIGZvciBzaGFwZSB0eXBlICR7dGhpcy50eXBlfWA7CiAgICB9CiAgICAvKioKICAgICAqIEB0b2RvIHVzZSBhYnN0cmFjdCBmb3IgdGhlc2Uga2luZCBvZiBtZXRob2RzCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgdGhyb3cgYGNhbGN1bGF0ZVdvcmxkQUFCQigpIG5vdCBpbXBsZW1lbnRlZCBmb3Igc2hhcGUgdHlwZSAke3RoaXMudHlwZX1gOwogICAgfQoKICB9CiAgU2hhcGUuaWRDb3VudGVyID0gMDsKICBTaGFwZS50eXBlcyA9IFNIQVBFX1RZUEVTOwoKICAvKioKICAgKiBUcmFuc2Zvcm1hdGlvbiB1dGlsaXRpZXMuCiAgICovCiAgY2xhc3MgVHJhbnNmb3JtIHsKICAgIC8qKgogICAgICogcG9zaXRpb24KICAgICAqLwoKICAgIC8qKgogICAgICogcXVhdGVybmlvbgogICAgICovCiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIHRoaXMucG9zaXRpb24gPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnF1YXRlcm5pb24gPSBuZXcgUXVhdGVybmlvbigpOwoKICAgICAgaWYgKG9wdGlvbnMucG9zaXRpb24pIHsKICAgICAgICB0aGlzLnBvc2l0aW9uLmNvcHkob3B0aW9ucy5wb3NpdGlvbik7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLnF1YXRlcm5pb24pIHsKICAgICAgICB0aGlzLnF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIGdsb2JhbCBwb2ludCBpbiBsb2NhbCB0cmFuc2Zvcm0gY29vcmRpbmF0ZXMuCiAgICAgKi8KCgogICAgcG9pbnRUb0xvY2FsKHdvcmxkUG9pbnQsIHJlc3VsdCkgewogICAgICByZXR1cm4gVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHRoaXMucG9zaXRpb24sIHRoaXMucXVhdGVybmlvbiwgd29ybGRQb2ludCwgcmVzdWx0KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGEgbG9jYWwgcG9pbnQgaW4gZ2xvYmFsIHRyYW5zZm9ybSBjb29yZGluYXRlcy4KICAgICAqLwoKCiAgICBwb2ludFRvV29ybGQobG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIHJldHVybiBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5wb3NpdGlvbiwgdGhpcy5xdWF0ZXJuaW9uLCBsb2NhbFBvaW50LCByZXN1bHQpOwogICAgfQogICAgLyoqCiAgICAgKiB2ZWN0b3JUb1dvcmxkRnJhbWUKICAgICAqLwoKCiAgICB2ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0aGlzLnF1YXRlcm5pb24udm11bHQobG9jYWxWZWN0b3IsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHBvaW50VG9Mb2NhbEZyYW1lCiAgICAgKi8KCgogICAgc3RhdGljIHBvaW50VG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCB3b3JsZFBvaW50LCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmVzdWx0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgd29ybGRQb2ludC52c3ViKHBvc2l0aW9uLCByZXN1bHQpOwogICAgICBxdWF0ZXJuaW9uLmNvbmp1Z2F0ZSh0bXBRdWF0JDEpOwogICAgICB0bXBRdWF0JDEudm11bHQocmVzdWx0LCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBwb2ludFRvV29ybGRGcmFtZQogICAgICovCgoKICAgIHN0YXRpYyBwb2ludFRvV29ybGRGcmFtZShwb3NpdGlvbiwgcXVhdGVybmlvbiwgbG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHF1YXRlcm5pb24udm11bHQobG9jYWxQb2ludCwgcmVzdWx0KTsKICAgICAgcmVzdWx0LnZhZGQocG9zaXRpb24sIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHZlY3RvclRvV29ybGRGcmFtZQogICAgICovCgoKICAgIHN0YXRpYyB2ZWN0b3JUb1dvcmxkRnJhbWUocXVhdGVybmlvbiwgbG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBxdWF0ZXJuaW9uLnZtdWx0KGxvY2FsVmVjdG9yLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiB2ZWN0b3JUb0xvY2FsRnJhbWUKICAgICAqLwoKCiAgICBzdGF0aWMgdmVjdG9yVG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCB3b3JsZFZlY3RvciwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHF1YXRlcm5pb24udyAqPSAtMTsKICAgICAgcXVhdGVybmlvbi52bXVsdCh3b3JsZFZlY3RvciwgcmVzdWx0KTsKICAgICAgcXVhdGVybmlvbi53ICo9IC0xOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICB9CiAgY29uc3QgdG1wUXVhdCQxID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgLyoqCiAgICogQSBzZXQgb2YgcG9seWdvbnMgZGVzY3JpYmluZyBhIGNvbnZleCBzaGFwZS4KICAgKgogICAqIFRoZSBzaGFwZSBNVVNUIGJlIGNvbnZleCBmb3IgdGhlIGNvZGUgdG8gd29yayBwcm9wZXJseS4gTm8gcG9seWdvbnMgbWF5IGJlIGNvcGxhbmFyIChjb250YWluZWQKICAgKiBpbiB0aGUgc2FtZSAzRCBwbGFuZSksIGluc3RlYWQgdGhlc2Ugc2hvdWxkIGJlIG1lcmdlZCBpbnRvIG9uZSBwb2x5Z29uLgogICAqCiAgICogQGF1dGhvciBxaWFvIC8gaHR0cHM6Ly9naXRodWIuY29tL3FpYW8gKG9yaWdpbmFsIGF1dGhvciwgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9xaWFvL3RocmVlLmpzL2NvbW1pdC84NTAyNmYwYzc2OWU0MDAwMTQ4YTY3ZDQ1YTllOWI5YzUxMDg4MzZmKQogICAqIEBhdXRob3Igc2NodGVwcGUgLyBodHRwczovL2dpdGh1Yi5jb20vc2NodGVwcGUKICAgKiBAc2VlIGh0dHBzOi8vd3d3LmFsdGRldmJsb2dhZGF5LmNvbS8yMDExLzA1LzEzL2NvbnRhY3QtZ2VuZXJhdGlvbi1iZXR3ZWVuLTNkLWNvbnZleC1tZXNoZXMvCiAgICoKICAgKiBAdG9kbyBNb3ZlIHRoZSBjbGlwcGluZyBmdW5jdGlvbnMgdG8gQ29udGFjdEdlbmVyYXRvcj8KICAgKiBAdG9kbyBBdXRvbWF0aWNhbGx5IG1lcmdlIGNvcGxhbmFyIHBvbHlnb25zIGluIGNvbnN0cnVjdG9yLgogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IGNvbnZleFNoYXBlID0gbmV3IENBTk5PTi5Db252ZXhQb2x5aGVkcm9uKHsgdmVydGljZXMsIGZhY2VzIH0pCiAgICogICAgIGNvbnN0IGNvbnZleEJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoeyBtYXNzOiAxLCBzaGFwZTogY29udmV4U2hhcGUgfSkKICAgKiAgICAgd29ybGQuYWRkQm9keShjb252ZXhCb2R5KQogICAqLwogIGNsYXNzIENvbnZleFBvbHloZWRyb24gZXh0ZW5kcyBTaGFwZSB7CiAgICAvKiogdmVydGljZXMgKi8KCiAgICAvKioKICAgICAqIEFycmF5IG9mIGludGVnZXIgYXJyYXlzLCBpbmRpY2F0aW5nIHdoaWNoIHZlcnRpY2VzIGVhY2ggZmFjZSBjb25zaXN0cyBvZgogICAgICovCgogICAgLyoqIGZhY2VOb3JtYWxzICovCgogICAgLyoqIHdvcmxkVmVydGljZXMgKi8KCiAgICAvKiogd29ybGRWZXJ0aWNlc05lZWRzVXBkYXRlICovCgogICAgLyoqIHdvcmxkRmFjZU5vcm1hbHMgKi8KCiAgICAvKiogd29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlICovCgogICAgLyoqCiAgICAgKiBJZiBnaXZlbiwgdGhlc2UgbG9jYWxseSBkZWZpbmVkLCBub3JtYWxpemVkIGF4ZXMgYXJlIHRoZSBvbmx5IG9uZXMgYmVpbmcgY2hlY2tlZCB3aGVuIGRvaW5nIHNlcGFyYXRpbmcgYXhpcyBjaGVjay4KICAgICAqLwoKICAgIC8qKiB1bmlxdWVFZGdlcyAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIHZlcnRpY2VzIEFuIGFycmF5IG9mIFZlYzMncwogICAgICogQHBhcmFtIGZhY2VzIEFycmF5IG9mIGludGVnZXIgYXJyYXlzLCBkZXNjcmliaW5nIHdoaWNoIHZlcnRpY2VzIHRoYXQgaXMgaW5jbHVkZWQgaW4gZWFjaCBmYWNlLgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihwcm9wcykgewogICAgICBpZiAocHJvcHMgPT09IHZvaWQgMCkgewogICAgICAgIHByb3BzID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IHsKICAgICAgICB2ZXJ0aWNlcyA9IFtdLAogICAgICAgIGZhY2VzID0gW10sCiAgICAgICAgbm9ybWFscyA9IFtdLAogICAgICAgIGF4ZXMsCiAgICAgICAgYm91bmRpbmdTcGhlcmVSYWRpdXMKICAgICAgfSA9IHByb3BzOwogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTgogICAgICB9KTsKICAgICAgdGhpcy52ZXJ0aWNlcyA9IHZlcnRpY2VzOwogICAgICB0aGlzLmZhY2VzID0gZmFjZXM7CiAgICAgIHRoaXMuZmFjZU5vcm1hbHMgPSBub3JtYWxzOwoKICAgICAgaWYgKHRoaXMuZmFjZU5vcm1hbHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhpcy5jb21wdXRlTm9ybWFscygpOwogICAgICB9CgogICAgICBpZiAoIWJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSBib3VuZGluZ1NwaGVyZVJhZGl1czsKICAgICAgfQoKICAgICAgdGhpcy53b3JsZFZlcnRpY2VzID0gW107IC8vIFdvcmxkIHRyYW5zZm9ybWVkIHZlcnNpb24gb2YgLnZlcnRpY2VzCgogICAgICB0aGlzLndvcmxkVmVydGljZXNOZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgIHRoaXMud29ybGRGYWNlTm9ybWFscyA9IFtdOyAvLyBXb3JsZCB0cmFuc2Zvcm1lZCB2ZXJzaW9uIG9mIC5mYWNlTm9ybWFscwoKICAgICAgdGhpcy53b3JsZEZhY2VOb3JtYWxzTmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICB0aGlzLnVuaXF1ZUF4ZXMgPSBheGVzID8gYXhlcy5zbGljZSgpIDogbnVsbDsKICAgICAgdGhpcy51bmlxdWVFZGdlcyA9IFtdOwogICAgICB0aGlzLmNvbXB1dGVFZGdlcygpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyB1bmlxdWVFZGdlcwogICAgICovCgoKICAgIGNvbXB1dGVFZGdlcygpIHsKICAgICAgY29uc3QgZmFjZXMgPSB0aGlzLmZhY2VzOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIGNvbnN0IGVkZ2VzID0gdGhpcy51bmlxdWVFZGdlczsKICAgICAgZWRnZXMubGVuZ3RoID0gMDsKICAgICAgY29uc3QgZWRnZSA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbaV07CiAgICAgICAgY29uc3QgbnVtVmVydGljZXMgPSBmYWNlLmxlbmd0aDsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IG51bVZlcnRpY2VzOyBqKyspIHsKICAgICAgICAgIGNvbnN0IGsgPSAoaiArIDEpICUgbnVtVmVydGljZXM7CiAgICAgICAgICB2ZXJ0aWNlc1tmYWNlW2pdXS52c3ViKHZlcnRpY2VzW2ZhY2Vba11dLCBlZGdlKTsKICAgICAgICAgIGVkZ2Uubm9ybWFsaXplKCk7CiAgICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTsKCiAgICAgICAgICBmb3IgKGxldCBwID0gMDsgcCAhPT0gZWRnZXMubGVuZ3RoOyBwKyspIHsKICAgICAgICAgICAgaWYgKGVkZ2VzW3BdLmFsbW9zdEVxdWFscyhlZGdlKSB8fCBlZGdlc1twXS5hbG1vc3RFcXVhbHMoZWRnZSkpIHsKICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIWZvdW5kKSB7CiAgICAgICAgICAgIGVkZ2VzLnB1c2goZWRnZS5jbG9uZSgpKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbm9ybWFscyBvZiB0aGUgZmFjZXMuCiAgICAgKiBXaWxsIHJldXNlIGV4aXN0aW5nIFZlYzMgb2JqZWN0cyBpbiB0aGUgYGZhY2VOb3JtYWxzYCBhcnJheSBpZiB0aGV5IGV4aXN0LgogICAgICovCgoKICAgIGNvbXB1dGVOb3JtYWxzKCkgewogICAgICB0aGlzLmZhY2VOb3JtYWxzLmxlbmd0aCA9IHRoaXMuZmFjZXMubGVuZ3RoOyAvLyBHZW5lcmF0ZSBub3JtYWxzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAvLyBDaGVjayBzbyBhbGwgdmVydGljZXMgZXhpc3RzIGZvciB0aGlzIGZhY2UKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuZmFjZXNbaV0ubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGlmICghdGhpcy52ZXJ0aWNlc1t0aGlzLmZhY2VzW2ldW2pdXSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFZlcnRleCAke3RoaXMuZmFjZXNbaV1bal19IG5vdCBmb3VuZCFgKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGNvbnN0IG4gPSB0aGlzLmZhY2VOb3JtYWxzW2ldIHx8IG5ldyBWZWMzKCk7CiAgICAgICAgdGhpcy5nZXRGYWNlTm9ybWFsKGksIG4pOwogICAgICAgIG4ubmVnYXRlKG4pOwogICAgICAgIHRoaXMuZmFjZU5vcm1hbHNbaV0gPSBuOwogICAgICAgIGNvbnN0IHZlcnRleCA9IHRoaXMudmVydGljZXNbdGhpcy5mYWNlc1tpXVswXV07CgogICAgICAgIGlmIChuLmRvdCh2ZXJ0ZXgpIDwgMCkgewogICAgICAgICAgY29uc29sZS5lcnJvcihgLmZhY2VOb3JtYWxzWyR7aX1dID0gVmVjMygke24udG9TdHJpbmcoKX0pIGxvb2tzIGxpa2UgaXQgcG9pbnRzIGludG8gdGhlIHNoYXBlPyBUaGUgdmVydGljZXMgZm9sbG93LiBNYWtlIHN1cmUgdGhleSBhcmUgb3JkZXJlZCBDQ1cgYXJvdW5kIHRoZSBub3JtYWwsIHVzaW5nIHRoZSByaWdodCBoYW5kIHJ1bGUuYCk7CgogICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLmZhY2VzW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgIGNvbnNvbGUud2FybihgLnZlcnRpY2VzWyR7dGhpcy5mYWNlc1tpXVtqXX1dID0gVmVjMygke3RoaXMudmVydGljZXNbdGhpcy5mYWNlc1tpXVtqXV0udG9TdHJpbmcoKX0pYCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdGhlIG5vcm1hbCBvZiBhIGZhY2UgZnJvbSBpdHMgdmVydGljZXMKICAgICAqLwoKCiAgICBnZXRGYWNlTm9ybWFsKGksIHRhcmdldCkgewogICAgICBjb25zdCBmID0gdGhpcy5mYWNlc1tpXTsKICAgICAgY29uc3QgdmEgPSB0aGlzLnZlcnRpY2VzW2ZbMF1dOwogICAgICBjb25zdCB2YiA9IHRoaXMudmVydGljZXNbZlsxXV07CiAgICAgIGNvbnN0IHZjID0gdGhpcy52ZXJ0aWNlc1tmWzJdXTsKICAgICAgQ29udmV4UG9seWhlZHJvbi5jb21wdXRlTm9ybWFsKHZhLCB2YiwgdmMsIHRhcmdldCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBmYWNlIG5vcm1hbCBnaXZlbiAzIHZlcnRpY2VzCiAgICAgKi8KCgogICAgc3RhdGljIGNvbXB1dGVOb3JtYWwodmEsIHZiLCB2YywgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNiID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgYWIgPSBuZXcgVmVjMygpOwogICAgICB2Yi52c3ViKHZhLCBhYik7CiAgICAgIHZjLnZzdWIodmIsIGNiKTsKICAgICAgY2IuY3Jvc3MoYWIsIHRhcmdldCk7CgogICAgICBpZiAoIXRhcmdldC5pc1plcm8oKSkgewogICAgICAgIHRhcmdldC5ub3JtYWxpemUoKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBAcGFyYW0gbWluRGlzdCBDbGFtcCBkaXN0YW5jZQogICAgICogQHBhcmFtIHJlc3VsdCBUaGUgYW4gYXJyYXkgb2YgY29udGFjdCBwb2ludCBvYmplY3RzLCBzZWUgY2xpcEZhY2VBZ2FpbnN0SHVsbAogICAgICovCgoKICAgIGNsaXBBZ2FpbnN0SHVsbChwb3NBLCBxdWF0QSwgaHVsbEIsIHBvc0IsIHF1YXRCLCBzZXBhcmF0aW5nTm9ybWFsLCBtaW5EaXN0LCBtYXhEaXN0LCByZXN1bHQpIHsKICAgICAgY29uc3QgV29ybGROb3JtYWwgPSBuZXcgVmVjMygpOwogICAgICBsZXQgY2xvc2VzdEZhY2VCID0gLTE7CiAgICAgIGxldCBkbWF4ID0gLU51bWJlci5NQVhfVkFMVUU7CgogICAgICBmb3IgKGxldCBmYWNlID0gMDsgZmFjZSA8IGh1bGxCLmZhY2VzLmxlbmd0aDsgZmFjZSsrKSB7CiAgICAgICAgV29ybGROb3JtYWwuY29weShodWxsQi5mYWNlTm9ybWFsc1tmYWNlXSk7CiAgICAgICAgcXVhdEIudm11bHQoV29ybGROb3JtYWwsIFdvcmxkTm9ybWFsKTsKICAgICAgICBjb25zdCBkID0gV29ybGROb3JtYWwuZG90KHNlcGFyYXRpbmdOb3JtYWwpOwoKICAgICAgICBpZiAoZCA+IGRtYXgpIHsKICAgICAgICAgIGRtYXggPSBkOwogICAgICAgICAgY2xvc2VzdEZhY2VCID0gZmFjZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IHdvcmxkVmVydHNCMSA9IFtdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBodWxsQi5mYWNlc1tjbG9zZXN0RmFjZUJdLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgYiA9IGh1bGxCLnZlcnRpY2VzW2h1bGxCLmZhY2VzW2Nsb3Nlc3RGYWNlQl1baV1dOwogICAgICAgIGNvbnN0IHdvcmxkYiA9IG5ldyBWZWMzKCk7CiAgICAgICAgd29ybGRiLmNvcHkoYik7CiAgICAgICAgcXVhdEIudm11bHQod29ybGRiLCB3b3JsZGIpOwogICAgICAgIHBvc0IudmFkZCh3b3JsZGIsIHdvcmxkYik7CiAgICAgICAgd29ybGRWZXJ0c0IxLnB1c2god29ybGRiKTsKICAgICAgfQoKICAgICAgaWYgKGNsb3Nlc3RGYWNlQiA+PSAwKSB7CiAgICAgICAgdGhpcy5jbGlwRmFjZUFnYWluc3RIdWxsKHNlcGFyYXRpbmdOb3JtYWwsIHBvc0EsIHF1YXRBLCB3b3JsZFZlcnRzQjEsIG1pbkRpc3QsIG1heERpc3QsIHJlc3VsdCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogRmluZCB0aGUgc2VwYXJhdGluZyBheGlzIGJldHdlZW4gdGhpcyBodWxsIGFuZCBhbm90aGVyCiAgICAgKiBAcGFyYW0gdGFyZ2V0IFRoZSB0YXJnZXQgdmVjdG9yIHRvIHNhdmUgdGhlIGF4aXMgaW4KICAgICAqIEByZXR1cm4gUmV0dXJucyBmYWxzZSBpZiBhIHNlcGFyYXRpb24gaXMgZm91bmQsIGVsc2UgdHJ1ZQogICAgICovCgoKICAgIGZpbmRTZXBhcmF0aW5nQXhpcyhodWxsQiwgcG9zQSwgcXVhdEEsIHBvc0IsIHF1YXRCLCB0YXJnZXQsIGZhY2VMaXN0QSwgZmFjZUxpc3RCKSB7CiAgICAgIGNvbnN0IGZhY2VBTm9ybWFsV1MzID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgV29ybGRub3JtYWwxID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgZGVsdGFDID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3Qgd29ybGRFZGdlMCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHdvcmxkRWRnZTEgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBDcm9zcyA9IG5ldyBWZWMzKCk7CiAgICAgIGxldCBkbWluID0gTnVtYmVyLk1BWF9WQUxVRTsKICAgICAgY29uc3QgaHVsbEEgPSB0aGlzOwoKICAgICAgaWYgKCFodWxsQS51bmlxdWVBeGVzKSB7CiAgICAgICAgY29uc3QgbnVtRmFjZXNBID0gZmFjZUxpc3RBID8gZmFjZUxpc3RBLmxlbmd0aCA6IGh1bGxBLmZhY2VzLmxlbmd0aDsgLy8gVGVzdCBmYWNlIG5vcm1hbHMgZnJvbSBodWxsQQoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUZhY2VzQTsgaSsrKSB7CiAgICAgICAgICBjb25zdCBmaSA9IGZhY2VMaXN0QSA/IGZhY2VMaXN0QVtpXSA6IGk7IC8vIEdldCB3b3JsZCBmYWNlIG5vcm1hbAoKICAgICAgICAgIGZhY2VBTm9ybWFsV1MzLmNvcHkoaHVsbEEuZmFjZU5vcm1hbHNbZmldKTsKICAgICAgICAgIHF1YXRBLnZtdWx0KGZhY2VBTm9ybWFsV1MzLCBmYWNlQU5vcm1hbFdTMyk7CiAgICAgICAgICBjb25zdCBkID0gaHVsbEEudGVzdFNlcEF4aXMoZmFjZUFOb3JtYWxXUzMsIGh1bGxCLCBwb3NBLCBxdWF0QSwgcG9zQiwgcXVhdEIpOwoKICAgICAgICAgIGlmIChkID09PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGQgPCBkbWluKSB7CiAgICAgICAgICAgIGRtaW4gPSBkOwogICAgICAgICAgICB0YXJnZXQuY29weShmYWNlQU5vcm1hbFdTMyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRlc3QgdW5pcXVlIGF4ZXMKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gaHVsbEEudW5pcXVlQXhlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgLy8gR2V0IHdvcmxkIGF4aXMKICAgICAgICAgIHF1YXRBLnZtdWx0KGh1bGxBLnVuaXF1ZUF4ZXNbaV0sIGZhY2VBTm9ybWFsV1MzKTsKICAgICAgICAgIGNvbnN0IGQgPSBodWxsQS50ZXN0U2VwQXhpcyhmYWNlQU5vcm1hbFdTMywgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KGZhY2VBTm9ybWFsV1MzKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICghaHVsbEIudW5pcXVlQXhlcykgewogICAgICAgIC8vIFRlc3QgZmFjZSBub3JtYWxzIGZyb20gaHVsbEIKICAgICAgICBjb25zdCBudW1GYWNlc0IgPSBmYWNlTGlzdEIgPyBmYWNlTGlzdEIubGVuZ3RoIDogaHVsbEIuZmFjZXMubGVuZ3RoOwoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUZhY2VzQjsgaSsrKSB7CiAgICAgICAgICBjb25zdCBmaSA9IGZhY2VMaXN0QiA/IGZhY2VMaXN0QltpXSA6IGk7CiAgICAgICAgICBXb3JsZG5vcm1hbDEuY29weShodWxsQi5mYWNlTm9ybWFsc1tmaV0pOwogICAgICAgICAgcXVhdEIudm11bHQoV29ybGRub3JtYWwxLCBXb3JsZG5vcm1hbDEpOwogICAgICAgICAgY29uc3QgZCA9IGh1bGxBLnRlc3RTZXBBeGlzKFdvcmxkbm9ybWFsMSwgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KFdvcmxkbm9ybWFsMSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRlc3QgdW5pcXVlIGF4ZXMgaW4gQgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBodWxsQi51bmlxdWVBeGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBxdWF0Qi52bXVsdChodWxsQi51bmlxdWVBeGVzW2ldLCBXb3JsZG5vcm1hbDEpOwogICAgICAgICAgY29uc3QgZCA9IGh1bGxBLnRlc3RTZXBBeGlzKFdvcmxkbm9ybWFsMSwgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KFdvcmxkbm9ybWFsMSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIFRlc3QgZWRnZXMKCgogICAgICBmb3IgKGxldCBlMCA9IDA7IGUwICE9PSBodWxsQS51bmlxdWVFZGdlcy5sZW5ndGg7IGUwKyspIHsKICAgICAgICAvLyBHZXQgd29ybGQgZWRnZQogICAgICAgIHF1YXRBLnZtdWx0KGh1bGxBLnVuaXF1ZUVkZ2VzW2UwXSwgd29ybGRFZGdlMCk7CgogICAgICAgIGZvciAobGV0IGUxID0gMDsgZTEgIT09IGh1bGxCLnVuaXF1ZUVkZ2VzLmxlbmd0aDsgZTErKykgewogICAgICAgICAgLy8gR2V0IHdvcmxkIGVkZ2UgMgogICAgICAgICAgcXVhdEIudm11bHQoaHVsbEIudW5pcXVlRWRnZXNbZTFdLCB3b3JsZEVkZ2UxKTsKICAgICAgICAgIHdvcmxkRWRnZTAuY3Jvc3Mod29ybGRFZGdlMSwgQ3Jvc3MpOwoKICAgICAgICAgIGlmICghQ3Jvc3MuYWxtb3N0WmVybygpKSB7CiAgICAgICAgICAgIENyb3NzLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICBjb25zdCBkaXN0ID0gaHVsbEEudGVzdFNlcEF4aXMoQ3Jvc3MsIGh1bGxCLCBwb3NBLCBxdWF0QSwgcG9zQiwgcXVhdEIpOwoKICAgICAgICAgICAgaWYgKGRpc3QgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZGlzdCA8IGRtaW4pIHsKICAgICAgICAgICAgICBkbWluID0gZGlzdDsKICAgICAgICAgICAgICB0YXJnZXQuY29weShDcm9zcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHBvc0IudnN1Yihwb3NBLCBkZWx0YUMpOwoKICAgICAgaWYgKGRlbHRhQy5kb3QodGFyZ2V0KSA+IDAuMCkgewogICAgICAgIHRhcmdldC5uZWdhdGUodGFyZ2V0KTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIFRlc3Qgc2VwYXJhdGluZyBheGlzIGFnYWluc3QgdHdvIGh1bGxzLiBCb3RoIGh1bGxzIGFyZSBwcm9qZWN0ZWQgb250byB0aGUgYXhpcyBhbmQgdGhlIG92ZXJsYXAgc2l6ZSBpcyByZXR1cm5lZCBpZiB0aGVyZSBpcyBvbmUuCiAgICAgKiBAcmV0dXJuIFRoZSBvdmVybGFwIGRlcHRoLCBvciBGQUxTRSBpZiBubyBwZW5ldHJhdGlvbi4KICAgICAqLwoKCiAgICB0ZXN0U2VwQXhpcyhheGlzLCBodWxsQiwgcG9zQSwgcXVhdEEsIHBvc0IsIHF1YXRCKSB7CiAgICAgIGNvbnN0IGh1bGxBID0gdGhpczsKICAgICAgQ29udmV4UG9seWhlZHJvbi5wcm9qZWN0KGh1bGxBLCBheGlzLCBwb3NBLCBxdWF0QSwgbWF4bWluQSk7CiAgICAgIENvbnZleFBvbHloZWRyb24ucHJvamVjdChodWxsQiwgYXhpcywgcG9zQiwgcXVhdEIsIG1heG1pbkIpOwogICAgICBjb25zdCBtYXhBID0gbWF4bWluQVswXTsKICAgICAgY29uc3QgbWluQSA9IG1heG1pbkFbMV07CiAgICAgIGNvbnN0IG1heEIgPSBtYXhtaW5CWzBdOwogICAgICBjb25zdCBtaW5CID0gbWF4bWluQlsxXTsKCiAgICAgIGlmIChtYXhBIDwgbWluQiB8fCBtYXhCIDwgbWluQSkgewogICAgICAgIHJldHVybiBmYWxzZTsgLy8gU2VwYXJhdGVkCiAgICAgIH0KCiAgICAgIGNvbnN0IGQwID0gbWF4QSAtIG1pbkI7CiAgICAgIGNvbnN0IGQxID0gbWF4QiAtIG1pbkE7CiAgICAgIGNvbnN0IGRlcHRoID0gZDAgPCBkMSA/IGQwIDogZDE7CiAgICAgIHJldHVybiBkZXB0aDsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlTG9jYWxJbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICAvLyBBcHByb3hpbWF0ZSB3aXRoIGJveCBpbmVydGlhCiAgICAgIC8vIEV4YWN0IGluZXJ0aWEgY2FsY3VsYXRpb24gaXMgb3ZlcmtpbGwsIGJ1dCBzZWUgaHR0cDovL2dlb21ldHJpY3Rvb2xzLmNvbS9Eb2N1bWVudGF0aW9uL1BvbHloZWRyYWxNYXNzUHJvcGVydGllcy5wZGYgZm9yIHRoZSBjb3JyZWN0IHdheSB0byBkbyBpdAogICAgICBjb25zdCBhYWJibWF4ID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgYWFiYm1pbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuY29tcHV0ZUxvY2FsQUFCQihhYWJibWluLCBhYWJibWF4KTsKICAgICAgY29uc3QgeCA9IGFhYmJtYXgueCAtIGFhYmJtaW4ueDsKICAgICAgY29uc3QgeSA9IGFhYmJtYXgueSAtIGFhYmJtaW4ueTsKICAgICAgY29uc3QgeiA9IGFhYmJtYXgueiAtIGFhYmJtaW4uejsKICAgICAgdGFyZ2V0LnggPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogeSAqIDIgKiB5ICsgMiAqIHogKiAyICogeik7CiAgICAgIHRhcmdldC55ID0gMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIHggKiAyICogeCArIDIgKiB6ICogMiAqIHopOwogICAgICB0YXJnZXQueiA9IDEuMCAvIDEyLjAgKiBtYXNzICogKDIgKiB5ICogMiAqIHkgKyAyICogeCAqIDIgKiB4KTsKICAgIH0KICAgIC8qKgogICAgICogQHBhcmFtIGZhY2VfaSBJbmRleCBvZiB0aGUgZmFjZQogICAgICovCgoKICAgIGdldFBsYW5lQ29uc3RhbnRPZkZhY2UoZmFjZV9pKSB7CiAgICAgIGNvbnN0IGYgPSB0aGlzLmZhY2VzW2ZhY2VfaV07CiAgICAgIGNvbnN0IG4gPSB0aGlzLmZhY2VOb3JtYWxzW2ZhY2VfaV07CiAgICAgIGNvbnN0IHYgPSB0aGlzLnZlcnRpY2VzW2ZbMF1dOwogICAgICBjb25zdCBjID0gLW4uZG90KHYpOwogICAgICByZXR1cm4gYzsKICAgIH0KICAgIC8qKgogICAgICogQ2xpcCBhIGZhY2UgYWdhaW5zdCBhIGh1bGwuCiAgICAgKiBAcGFyYW0gd29ybGRWZXJ0c0IxIEFuIGFycmF5IG9mIFZlYzMgd2l0aCB2ZXJ0aWNlcyBpbiB0aGUgd29ybGQgZnJhbWUuCiAgICAgKiBAcGFyYW0gbWluRGlzdCBEaXN0YW5jZSBjbGFtcGluZwogICAgICogQHBhcmFtIEFycmF5IHJlc3VsdCBBcnJheSB0byBzdG9yZSByZXN1bHRpbmcgY29udGFjdCBwb2ludHMgaW4uIFdpbGwgYmUgb2JqZWN0cyB3aXRoIHByb3BlcnRpZXM6IHBvaW50LCBkZXB0aCwgbm9ybWFsLiBUaGVzZSBhcmUgcmVwcmVzZW50ZWQgaW4gd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKi8KCgogICAgY2xpcEZhY2VBZ2FpbnN0SHVsbChzZXBhcmF0aW5nTm9ybWFsLCBwb3NBLCBxdWF0QSwgd29ybGRWZXJ0c0IxLCBtaW5EaXN0LCBtYXhEaXN0LCByZXN1bHQpIHsKICAgICAgY29uc3QgZmFjZUFOb3JtYWxXUyA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGVkZ2UwID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgV29ybGRFZGdlMCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHdvcmxkUGxhbmVBbm9ybWFsMSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHBsYW5lTm9ybWFsV1MxID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3Qgd29ybGRBMSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGxvY2FsUGxhbmVOb3JtYWwgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBwbGFuZU5vcm1hbFdTID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgaHVsbEEgPSB0aGlzOwogICAgICBjb25zdCB3b3JsZFZlcnRzQjIgPSBbXTsKICAgICAgY29uc3QgcFZ0eEluID0gd29ybGRWZXJ0c0IxOwogICAgICBjb25zdCBwVnR4T3V0ID0gd29ybGRWZXJ0c0IyOwogICAgICBsZXQgY2xvc2VzdEZhY2VBID0gLTE7CiAgICAgIGxldCBkbWluID0gTnVtYmVyLk1BWF9WQUxVRTsgLy8gRmluZCB0aGUgZmFjZSB3aXRoIG5vcm1hbCBjbG9zZXN0IHRvIHRoZSBzZXBhcmF0aW5nIGF4aXMKCiAgICAgIGZvciAobGV0IGZhY2UgPSAwOyBmYWNlIDwgaHVsbEEuZmFjZXMubGVuZ3RoOyBmYWNlKyspIHsKICAgICAgICBmYWNlQU5vcm1hbFdTLmNvcHkoaHVsbEEuZmFjZU5vcm1hbHNbZmFjZV0pOwogICAgICAgIHF1YXRBLnZtdWx0KGZhY2VBTm9ybWFsV1MsIGZhY2VBTm9ybWFsV1MpOwogICAgICAgIGNvbnN0IGQgPSBmYWNlQU5vcm1hbFdTLmRvdChzZXBhcmF0aW5nTm9ybWFsKTsKCiAgICAgICAgaWYgKGQgPCBkbWluKSB7CiAgICAgICAgICBkbWluID0gZDsKICAgICAgICAgIGNsb3Nlc3RGYWNlQSA9IGZhY2U7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoY2xvc2VzdEZhY2VBIDwgMCkgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBHZXQgdGhlIGZhY2UgYW5kIGNvbnN0cnVjdCBjb25uZWN0ZWQgZmFjZXMKCgogICAgICBjb25zdCBwb2x5QSA9IGh1bGxBLmZhY2VzW2Nsb3Nlc3RGYWNlQV07CiAgICAgIHBvbHlBLmNvbm5lY3RlZEZhY2VzID0gW107CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGh1bGxBLmZhY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBodWxsQS5mYWNlc1tpXS5sZW5ndGg7IGorKykgewogICAgICAgICAgaWYgKAogICAgICAgICAgLyogU2hhcmluZyBhIHZlcnRleCovCiAgICAgICAgICBwb2x5QS5pbmRleE9mKGh1bGxBLmZhY2VzW2ldW2pdKSAhPT0gLTEgJiYKICAgICAgICAgIC8qIE5vdCB0aGUgb25lIHdlIGFyZSBsb29raW5nIGZvciBjb25uZWN0aW9ucyBmcm9tICovCiAgICAgICAgICBpICE9PSBjbG9zZXN0RmFjZUEgJiYKICAgICAgICAgIC8qIE5vdCBhbHJlYWR5IGFkZGVkICovCiAgICAgICAgICBwb2x5QS5jb25uZWN0ZWRGYWNlcy5pbmRleE9mKGkpID09PSAtMSkgewogICAgICAgICAgICBwb2x5QS5jb25uZWN0ZWRGYWNlcy5wdXNoKGkpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvLyBDbGlwIHRoZSBwb2x5Z29uIHRvIHRoZSBiYWNrIG9mIHRoZSBwbGFuZXMgb2YgYWxsIGZhY2VzIG9mIGh1bGwgQSwKICAgICAgLy8gdGhhdCBhcmUgYWRqYWNlbnQgdG8gdGhlIHdpdG5lc3MgZmFjZQoKCiAgICAgIGNvbnN0IG51bVZlcnRpY2VzQSA9IHBvbHlBLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtVmVydGljZXNBOyBpKyspIHsKICAgICAgICBjb25zdCBhID0gaHVsbEEudmVydGljZXNbcG9seUFbaV1dOwogICAgICAgIGNvbnN0IGIgPSBodWxsQS52ZXJ0aWNlc1twb2x5QVsoaSArIDEpICUgbnVtVmVydGljZXNBXV07CiAgICAgICAgYS52c3ViKGIsIGVkZ2UwKTsKICAgICAgICBXb3JsZEVkZ2UwLmNvcHkoZWRnZTApOwogICAgICAgIHF1YXRBLnZtdWx0KFdvcmxkRWRnZTAsIFdvcmxkRWRnZTApOwogICAgICAgIHBvc0EudmFkZChXb3JsZEVkZ2UwLCBXb3JsZEVkZ2UwKTsKICAgICAgICB3b3JsZFBsYW5lQW5vcm1hbDEuY29weSh0aGlzLmZhY2VOb3JtYWxzW2Nsb3Nlc3RGYWNlQV0pOwogICAgICAgIHF1YXRBLnZtdWx0KHdvcmxkUGxhbmVBbm9ybWFsMSwgd29ybGRQbGFuZUFub3JtYWwxKTsKICAgICAgICBwb3NBLnZhZGQod29ybGRQbGFuZUFub3JtYWwxLCB3b3JsZFBsYW5lQW5vcm1hbDEpOwogICAgICAgIFdvcmxkRWRnZTAuY3Jvc3Mod29ybGRQbGFuZUFub3JtYWwxLCBwbGFuZU5vcm1hbFdTMSk7CiAgICAgICAgcGxhbmVOb3JtYWxXUzEubmVnYXRlKHBsYW5lTm9ybWFsV1MxKTsKICAgICAgICB3b3JsZEExLmNvcHkoYSk7CiAgICAgICAgcXVhdEEudm11bHQod29ybGRBMSwgd29ybGRBMSk7CiAgICAgICAgcG9zQS52YWRkKHdvcmxkQTEsIHdvcmxkQTEpOwogICAgICAgIGNvbnN0IG90aGVyRmFjZSA9IHBvbHlBLmNvbm5lY3RlZEZhY2VzW2ldOwogICAgICAgIGxvY2FsUGxhbmVOb3JtYWwuY29weSh0aGlzLmZhY2VOb3JtYWxzW290aGVyRmFjZV0pOwogICAgICAgIGNvbnN0IGxvY2FsUGxhbmVFcSA9IHRoaXMuZ2V0UGxhbmVDb25zdGFudE9mRmFjZShvdGhlckZhY2UpOwogICAgICAgIHBsYW5lTm9ybWFsV1MuY29weShsb2NhbFBsYW5lTm9ybWFsKTsKICAgICAgICBxdWF0QS52bXVsdChwbGFuZU5vcm1hbFdTLCBwbGFuZU5vcm1hbFdTKTsKICAgICAgICBjb25zdCBwbGFuZUVxV1MgPSBsb2NhbFBsYW5lRXEgLSBwbGFuZU5vcm1hbFdTLmRvdChwb3NBKTsgLy8gQ2xpcCBmYWNlIGFnYWluc3Qgb3VyIGNvbnN0cnVjdGVkIHBsYW5lCgogICAgICAgIHRoaXMuY2xpcEZhY2VBZ2FpbnN0UGxhbmUocFZ0eEluLCBwVnR4T3V0LCBwbGFuZU5vcm1hbFdTLCBwbGFuZUVxV1MpOyAvLyBUaHJvdyBhd2F5IGFsbCBjbGlwcGVkIHBvaW50cywgYnV0IHNhdmUgdGhlIHJlbWFpbmluZyB1bnRpbCBuZXh0IGNsaXAKCiAgICAgICAgd2hpbGUgKHBWdHhJbi5sZW5ndGgpIHsKICAgICAgICAgIHBWdHhJbi5zaGlmdCgpOwogICAgICAgIH0KCiAgICAgICAgd2hpbGUgKHBWdHhPdXQubGVuZ3RoKSB7CiAgICAgICAgICBwVnR4SW4ucHVzaChwVnR4T3V0LnNoaWZ0KCkpOwogICAgICAgIH0KICAgICAgfSAvLyBvbmx5IGtlZXAgY29udGFjdCBwb2ludHMgdGhhdCBhcmUgYmVoaW5kIHRoZSB3aXRuZXNzIGZhY2UKCgogICAgICBsb2NhbFBsYW5lTm9ybWFsLmNvcHkodGhpcy5mYWNlTm9ybWFsc1tjbG9zZXN0RmFjZUFdKTsKICAgICAgY29uc3QgbG9jYWxQbGFuZUVxID0gdGhpcy5nZXRQbGFuZUNvbnN0YW50T2ZGYWNlKGNsb3Nlc3RGYWNlQSk7CiAgICAgIHBsYW5lTm9ybWFsV1MuY29weShsb2NhbFBsYW5lTm9ybWFsKTsKICAgICAgcXVhdEEudm11bHQocGxhbmVOb3JtYWxXUywgcGxhbmVOb3JtYWxXUyk7CiAgICAgIGNvbnN0IHBsYW5lRXFXUyA9IGxvY2FsUGxhbmVFcSAtIHBsYW5lTm9ybWFsV1MuZG90KHBvc0EpOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwVnR4SW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICBsZXQgZGVwdGggPSBwbGFuZU5vcm1hbFdTLmRvdChwVnR4SW5baV0pICsgcGxhbmVFcVdTOyAvLyA/Pz8KCiAgICAgICAgaWYgKGRlcHRoIDw9IG1pbkRpc3QpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKGBjbGFtcGVkOiBkZXB0aD0ke2RlcHRofSB0byBtaW5EaXN0PSR7bWluRGlzdH1gKTsKICAgICAgICAgIGRlcHRoID0gbWluRGlzdDsKICAgICAgICB9CgogICAgICAgIGlmIChkZXB0aCA8PSBtYXhEaXN0KSB7CiAgICAgICAgICBjb25zdCBwb2ludCA9IHBWdHhJbltpXTsKCiAgICAgICAgICBpZiAoZGVwdGggPD0gMWUtNikgewogICAgICAgICAgICBjb25zdCBwID0gewogICAgICAgICAgICAgIHBvaW50LAogICAgICAgICAgICAgIG5vcm1hbDogcGxhbmVOb3JtYWxXUywKICAgICAgICAgICAgICBkZXB0aAogICAgICAgICAgICB9OwogICAgICAgICAgICByZXN1bHQucHVzaChwKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2xpcCBhIGZhY2UgaW4gYSBodWxsIGFnYWluc3QgdGhlIGJhY2sgb2YgYSBwbGFuZS4KICAgICAqIEBwYXJhbSBwbGFuZUNvbnN0YW50IFRoZSBjb25zdGFudCBpbiB0aGUgbWF0aGVtYXRpY2FsIHBsYW5lIGVxdWF0aW9uCiAgICAgKi8KCgogICAgY2xpcEZhY2VBZ2FpbnN0UGxhbmUoaW5WZXJ0aWNlcywgb3V0VmVydGljZXMsIHBsYW5lTm9ybWFsLCBwbGFuZUNvbnN0YW50KSB7CiAgICAgIGxldCBuX2RvdF9maXJzdDsKICAgICAgbGV0IG5fZG90X2xhc3Q7CiAgICAgIGNvbnN0IG51bVZlcnRzID0gaW5WZXJ0aWNlcy5sZW5ndGg7CgogICAgICBpZiAobnVtVmVydHMgPCAyKSB7CiAgICAgICAgcmV0dXJuIG91dFZlcnRpY2VzOwogICAgICB9CgogICAgICBsZXQgZmlyc3RWZXJ0ZXggPSBpblZlcnRpY2VzW2luVmVydGljZXMubGVuZ3RoIC0gMV07CiAgICAgIGxldCBsYXN0VmVydGV4ID0gaW5WZXJ0aWNlc1swXTsKICAgICAgbl9kb3RfZmlyc3QgPSBwbGFuZU5vcm1hbC5kb3QoZmlyc3RWZXJ0ZXgpICsgcGxhbmVDb25zdGFudDsKCiAgICAgIGZvciAobGV0IHZpID0gMDsgdmkgPCBudW1WZXJ0czsgdmkrKykgewogICAgICAgIGxhc3RWZXJ0ZXggPSBpblZlcnRpY2VzW3ZpXTsKICAgICAgICBuX2RvdF9sYXN0ID0gcGxhbmVOb3JtYWwuZG90KGxhc3RWZXJ0ZXgpICsgcGxhbmVDb25zdGFudDsKCiAgICAgICAgaWYgKG5fZG90X2ZpcnN0IDwgMCkgewogICAgICAgICAgaWYgKG5fZG90X2xhc3QgPCAwKSB7CiAgICAgICAgICAgIC8vIFN0YXJ0IDwgMCwgZW5kIDwgMCwgc28gb3V0cHV0IGxhc3RWZXJ0ZXgKICAgICAgICAgICAgY29uc3QgbmV3diA9IG5ldyBWZWMzKCk7CiAgICAgICAgICAgIG5ld3YuY29weShsYXN0VmVydGV4KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChuZXd2KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIFN0YXJ0IDwgMCwgZW5kID49IDAsIHNvIG91dHB1dCBpbnRlcnNlY3Rpb24KICAgICAgICAgICAgY29uc3QgbmV3diA9IG5ldyBWZWMzKCk7CiAgICAgICAgICAgIGZpcnN0VmVydGV4LmxlcnAobGFzdFZlcnRleCwgbl9kb3RfZmlyc3QgLyAobl9kb3RfZmlyc3QgLSBuX2RvdF9sYXN0KSwgbmV3dik7CiAgICAgICAgICAgIG91dFZlcnRpY2VzLnB1c2gobmV3dik7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChuX2RvdF9sYXN0IDwgMCkgewogICAgICAgICAgICAvLyBTdGFydCA+PSAwLCBlbmQgPCAwIHNvIG91dHB1dCBpbnRlcnNlY3Rpb24gYW5kIGVuZAogICAgICAgICAgICBjb25zdCBuZXd2ID0gbmV3IFZlYzMoKTsKICAgICAgICAgICAgZmlyc3RWZXJ0ZXgubGVycChsYXN0VmVydGV4LCBuX2RvdF9maXJzdCAvIChuX2RvdF9maXJzdCAtIG5fZG90X2xhc3QpLCBuZXd2KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChuZXd2KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChsYXN0VmVydGV4KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZpcnN0VmVydGV4ID0gbGFzdFZlcnRleDsKICAgICAgICBuX2RvdF9maXJzdCA9IG5fZG90X2xhc3Q7CiAgICAgIH0KCiAgICAgIHJldHVybiBvdXRWZXJ0aWNlczsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyBgLndvcmxkVmVydGljZXNgIGFuZCBzZXRzIGAud29ybGRWZXJ0aWNlc05lZWRzVXBkYXRlYCB0byBmYWxzZS4KICAgICAqLwoKCiAgICBjb21wdXRlV29ybGRWZXJ0aWNlcyhwb3NpdGlvbiwgcXVhdCkgewogICAgICB3aGlsZSAodGhpcy53b3JsZFZlcnRpY2VzLmxlbmd0aCA8IHRoaXMudmVydGljZXMubGVuZ3RoKSB7CiAgICAgICAgdGhpcy53b3JsZFZlcnRpY2VzLnB1c2gobmV3IFZlYzMoKSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsKICAgICAgY29uc3Qgd29ybGRWZXJ0cyA9IHRoaXMud29ybGRWZXJ0aWNlczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSB0aGlzLnZlcnRpY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgcXVhdC52bXVsdCh2ZXJ0c1tpXSwgd29ybGRWZXJ0c1tpXSk7CiAgICAgICAgcG9zaXRpb24udmFkZCh3b3JsZFZlcnRzW2ldLCB3b3JsZFZlcnRzW2ldKTsKICAgICAgfQoKICAgICAgdGhpcy53b3JsZFZlcnRpY2VzTmVlZHNVcGRhdGUgPSBmYWxzZTsKICAgIH0KCiAgICBjb21wdXRlTG9jYWxBQUJCKGFhYmJtaW4sIGFhYmJtYXgpIHsKICAgICAgY29uc3QgdmVydGljZXMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBhYWJibWluLnNldChOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFKTsKICAgICAgYWFiYm1heC5zZXQoLU51bWJlci5NQVhfVkFMVUUsIC1OdW1iZXIuTUFYX1ZBTFVFLCAtTnVtYmVyLk1BWF9WQUxVRSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMudmVydGljZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gdmVydGljZXNbaV07CgogICAgICAgIGlmICh2LnggPCBhYWJibWluLngpIHsKICAgICAgICAgIGFhYmJtaW4ueCA9IHYueDsKICAgICAgICB9IGVsc2UgaWYgKHYueCA+IGFhYmJtYXgueCkgewogICAgICAgICAgYWFiYm1heC54ID0gdi54OwogICAgICAgIH0KCiAgICAgICAgaWYgKHYueSA8IGFhYmJtaW4ueSkgewogICAgICAgICAgYWFiYm1pbi55ID0gdi55OwogICAgICAgIH0gZWxzZSBpZiAodi55ID4gYWFiYm1heC55KSB7CiAgICAgICAgICBhYWJibWF4LnkgPSB2Lnk7CiAgICAgICAgfQoKICAgICAgICBpZiAodi56IDwgYWFiYm1pbi56KSB7CiAgICAgICAgICBhYWJibWluLnogPSB2Lno7CiAgICAgICAgfSBlbHNlIGlmICh2LnogPiBhYWJibWF4LnopIHsKICAgICAgICAgIGFhYmJtYXgueiA9IHYuejsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyBgd29ybGRWZXJ0aWNlc2AgYW5kIHNldHMgYHdvcmxkVmVydGljZXNOZWVkc1VwZGF0ZWAgdG8gZmFsc2UuCiAgICAgKi8KCgogICAgY29tcHV0ZVdvcmxkRmFjZU5vcm1hbHMocXVhdCkgewogICAgICBjb25zdCBOID0gdGhpcy5mYWNlTm9ybWFscy5sZW5ndGg7CgogICAgICB3aGlsZSAodGhpcy53b3JsZEZhY2VOb3JtYWxzLmxlbmd0aCA8IE4pIHsKICAgICAgICB0aGlzLndvcmxkRmFjZU5vcm1hbHMucHVzaChuZXcgVmVjMygpKTsKICAgICAgfQoKICAgICAgY29uc3Qgbm9ybWFscyA9IHRoaXMuZmFjZU5vcm1hbHM7CiAgICAgIGNvbnN0IHdvcmxkTm9ybWFscyA9IHRoaXMud29ybGRGYWNlTm9ybWFsczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBxdWF0LnZtdWx0KG5vcm1hbHNbaV0sIHdvcmxkTm9ybWFsc1tpXSk7CiAgICAgIH0KCiAgICAgIHRoaXMud29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIC8vIEFzc3VtZSBwb2ludHMgYXJlIGRpc3RyaWJ1dGVkIHdpdGggbG9jYWwgKDAsMCwwKSBhcyBjZW50ZXIKICAgICAgbGV0IG1heDIgPSAwOwogICAgICBjb25zdCB2ZXJ0cyA9IHRoaXMudmVydGljZXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBub3JtMiA9IHZlcnRzW2ldLmxlbmd0aFNxdWFyZWQoKTsKCiAgICAgICAgaWYgKG5vcm0yID4gbWF4MikgewogICAgICAgICAgbWF4MiA9IG5vcm0yOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IE1hdGguc3FydChtYXgyKTsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlV29ybGRBQUJCCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgY29uc3QgdmVydHMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBsZXQgbWlueDsKICAgICAgbGV0IG1pbnk7CiAgICAgIGxldCBtaW56OwogICAgICBsZXQgbWF4eDsKICAgICAgbGV0IG1heHk7CiAgICAgIGxldCBtYXh6OwogICAgICBsZXQgdGVtcFdvcmxkVmVydGV4ID0gbmV3IFZlYzMoKTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICB0ZW1wV29ybGRWZXJ0ZXguY29weSh2ZXJ0c1tpXSk7CiAgICAgICAgcXVhdC52bXVsdCh0ZW1wV29ybGRWZXJ0ZXgsIHRlbXBXb3JsZFZlcnRleCk7CiAgICAgICAgcG9zLnZhZGQodGVtcFdvcmxkVmVydGV4LCB0ZW1wV29ybGRWZXJ0ZXgpOwogICAgICAgIGNvbnN0IHYgPSB0ZW1wV29ybGRWZXJ0ZXg7CgogICAgICAgIGlmIChtaW54ID09PSB1bmRlZmluZWQgfHwgdi54IDwgbWlueCkgewogICAgICAgICAgbWlueCA9IHYueDsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh4ID09PSB1bmRlZmluZWQgfHwgdi54ID4gbWF4eCkgewogICAgICAgICAgbWF4eCA9IHYueDsKICAgICAgICB9CgogICAgICAgIGlmIChtaW55ID09PSB1bmRlZmluZWQgfHwgdi55IDwgbWlueSkgewogICAgICAgICAgbWlueSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh5ID09PSB1bmRlZmluZWQgfHwgdi55ID4gbWF4eSkgewogICAgICAgICAgbWF4eSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmIChtaW56ID09PSB1bmRlZmluZWQgfHwgdi56IDwgbWlueikgewogICAgICAgICAgbWlueiA9IHYuejsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh6ID09PSB1bmRlZmluZWQgfHwgdi56ID4gbWF4eikgewogICAgICAgICAgbWF4eiA9IHYuejsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIG1pbi5zZXQobWlueCwgbWlueSwgbWlueik7CiAgICAgIG1heC5zZXQobWF4eCwgbWF4eSwgbWF4eik7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhcHByb3hpbWF0ZSBjb252ZXggdm9sdW1lCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICByZXR1cm4gNC4wICogTWF0aC5QSSAqIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgLyAzLjA7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBhdmVyYWdlIG9mIGFsbCB0aGUgdmVydGljZXMgcG9zaXRpb25zCiAgICAgKi8KCgogICAgZ2V0QXZlcmFnZVBvaW50TG9jYWwodGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICB0YXJnZXQudmFkZCh2ZXJ0c1tpXSwgdGFyZ2V0KTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnNjYWxlKDEgLyB2ZXJ0cy5sZW5ndGgsIHRhcmdldCk7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIFRyYW5zZm9ybSBhbGwgbG9jYWwgcG9pbnRzLiBXaWxsIGNoYW5nZSB0aGUgLnZlcnRpY2VzCiAgICAgKi8KCgogICAgdHJhbnNmb3JtQWxsUG9pbnRzKG9mZnNldCwgcXVhdCkgewogICAgICBjb25zdCBuID0gdGhpcy52ZXJ0aWNlcy5sZW5ndGg7CiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsgLy8gQXBwbHkgcm90YXRpb24KCiAgICAgIGlmIChxdWF0KSB7CiAgICAgICAgLy8gUm90YXRlIHZlcnRpY2VzCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHYgPSB2ZXJ0c1tpXTsKICAgICAgICAgIHF1YXQudm11bHQodiwgdik7CiAgICAgICAgfSAvLyBSb3RhdGUgZmFjZSBub3JtYWxzCgoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZU5vcm1hbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHYgPSB0aGlzLmZhY2VOb3JtYWxzW2ldOwogICAgICAgICAgcXVhdC52bXVsdCh2LCB2KTsKICAgICAgICB9CiAgICAgICAgLyoKICAgICAgICAgICAgICAvLyBSb3RhdGUgZWRnZXMKICAgICAgICAgICAgICBmb3IobGV0IGk9MDsgaTx0aGlzLnVuaXF1ZUVkZ2VzLmxlbmd0aDsgaSsrKXsKICAgICAgICAgICAgICAgICAgY29uc3QgdiA9IHRoaXMudW5pcXVlRWRnZXNbaV07CiAgICAgICAgICAgICAgICAgIHF1YXQudm11bHQodix2KTsKICAgICAgICAgICAgICB9Ki8KCiAgICAgIH0gLy8gQXBwbHkgb2Zmc2V0CgoKICAgICAgaWYgKG9mZnNldCkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgICBjb25zdCB2ID0gdmVydHNbaV07CiAgICAgICAgICB2LnZhZGQob2Zmc2V0LCB2KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2hlY2tzIHdoZXRoZXIgcCBpcyBpbnNpZGUgdGhlIHBvbHloZWRyYS4gTXVzdCBiZSBpbiBsb2NhbCBjb29yZHMuCiAgICAgKiBUaGUgcG9pbnQgbGllcyBvdXRzaWRlIG9mIHRoZSBjb252ZXggaHVsbCBvZiB0aGUgb3RoZXIgcG9pbnRzIGlmIGFuZCBvbmx5IGlmIHRoZSBkaXJlY3Rpb24KICAgICAqIG9mIGFsbCB0aGUgdmVjdG9ycyBmcm9tIGl0IHRvIHRob3NlIG90aGVyIHBvaW50cyBhcmUgb24gbGVzcyB0aGFuIG9uZSBoYWxmIG9mIGEgc3BoZXJlIGFyb3VuZCBpdC4KICAgICAqIEBwYXJhbSBwIEEgcG9pbnQgZ2l2ZW4gaW4gbG9jYWwgY29vcmRpbmF0ZXMKICAgICAqLwoKCiAgICBwb2ludElzSW5zaWRlKHApIHsKICAgICAgY29uc3QgdmVydHMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBjb25zdCBmYWNlcyA9IHRoaXMuZmFjZXM7CiAgICAgIGNvbnN0IG5vcm1hbHMgPSB0aGlzLmZhY2VOb3JtYWxzOwogICAgICBjb25zdCBwb3NpdGl2ZVJlc3VsdCA9IG51bGw7CiAgICAgIGNvbnN0IHBvaW50SW5zaWRlID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5nZXRBdmVyYWdlUG9pbnRMb2NhbChwb2ludEluc2lkZSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBsZXQgbiA9IG5vcm1hbHNbaV07CiAgICAgICAgY29uc3QgdiA9IHZlcnRzW2ZhY2VzW2ldWzBdXTsgLy8gV2Ugb25seSBuZWVkIG9uZSBwb2ludCBpbiB0aGUgZmFjZQogICAgICAgIC8vIFRoaXMgZG90IHByb2R1Y3QgZGV0ZXJtaW5lcyB3aGljaCBzaWRlIG9mIHRoZSBlZGdlIHRoZSBwb2ludCBpcwoKICAgICAgICBjb25zdCB2VG9QID0gbmV3IFZlYzMoKTsKICAgICAgICBwLnZzdWIodiwgdlRvUCk7CiAgICAgICAgY29uc3QgcjEgPSBuLmRvdCh2VG9QKTsKICAgICAgICBjb25zdCB2VG9Qb2ludEluc2lkZSA9IG5ldyBWZWMzKCk7CiAgICAgICAgcG9pbnRJbnNpZGUudnN1Yih2LCB2VG9Qb2ludEluc2lkZSk7CiAgICAgICAgY29uc3QgcjIgPSBuLmRvdCh2VG9Qb2ludEluc2lkZSk7CgogICAgICAgIGlmIChyMSA8IDAgJiYgcjIgPiAwIHx8IHIxID4gMCAmJiByMiA8IDApIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsgLy8gRW5jb3VudGVyZWQgc29tZSBvdGhlciBzaWduLiBFeGl0LgogICAgICAgIH0KICAgICAgfSAvLyBJZiB3ZSBnb3QgaGVyZSwgYWxsIGRvdCBwcm9kdWN0cyB3ZXJlIG9mIHRoZSBzYW1lIHNpZ24uCgoKICAgICAgcmV0dXJuIHBvc2l0aXZlUmVzdWx0ID8gMSA6IC0xOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgbWF4IGFuZCBtaW4gZG90IHByb2R1Y3Qgb2YgYSBjb252ZXggaHVsbCBhdCBwb3NpdGlvbiAocG9zLHF1YXQpIHByb2plY3RlZCBvbnRvIGFuIGF4aXMuCiAgICAgKiBSZXN1bHRzIGFyZSBzYXZlZCBpbiB0aGUgYXJyYXkgbWF4bWluLgogICAgICogQHBhcmFtIHJlc3VsdCByZXN1bHRbMF0gYW5kIHJlc3VsdFsxXSB3aWxsIGJlIHNldCB0byBtYXhpbXVtIGFuZCBtaW5pbXVtLCByZXNwZWN0aXZlbHkuCiAgICAgKi8KCgogICAgc3RhdGljIHByb2plY3Qoc2hhcGUsIGF4aXMsIHBvcywgcXVhdCwgcmVzdWx0KSB7CiAgICAgIGNvbnN0IG4gPSBzaGFwZS52ZXJ0aWNlcy5sZW5ndGg7CiAgICAgIGNvbnN0IGxvY2FsQXhpcyA9IHByb2plY3RfbG9jYWxBeGlzOwogICAgICBsZXQgbWF4ID0gMDsKICAgICAgbGV0IG1pbiA9IDA7CiAgICAgIGNvbnN0IGxvY2FsT3JpZ2luID0gcHJvamVjdF9sb2NhbE9yaWdpbjsKICAgICAgY29uc3QgdnMgPSBzaGFwZS52ZXJ0aWNlczsKICAgICAgbG9jYWxPcmlnaW4uc2V0WmVybygpOyAvLyBUcmFuc2Zvcm0gdGhlIGF4aXMgdG8gbG9jYWwKCiAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb0xvY2FsRnJhbWUocG9zLCBxdWF0LCBheGlzLCBsb2NhbEF4aXMpOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zLCBxdWF0LCBsb2NhbE9yaWdpbiwgbG9jYWxPcmlnaW4pOwogICAgICBjb25zdCBhZGQgPSBsb2NhbE9yaWdpbi5kb3QobG9jYWxBeGlzKTsKICAgICAgbWluID0gbWF4ID0gdnNbMF0uZG90KGxvY2FsQXhpcyk7CgogICAgICBmb3IgKGxldCBpID0gMTsgaSA8IG47IGkrKykgewogICAgICAgIGNvbnN0IHZhbCA9IHZzW2ldLmRvdChsb2NhbEF4aXMpOwoKICAgICAgICBpZiAodmFsID4gbWF4KSB7CiAgICAgICAgICBtYXggPSB2YWw7CiAgICAgICAgfQoKICAgICAgICBpZiAodmFsIDwgbWluKSB7CiAgICAgICAgICBtaW4gPSB2YWw7CiAgICAgICAgfQogICAgICB9CgogICAgICBtaW4gLT0gYWRkOwogICAgICBtYXggLT0gYWRkOwoKICAgICAgaWYgKG1pbiA+IG1heCkgewogICAgICAgIC8vIEluY29uc2lzdGVudCAtIHN3YXAKICAgICAgICBjb25zdCB0ZW1wID0gbWluOwogICAgICAgIG1pbiA9IG1heDsKICAgICAgICBtYXggPSB0ZW1wOwogICAgICB9IC8vIE91dHB1dAoKCiAgICAgIHJlc3VsdFswXSA9IG1heDsKICAgICAgcmVzdWx0WzFdID0gbWluOwogICAgfQoKICB9CiAgY29uc3QgbWF4bWluQSA9IFtdOwogIGNvbnN0IG1heG1pbkIgPSBbXTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHByb2plY3RfbG9jYWxBeGlzID0gbmV3IFZlYzMoKTsKICBjb25zdCBwcm9qZWN0X2xvY2FsT3JpZ2luID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQSAzZCBib3ggc2hhcGUuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3Qgc2l6ZSA9IDEKICAgKiAgICAgY29uc3QgaGFsZkV4dGVudHMgPSBuZXcgQ0FOTk9OLlZlYzMoc2l6ZSwgc2l6ZSwgc2l6ZSkKICAgKiAgICAgY29uc3QgYm94U2hhcGUgPSBuZXcgQ0FOTk9OLkJveChoYWxmRXh0ZW50cykKICAgKiAgICAgY29uc3QgYm94Qm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBib3hTaGFwZSB9KQogICAqICAgICB3b3JsZC5hZGRCb2R5KGJveEJvZHkpCiAgICovCiAgY2xhc3MgQm94IGV4dGVuZHMgU2hhcGUgewogICAgLyoqCiAgICAgKiBUaGUgaGFsZiBleHRlbnRzIG9mIHRoZSBib3guCiAgICAgKi8KCiAgICAvKioKICAgICAqIFVzZWQgYnkgdGhlIGNvbnRhY3QgZ2VuZXJhdG9yIHRvIG1ha2UgY29udGFjdHMgd2l0aCBvdGhlciBjb252ZXggcG9seWhlZHJhIGZvciBleGFtcGxlLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihoYWxmRXh0ZW50cykgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuQk9YCiAgICAgIH0pOwogICAgICB0aGlzLmhhbGZFeHRlbnRzID0gaGFsZkV4dGVudHM7CiAgICAgIHRoaXMuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uID0gbnVsbDsKICAgICAgdGhpcy51cGRhdGVDb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24oKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGVzIHRoZSBsb2NhbCBjb252ZXggcG9seWhlZHJvbiByZXByZXNlbnRhdGlvbiB1c2VkIGZvciBzb21lIGNvbGxpc2lvbnMuCiAgICAgKi8KCgogICAgdXBkYXRlQ29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uKCkgewogICAgICBjb25zdCBzeCA9IHRoaXMuaGFsZkV4dGVudHMueDsKICAgICAgY29uc3Qgc3kgPSB0aGlzLmhhbGZFeHRlbnRzLnk7CiAgICAgIGNvbnN0IHN6ID0gdGhpcy5oYWxmRXh0ZW50cy56OwogICAgICBjb25zdCBWID0gVmVjMzsKICAgICAgY29uc3QgdmVydGljZXMgPSBbbmV3IFYoLXN4LCAtc3ksIC1zeiksIG5ldyBWKHN4LCAtc3ksIC1zeiksIG5ldyBWKHN4LCBzeSwgLXN6KSwgbmV3IFYoLXN4LCBzeSwgLXN6KSwgbmV3IFYoLXN4LCAtc3ksIHN6KSwgbmV3IFYoc3gsIC1zeSwgc3opLCBuZXcgVihzeCwgc3ksIHN6KSwgbmV3IFYoLXN4LCBzeSwgc3opXTsKICAgICAgY29uc3QgZmFjZXMgPSBbWzMsIDIsIDEsIDBdLCAvLyAtegogICAgICBbNCwgNSwgNiwgN10sIC8vICt6CiAgICAgIFs1LCA0LCAwLCAxXSwgLy8gLXkKICAgICAgWzIsIDMsIDcsIDZdLCAvLyAreQogICAgICBbMCwgNCwgNywgM10sIC8vIC14CiAgICAgIFsxLCAyLCA2LCA1XSAvLyAreAogICAgICBdOwogICAgICBjb25zdCBheGVzID0gW25ldyBWKDAsIDAsIDEpLCBuZXcgVigwLCAxLCAwKSwgbmV3IFYoMSwgMCwgMCldOwogICAgICBjb25zdCBoID0gbmV3IENvbnZleFBvbHloZWRyb24oewogICAgICAgIHZlcnRpY2VzLAogICAgICAgIGZhY2VzLAogICAgICAgIGF4ZXMKICAgICAgfSk7CiAgICAgIHRoaXMuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uID0gaDsKICAgICAgaC5tYXRlcmlhbCA9IHRoaXMubWF0ZXJpYWw7CiAgICB9CiAgICAvKioKICAgICAqIENhbGN1bGF0ZSB0aGUgaW5lcnRpYSBvZiB0aGUgYm94LgogICAgICovCgoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgQm94LmNhbGN1bGF0ZUluZXJ0aWEodGhpcy5oYWxmRXh0ZW50cywgbWFzcywgdGFyZ2V0KTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgICBzdGF0aWMgY2FsY3VsYXRlSW5lcnRpYShoYWxmRXh0ZW50cywgbWFzcywgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGUgPSBoYWxmRXh0ZW50czsKICAgICAgdGFyZ2V0LnggPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogZS55ICogMiAqIGUueSArIDIgKiBlLnogKiAyICogZS56KTsKICAgICAgdGFyZ2V0LnkgPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogZS54ICogMiAqIGUueCArIDIgKiBlLnogKiAyICogZS56KTsKICAgICAgdGFyZ2V0LnogPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogZS55ICogMiAqIGUueSArIDIgKiBlLnggKiAyICogZS54KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBib3ggNiBzaWRlIG5vcm1hbHMKICAgICAqIEBwYXJhbSBzaXhUYXJnZXRWZWN0b3JzIEFuIGFycmF5IG9mIDYgdmVjdG9ycywgdG8gc3RvcmUgdGhlIHJlc3VsdGluZyBzaWRlIG5vcm1hbHMgaW4uCiAgICAgKiBAcGFyYW0gcXVhdCBPcmllbnRhdGlvbiB0byBhcHBseSB0byB0aGUgbm9ybWFsIHZlY3RvcnMuIElmIG5vdCBwcm92aWRlZCwgdGhlIHZlY3RvcnMgd2lsbCBiZSBpbiByZXNwZWN0IHRvIHRoZSBsb2NhbCBmcmFtZS4KICAgICAqLwoKCiAgICBnZXRTaWRlTm9ybWFscyhzaXhUYXJnZXRWZWN0b3JzLCBxdWF0KSB7CiAgICAgIGNvbnN0IHNpZGVzID0gc2l4VGFyZ2V0VmVjdG9yczsKICAgICAgY29uc3QgZXggPSB0aGlzLmhhbGZFeHRlbnRzOwogICAgICBzaWRlc1swXS5zZXQoZXgueCwgMCwgMCk7CiAgICAgIHNpZGVzWzFdLnNldCgwLCBleC55LCAwKTsKICAgICAgc2lkZXNbMl0uc2V0KDAsIDAsIGV4LnopOwogICAgICBzaWRlc1szXS5zZXQoLWV4LngsIDAsIDApOwogICAgICBzaWRlc1s0XS5zZXQoMCwgLWV4LnksIDApOwogICAgICBzaWRlc1s1XS5zZXQoMCwgMCwgLWV4LnopOwoKICAgICAgaWYgKHF1YXQgIT09IHVuZGVmaW5lZCkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBzaWRlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgcXVhdC52bXVsdChzaWRlc1tpXSwgc2lkZXNbaV0pOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHNpZGVzOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSB2b2x1bWUgb2YgdGhlIGJveC4KICAgICAqLwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiA4LjAgKiB0aGlzLmhhbGZFeHRlbnRzLnggKiB0aGlzLmhhbGZFeHRlbnRzLnkgKiB0aGlzLmhhbGZFeHRlbnRzLno7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSB0aGlzLmhhbGZFeHRlbnRzLmxlbmd0aCgpOwogICAgfQogICAgLyoqCiAgICAgKiBmb3JFYWNoV29ybGRDb3JuZXIKICAgICAqLwoKCiAgICBmb3JFYWNoV29ybGRDb3JuZXIocG9zLCBxdWF0LCBjYWxsYmFjaykgewogICAgICBjb25zdCBlID0gdGhpcy5oYWxmRXh0ZW50czsKICAgICAgY29uc3QgY29ybmVycyA9IFtbZS54LCBlLnksIGUuel0sIFstZS54LCBlLnksIGUuel0sIFstZS54LCAtZS55LCBlLnpdLCBbLWUueCwgLWUueSwgLWUuel0sIFtlLngsIC1lLnksIC1lLnpdLCBbZS54LCBlLnksIC1lLnpdLCBbLWUueCwgZS55LCAtZS56XSwgW2UueCwgLWUueSwgZS56XV07CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvcm5lcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICB3b3JsZENvcm5lclRlbXBQb3Muc2V0KGNvcm5lcnNbaV1bMF0sIGNvcm5lcnNbaV1bMV0sIGNvcm5lcnNbaV1bMl0pOwogICAgICAgIHF1YXQudm11bHQod29ybGRDb3JuZXJUZW1wUG9zLCB3b3JsZENvcm5lclRlbXBQb3MpOwogICAgICAgIHBvcy52YWRkKHdvcmxkQ29ybmVyVGVtcFBvcywgd29ybGRDb3JuZXJUZW1wUG9zKTsKICAgICAgICBjYWxsYmFjayh3b3JsZENvcm5lclRlbXBQb3MueCwgd29ybGRDb3JuZXJUZW1wUG9zLnksIHdvcmxkQ29ybmVyVGVtcFBvcy56KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBjYWxjdWxhdGVXb3JsZEFBQkIKICAgICAqLwoKCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICBjb25zdCBlID0gdGhpcy5oYWxmRXh0ZW50czsKICAgICAgd29ybGRDb3JuZXJzVGVtcFswXS5zZXQoZS54LCBlLnksIGUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbMV0uc2V0KC1lLngsIGUueSwgZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFsyXS5zZXQoLWUueCwgLWUueSwgZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFszXS5zZXQoLWUueCwgLWUueSwgLWUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbNF0uc2V0KGUueCwgLWUueSwgLWUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbNV0uc2V0KGUueCwgZS55LCAtZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFs2XS5zZXQoLWUueCwgZS55LCAtZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFs3XS5zZXQoZS54LCAtZS55LCBlLnopOwogICAgICBjb25zdCB3YyA9IHdvcmxkQ29ybmVyc1RlbXBbMF07CiAgICAgIHF1YXQudm11bHQod2MsIHdjKTsKICAgICAgcG9zLnZhZGQod2MsIHdjKTsKICAgICAgbWF4LmNvcHkod2MpOwogICAgICBtaW4uY29weSh3Yyk7CgogICAgICBmb3IgKGxldCBpID0gMTsgaSA8IDg7IGkrKykgewogICAgICAgIGNvbnN0IHdjID0gd29ybGRDb3JuZXJzVGVtcFtpXTsKICAgICAgICBxdWF0LnZtdWx0KHdjLCB3Yyk7CiAgICAgICAgcG9zLnZhZGQod2MsIHdjKTsKICAgICAgICBjb25zdCB4ID0gd2MueDsKICAgICAgICBjb25zdCB5ID0gd2MueTsKICAgICAgICBjb25zdCB6ID0gd2MuejsKCiAgICAgICAgaWYgKHggPiBtYXgueCkgewogICAgICAgICAgbWF4LnggPSB4OwogICAgICAgIH0KCiAgICAgICAgaWYgKHkgPiBtYXgueSkgewogICAgICAgICAgbWF4LnkgPSB5OwogICAgICAgIH0KCiAgICAgICAgaWYgKHogPiBtYXgueikgewogICAgICAgICAgbWF4LnogPSB6OwogICAgICAgIH0KCiAgICAgICAgaWYgKHggPCBtaW4ueCkgewogICAgICAgICAgbWluLnggPSB4OwogICAgICAgIH0KCiAgICAgICAgaWYgKHkgPCBtaW4ueSkgewogICAgICAgICAgbWluLnkgPSB5OwogICAgICAgIH0KCiAgICAgICAgaWYgKHogPCBtaW4ueikgewogICAgICAgICAgbWluLnogPSB6OwogICAgICAgIH0KICAgICAgfSAvLyBHZXQgZWFjaCBheGlzIG1heAogICAgICAvLyBtaW4uc2V0KEluZmluaXR5LEluZmluaXR5LEluZmluaXR5KTsKICAgICAgLy8gbWF4LnNldCgtSW5maW5pdHksLUluZmluaXR5LC1JbmZpbml0eSk7CiAgICAgIC8vIHRoaXMuZm9yRWFjaFdvcmxkQ29ybmVyKHBvcyxxdWF0LGZ1bmN0aW9uKHgseSx6KXsKICAgICAgLy8gICAgIGlmKHggPiBtYXgueCl7CiAgICAgIC8vICAgICAgICAgbWF4LnggPSB4OwogICAgICAvLyAgICAgfQogICAgICAvLyAgICAgaWYoeSA+IG1heC55KXsKICAgICAgLy8gICAgICAgICBtYXgueSA9IHk7CiAgICAgIC8vICAgICB9CiAgICAgIC8vICAgICBpZih6ID4gbWF4LnopewogICAgICAvLyAgICAgICAgIG1heC56ID0gejsKICAgICAgLy8gICAgIH0KICAgICAgLy8gICAgIGlmKHggPCBtaW4ueCl7CiAgICAgIC8vICAgICAgICAgbWluLnggPSB4OwogICAgICAvLyAgICAgfQogICAgICAvLyAgICAgaWYoeSA8IG1pbi55KXsKICAgICAgLy8gICAgICAgICBtaW4ueSA9IHk7CiAgICAgIC8vICAgICB9CiAgICAgIC8vICAgICBpZih6IDwgbWluLnopewogICAgICAvLyAgICAgICAgIG1pbi56ID0gejsKICAgICAgLy8gICAgIH0KICAgICAgLy8gfSk7CgogICAgfQoKICB9CiAgY29uc3Qgd29ybGRDb3JuZXJUZW1wUG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCB3b3JsZENvcm5lcnNUZW1wID0gW25ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCldOwoKICAvKioKICAgKiBCT0RZX1RZUEVTCiAgICovCiAgY29uc3QgQk9EWV9UWVBFUyA9IHsKICAgIC8qKiBEWU5BTUlDICovCiAgICBEWU5BTUlDOiAxLAoKICAgIC8qKiBTVEFUSUMgKi8KICAgIFNUQVRJQzogMiwKCiAgICAvKiogS0lORU1BVElDICovCiAgICBLSU5FTUFUSUM6IDQKICB9OwogIC8qKgogICAqIEJvZHlUeXBlCiAgICovCgogIC8qKgogICAqIEJPRFlfU0xFRVBfU1RBVEVTCiAgICovCiAgY29uc3QgQk9EWV9TTEVFUF9TVEFURVMgPSB7CiAgICAvKiogQVdBS0UgKi8KICAgIEFXQUtFOiAwLAoKICAgIC8qKiBTTEVFUFkgKi8KICAgIFNMRUVQWTogMSwKCiAgICAvKiogU0xFRVBJTkcgKi8KICAgIFNMRUVQSU5HOiAyCiAgfTsKICAvKioKICAgKiBCb2R5U2xlZXBTdGF0ZQogICAqLwoKICAvKioKICAgKiBCYXNlIGNsYXNzIGZvciBhbGwgYm9keSB0eXBlcy4KICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCBzaGFwZSA9IG5ldyBDQU5OT04uU3BoZXJlKDEpCiAgICogICAgIGNvbnN0IGJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoewogICAqICAgICAgIG1hc3M6IDEsCiAgICogICAgICAgc2hhcGUsCiAgICogICAgIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoYm9keSkKICAgKi8KICBjbGFzcyBCb2R5IGV4dGVuZHMgRXZlbnRUYXJnZXQgewogICAgLyoqCiAgICAgKiBEaXNwYXRjaGVkIGFmdGVyIHR3byBib2RpZXMgY29sbGlkZS4gVGhpcyBldmVudCBpcyBkaXNwYXRjaGVkIG9uIGVhY2gKICAgICAqIG9mIHRoZSB0d28gYm9kaWVzIGludm9sdmVkIGluIHRoZSBjb2xsaXNpb24uCiAgICAgKiBAZXZlbnQgY29sbGlkZQogICAgICogQHBhcmFtIGJvZHkgVGhlIGJvZHkgdGhhdCB3YXMgaW52b2x2ZWQgaW4gdGhlIGNvbGxpc2lvbi4KICAgICAqIEBwYXJhbSBjb250YWN0IFRoZSBkZXRhaWxzIG9mIHRoZSBjb2xsaXNpb24uCiAgICAgKi8KCiAgICAvKioKICAgICAqIEEgZHluYW1pYyBib2R5IGlzIGZ1bGx5IHNpbXVsYXRlZC4gQ2FuIGJlIG1vdmVkIG1hbnVhbGx5IGJ5IHRoZSB1c2VyLCBidXQgbm9ybWFsbHkgdGhleSBtb3ZlIGFjY29yZGluZyB0byBmb3JjZXMuIEEgZHluYW1pYyBib2R5IGNhbiBjb2xsaWRlIHdpdGggYWxsIGJvZHkgdHlwZXMuIEEgZHluYW1pYyBib2R5IGFsd2F5cyBoYXMgZmluaXRlLCBub24temVybyBtYXNzLgogICAgICovCgogICAgLyoqCiAgICAgKiBBIHN0YXRpYyBib2R5IGRvZXMgbm90IG1vdmUgZHVyaW5nIHNpbXVsYXRpb24gYW5kIGJlaGF2ZXMgYXMgaWYgaXQgaGFzIGluZmluaXRlIG1hc3MuIFN0YXRpYyBib2RpZXMgY2FuIGJlIG1vdmVkIG1hbnVhbGx5IGJ5IHNldHRpbmcgdGhlIHBvc2l0aW9uIG9mIHRoZSBib2R5LiBUaGUgdmVsb2NpdHkgb2YgYSBzdGF0aWMgYm9keSBpcyBhbHdheXMgemVyby4gU3RhdGljIGJvZGllcyBkbyBub3QgY29sbGlkZSB3aXRoIG90aGVyIHN0YXRpYyBvciBraW5lbWF0aWMgYm9kaWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBBIGtpbmVtYXRpYyBib2R5IG1vdmVzIHVuZGVyIHNpbXVsYXRpb24gYWNjb3JkaW5nIHRvIGl0cyB2ZWxvY2l0eS4gVGhleSBkbyBub3QgcmVzcG9uZCB0byBmb3JjZXMuIFRoZXkgY2FuIGJlIG1vdmVkIG1hbnVhbGx5LCBidXQgbm9ybWFsbHkgYSBraW5lbWF0aWMgYm9keSBpcyBtb3ZlZCBieSBzZXR0aW5nIGl0cyB2ZWxvY2l0eS4gQSBraW5lbWF0aWMgYm9keSBiZWhhdmVzIGFzIGlmIGl0IGhhcyBpbmZpbml0ZSBtYXNzLiBLaW5lbWF0aWMgYm9kaWVzIGRvIG5vdCBjb2xsaWRlIHdpdGggb3RoZXIgc3RhdGljIG9yIGtpbmVtYXRpYyBib2RpZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFXQUtFCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNMRUVQWQogICAgICovCgogICAgLyoqCiAgICAgKiBTTEVFUElORwogICAgICovCgogICAgLyoqCiAgICAgKiBEaXNwYXRjaGVkIGFmdGVyIGEgc2xlZXBpbmcgYm9keSBoYXMgd29rZW4gdXAuCiAgICAgKiBAZXZlbnQgd2FrZXVwCiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3BhdGNoZWQgYWZ0ZXIgYSBib2R5IGhhcyBnb25lIGluIHRvIHRoZSBzbGVlcHkgc3RhdGUuCiAgICAgKiBAZXZlbnQgc2xlZXB5CiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3BhdGNoZWQgYWZ0ZXIgYSBib2R5IGhhcyBmYWxsZW4gYXNsZWVwLgogICAgICogQGV2ZW50IHNsZWVwCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5pZCA9IEJvZHkuaWRDb3VudGVyKys7CiAgICAgIHRoaXMuaW5kZXggPSAtMTsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICAgIHRoaXMudmxhbWJkYSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSB0eXBlb2Ygb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJHcm91cCA9PT0gJ251bWJlcicgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrID0gdHlwZW9mIG9wdGlvbnMuY29sbGlzaW9uRmlsdGVyTWFzayA9PT0gJ251bWJlcicgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgOiAtMTsKICAgICAgdGhpcy5jb2xsaXNpb25SZXNwb25zZSA9IHR5cGVvZiBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlID09PSAnYm9vbGVhbicgPyBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlIDogdHJ1ZTsKICAgICAgdGhpcy5wb3NpdGlvbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucHJldmlvdXNQb3NpdGlvbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaW50ZXJwb2xhdGVkUG9zaXRpb24gPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmluaXRQb3NpdGlvbiA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy5wb3NpdGlvbikgewogICAgICAgIHRoaXMucG9zaXRpb24uY29weShvcHRpb25zLnBvc2l0aW9uKTsKICAgICAgICB0aGlzLnByZXZpb3VzUG9zaXRpb24uY29weShvcHRpb25zLnBvc2l0aW9uKTsKICAgICAgICB0aGlzLmludGVycG9sYXRlZFBvc2l0aW9uLmNvcHkob3B0aW9ucy5wb3NpdGlvbik7CiAgICAgICAgdGhpcy5pbml0UG9zaXRpb24uY29weShvcHRpb25zLnBvc2l0aW9uKTsKICAgICAgfQoKICAgICAgdGhpcy52ZWxvY2l0eSA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy52ZWxvY2l0eSkgewogICAgICAgIHRoaXMudmVsb2NpdHkuY29weShvcHRpb25zLnZlbG9jaXR5KTsKICAgICAgfQoKICAgICAgdGhpcy5pbml0VmVsb2NpdHkgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmZvcmNlID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgbWFzcyA9IHR5cGVvZiBvcHRpb25zLm1hc3MgPT09ICdudW1iZXInID8gb3B0aW9ucy5tYXNzIDogMDsKICAgICAgdGhpcy5tYXNzID0gbWFzczsKICAgICAgdGhpcy5pbnZNYXNzID0gbWFzcyA+IDAgPyAxLjAgLyBtYXNzIDogMDsKICAgICAgdGhpcy5tYXRlcmlhbCA9IG9wdGlvbnMubWF0ZXJpYWwgfHwgbnVsbDsKICAgICAgdGhpcy5saW5lYXJEYW1waW5nID0gdHlwZW9mIG9wdGlvbnMubGluZWFyRGFtcGluZyA9PT0gJ251bWJlcicgPyBvcHRpb25zLmxpbmVhckRhbXBpbmcgOiAwLjAxOwogICAgICB0aGlzLnR5cGUgPSBtYXNzIDw9IDAuMCA/IEJvZHkuU1RBVElDIDogQm9keS5EWU5BTUlDOwoKICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLnR5cGUgPT09IHR5cGVvZiBCb2R5LlNUQVRJQykgewogICAgICAgIHRoaXMudHlwZSA9IG9wdGlvbnMudHlwZTsKICAgICAgfQoKICAgICAgdGhpcy5hbGxvd1NsZWVwID0gdHlwZW9mIG9wdGlvbnMuYWxsb3dTbGVlcCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFsbG93U2xlZXAgOiB0cnVlOwogICAgICB0aGlzLnNsZWVwU3RhdGUgPSBCb2R5LkFXQUtFOwogICAgICB0aGlzLnNsZWVwU3BlZWRMaW1pdCA9IHR5cGVvZiBvcHRpb25zLnNsZWVwU3BlZWRMaW1pdCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLnNsZWVwU3BlZWRMaW1pdCA6IDAuMTsKICAgICAgdGhpcy5zbGVlcFRpbWVMaW1pdCA9IHR5cGVvZiBvcHRpb25zLnNsZWVwVGltZUxpbWl0ICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuc2xlZXBUaW1lTGltaXQgOiAxOwogICAgICB0aGlzLnRpbWVMYXN0U2xlZXB5ID0gMDsKICAgICAgdGhpcy53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gZmFsc2U7CiAgICAgIHRoaXMudG9ycXVlID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5xdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgdGhpcy5pbml0UXVhdGVybmlvbiA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIHRoaXMucHJldmlvdXNRdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgdGhpcy5pbnRlcnBvbGF0ZWRRdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgICAgIGlmIChvcHRpb25zLnF1YXRlcm5pb24pIHsKICAgICAgICB0aGlzLnF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICAgIHRoaXMuaW5pdFF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICAgIHRoaXMucHJldmlvdXNRdWF0ZXJuaW9uLmNvcHkob3B0aW9ucy5xdWF0ZXJuaW9uKTsKICAgICAgICB0aGlzLmludGVycG9sYXRlZFF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICB9CgogICAgICB0aGlzLmFuZ3VsYXJWZWxvY2l0eSA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy5hbmd1bGFyVmVsb2NpdHkpIHsKICAgICAgICB0aGlzLmFuZ3VsYXJWZWxvY2l0eS5jb3B5KG9wdGlvbnMuYW5ndWxhclZlbG9jaXR5KTsKICAgICAgfQoKICAgICAgdGhpcy5pbml0QW5ndWxhclZlbG9jaXR5ID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5zaGFwZXMgPSBbXTsKICAgICAgdGhpcy5zaGFwZU9mZnNldHMgPSBbXTsKICAgICAgdGhpcy5zaGFwZU9yaWVudGF0aW9ucyA9IFtdOwogICAgICB0aGlzLmluZXJ0aWEgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludkluZXJ0aWEgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludkluZXJ0aWFXb3JsZCA9IG5ldyBNYXQzKCk7CiAgICAgIHRoaXMuaW52TWFzc1NvbHZlID0gMDsKICAgICAgdGhpcy5pbnZJbmVydGlhU29sdmUgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludkluZXJ0aWFXb3JsZFNvbHZlID0gbmV3IE1hdDMoKTsKICAgICAgdGhpcy5maXhlZFJvdGF0aW9uID0gdHlwZW9mIG9wdGlvbnMuZml4ZWRSb3RhdGlvbiAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmZpeGVkUm90YXRpb24gOiBmYWxzZTsKICAgICAgdGhpcy5hbmd1bGFyRGFtcGluZyA9IHR5cGVvZiBvcHRpb25zLmFuZ3VsYXJEYW1waW5nICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuYW5ndWxhckRhbXBpbmcgOiAwLjAxOwogICAgICB0aGlzLmxpbmVhckZhY3RvciA9IG5ldyBWZWMzKDEsIDEsIDEpOwoKICAgICAgaWYgKG9wdGlvbnMubGluZWFyRmFjdG9yKSB7CiAgICAgICAgdGhpcy5saW5lYXJGYWN0b3IuY29weShvcHRpb25zLmxpbmVhckZhY3Rvcik7CiAgICAgIH0KCiAgICAgIHRoaXMuYW5ndWxhckZhY3RvciA9IG5ldyBWZWMzKDEsIDEsIDEpOwoKICAgICAgaWYgKG9wdGlvbnMuYW5ndWxhckZhY3RvcikgewogICAgICAgIHRoaXMuYW5ndWxhckZhY3Rvci5jb3B5KG9wdGlvbnMuYW5ndWxhckZhY3Rvcik7CiAgICAgIH0KCiAgICAgIHRoaXMuYWFiYiA9IG5ldyBBQUJCKCk7CiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgdGhpcy5ib3VuZGluZ1JhZGl1cyA9IDA7CiAgICAgIHRoaXMud2xhbWJkYSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaXNUcmlnZ2VyID0gQm9vbGVhbihvcHRpb25zLmlzVHJpZ2dlcik7CgogICAgICBpZiAob3B0aW9ucy5zaGFwZSkgewogICAgICAgIHRoaXMuYWRkU2hhcGUob3B0aW9ucy5zaGFwZSk7CiAgICAgIH0KCiAgICAgIHRoaXMudXBkYXRlTWFzc1Byb3BlcnRpZXMoKTsKICAgIH0KICAgIC8qKgogICAgICogV2FrZSB0aGUgYm9keSB1cC4KICAgICAqLwoKCiAgICB3YWtlVXAoKSB7CiAgICAgIGNvbnN0IHByZXZTdGF0ZSA9IHRoaXMuc2xlZXBTdGF0ZTsKICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5BV0FLRTsKICAgICAgdGhpcy53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gZmFsc2U7CgogICAgICBpZiAocHJldlN0YXRlID09PSBCb2R5LlNMRUVQSU5HKSB7CiAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KEJvZHkud2FrZXVwRXZlbnQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEZvcmNlIGJvZHkgc2xlZXAKICAgICAqLwoKCiAgICBzbGVlcCgpIHsKICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5TTEVFUElORzsKICAgICAgdGhpcy52ZWxvY2l0eS5zZXQoMCwgMCwgMCk7CiAgICAgIHRoaXMuYW5ndWxhclZlbG9jaXR5LnNldCgwLCAwLCAwKTsKICAgICAgdGhpcy53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIENhbGxlZCBldmVyeSB0aW1lc3RlcCB0byB1cGRhdGUgaW50ZXJuYWwgc2xlZXAgdGltZXIgYW5kIGNoYW5nZSBzbGVlcCBzdGF0ZSBpZiBuZWVkZWQuCiAgICAgKiBAcGFyYW0gdGltZSBUaGUgd29ybGQgdGltZSBpbiBzZWNvbmRzCiAgICAgKi8KCgogICAgc2xlZXBUaWNrKHRpbWUpIHsKICAgICAgaWYgKHRoaXMuYWxsb3dTbGVlcCkgewogICAgICAgIGNvbnN0IHNsZWVwU3RhdGUgPSB0aGlzLnNsZWVwU3RhdGU7CiAgICAgICAgY29uc3Qgc3BlZWRTcXVhcmVkID0gdGhpcy52ZWxvY2l0eS5sZW5ndGhTcXVhcmVkKCkgKyB0aGlzLmFuZ3VsYXJWZWxvY2l0eS5sZW5ndGhTcXVhcmVkKCk7CiAgICAgICAgY29uc3Qgc3BlZWRMaW1pdFNxdWFyZWQgPSB0aGlzLnNsZWVwU3BlZWRMaW1pdCAqKiAyOwoKICAgICAgICBpZiAoc2xlZXBTdGF0ZSA9PT0gQm9keS5BV0FLRSAmJiBzcGVlZFNxdWFyZWQgPCBzcGVlZExpbWl0U3F1YXJlZCkgewogICAgICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5TTEVFUFk7IC8vIFNsZWVweQoKICAgICAgICAgIHRoaXMudGltZUxhc3RTbGVlcHkgPSB0aW1lOwogICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KEJvZHkuc2xlZXB5RXZlbnQpOwogICAgICAgIH0gZWxzZSBpZiAoc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUFkgJiYgc3BlZWRTcXVhcmVkID4gc3BlZWRMaW1pdFNxdWFyZWQpIHsKICAgICAgICAgIHRoaXMud2FrZVVwKCk7IC8vIFdha2UgdXAKICAgICAgICB9IGVsc2UgaWYgKHNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBZICYmIHRpbWUgLSB0aGlzLnRpbWVMYXN0U2xlZXB5ID4gdGhpcy5zbGVlcFRpbWVMaW1pdCkgewogICAgICAgICAgdGhpcy5zbGVlcCgpOyAvLyBTbGVlcGluZwoKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChCb2R5LnNsZWVwRXZlbnQpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBJZiB0aGUgYm9keSBpcyBzbGVlcGluZywgaXQgc2hvdWxkIGJlIGltbW92YWJsZSAvIGhhdmUgaW5maW5pdGUgbWFzcyBkdXJpbmcgc29sdmUuIFdlIHNvbHZlIGl0IGJ5IGhhdmluZyBhIHNlcGFyYXRlICJzb2x2ZSBtYXNzIi4KICAgICAqLwoKCiAgICB1cGRhdGVTb2x2ZU1hc3NQcm9wZXJ0aWVzKCkgewogICAgICBpZiAodGhpcy5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HIHx8IHRoaXMudHlwZSA9PT0gQm9keS5LSU5FTUFUSUMpIHsKICAgICAgICB0aGlzLmludk1hc3NTb2x2ZSA9IDA7CiAgICAgICAgdGhpcy5pbnZJbmVydGlhU29sdmUuc2V0WmVybygpOwogICAgICAgIHRoaXMuaW52SW5lcnRpYVdvcmxkU29sdmUuc2V0WmVybygpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuaW52TWFzc1NvbHZlID0gdGhpcy5pbnZNYXNzOwogICAgICAgIHRoaXMuaW52SW5lcnRpYVNvbHZlLmNvcHkodGhpcy5pbnZJbmVydGlhKTsKICAgICAgICB0aGlzLmludkluZXJ0aWFXb3JsZFNvbHZlLmNvcHkodGhpcy5pbnZJbmVydGlhV29ybGQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgYSB3b3JsZCBwb2ludCB0byBsb2NhbCBib2R5IGZyYW1lLgogICAgICovCgoKICAgIHBvaW50VG9Mb2NhbEZyYW1lKHdvcmxkUG9pbnQsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB3b3JsZFBvaW50LnZzdWIodGhpcy5wb3NpdGlvbiwgcmVzdWx0KTsKICAgICAgdGhpcy5xdWF0ZXJuaW9uLmNvbmp1Z2F0ZSgpLnZtdWx0KHJlc3VsdCwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCBhIHdvcmxkIHZlY3RvciB0byBsb2NhbCBib2R5IGZyYW1lLgogICAgICovCgoKICAgIHZlY3RvclRvTG9jYWxGcmFtZSh3b3JsZFZlY3RvciwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMucXVhdGVybmlvbi5jb25qdWdhdGUoKS52bXVsdCh3b3JsZFZlY3RvciwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCBhIGxvY2FsIGJvZHkgcG9pbnQgdG8gd29ybGQgZnJhbWUuCiAgICAgKi8KCgogICAgcG9pbnRUb1dvcmxkRnJhbWUobG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMucXVhdGVybmlvbi52bXVsdChsb2NhbFBvaW50LCByZXN1bHQpOwogICAgICByZXN1bHQudmFkZCh0aGlzLnBvc2l0aW9uLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0IGEgbG9jYWwgYm9keSBwb2ludCB0byB3b3JsZCBmcmFtZS4KICAgICAqLwoKCiAgICB2ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0aGlzLnF1YXRlcm5pb24udm11bHQobG9jYWxWZWN0b3IsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIEFkZCBhIHNoYXBlIHRvIHRoZSBib2R5IHdpdGggYSBsb2NhbCBvZmZzZXQgYW5kIG9yaWVudGF0aW9uLgogICAgICogQHJldHVybiBUaGUgYm9keSBvYmplY3QsIGZvciBjaGFpbmFiaWxpdHkuCiAgICAgKi8KCgogICAgYWRkU2hhcGUoc2hhcGUsIF9vZmZzZXQsIF9vcmllbnRhdGlvbikgewogICAgICBjb25zdCBvZmZzZXQgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBvcmllbnRhdGlvbiA9IG5ldyBRdWF0ZXJuaW9uKCk7CgogICAgICBpZiAoX29mZnNldCkgewogICAgICAgIG9mZnNldC5jb3B5KF9vZmZzZXQpOwogICAgICB9CgogICAgICBpZiAoX29yaWVudGF0aW9uKSB7CiAgICAgICAgb3JpZW50YXRpb24uY29weShfb3JpZW50YXRpb24pOwogICAgICB9CgogICAgICB0aGlzLnNoYXBlcy5wdXNoKHNoYXBlKTsKICAgICAgdGhpcy5zaGFwZU9mZnNldHMucHVzaChvZmZzZXQpOwogICAgICB0aGlzLnNoYXBlT3JpZW50YXRpb25zLnB1c2gob3JpZW50YXRpb24pOwogICAgICB0aGlzLnVwZGF0ZU1hc3NQcm9wZXJ0aWVzKCk7CiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdSYWRpdXMoKTsKICAgICAgdGhpcy5hYWJiTmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICBzaGFwZS5ib2R5ID0gdGhpczsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZSBhIHNoYXBlIGZyb20gdGhlIGJvZHkuCiAgICAgKiBAcmV0dXJuIFRoZSBib2R5IG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eS4KICAgICAqLwoKCiAgICByZW1vdmVTaGFwZShzaGFwZSkgewogICAgICBjb25zdCBpbmRleCA9IHRoaXMuc2hhcGVzLmluZGV4T2Yoc2hhcGUpOwoKICAgICAgaWYgKGluZGV4ID09PSAtMSkgewogICAgICAgIGNvbnNvbGUud2FybignU2hhcGUgZG9lcyBub3QgYmVsb25nIHRvIHRoZSBib2R5Jyk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIHRoaXMuc2hhcGVzLnNwbGljZShpbmRleCwgMSk7CiAgICAgIHRoaXMuc2hhcGVPZmZzZXRzLnNwbGljZShpbmRleCwgMSk7CiAgICAgIHRoaXMuc2hhcGVPcmllbnRhdGlvbnMuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgdGhpcy51cGRhdGVNYXNzUHJvcGVydGllcygpOwogICAgICB0aGlzLnVwZGF0ZUJvdW5kaW5nUmFkaXVzKCk7CiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgc2hhcGUuYm9keSA9IG51bGw7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgdGhlIGJvdW5kaW5nIHJhZGl1cyBvZiB0aGUgYm9keS4gU2hvdWxkIGJlIGRvbmUgaWYgYW55IG9mIHRoZSBzaGFwZXMgYXJlIGNoYW5nZWQuCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdSYWRpdXMoKSB7CiAgICAgIGNvbnN0IHNoYXBlcyA9IHRoaXMuc2hhcGVzOwogICAgICBjb25zdCBzaGFwZU9mZnNldHMgPSB0aGlzLnNoYXBlT2Zmc2V0czsKICAgICAgY29uc3QgTiA9IHNoYXBlcy5sZW5ndGg7CiAgICAgIGxldCByYWRpdXMgPSAwOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IHNoYXBlID0gc2hhcGVzW2ldOwogICAgICAgIHNoYXBlLnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICAgICAgY29uc3Qgb2Zmc2V0ID0gc2hhcGVPZmZzZXRzW2ldLmxlbmd0aCgpOwogICAgICAgIGNvbnN0IHIgPSBzaGFwZS5ib3VuZGluZ1NwaGVyZVJhZGl1czsKCiAgICAgICAgaWYgKG9mZnNldCArIHIgPiByYWRpdXMpIHsKICAgICAgICAgIHJhZGl1cyA9IG9mZnNldCArIHI7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmJvdW5kaW5nUmFkaXVzID0gcmFkaXVzOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGVzIHRoZSAuYWFiYgogICAgICovCgoKICAgIHVwZGF0ZUFBQkIoKSB7CiAgICAgIGNvbnN0IHNoYXBlcyA9IHRoaXMuc2hhcGVzOwogICAgICBjb25zdCBzaGFwZU9mZnNldHMgPSB0aGlzLnNoYXBlT2Zmc2V0czsKICAgICAgY29uc3Qgc2hhcGVPcmllbnRhdGlvbnMgPSB0aGlzLnNoYXBlT3JpZW50YXRpb25zOwogICAgICBjb25zdCBOID0gc2hhcGVzLmxlbmd0aDsKICAgICAgY29uc3Qgb2Zmc2V0ID0gdG1wVmVjOwogICAgICBjb25zdCBvcmllbnRhdGlvbiA9IHRtcFF1YXQ7CiAgICAgIGNvbnN0IGJvZHlRdWF0ID0gdGhpcy5xdWF0ZXJuaW9uOwogICAgICBjb25zdCBhYWJiID0gdGhpcy5hYWJiOwogICAgICBjb25zdCBzaGFwZUFBQkIgPSB1cGRhdGVBQUJCX3NoYXBlQUFCQjsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBzaGFwZSA9IHNoYXBlc1tpXTsgLy8gR2V0IHNoYXBlIHdvcmxkIHBvc2l0aW9uCgogICAgICAgIGJvZHlRdWF0LnZtdWx0KHNoYXBlT2Zmc2V0c1tpXSwgb2Zmc2V0KTsKICAgICAgICBvZmZzZXQudmFkZCh0aGlzLnBvc2l0aW9uLCBvZmZzZXQpOyAvLyBHZXQgc2hhcGUgd29ybGQgcXVhdGVybmlvbgoKICAgICAgICBib2R5UXVhdC5tdWx0KHNoYXBlT3JpZW50YXRpb25zW2ldLCBvcmllbnRhdGlvbik7IC8vIEdldCBzaGFwZSBBQUJCCgogICAgICAgIHNoYXBlLmNhbGN1bGF0ZVdvcmxkQUFCQihvZmZzZXQsIG9yaWVudGF0aW9uLCBzaGFwZUFBQkIubG93ZXJCb3VuZCwgc2hhcGVBQUJCLnVwcGVyQm91bmQpOwoKICAgICAgICBpZiAoaSA9PT0gMCkgewogICAgICAgICAgYWFiYi5jb3B5KHNoYXBlQUFCQik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGFhYmIuZXh0ZW5kKHNoYXBlQUFCQik7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmFhYmJOZWVkc1VwZGF0ZSA9IGZhbHNlOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgYC5pbmVydGlhV29ybGRgIGFuZCBgLmludkluZXJ0aWFXb3JsZGAKICAgICAqLwoKCiAgICB1cGRhdGVJbmVydGlhV29ybGQoZm9yY2UpIHsKICAgICAgY29uc3QgSSA9IHRoaXMuaW52SW5lcnRpYTsKCiAgICAgIGlmIChJLnggPT09IEkueSAmJiBJLnkgPT09IEkueiAmJiAhZm9yY2UpIDsgZWxzZSB7CiAgICAgICAgY29uc3QgbTEgPSB1aXdfbTE7CiAgICAgICAgY29uc3QgbTIgPSB1aXdfbTI7CiAgICAgICAgbTEuc2V0Um90YXRpb25Gcm9tUXVhdGVybmlvbih0aGlzLnF1YXRlcm5pb24pOwogICAgICAgIG0xLnRyYW5zcG9zZShtMik7CiAgICAgICAgbTEuc2NhbGUoSSwgbTEpOwogICAgICAgIG0xLm1tdWx0KG0yLCB0aGlzLmludkluZXJ0aWFXb3JsZCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQXBwbHkgZm9yY2UgdG8gYSBwb2ludCBvZiB0aGUgYm9keS4gVGhpcyBjb3VsZCBmb3IgZXhhbXBsZSBiZSBhIHBvaW50IG9uIHRoZSBCb2R5IHN1cmZhY2UuCiAgICAgKiBBcHBseWluZyBmb3JjZSB0aGlzIHdheSB3aWxsIGFkZCB0byBCb2R5LmZvcmNlIGFuZCBCb2R5LnRvcnF1ZS4KICAgICAqIEBwYXJhbSBmb3JjZSBUaGUgYW1vdW50IG9mIGZvcmNlIHRvIGFkZC4KICAgICAqIEBwYXJhbSByZWxhdGl2ZVBvaW50IEEgcG9pbnQgcmVsYXRpdmUgdG8gdGhlIGNlbnRlciBvZiBtYXNzIHRvIGFwcGx5IHRoZSBmb3JjZSBvbi4KICAgICAqLwoKCiAgICBhcHBseUZvcmNlKGZvcmNlLCByZWxhdGl2ZVBvaW50KSB7CiAgICAgIGlmIChyZWxhdGl2ZVBvaW50ID09PSB2b2lkIDApIHsKICAgICAgICByZWxhdGl2ZVBvaW50ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgLy8gTmVlZGVkPwogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLndha2VVcCgpOwogICAgICB9IC8vIENvbXB1dGUgcHJvZHVjZWQgcm90YXRpb25hbCBmb3JjZQoKCiAgICAgIGNvbnN0IHJvdEZvcmNlID0gQm9keV9hcHBseUZvcmNlX3JvdEZvcmNlOwogICAgICByZWxhdGl2ZVBvaW50LmNyb3NzKGZvcmNlLCByb3RGb3JjZSk7IC8vIEFkZCBsaW5lYXIgZm9yY2UKCiAgICAgIHRoaXMuZm9yY2UudmFkZChmb3JjZSwgdGhpcy5mb3JjZSk7IC8vIEFkZCByb3RhdGlvbmFsIGZvcmNlCgogICAgICB0aGlzLnRvcnF1ZS52YWRkKHJvdEZvcmNlLCB0aGlzLnRvcnF1ZSk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IGZvcmNlIHRvIGEgbG9jYWwgcG9pbnQgaW4gdGhlIGJvZHkuCiAgICAgKiBAcGFyYW0gZm9yY2UgVGhlIGZvcmNlIHZlY3RvciB0byBhcHBseSwgZGVmaW5lZCBsb2NhbGx5IGluIHRoZSBib2R5IGZyYW1lLgogICAgICogQHBhcmFtIGxvY2FsUG9pbnQgQSBsb2NhbCBwb2ludCBpbiB0aGUgYm9keSB0byBhcHBseSB0aGUgZm9yY2Ugb24uCiAgICAgKi8KCgogICAgYXBwbHlMb2NhbEZvcmNlKGxvY2FsRm9yY2UsIGxvY2FsUG9pbnQpIHsKICAgICAgaWYgKGxvY2FsUG9pbnQgPT09IHZvaWQgMCkgewogICAgICAgIGxvY2FsUG9pbnQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHdvcmxkRm9yY2UgPSBCb2R5X2FwcGx5TG9jYWxGb3JjZV93b3JsZEZvcmNlOwogICAgICBjb25zdCByZWxhdGl2ZVBvaW50V29ybGQgPSBCb2R5X2FwcGx5TG9jYWxGb3JjZV9yZWxhdGl2ZVBvaW50V29ybGQ7IC8vIFRyYW5zZm9ybSB0aGUgZm9yY2UgdmVjdG9yIHRvIHdvcmxkIHNwYWNlCgogICAgICB0aGlzLnZlY3RvclRvV29ybGRGcmFtZShsb2NhbEZvcmNlLCB3b3JsZEZvcmNlKTsKICAgICAgdGhpcy52ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxQb2ludCwgcmVsYXRpdmVQb2ludFdvcmxkKTsKICAgICAgdGhpcy5hcHBseUZvcmNlKHdvcmxkRm9yY2UsIHJlbGF0aXZlUG9pbnRXb3JsZCk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IHRvcnF1ZSB0byB0aGUgYm9keS4KICAgICAqIEBwYXJhbSB0b3JxdWUgVGhlIGFtb3VudCBvZiB0b3JxdWUgdG8gYWRkLgogICAgICovCgoKICAgIGFwcGx5VG9ycXVlKHRvcnF1ZSkgewogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLndha2VVcCgpOwogICAgICB9IC8vIEFkZCByb3RhdGlvbmFsIGZvcmNlCgoKICAgICAgdGhpcy50b3JxdWUudmFkZCh0b3JxdWUsIHRoaXMudG9ycXVlKTsKICAgIH0KICAgIC8qKgogICAgICogQXBwbHkgaW1wdWxzZSB0byBhIHBvaW50IG9mIHRoZSBib2R5LiBUaGlzIGNvdWxkIGZvciBleGFtcGxlIGJlIGEgcG9pbnQgb24gdGhlIEJvZHkgc3VyZmFjZS4KICAgICAqIEFuIGltcHVsc2UgaXMgYSBmb3JjZSBhZGRlZCB0byBhIGJvZHkgZHVyaW5nIGEgc2hvcnQgcGVyaW9kIG9mIHRpbWUgKGltcHVsc2UgPSBmb3JjZSAqIHRpbWUpLgogICAgICogSW1wdWxzZXMgd2lsbCBiZSBhZGRlZCB0byBCb2R5LnZlbG9jaXR5IGFuZCBCb2R5LmFuZ3VsYXJWZWxvY2l0eS4KICAgICAqIEBwYXJhbSBpbXB1bHNlIFRoZSBhbW91bnQgb2YgaW1wdWxzZSB0byBhZGQuCiAgICAgKiBAcGFyYW0gcmVsYXRpdmVQb2ludCBBIHBvaW50IHJlbGF0aXZlIHRvIHRoZSBjZW50ZXIgb2YgbWFzcyB0byBhcHBseSB0aGUgZm9yY2Ugb24uCiAgICAgKi8KCgogICAgYXBwbHlJbXB1bHNlKGltcHVsc2UsIHJlbGF0aXZlUG9pbnQpIHsKICAgICAgaWYgKHJlbGF0aXZlUG9pbnQgPT09IHZvaWQgMCkgewogICAgICAgIHJlbGF0aXZlUG9pbnQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLndha2VVcCgpOwogICAgICB9IC8vIENvbXB1dGUgcG9pbnQgcG9zaXRpb24gcmVsYXRpdmUgdG8gdGhlIGJvZHkgY2VudGVyCgoKICAgICAgY29uc3QgciA9IHJlbGF0aXZlUG9pbnQ7IC8vIENvbXB1dGUgcHJvZHVjZWQgY2VudHJhbCBpbXB1bHNlIHZlbG9jaXR5CgogICAgICBjb25zdCB2ZWxvID0gQm9keV9hcHBseUltcHVsc2VfdmVsbzsKICAgICAgdmVsby5jb3B5KGltcHVsc2UpOwogICAgICB2ZWxvLnNjYWxlKHRoaXMuaW52TWFzcywgdmVsbyk7IC8vIEFkZCBsaW5lYXIgaW1wdWxzZQoKICAgICAgdGhpcy52ZWxvY2l0eS52YWRkKHZlbG8sIHRoaXMudmVsb2NpdHkpOyAvLyBDb21wdXRlIHByb2R1Y2VkIHJvdGF0aW9uYWwgaW1wdWxzZSB2ZWxvY2l0eQoKICAgICAgY29uc3Qgcm90VmVsbyA9IEJvZHlfYXBwbHlJbXB1bHNlX3JvdFZlbG87CiAgICAgIHIuY3Jvc3MoaW1wdWxzZSwgcm90VmVsbyk7CiAgICAgIC8qCiAgICAgICByb3RWZWxvLnggKj0gdGhpcy5pbnZJbmVydGlhLng7CiAgICAgICByb3RWZWxvLnkgKj0gdGhpcy5pbnZJbmVydGlhLnk7CiAgICAgICByb3RWZWxvLnogKj0gdGhpcy5pbnZJbmVydGlhLno7CiAgICAgICAqLwoKICAgICAgdGhpcy5pbnZJbmVydGlhV29ybGQudm11bHQocm90VmVsbywgcm90VmVsbyk7IC8vIEFkZCByb3RhdGlvbmFsIEltcHVsc2UKCiAgICAgIHRoaXMuYW5ndWxhclZlbG9jaXR5LnZhZGQocm90VmVsbywgdGhpcy5hbmd1bGFyVmVsb2NpdHkpOwogICAgfQogICAgLyoqCiAgICAgKiBBcHBseSBsb2NhbGx5LWRlZmluZWQgaW1wdWxzZSB0byBhIGxvY2FsIHBvaW50IGluIHRoZSBib2R5LgogICAgICogQHBhcmFtIGZvcmNlIFRoZSBmb3JjZSB2ZWN0b3IgdG8gYXBwbHksIGRlZmluZWQgbG9jYWxseSBpbiB0aGUgYm9keSBmcmFtZS4KICAgICAqIEBwYXJhbSBsb2NhbFBvaW50IEEgbG9jYWwgcG9pbnQgaW4gdGhlIGJvZHkgdG8gYXBwbHkgdGhlIGZvcmNlIG9uLgogICAgICovCgoKICAgIGFwcGx5TG9jYWxJbXB1bHNlKGxvY2FsSW1wdWxzZSwgbG9jYWxQb2ludCkgewogICAgICBpZiAobG9jYWxQb2ludCA9PT0gdm9pZCAwKSB7CiAgICAgICAgbG9jYWxQb2ludCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnR5cGUgIT09IEJvZHkuRFlOQU1JQykgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3Qgd29ybGRJbXB1bHNlID0gQm9keV9hcHBseUxvY2FsSW1wdWxzZV93b3JsZEltcHVsc2U7CiAgICAgIGNvbnN0IHJlbGF0aXZlUG9pbnRXb3JsZCA9IEJvZHlfYXBwbHlMb2NhbEltcHVsc2VfcmVsYXRpdmVQb2ludDsgLy8gVHJhbnNmb3JtIHRoZSBmb3JjZSB2ZWN0b3IgdG8gd29ybGQgc3BhY2UKCiAgICAgIHRoaXMudmVjdG9yVG9Xb3JsZEZyYW1lKGxvY2FsSW1wdWxzZSwgd29ybGRJbXB1bHNlKTsKICAgICAgdGhpcy52ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxQb2ludCwgcmVsYXRpdmVQb2ludFdvcmxkKTsKICAgICAgdGhpcy5hcHBseUltcHVsc2Uod29ybGRJbXB1bHNlLCByZWxhdGl2ZVBvaW50V29ybGQpOwogICAgfQogICAgLyoqCiAgICAgKiBTaG91bGQgYmUgY2FsbGVkIHdoZW5ldmVyIHlvdSBjaGFuZ2UgdGhlIGJvZHkgc2hhcGUgb3IgbWFzcy4KICAgICAqLwoKCiAgICB1cGRhdGVNYXNzUHJvcGVydGllcygpIHsKICAgICAgY29uc3QgaGFsZkV4dGVudHMgPSBCb2R5X3VwZGF0ZU1hc3NQcm9wZXJ0aWVzX2hhbGZFeHRlbnRzOwogICAgICB0aGlzLmludk1hc3MgPSB0aGlzLm1hc3MgPiAwID8gMS4wIC8gdGhpcy5tYXNzIDogMDsKICAgICAgY29uc3QgSSA9IHRoaXMuaW5lcnRpYTsKICAgICAgY29uc3QgZml4ZWQgPSB0aGlzLmZpeGVkUm90YXRpb247IC8vIEFwcHJveGltYXRlIHdpdGggQUFCQiBib3gKCiAgICAgIHRoaXMudXBkYXRlQUFCQigpOwogICAgICBoYWxmRXh0ZW50cy5zZXQoKHRoaXMuYWFiYi51cHBlckJvdW5kLnggLSB0aGlzLmFhYmIubG93ZXJCb3VuZC54KSAvIDIsICh0aGlzLmFhYmIudXBwZXJCb3VuZC55IC0gdGhpcy5hYWJiLmxvd2VyQm91bmQueSkgLyAyLCAodGhpcy5hYWJiLnVwcGVyQm91bmQueiAtIHRoaXMuYWFiYi5sb3dlckJvdW5kLnopIC8gMik7CiAgICAgIEJveC5jYWxjdWxhdGVJbmVydGlhKGhhbGZFeHRlbnRzLCB0aGlzLm1hc3MsIEkpOwogICAgICB0aGlzLmludkluZXJ0aWEuc2V0KEkueCA+IDAgJiYgIWZpeGVkID8gMS4wIC8gSS54IDogMCwgSS55ID4gMCAmJiAhZml4ZWQgPyAxLjAgLyBJLnkgOiAwLCBJLnogPiAwICYmICFmaXhlZCA/IDEuMCAvIEkueiA6IDApOwogICAgICB0aGlzLnVwZGF0ZUluZXJ0aWFXb3JsZCh0cnVlKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHdvcmxkIHZlbG9jaXR5IG9mIGEgcG9pbnQgaW4gdGhlIGJvZHkuCiAgICAgKiBAcGFyYW0gd29ybGRQb2ludAogICAgICogQHBhcmFtIHJlc3VsdAogICAgICogQHJldHVybiBUaGUgcmVzdWx0IHZlY3Rvci4KICAgICAqLwoKCiAgICBnZXRWZWxvY2l0eUF0V29ybGRQb2ludCh3b3JsZFBvaW50LCByZXN1bHQpIHsKICAgICAgY29uc3QgciA9IG5ldyBWZWMzKCk7CiAgICAgIHdvcmxkUG9pbnQudnN1Yih0aGlzLnBvc2l0aW9uLCByKTsKICAgICAgdGhpcy5hbmd1bGFyVmVsb2NpdHkuY3Jvc3MociwgcmVzdWx0KTsKICAgICAgdGhpcy52ZWxvY2l0eS52YWRkKHJlc3VsdCwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogTW92ZSB0aGUgYm9keSBmb3J3YXJkIGluIHRpbWUuCiAgICAgKiBAcGFyYW0gZHQgVGltZSBzdGVwCiAgICAgKiBAcGFyYW0gcXVhdE5vcm1hbGl6ZSBTZXQgdG8gdHJ1ZSB0byBub3JtYWxpemUgdGhlIGJvZHkgcXVhdGVybmlvbgogICAgICogQHBhcmFtIHF1YXROb3JtYWxpemVGYXN0IElmIHRoZSBxdWF0ZXJuaW9uIHNob3VsZCBiZSBub3JtYWxpemVkIHVzaW5nICJmYXN0IiBxdWF0ZXJuaW9uIG5vcm1hbGl6YXRpb24KICAgICAqLwoKCiAgICBpbnRlZ3JhdGUoZHQsIHF1YXROb3JtYWxpemUsIHF1YXROb3JtYWxpemVGYXN0KSB7CiAgICAgIC8vIFNhdmUgcHJldmlvdXMgcG9zaXRpb24KICAgICAgdGhpcy5wcmV2aW91c1Bvc2l0aW9uLmNvcHkodGhpcy5wb3NpdGlvbik7CiAgICAgIHRoaXMucHJldmlvdXNRdWF0ZXJuaW9uLmNvcHkodGhpcy5xdWF0ZXJuaW9uKTsKCiAgICAgIGlmICghKHRoaXMudHlwZSA9PT0gQm9keS5EWU5BTUlDIHx8IHRoaXMudHlwZSA9PT0gQm9keS5LSU5FTUFUSUMpIHx8IHRoaXMuc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORykgewogICAgICAgIC8vIE9ubHkgZm9yIGR5bmFtaWMKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlbG8gPSB0aGlzLnZlbG9jaXR5OwogICAgICBjb25zdCBhbmd1bGFyVmVsbyA9IHRoaXMuYW5ndWxhclZlbG9jaXR5OwogICAgICBjb25zdCBwb3MgPSB0aGlzLnBvc2l0aW9uOwogICAgICBjb25zdCBmb3JjZSA9IHRoaXMuZm9yY2U7CiAgICAgIGNvbnN0IHRvcnF1ZSA9IHRoaXMudG9ycXVlOwogICAgICBjb25zdCBxdWF0ID0gdGhpcy5xdWF0ZXJuaW9uOwogICAgICBjb25zdCBpbnZNYXNzID0gdGhpcy5pbnZNYXNzOwogICAgICBjb25zdCBpbnZJbmVydGlhID0gdGhpcy5pbnZJbmVydGlhV29ybGQ7CiAgICAgIGNvbnN0IGxpbmVhckZhY3RvciA9IHRoaXMubGluZWFyRmFjdG9yOwogICAgICBjb25zdCBpTWR0ID0gaW52TWFzcyAqIGR0OwogICAgICB2ZWxvLnggKz0gZm9yY2UueCAqIGlNZHQgKiBsaW5lYXJGYWN0b3IueDsKICAgICAgdmVsby55ICs9IGZvcmNlLnkgKiBpTWR0ICogbGluZWFyRmFjdG9yLnk7CiAgICAgIHZlbG8ueiArPSBmb3JjZS56ICogaU1kdCAqIGxpbmVhckZhY3Rvci56OwogICAgICBjb25zdCBlID0gaW52SW5lcnRpYS5lbGVtZW50czsKICAgICAgY29uc3QgYW5ndWxhckZhY3RvciA9IHRoaXMuYW5ndWxhckZhY3RvcjsKICAgICAgY29uc3QgdHggPSB0b3JxdWUueCAqIGFuZ3VsYXJGYWN0b3IueDsKICAgICAgY29uc3QgdHkgPSB0b3JxdWUueSAqIGFuZ3VsYXJGYWN0b3IueTsKICAgICAgY29uc3QgdHogPSB0b3JxdWUueiAqIGFuZ3VsYXJGYWN0b3IuejsKICAgICAgYW5ndWxhclZlbG8ueCArPSBkdCAqIChlWzBdICogdHggKyBlWzFdICogdHkgKyBlWzJdICogdHopOwogICAgICBhbmd1bGFyVmVsby55ICs9IGR0ICogKGVbM10gKiB0eCArIGVbNF0gKiB0eSArIGVbNV0gKiB0eik7CiAgICAgIGFuZ3VsYXJWZWxvLnogKz0gZHQgKiAoZVs2XSAqIHR4ICsgZVs3XSAqIHR5ICsgZVs4XSAqIHR6KTsgLy8gVXNlIG5ldyB2ZWxvY2l0eSAgLSBsZWFwIGZyb2cKCiAgICAgIHBvcy54ICs9IHZlbG8ueCAqIGR0OwogICAgICBwb3MueSArPSB2ZWxvLnkgKiBkdDsKICAgICAgcG9zLnogKz0gdmVsby56ICogZHQ7CiAgICAgIHF1YXQuaW50ZWdyYXRlKHRoaXMuYW5ndWxhclZlbG9jaXR5LCBkdCwgdGhpcy5hbmd1bGFyRmFjdG9yLCBxdWF0KTsKCiAgICAgIGlmIChxdWF0Tm9ybWFsaXplKSB7CiAgICAgICAgaWYgKHF1YXROb3JtYWxpemVGYXN0KSB7CiAgICAgICAgICBxdWF0Lm5vcm1hbGl6ZUZhc3QoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcXVhdC5ub3JtYWxpemUoKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsgLy8gVXBkYXRlIHdvcmxkIGluZXJ0aWEKCiAgICAgIHRoaXMudXBkYXRlSW5lcnRpYVdvcmxkKCk7CiAgICB9CgogIH0KICBCb2R5LmlkQ291bnRlciA9IDA7CiAgQm9keS5DT0xMSURFX0VWRU5UX05BTUUgPSAnY29sbGlkZSc7CiAgQm9keS5EWU5BTUlDID0gQk9EWV9UWVBFUy5EWU5BTUlDOwogIEJvZHkuU1RBVElDID0gQk9EWV9UWVBFUy5TVEFUSUM7CiAgQm9keS5LSU5FTUFUSUMgPSBCT0RZX1RZUEVTLktJTkVNQVRJQzsKICBCb2R5LkFXQUtFID0gQk9EWV9TTEVFUF9TVEFURVMuQVdBS0U7CiAgQm9keS5TTEVFUFkgPSBCT0RZX1NMRUVQX1NUQVRFUy5TTEVFUFk7CiAgQm9keS5TTEVFUElORyA9IEJPRFlfU0xFRVBfU1RBVEVTLlNMRUVQSU5HOwogIEJvZHkud2FrZXVwRXZlbnQgPSB7CiAgICB0eXBlOiAnd2FrZXVwJwogIH07CiAgQm9keS5zbGVlcHlFdmVudCA9IHsKICAgIHR5cGU6ICdzbGVlcHknCiAgfTsKICBCb2R5LnNsZWVwRXZlbnQgPSB7CiAgICB0eXBlOiAnc2xlZXAnCiAgfTsKICBjb25zdCB0bXBWZWMgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFF1YXQgPSBuZXcgUXVhdGVybmlvbigpOwogIGNvbnN0IHVwZGF0ZUFBQkJfc2hhcGVBQUJCID0gbmV3IEFBQkIoKTsKICBjb25zdCB1aXdfbTEgPSBuZXcgTWF0MygpOwogIGNvbnN0IHVpd19tMiA9IG5ldyBNYXQzKCk7CiAgbmV3IE1hdDMoKTsKICBjb25zdCBCb2R5X2FwcGx5Rm9yY2Vfcm90Rm9yY2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEZvcmNlX3dvcmxkRm9yY2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEZvcmNlX3JlbGF0aXZlUG9pbnRXb3JsZCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUltcHVsc2VfdmVsbyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUltcHVsc2Vfcm90VmVsbyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUxvY2FsSW1wdWxzZV93b3JsZEltcHVsc2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEltcHVsc2VfcmVsYXRpdmVQb2ludCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV91cGRhdGVNYXNzUHJvcGVydGllc19oYWxmRXh0ZW50cyA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIEJhc2UgY2xhc3MgZm9yIGJyb2FkcGhhc2UgaW1wbGVtZW50YXRpb25zCiAgICogQGF1dGhvciBzY2h0ZXBwZQogICAqLwogIGNsYXNzIEJyb2FkcGhhc2UgewogICAgLyoqCiAgICAgKiBUaGUgd29ybGQgdG8gc2VhcmNoIGZvciBjb2xsaXNpb25zIGluLgogICAgICovCgogICAgLyoqCiAgICAgKiBJZiBzZXQgdG8gdHJ1ZSwgdGhlIGJyb2FkcGhhc2UgdXNlcyBib3VuZGluZyBib3hlcyBmb3IgaW50ZXJzZWN0aW9uIHRlc3RzLCBlbHNlIGl0IHVzZXMgYm91bmRpbmcgc3BoZXJlcy4KICAgICAqLwoKICAgIC8qKgogICAgICogU2V0IHRvIHRydWUgaWYgdGhlIG9iamVjdHMgaW4gdGhlIHdvcmxkIG1vdmVkLgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICAgIHRoaXMudXNlQm91bmRpbmdCb3hlcyA9IGZhbHNlOwogICAgICB0aGlzLmRpcnR5ID0gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBjb2xsaXNpb24gcGFpcnMgZnJvbSB0aGUgd29ybGQKICAgICAqIEBwYXJhbSB3b3JsZCBUaGUgd29ybGQgdG8gc2VhcmNoIGluCiAgICAgKiBAcGFyYW0gcDEgRW1wdHkgYXJyYXkgdG8gYmUgZmlsbGVkIHdpdGggYm9keSBvYmplY3RzCiAgICAgKiBAcGFyYW0gcDIgRW1wdHkgYXJyYXkgdG8gYmUgZmlsbGVkIHdpdGggYm9keSBvYmplY3RzCiAgICAgKi8KCgogICAgY29sbGlzaW9uUGFpcnMod29ybGQsIHAxLCBwMikgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ2NvbGxpc2lvblBhaXJzIG5vdCBpbXBsZW1lbnRlZCBmb3IgdGhpcyBCcm9hZFBoYXNlIGNsYXNzIScpOwogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhIGJvZHkgcGFpciBuZWVkcyB0byBiZSBpbnRlcnNlY3Rpb24gdGVzdGVkIGF0IGFsbC4KICAgICAqLwoKCiAgICBuZWVkQnJvYWRwaGFzZUNvbGxpc2lvbihib2R5QSwgYm9keUIpIHsKICAgICAgLy8gQ2hlY2sgY29sbGlzaW9uIGZpbHRlciBtYXNrcwogICAgICBpZiAoKGJvZHlBLmNvbGxpc2lvbkZpbHRlckdyb3VwICYgYm9keUIuY29sbGlzaW9uRmlsdGVyTWFzaykgPT09IDAgfHwgKGJvZHlCLmNvbGxpc2lvbkZpbHRlckdyb3VwICYgYm9keUEuY29sbGlzaW9uRmlsdGVyTWFzaykgPT09IDApIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0gLy8gQ2hlY2sgdHlwZXMKCgogICAgICBpZiAoKChib2R5QS50eXBlICYgQm9keS5TVEFUSUMpICE9PSAwIHx8IGJvZHlBLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpICYmICgoYm9keUIudHlwZSAmIEJvZHkuU1RBVElDKSAhPT0gMCB8fCBib2R5Qi5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HKSkgewogICAgICAgIC8vIEJvdGggYm9kaWVzIGFyZSBzdGF0aWMgb3Igc2xlZXBpbmcuIFNraXAuCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kaW5nIHZvbHVtZXMgb2YgdHdvIGJvZGllcyBpbnRlcnNlY3QuCiAgICAgKi8KCgogICAgaW50ZXJzZWN0aW9uVGVzdChib2R5QSwgYm9keUIsIHBhaXJzMSwgcGFpcnMyKSB7CiAgICAgIGlmICh0aGlzLnVzZUJvdW5kaW5nQm94ZXMpIHsKICAgICAgICB0aGlzLmRvQm91bmRpbmdCb3hCcm9hZHBoYXNlKGJvZHlBLCBib2R5QiwgcGFpcnMxLCBwYWlyczIpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZG9Cb3VuZGluZ1NwaGVyZUJyb2FkcGhhc2UoYm9keUEsIGJvZHlCLCBwYWlyczEsIHBhaXJzMik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kaW5nIHNwaGVyZXMgb2YgdHdvIGJvZGllcyBhcmUgaW50ZXJzZWN0aW5nLgogICAgICogQHBhcmFtIHBhaXJzMSBib2R5QSBpcyBhcHBlbmRlZCB0byB0aGlzIGFycmF5IGlmIGludGVyc2VjdGlvbgogICAgICogQHBhcmFtIHBhaXJzMiBib2R5QiBpcyBhcHBlbmRlZCB0byB0aGlzIGFycmF5IGlmIGludGVyc2VjdGlvbgogICAgICovCgoKICAgIGRvQm91bmRpbmdTcGhlcmVCcm9hZHBoYXNlKGJvZHlBLCBib2R5QiwgcGFpcnMxLCBwYWlyczIpIHsKICAgICAgY29uc3QgciA9IEJyb2FkcGhhc2VfY29sbGlzaW9uUGFpcnNfcjsKICAgICAgYm9keUIucG9zaXRpb24udnN1Yihib2R5QS5wb3NpdGlvbiwgcik7CiAgICAgIGNvbnN0IGJvdW5kaW5nUmFkaXVzU3VtMiA9IChib2R5QS5ib3VuZGluZ1JhZGl1cyArIGJvZHlCLmJvdW5kaW5nUmFkaXVzKSAqKiAyOwogICAgICBjb25zdCBub3JtMiA9IHIubGVuZ3RoU3F1YXJlZCgpOwoKICAgICAgaWYgKG5vcm0yIDwgYm91bmRpbmdSYWRpdXNTdW0yKSB7CiAgICAgICAgcGFpcnMxLnB1c2goYm9keUEpOwogICAgICAgIHBhaXJzMi5wdXNoKGJvZHlCKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgYm91bmRpbmcgYm94ZXMgb2YgdHdvIGJvZGllcyBhcmUgaW50ZXJzZWN0aW5nLgogICAgICovCgoKICAgIGRvQm91bmRpbmdCb3hCcm9hZHBoYXNlKGJvZHlBLCBib2R5QiwgcGFpcnMxLCBwYWlyczIpIHsKICAgICAgaWYgKGJvZHlBLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgIGJvZHlBLnVwZGF0ZUFBQkIoKTsKICAgICAgfQoKICAgICAgaWYgKGJvZHlCLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgIGJvZHlCLnVwZGF0ZUFBQkIoKTsKICAgICAgfSAvLyBDaGVjayBBQUJCIC8gQUFCQgoKCiAgICAgIGlmIChib2R5QS5hYWJiLm92ZXJsYXBzKGJvZHlCLmFhYmIpKSB7CiAgICAgICAgcGFpcnMxLnB1c2goYm9keUEpOwogICAgICAgIHBhaXJzMi5wdXNoKGJvZHlCKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmVzIGR1cGxpY2F0ZSBwYWlycyBmcm9tIHRoZSBwYWlyIGFycmF5cy4KICAgICAqLwoKCiAgICBtYWtlUGFpcnNVbmlxdWUocGFpcnMxLCBwYWlyczIpIHsKICAgICAgY29uc3QgdCA9IEJyb2FkcGhhc2VfbWFrZVBhaXJzVW5pcXVlX3RlbXA7CiAgICAgIGNvbnN0IHAxID0gQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfcDE7CiAgICAgIGNvbnN0IHAyID0gQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfcDI7CiAgICAgIGNvbnN0IE4gPSBwYWlyczEubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIHAxW2ldID0gcGFpcnMxW2ldOwogICAgICAgIHAyW2ldID0gcGFpcnMyW2ldOwogICAgICB9CgogICAgICBwYWlyczEubGVuZ3RoID0gMDsKICAgICAgcGFpcnMyLmxlbmd0aCA9IDA7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgaWQxID0gcDFbaV0uaWQ7CiAgICAgICAgY29uc3QgaWQyID0gcDJbaV0uaWQ7CiAgICAgICAgY29uc3Qga2V5ID0gaWQxIDwgaWQyID8gYCR7aWQxfSwke2lkMn1gIDogYCR7aWQyfSwke2lkMX1gOwogICAgICAgIHRba2V5XSA9IGk7CiAgICAgICAgdC5rZXlzLnB1c2goa2V5KTsKICAgICAgfQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IHQua2V5cy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGtleSA9IHQua2V5cy5wb3AoKTsKICAgICAgICBjb25zdCBwYWlySW5kZXggPSB0W2tleV07CiAgICAgICAgcGFpcnMxLnB1c2gocDFbcGFpckluZGV4XSk7CiAgICAgICAgcGFpcnMyLnB1c2gocDJbcGFpckluZGV4XSk7CiAgICAgICAgZGVsZXRlIHRba2V5XTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBUbyBiZSBpbXBsZW1lbnRlZCBieSBzdWJjYXNzZXMKICAgICAqLwoKCiAgICBzZXRXb3JsZCh3b3JsZCkge30KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kaW5nIHNwaGVyZXMgb2YgdHdvIGJvZGllcyBvdmVybGFwLgogICAgICovCgoKICAgIHN0YXRpYyBib3VuZGluZ1NwaGVyZUNoZWNrKGJvZHlBLCBib2R5QikgewogICAgICBjb25zdCBkaXN0ID0gbmV3IFZlYzMoKTsgLy8gYnNjX2Rpc3Q7CgogICAgICBib2R5QS5wb3NpdGlvbi52c3ViKGJvZHlCLnBvc2l0aW9uLCBkaXN0KTsKICAgICAgY29uc3Qgc2EgPSBib2R5QS5zaGFwZXNbMF07CiAgICAgIGNvbnN0IHNiID0gYm9keUIuc2hhcGVzWzBdOwogICAgICByZXR1cm4gTWF0aC5wb3coc2EuYm91bmRpbmdTcGhlcmVSYWRpdXMgKyBzYi5ib3VuZGluZ1NwaGVyZVJhZGl1cywgMikgPiBkaXN0Lmxlbmd0aFNxdWFyZWQoKTsKICAgIH0KICAgIC8qKgogICAgICogUmV0dXJucyBhbGwgdGhlIGJvZGllcyB3aXRoaW4gdGhlIEFBQkIuCiAgICAgKi8KCgogICAgYWFiYlF1ZXJ5KHdvcmxkLCBhYWJiLCByZXN1bHQpIHsKICAgICAgY29uc29sZS53YXJuKCcuYWFiYlF1ZXJ5IGlzIG5vdCBpbXBsZW1lbnRlZCBpbiB0aGlzIEJyb2FkcGhhc2Ugc3ViY2xhc3MuJyk7CiAgICAgIHJldHVybiBbXTsKICAgIH0KCiAgfSAvLyBUZW1wIG9iamVjdHMKCiAgY29uc3QgQnJvYWRwaGFzZV9jb2xsaXNpb25QYWlyc19yID0gbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIG5ldyBRdWF0ZXJuaW9uKCk7CiAgbmV3IFZlYzMoKTsKICBjb25zdCBCcm9hZHBoYXNlX21ha2VQYWlyc1VuaXF1ZV90ZW1wID0gewogICAga2V5czogW10KICB9OwogIGNvbnN0IEJyb2FkcGhhc2VfbWFrZVBhaXJzVW5pcXVlX3AxID0gW107CiAgY29uc3QgQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfcDIgPSBbXTsKICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogTmFpdmUgYnJvYWRwaGFzZSBpbXBsZW1lbnRhdGlvbiwgdXNlZCBpbiBsYWNrIG9mIGJldHRlciBvbmVzLgogICAqCiAgICogVGhlIG5haXZlIGJyb2FkcGhhc2UgbG9va3MgYXQgYWxsIHBvc3NpYmxlIHBhaXJzIHdpdGhvdXQgcmVzdHJpY3Rpb24sIHRoZXJlZm9yZSBpdCBoYXMgY29tcGxleGl0eSBOXjIgXyh3aGljaCBpcyBiYWQpXwogICAqLwogIGNsYXNzIE5haXZlQnJvYWRwaGFzZSBleHRlbmRzIEJyb2FkcGhhc2UgewogICAgLyoqCiAgICAgKiBAdG9kbyBSZW1vdmUgdXNlbGVzcyBjb25zdHJ1Y3RvcgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFsbCB0aGUgY29sbGlzaW9uIHBhaXJzIGluIHRoZSBwaHlzaWNzIHdvcmxkCiAgICAgKi8KCgogICAgY29sbGlzaW9uUGFpcnMod29ybGQsIHBhaXJzMSwgcGFpcnMyKSB7CiAgICAgIGNvbnN0IGJvZGllcyA9IHdvcmxkLmJvZGllczsKICAgICAgY29uc3QgbiA9IGJvZGllcy5sZW5ndGg7CiAgICAgIGxldCBiaTsKICAgICAgbGV0IGJqOyAvLyBOYWl2ZSBOXjIgZnR3IQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IG47IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBpOyBqKyspIHsKICAgICAgICAgIGJpID0gYm9kaWVzW2ldOwogICAgICAgICAgYmogPSBib2RpZXNbal07CgogICAgICAgICAgaWYgKCF0aGlzLm5lZWRCcm9hZHBoYXNlQ29sbGlzaW9uKGJpLCBiaikpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5pbnRlcnNlY3Rpb25UZXN0KGJpLCBiaiwgcGFpcnMxLCBwYWlyczIpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFsbCB0aGUgYm9kaWVzIHdpdGhpbiBhbiBBQUJCLgogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSB0byBzdG9yZSByZXN1bHRpbmcgYm9kaWVzIGluLgogICAgICovCgoKICAgIGFhYmJRdWVyeSh3b3JsZCwgYWFiYiwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IFtdOwogICAgICB9CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdvcmxkLmJvZGllcy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGIgPSB3b3JsZC5ib2RpZXNbaV07CgogICAgICAgIGlmIChiLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgICAgYi51cGRhdGVBQUJCKCk7CiAgICAgICAgfSAvLyBVZ2x5IGhhY2sgdW50aWwgQm9keSBnZXRzIGFhYmIKCgogICAgICAgIGlmIChiLmFhYmIub3ZlcmxhcHMoYWFiYikpIHsKICAgICAgICAgIHJlc3VsdC5wdXNoKGIpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KCiAgfQoKICAvKioKICAgKiBTdG9yYWdlIGZvciBSYXkgY2FzdGluZyBkYXRhCiAgICovCiAgY2xhc3MgUmF5Y2FzdFJlc3VsdCB7CiAgICAvKioKICAgICAqIHJheUZyb21Xb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiByYXlUb1dvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIGhpdE5vcm1hbFdvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIGhpdFBvaW50V29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogaGFzSGl0CiAgICAgKi8KCiAgICAvKioKICAgICAqIHNoYXBlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGJvZHkKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGluZGV4IG9mIHRoZSBoaXQgdHJpYW5nbGUsIGlmIHRoZSBoaXQgc2hhcGUgd2FzIGEgdHJpbWVzaAogICAgICovCgogICAgLyoqCiAgICAgKiBEaXN0YW5jZSB0byB0aGUgaGl0LiBXaWxsIGJlIHNldCB0byAtMSBpZiB0aGVyZSB3YXMgbm8gaGl0CiAgICAgKi8KCiAgICAvKioKICAgICAqIElmIHRoZSByYXkgc2hvdWxkIHN0b3AgdHJhdmVyc2luZyB0aGUgYm9kaWVzCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLnJheUZyb21Xb3JsZCA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucmF5VG9Xb3JsZCA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaGl0Tm9ybWFsV29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmhpdFBvaW50V29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmhhc0hpdCA9IGZhbHNlOwogICAgICB0aGlzLnNoYXBlID0gbnVsbDsKICAgICAgdGhpcy5ib2R5ID0gbnVsbDsKICAgICAgdGhpcy5oaXRGYWNlSW5kZXggPSAtMTsKICAgICAgdGhpcy5kaXN0YW5jZSA9IC0xOwogICAgICB0aGlzLnNob3VsZFN0b3AgPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogUmVzZXQgYWxsIHJlc3VsdCBkYXRhLgogICAgICovCgoKICAgIHJlc2V0KCkgewogICAgICB0aGlzLnJheUZyb21Xb3JsZC5zZXRaZXJvKCk7CiAgICAgIHRoaXMucmF5VG9Xb3JsZC5zZXRaZXJvKCk7CiAgICAgIHRoaXMuaGl0Tm9ybWFsV29ybGQuc2V0WmVybygpOwogICAgICB0aGlzLmhpdFBvaW50V29ybGQuc2V0WmVybygpOwogICAgICB0aGlzLmhhc0hpdCA9IGZhbHNlOwogICAgICB0aGlzLnNoYXBlID0gbnVsbDsKICAgICAgdGhpcy5ib2R5ID0gbnVsbDsKICAgICAgdGhpcy5oaXRGYWNlSW5kZXggPSAtMTsKICAgICAgdGhpcy5kaXN0YW5jZSA9IC0xOwogICAgICB0aGlzLnNob3VsZFN0b3AgPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogYWJvcnQKICAgICAqLwoKCiAgICBhYm9ydCgpIHsKICAgICAgdGhpcy5zaG91bGRTdG9wID0gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHJlc3VsdCBkYXRhLgogICAgICovCgoKICAgIHNldChyYXlGcm9tV29ybGQsIHJheVRvV29ybGQsIGhpdE5vcm1hbFdvcmxkLCBoaXRQb2ludFdvcmxkLCBzaGFwZSwgYm9keSwgZGlzdGFuY2UpIHsKICAgICAgdGhpcy5yYXlGcm9tV29ybGQuY29weShyYXlGcm9tV29ybGQpOwogICAgICB0aGlzLnJheVRvV29ybGQuY29weShyYXlUb1dvcmxkKTsKICAgICAgdGhpcy5oaXROb3JtYWxXb3JsZC5jb3B5KGhpdE5vcm1hbFdvcmxkKTsKICAgICAgdGhpcy5oaXRQb2ludFdvcmxkLmNvcHkoaGl0UG9pbnRXb3JsZCk7CiAgICAgIHRoaXMuc2hhcGUgPSBzaGFwZTsKICAgICAgdGhpcy5ib2R5ID0gYm9keTsKICAgICAgdGhpcy5kaXN0YW5jZSA9IGRpc3RhbmNlOwogICAgfQoKICB9CgogIGxldCBfU2hhcGUkdHlwZXMkU1BIRVJFLCBfU2hhcGUkdHlwZXMkUExBTkUsIF9TaGFwZSR0eXBlcyRCT1gsIF9TaGFwZSR0eXBlcyRDWUxJTkRFUiwgX1NoYXBlJHR5cGVzJENPTlZFWFBPLCBfU2hhcGUkdHlwZXMkSEVJR0hURkksIF9TaGFwZSR0eXBlcyRUUklNRVNIOwoKICAvKioKICAgKiBSQVlfTU9ERVMKICAgKi8KICBjb25zdCBSQVlfTU9ERVMgPSB7CiAgICAvKiogQ0xPU0VTVCAqLwogICAgQ0xPU0VTVDogMSwKCiAgICAvKiogQU5ZICovCiAgICBBTlk6IDIsCgogICAgLyoqIEFMTCAqLwogICAgQUxMOiA0CiAgfTsKICAvKioKICAgKiBSYXlNb2RlCiAgICovCgogIF9TaGFwZSR0eXBlcyRTUEhFUkUgPSBTaGFwZS50eXBlcy5TUEhFUkU7CiAgX1NoYXBlJHR5cGVzJFBMQU5FID0gU2hhcGUudHlwZXMuUExBTkU7CiAgX1NoYXBlJHR5cGVzJEJPWCA9IFNoYXBlLnR5cGVzLkJPWDsKICBfU2hhcGUkdHlwZXMkQ1lMSU5ERVIgPSBTaGFwZS50eXBlcy5DWUxJTkRFUjsKICBfU2hhcGUkdHlwZXMkQ09OVkVYUE8gPSBTaGFwZS50eXBlcy5DT05WRVhQT0xZSEVEUk9OOwogIF9TaGFwZSR0eXBlcyRIRUlHSFRGSSA9IFNoYXBlLnR5cGVzLkhFSUdIVEZJRUxEOwogIF9TaGFwZSR0eXBlcyRUUklNRVNIID0gU2hhcGUudHlwZXMuVFJJTUVTSDsKCiAgLyoqCiAgICogQSBsaW5lIGluIDNEIHNwYWNlIHRoYXQgaW50ZXJzZWN0cyBib2RpZXMgYW5kIHJldHVybiBwb2ludHMuCiAgICovCiAgY2xhc3MgUmF5IHsKICAgIC8qKgogICAgICogZnJvbQogICAgICovCgogICAgLyoqCiAgICAgKiB0bwogICAgICovCgogICAgLyoqCiAgICAgKiBkaXJlY3Rpb24KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHByZWNpc2lvbiBvZiB0aGUgcmF5LiBVc2VkIHdoZW4gY2hlY2tpbmcgcGFyYWxsZWxpdHkgZXRjLgogICAgICogQGRlZmF1bHQgMC4wMDAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNldCB0byBgZmFsc2VgIGlmIHlvdSBkb24ndCB3YW50IHRoZSBSYXkgdG8gdGFrZSBgY29sbGlzaW9uUmVzcG9uc2VgIGZsYWdzIGludG8gYWNjb3VudCBvbiBib2RpZXMgYW5kIHNoYXBlcy4KICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogSWYgc2V0IHRvIGB0cnVlYCwgdGhlIHJheSBza2lwcyBhbnkgaGl0cyB3aXRoIG5vcm1hbC5kb3QocmF5RGlyZWN0aW9uKSA8IDAuCiAgICAgKiBAZGVmYXVsdCBmYWxzZQogICAgICovCgogICAgLyoqCiAgICAgKiBjb2xsaXNpb25GaWx0ZXJNYXNrCiAgICAgKiBAZGVmYXVsdCAtMQogICAgICovCgogICAgLyoqCiAgICAgKiBjb2xsaXNpb25GaWx0ZXJHcm91cAogICAgICogQGRlZmF1bHQgLTEKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGludGVyc2VjdGlvbiBtb2RlLiBTaG91bGQgYmUgUmF5LkFOWSwgUmF5LkFMTCBvciBSYXkuQ0xPU0VTVC4KICAgICAqIEBkZWZhdWx0IFJBWS5BTlkKICAgICAqLwoKICAgIC8qKgogICAgICogQ3VycmVudCByZXN1bHQgb2JqZWN0LgogICAgICovCgogICAgLyoqCiAgICAgKiBXaWxsIGJlIHNldCB0byBgdHJ1ZWAgZHVyaW5nIGludGVyc2VjdFdvcmxkKCkgaWYgdGhlIHJheSBoaXQgYW55dGhpbmcuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFVzZXItcHJvdmlkZWQgcmVzdWx0IGNhbGxiYWNrLiBXaWxsIGJlIHVzZWQgaWYgbW9kZSBpcyBSYXkuQUxMLgogICAgICovCgogICAgLyoqCiAgICAgKiBDTE9TRVNUCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFOWQogICAgICovCgogICAgLyoqCiAgICAgKiBBTEwKICAgICAqLwogICAgZ2V0IFtfU2hhcGUkdHlwZXMkU1BIRVJFXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdFNwaGVyZTsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRQTEFORV0oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RQbGFuZTsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRCT1hdKCkgewogICAgICByZXR1cm4gdGhpcy5faW50ZXJzZWN0Qm94OwogICAgfQoKICAgIGdldCBbX1NoYXBlJHR5cGVzJENZTElOREVSXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdENvbnZleDsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRDT05WRVhQT10oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RDb252ZXg7CiAgICB9CgogICAgZ2V0IFtfU2hhcGUkdHlwZXMkSEVJR0hURkldKCkgewogICAgICByZXR1cm4gdGhpcy5faW50ZXJzZWN0SGVpZ2h0ZmllbGQ7CiAgICB9CgogICAgZ2V0IFtfU2hhcGUkdHlwZXMkVFJJTUVTSF0oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RUcmltZXNoOwogICAgfQoKICAgIGNvbnN0cnVjdG9yKGZyb20sIHRvKSB7CiAgICAgIGlmIChmcm9tID09PSB2b2lkIDApIHsKICAgICAgICBmcm9tID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgaWYgKHRvID09PSB2b2lkIDApIHsKICAgICAgICB0byA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMuZnJvbSA9IGZyb20uY2xvbmUoKTsKICAgICAgdGhpcy50byA9IHRvLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5wcmVjaXNpb24gPSAwLjAwMDE7CiAgICAgIHRoaXMuY2hlY2tDb2xsaXNpb25SZXNwb25zZSA9IHRydWU7CiAgICAgIHRoaXMuc2tpcEJhY2tmYWNlcyA9IGZhbHNlOwogICAgICB0aGlzLmNvbGxpc2lvbkZpbHRlck1hc2sgPSAtMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJHcm91cCA9IC0xOwogICAgICB0aGlzLm1vZGUgPSBSYXkuQU5ZOwogICAgICB0aGlzLnJlc3VsdCA9IG5ldyBSYXljYXN0UmVzdWx0KCk7CiAgICAgIHRoaXMuaGFzSGl0ID0gZmFsc2U7CgogICAgICB0aGlzLmNhbGxiYWNrID0gcmVzdWx0ID0+IHt9OwogICAgfQogICAgLyoqCiAgICAgKiBEbyBpdGVyc2VjdGlvbiBhZ2FpbnN0IGFsbCBib2RpZXMgaW4gdGhlIGdpdmVuIFdvcmxkLgogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSByYXkgaGl0IGFueXRoaW5nLCBvdGhlcndpc2UgZmFsc2UuCiAgICAgKi8KCgogICAgaW50ZXJzZWN0V29ybGQod29ybGQsIG9wdGlvbnMpIHsKICAgICAgdGhpcy5tb2RlID0gb3B0aW9ucy5tb2RlIHx8IFJheS5BTlk7CiAgICAgIHRoaXMucmVzdWx0ID0gb3B0aW9ucy5yZXN1bHQgfHwgbmV3IFJheWNhc3RSZXN1bHQoKTsKICAgICAgdGhpcy5za2lwQmFja2ZhY2VzID0gISFvcHRpb25zLnNraXBCYWNrZmFjZXM7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyTWFzayA9IHR5cGVvZiBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJNYXNrIDogLTE7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSB0eXBlb2Ygb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJHcm91cCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogLTE7CiAgICAgIHRoaXMuY2hlY2tDb2xsaXNpb25SZXNwb25zZSA9IHR5cGVvZiBvcHRpb25zLmNoZWNrQ29sbGlzaW9uUmVzcG9uc2UgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5jaGVja0NvbGxpc2lvblJlc3BvbnNlIDogdHJ1ZTsKCiAgICAgIGlmIChvcHRpb25zLmZyb20pIHsKICAgICAgICB0aGlzLmZyb20uY29weShvcHRpb25zLmZyb20pOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy50bykgewogICAgICAgIHRoaXMudG8uY29weShvcHRpb25zLnRvKTsKICAgICAgfQoKICAgICAgdGhpcy5jYWxsYmFjayA9IG9wdGlvbnMuY2FsbGJhY2sgfHwgKCgpID0+IHt9KTsKCiAgICAgIHRoaXMuaGFzSGl0ID0gZmFsc2U7CiAgICAgIHRoaXMucmVzdWx0LnJlc2V0KCk7CiAgICAgIHRoaXMudXBkYXRlRGlyZWN0aW9uKCk7CiAgICAgIHRoaXMuZ2V0QUFCQih0bXBBQUJCJDEpOwogICAgICB0bXBBcnJheS5sZW5ndGggPSAwOwogICAgICB3b3JsZC5icm9hZHBoYXNlLmFhYmJRdWVyeSh3b3JsZCwgdG1wQUFCQiQxLCB0bXBBcnJheSk7CiAgICAgIHRoaXMuaW50ZXJzZWN0Qm9kaWVzKHRtcEFycmF5KTsKICAgICAgcmV0dXJuIHRoaXMuaGFzSGl0OwogICAgfQogICAgLyoqCiAgICAgKiBTaG9vdCBhIHJheSBhdCBhIGJvZHksIGdldCBiYWNrIGluZm9ybWF0aW9uIGFib3V0IHRoZSBoaXQuCiAgICAgKiBAZGVwcmVjYXRlZCBAcGFyYW0gcmVzdWx0IHNldCB0aGUgcmVzdWx0IHByb3BlcnR5IG9mIHRoZSBSYXkgaW5zdGVhZC4KICAgICAqLwoKCiAgICBpbnRlcnNlY3RCb2R5KGJvZHksIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0KSB7CiAgICAgICAgdGhpcy5yZXN1bHQgPSByZXN1bHQ7CiAgICAgICAgdGhpcy51cGRhdGVEaXJlY3Rpb24oKTsKICAgICAgfQoKICAgICAgY29uc3QgY2hlY2tDb2xsaXNpb25SZXNwb25zZSA9IHRoaXMuY2hlY2tDb2xsaXNpb25SZXNwb25zZTsKCiAgICAgIGlmIChjaGVja0NvbGxpc2lvblJlc3BvbnNlICYmICFib2R5LmNvbGxpc2lvblJlc3BvbnNlKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoKHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgJiBib2R5LmNvbGxpc2lvbkZpbHRlck1hc2spID09PSAwIHx8IChib2R5LmNvbGxpc2lvbkZpbHRlckdyb3VwICYgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrKSA9PT0gMCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3QgeGkgPSBpbnRlcnNlY3RCb2R5X3hpOwogICAgICBjb25zdCBxaSA9IGludGVyc2VjdEJvZHlfcWk7CgogICAgICBmb3IgKGxldCBpID0gMCwgTiA9IGJvZHkuc2hhcGVzLmxlbmd0aDsgaSA8IE47IGkrKykgewogICAgICAgIGNvbnN0IHNoYXBlID0gYm9keS5zaGFwZXNbaV07CgogICAgICAgIGlmIChjaGVja0NvbGxpc2lvblJlc3BvbnNlICYmICFzaGFwZS5jb2xsaXNpb25SZXNwb25zZSkgewogICAgICAgICAgY29udGludWU7IC8vIFNraXAKICAgICAgICB9CgogICAgICAgIGJvZHkucXVhdGVybmlvbi5tdWx0KGJvZHkuc2hhcGVPcmllbnRhdGlvbnNbaV0sIHFpKTsKICAgICAgICBib2R5LnF1YXRlcm5pb24udm11bHQoYm9keS5zaGFwZU9mZnNldHNbaV0sIHhpKTsKICAgICAgICB4aS52YWRkKGJvZHkucG9zaXRpb24sIHhpKTsKICAgICAgICB0aGlzLmludGVyc2VjdFNoYXBlKHNoYXBlLCBxaSwgeGksIGJvZHkpOwoKICAgICAgICBpZiAodGhpcy5yZXN1bHQuc2hvdWxkU3RvcCkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFNob290IGEgcmF5IGF0IGFuIGFycmF5IGJvZGllcywgZ2V0IGJhY2sgaW5mb3JtYXRpb24gYWJvdXQgdGhlIGhpdC4KICAgICAqIEBwYXJhbSBib2RpZXMgQW4gYXJyYXkgb2YgQm9keSBvYmplY3RzLgogICAgICogQGRlcHJlY2F0ZWQgQHBhcmFtIHJlc3VsdCBzZXQgdGhlIHJlc3VsdCBwcm9wZXJ0eSBvZiB0aGUgUmF5IGluc3RlYWQuCiAgICAgKgogICAgICovCgoKICAgIGludGVyc2VjdEJvZGllcyhib2RpZXMsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0KSB7CiAgICAgICAgdGhpcy5yZXN1bHQgPSByZXN1bHQ7CiAgICAgICAgdGhpcy51cGRhdGVEaXJlY3Rpb24oKTsKICAgICAgfQoKICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBib2RpZXMubGVuZ3RoOyAhdGhpcy5yZXN1bHQuc2hvdWxkU3RvcCAmJiBpIDwgbDsgaSsrKSB7CiAgICAgICAgdGhpcy5pbnRlcnNlY3RCb2R5KGJvZGllc1tpXSk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyB0aGUgZGlyZWN0aW9uIHZlY3Rvci4KICAgICAqLwoKCiAgICB1cGRhdGVEaXJlY3Rpb24oKSB7CiAgICAgIHRoaXMudG8udnN1Yih0aGlzLmZyb20sIHRoaXMuZGlyZWN0aW9uKTsKICAgICAgdGhpcy5kaXJlY3Rpb24ubm9ybWFsaXplKCk7CiAgICB9CgogICAgaW50ZXJzZWN0U2hhcGUoc2hhcGUsIHF1YXQsIHBvc2l0aW9uLCBib2R5KSB7CiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207IC8vIENoZWNraW5nIGJvdW5kaW5nU3BoZXJlCgogICAgICBjb25zdCBkaXN0YW5jZSA9IGRpc3RhbmNlRnJvbUludGVyc2VjdGlvbihmcm9tLCB0aGlzLmRpcmVjdGlvbiwgcG9zaXRpb24pOwoKICAgICAgaWYgKGRpc3RhbmNlID4gc2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IGludGVyc2VjdE1ldGhvZCA9IHRoaXNbc2hhcGUudHlwZV07CgogICAgICBpZiAoaW50ZXJzZWN0TWV0aG9kKSB7CiAgICAgICAgaW50ZXJzZWN0TWV0aG9kLmNhbGwodGhpcywgc2hhcGUsIHF1YXQsIHBvc2l0aW9uLCBib2R5LCBzaGFwZSk7CiAgICAgIH0KICAgIH0KCiAgICBfaW50ZXJzZWN0Qm94KGJveCwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHJlcG9ydGVkU2hhcGUpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdENvbnZleChib3guY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSk7CiAgICB9CgogICAgX2ludGVyc2VjdFBsYW5lKHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSkgewogICAgICBjb25zdCBmcm9tID0gdGhpcy5mcm9tOwogICAgICBjb25zdCB0byA9IHRoaXMudG87CiAgICAgIGNvbnN0IGRpcmVjdGlvbiA9IHRoaXMuZGlyZWN0aW9uOyAvLyBHZXQgcGxhbmUgbm9ybWFsCgogICAgICBjb25zdCB3b3JsZE5vcm1hbCA9IG5ldyBWZWMzKDAsIDAsIDEpOwogICAgICBxdWF0LnZtdWx0KHdvcmxkTm9ybWFsLCB3b3JsZE5vcm1hbCk7CiAgICAgIGNvbnN0IGxlbiA9IG5ldyBWZWMzKCk7CiAgICAgIGZyb20udnN1Yihwb3NpdGlvbiwgbGVuKTsKICAgICAgY29uc3QgcGxhbmVUb0Zyb20gPSBsZW4uZG90KHdvcmxkTm9ybWFsKTsKICAgICAgdG8udnN1Yihwb3NpdGlvbiwgbGVuKTsKICAgICAgY29uc3QgcGxhbmVUb1RvID0gbGVuLmRvdCh3b3JsZE5vcm1hbCk7CgogICAgICBpZiAocGxhbmVUb0Zyb20gKiBwbGFuZVRvVG8gPiAwKSB7CiAgICAgICAgLy8gImZyb20iIGFuZCAidG8iIGFyZSBvbiB0aGUgc2FtZSBzaWRlIG9mIHRoZSBwbGFuZS4uLiBiYWlsIG91dAogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKGZyb20uZGlzdGFuY2VUbyh0bykgPCBwbGFuZVRvRnJvbSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3Qgbl9kb3RfZGlyID0gd29ybGROb3JtYWwuZG90KGRpcmVjdGlvbik7CgogICAgICBpZiAoTWF0aC5hYnMobl9kb3RfZGlyKSA8IHRoaXMucHJlY2lzaW9uKSB7CiAgICAgICAgLy8gTm8gaW50ZXJzZWN0aW9uCiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCBwbGFuZVBvaW50VG9Gcm9tID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgZGlyX3NjYWxlZF93aXRoX3QgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBoaXRQb2ludFdvcmxkID0gbmV3IFZlYzMoKTsKICAgICAgZnJvbS52c3ViKHBvc2l0aW9uLCBwbGFuZVBvaW50VG9Gcm9tKTsKICAgICAgY29uc3QgdCA9IC13b3JsZE5vcm1hbC5kb3QocGxhbmVQb2ludFRvRnJvbSkgLyBuX2RvdF9kaXI7CiAgICAgIGRpcmVjdGlvbi5zY2FsZSh0LCBkaXJfc2NhbGVkX3dpdGhfdCk7CiAgICAgIGZyb20udmFkZChkaXJfc2NhbGVkX3dpdGhfdCwgaGl0UG9pbnRXb3JsZCk7CiAgICAgIHRoaXMucmVwb3J0SW50ZXJzZWN0aW9uKHdvcmxkTm9ybWFsLCBoaXRQb2ludFdvcmxkLCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgd29ybGQgQUFCQiBvZiB0aGUgcmF5LgogICAgICovCgoKICAgIGdldEFBQkIoYWFiYikgewogICAgICBjb25zdCB7CiAgICAgICAgbG93ZXJCb3VuZCwKICAgICAgICB1cHBlckJvdW5kCiAgICAgIH0gPSBhYWJiOwogICAgICBjb25zdCB0byA9IHRoaXMudG87CiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207CiAgICAgIGxvd2VyQm91bmQueCA9IE1hdGgubWluKHRvLngsIGZyb20ueCk7CiAgICAgIGxvd2VyQm91bmQueSA9IE1hdGgubWluKHRvLnksIGZyb20ueSk7CiAgICAgIGxvd2VyQm91bmQueiA9IE1hdGgubWluKHRvLnosIGZyb20ueik7CiAgICAgIHVwcGVyQm91bmQueCA9IE1hdGgubWF4KHRvLngsIGZyb20ueCk7CiAgICAgIHVwcGVyQm91bmQueSA9IE1hdGgubWF4KHRvLnksIGZyb20ueSk7CiAgICAgIHVwcGVyQm91bmQueiA9IE1hdGgubWF4KHRvLnosIGZyb20ueik7CiAgICB9CgogICAgX2ludGVyc2VjdEhlaWdodGZpZWxkKHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSkgewogICAgICBzaGFwZS5kYXRhOwogICAgICBzaGFwZS5lbGVtZW50U2l6ZTsgLy8gQ29udmVydCB0aGUgcmF5IHRvIGxvY2FsIGhlaWdodGZpZWxkIGNvb3JkaW5hdGVzCgogICAgICBjb25zdCBsb2NhbFJheSA9IGludGVyc2VjdEhlaWdodGZpZWxkX2xvY2FsUmF5OyAvL25ldyBSYXkodGhpcy5mcm9tLCB0aGlzLnRvKTsKCiAgICAgIGxvY2FsUmF5LmZyb20uY29weSh0aGlzLmZyb20pOwogICAgICBsb2NhbFJheS50by5jb3B5KHRoaXMudG8pOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zaXRpb24sIHF1YXQsIGxvY2FsUmF5LmZyb20sIGxvY2FsUmF5LmZyb20pOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zaXRpb24sIHF1YXQsIGxvY2FsUmF5LnRvLCBsb2NhbFJheS50byk7CiAgICAgIGxvY2FsUmF5LnVwZGF0ZURpcmVjdGlvbigpOyAvLyBHZXQgdGhlIGluZGV4IG9mIHRoZSBkYXRhIHBvaW50cyB0byB0ZXN0IGFnYWluc3QKCiAgICAgIGNvbnN0IGluZGV4ID0gaW50ZXJzZWN0SGVpZ2h0ZmllbGRfaW5kZXg7CiAgICAgIGxldCBpTWluWDsKICAgICAgbGV0IGlNaW5ZOwogICAgICBsZXQgaU1heFg7CiAgICAgIGxldCBpTWF4WTsgLy8gU2V0IHRvIG1heAoKICAgICAgaU1pblggPSBpTWluWSA9IDA7CiAgICAgIGlNYXhYID0gaU1heFkgPSBzaGFwZS5kYXRhLmxlbmd0aCAtIDE7CiAgICAgIGNvbnN0IGFhYmIgPSBuZXcgQUFCQigpOwogICAgICBsb2NhbFJheS5nZXRBQUJCKGFhYmIpOwogICAgICBzaGFwZS5nZXRJbmRleE9mUG9zaXRpb24oYWFiYi5sb3dlckJvdW5kLngsIGFhYmIubG93ZXJCb3VuZC55LCBpbmRleCwgdHJ1ZSk7CiAgICAgIGlNaW5YID0gTWF0aC5tYXgoaU1pblgsIGluZGV4WzBdKTsKICAgICAgaU1pblkgPSBNYXRoLm1heChpTWluWSwgaW5kZXhbMV0pOwogICAgICBzaGFwZS5nZXRJbmRleE9mUG9zaXRpb24oYWFiYi51cHBlckJvdW5kLngsIGFhYmIudXBwZXJCb3VuZC55LCBpbmRleCwgdHJ1ZSk7CiAgICAgIGlNYXhYID0gTWF0aC5taW4oaU1heFgsIGluZGV4WzBdICsgMSk7CiAgICAgIGlNYXhZID0gTWF0aC5taW4oaU1heFksIGluZGV4WzFdICsgMSk7CgogICAgICBmb3IgKGxldCBpID0gaU1pblg7IGkgPCBpTWF4WDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IGlNaW5ZOyBqIDwgaU1heFk7IGorKykgewogICAgICAgICAgaWYgKHRoaXMucmVzdWx0LnNob3VsZFN0b3ApIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHNoYXBlLmdldEFhYmJBdEluZGV4KGksIGosIGFhYmIpOwoKICAgICAgICAgIGlmICghYWFiYi5vdmVybGFwc1JheShsb2NhbFJheSkpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9IC8vIExvd2VyIHRyaWFuZ2xlCgoKICAgICAgICAgIHNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIGZhbHNlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShwb3NpdGlvbiwgcXVhdCwgc2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgdGhpcy5faW50ZXJzZWN0Q29udmV4KHNoYXBlLnBpbGxhckNvbnZleCwgcXVhdCwgd29ybGRQaWxsYXJPZmZzZXQsIGJvZHksIHJlcG9ydGVkU2hhcGUsIGludGVyc2VjdENvbnZleE9wdGlvbnMpOwoKICAgICAgICAgIGlmICh0aGlzLnJlc3VsdC5zaG91bGRTdG9wKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0gLy8gVXBwZXIgdHJpYW5nbGUKCgogICAgICAgICAgc2hhcGUuZ2V0Q29udmV4VHJpYW5nbGVQaWxsYXIoaSwgaiwgdHJ1ZSk7CiAgICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUocG9zaXRpb24sIHF1YXQsIHNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIHRoaXMuX2ludGVyc2VjdENvbnZleChzaGFwZS5waWxsYXJDb252ZXgsIHF1YXQsIHdvcmxkUGlsbGFyT2Zmc2V0LCBib2R5LCByZXBvcnRlZFNoYXBlLCBpbnRlcnNlY3RDb252ZXhPcHRpb25zKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBfaW50ZXJzZWN0U3BoZXJlKHNwaGVyZSwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHJlcG9ydGVkU2hhcGUpIHsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCByID0gc3BoZXJlLnJhZGl1czsKICAgICAgY29uc3QgYSA9ICh0by54IC0gZnJvbS54KSAqKiAyICsgKHRvLnkgLSBmcm9tLnkpICoqIDIgKyAodG8ueiAtIGZyb20ueikgKiogMjsKICAgICAgY29uc3QgYiA9IDIgKiAoKHRvLnggLSBmcm9tLngpICogKGZyb20ueCAtIHBvc2l0aW9uLngpICsgKHRvLnkgLSBmcm9tLnkpICogKGZyb20ueSAtIHBvc2l0aW9uLnkpICsgKHRvLnogLSBmcm9tLnopICogKGZyb20ueiAtIHBvc2l0aW9uLnopKTsKICAgICAgY29uc3QgYyA9IChmcm9tLnggLSBwb3NpdGlvbi54KSAqKiAyICsgKGZyb20ueSAtIHBvc2l0aW9uLnkpICoqIDIgKyAoZnJvbS56IC0gcG9zaXRpb24ueikgKiogMiAtIHIgKiogMjsKICAgICAgY29uc3QgZGVsdGEgPSBiICoqIDIgLSA0ICogYSAqIGM7CiAgICAgIGNvbnN0IGludGVyc2VjdGlvblBvaW50ID0gUmF5X2ludGVyc2VjdFNwaGVyZV9pbnRlcnNlY3Rpb25Qb2ludDsKICAgICAgY29uc3Qgbm9ybWFsID0gUmF5X2ludGVyc2VjdFNwaGVyZV9ub3JtYWw7CgogICAgICBpZiAoZGVsdGEgPCAwKSB7CiAgICAgICAgLy8gTm8gaW50ZXJzZWN0aW9uCiAgICAgICAgcmV0dXJuOwogICAgICB9IGVsc2UgaWYgKGRlbHRhID09PSAwKSB7CiAgICAgICAgLy8gc2luZ2xlIGludGVyc2VjdGlvbiBwb2ludAogICAgICAgIGZyb20ubGVycCh0bywgZGVsdGEsIGludGVyc2VjdGlvblBvaW50KTsKICAgICAgICBpbnRlcnNlY3Rpb25Qb2ludC52c3ViKHBvc2l0aW9uLCBub3JtYWwpOwogICAgICAgIG5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdGlvblBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgZDEgPSAoLWIgLSBNYXRoLnNxcnQoZGVsdGEpKSAvICgyICogYSk7CiAgICAgICAgY29uc3QgZDIgPSAoLWIgKyBNYXRoLnNxcnQoZGVsdGEpKSAvICgyICogYSk7CgogICAgICAgIGlmIChkMSA+PSAwICYmIGQxIDw9IDEpIHsKICAgICAgICAgIGZyb20ubGVycCh0bywgZDEsIGludGVyc2VjdGlvblBvaW50KTsKICAgICAgICAgIGludGVyc2VjdGlvblBvaW50LnZzdWIocG9zaXRpb24sIG5vcm1hbCk7CiAgICAgICAgICBub3JtYWwubm9ybWFsaXplKCk7CiAgICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdGlvblBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5yZXN1bHQuc2hvdWxkU3RvcCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKGQyID49IDAgJiYgZDIgPD0gMSkgewogICAgICAgICAgZnJvbS5sZXJwKHRvLCBkMiwgaW50ZXJzZWN0aW9uUG9pbnQpOwogICAgICAgICAgaW50ZXJzZWN0aW9uUG9pbnQudnN1Yihwb3NpdGlvbiwgbm9ybWFsKTsKICAgICAgICAgIG5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgICAgIHRoaXMucmVwb3J0SW50ZXJzZWN0aW9uKG5vcm1hbCwgaW50ZXJzZWN0aW9uUG9pbnQsIHJlcG9ydGVkU2hhcGUsIGJvZHksIC0xKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBfaW50ZXJzZWN0Q29udmV4KHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSwgb3B0aW9ucykgewogICAgICBjb25zdCBub3JtYWwgPSBpbnRlcnNlY3RDb252ZXhfbm9ybWFsOwogICAgICBjb25zdCB2ZWN0b3IgPSBpbnRlcnNlY3RDb252ZXhfdmVjdG9yOwogICAgICBjb25zdCBmYWNlTGlzdCA9IG9wdGlvbnMgJiYgb3B0aW9ucy5mYWNlTGlzdCB8fCBudWxsOyAvLyBDaGVja2luZyBmYWNlcwoKICAgICAgY29uc3QgZmFjZXMgPSBzaGFwZS5mYWNlczsKICAgICAgY29uc3QgdmVydGljZXMgPSBzaGFwZS52ZXJ0aWNlczsKICAgICAgY29uc3Qgbm9ybWFscyA9IHNoYXBlLmZhY2VOb3JtYWxzOwogICAgICBjb25zdCBkaXJlY3Rpb24gPSB0aGlzLmRpcmVjdGlvbjsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCBmcm9tVG9EaXN0YW5jZSA9IGZyb20uZGlzdGFuY2VUbyh0byk7CiAgICAgIGNvbnN0IE5mYWNlcyA9IGZhY2VMaXN0ID8gZmFjZUxpc3QubGVuZ3RoIDogZmFjZXMubGVuZ3RoOwogICAgICBjb25zdCByZXN1bHQgPSB0aGlzLnJlc3VsdDsKCiAgICAgIGZvciAobGV0IGogPSAwOyAhcmVzdWx0LnNob3VsZFN0b3AgJiYgaiA8IE5mYWNlczsgaisrKSB7CiAgICAgICAgY29uc3QgZmkgPSBmYWNlTGlzdCA/IGZhY2VMaXN0W2pdIDogajsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbZmldOwogICAgICAgIGNvbnN0IGZhY2VOb3JtYWwgPSBub3JtYWxzW2ZpXTsKICAgICAgICBjb25zdCBxID0gcXVhdDsKICAgICAgICBjb25zdCB4ID0gcG9zaXRpb247IC8vIGRldGVybWluZSBpZiByYXkgaW50ZXJzZWN0cyB0aGUgcGxhbmUgb2YgdGhlIGZhY2UKICAgICAgICAvLyBub3RlOiB0aGlzIHdvcmtzIHJlZ2FyZGxlc3Mgb2YgdGhlIGRpcmVjdGlvbiBvZiB0aGUgZmFjZSBub3JtYWwKICAgICAgICAvLyBHZXQgcGxhbmUgcG9pbnQgaW4gd29ybGQgY29vcmRpbmF0ZXMuLi4KCiAgICAgICAgdmVjdG9yLmNvcHkodmVydGljZXNbZmFjZVswXV0pOwogICAgICAgIHEudm11bHQodmVjdG9yLCB2ZWN0b3IpOwogICAgICAgIHZlY3Rvci52YWRkKHgsIHZlY3Rvcik7IC8vIC4uLmJ1dCBtYWtlIGl0IHJlbGF0aXZlIHRvIHRoZSByYXkgZnJvbS4gV2UnbGwgZml4IHRoaXMgbGF0ZXIuCgogICAgICAgIHZlY3Rvci52c3ViKGZyb20sIHZlY3Rvcik7IC8vIEdldCBwbGFuZSBub3JtYWwKCiAgICAgICAgcS52bXVsdChmYWNlTm9ybWFsLCBub3JtYWwpOyAvLyBJZiB0aGlzIGRvdCBwcm9kdWN0IGlzIG5lZ2F0aXZlLCB3ZSBoYXZlIHNvbWV0aGluZyBpbnRlcmVzdGluZwoKICAgICAgICBjb25zdCBkb3QgPSBkaXJlY3Rpb24uZG90KG5vcm1hbCk7IC8vIEJhaWwgb3V0IGlmIHJheSBhbmQgcGxhbmUgYXJlIHBhcmFsbGVsCgogICAgICAgIGlmIChNYXRoLmFicyhkb3QpIDwgdGhpcy5wcmVjaXNpb24pIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0gLy8gY2FsYyBkaXN0YW5jZSB0byBwbGFuZQoKCiAgICAgICAgY29uc3Qgc2NhbGFyID0gbm9ybWFsLmRvdCh2ZWN0b3IpIC8gZG90OyAvLyBpZiBuZWdhdGl2ZSBkaXN0YW5jZSwgdGhlbiBwbGFuZSBpcyBiZWhpbmQgcmF5CgogICAgICAgIGlmIChzY2FsYXIgPCAwKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9IC8vIGlmIChkb3QgPCAwKSB7CiAgICAgICAgLy8gSW50ZXJzZWN0aW9uIHBvaW50IGlzIGZyb20gKyBkaXJlY3Rpb24gKiBzY2FsYXIKCgogICAgICAgIGRpcmVjdGlvbi5zY2FsZShzY2FsYXIsIGludGVyc2VjdFBvaW50KTsKICAgICAgICBpbnRlcnNlY3RQb2ludC52YWRkKGZyb20sIGludGVyc2VjdFBvaW50KTsgLy8gYSBpcyB0aGUgcG9pbnQgd2UgY29tcGFyZSBwb2ludHMgYiBhbmQgYyB3aXRoLgoKICAgICAgICBhLmNvcHkodmVydGljZXNbZmFjZVswXV0pOwogICAgICAgIHEudm11bHQoYSwgYSk7CiAgICAgICAgeC52YWRkKGEsIGEpOwoKICAgICAgICBmb3IgKGxldCBpID0gMTsgIXJlc3VsdC5zaG91bGRTdG9wICYmIGkgPCBmYWNlLmxlbmd0aCAtIDE7IGkrKykgewogICAgICAgICAgLy8gVHJhbnNmb3JtIDMgdmVydGljZXMgdG8gd29ybGQgY29vcmRzCiAgICAgICAgICBiLmNvcHkodmVydGljZXNbZmFjZVtpXV0pOwogICAgICAgICAgYy5jb3B5KHZlcnRpY2VzW2ZhY2VbaSArIDFdXSk7CiAgICAgICAgICBxLnZtdWx0KGIsIGIpOwogICAgICAgICAgcS52bXVsdChjLCBjKTsKICAgICAgICAgIHgudmFkZChiLCBiKTsKICAgICAgICAgIHgudmFkZChjLCBjKTsKICAgICAgICAgIGNvbnN0IGRpc3RhbmNlID0gaW50ZXJzZWN0UG9pbnQuZGlzdGFuY2VUbyhmcm9tKTsKCiAgICAgICAgICBpZiAoIShSYXkucG9pbnRJblRyaWFuZ2xlKGludGVyc2VjdFBvaW50LCBhLCBiLCBjKSB8fCBSYXkucG9pbnRJblRyaWFuZ2xlKGludGVyc2VjdFBvaW50LCBiLCBhLCBjKSkgfHwgZGlzdGFuY2UgPiBmcm9tVG9EaXN0YW5jZSkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdFBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCBmaSk7CiAgICAgICAgfSAvLyB9CgogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEB0b2RvIE9wdGltaXplIGJ5IHRyYW5zZm9ybWluZyB0aGUgd29ybGQgdG8gbG9jYWwgc3BhY2UgZmlyc3QuCiAgICAgKiBAdG9kbyBVc2UgT2N0cmVlIGxvb2t1cAogICAgICovCgoKICAgIF9pbnRlcnNlY3RUcmltZXNoKG1lc2gsIHF1YXQsIHBvc2l0aW9uLCBib2R5LCByZXBvcnRlZFNoYXBlLCBvcHRpb25zKSB7CiAgICAgIGNvbnN0IG5vcm1hbCA9IGludGVyc2VjdFRyaW1lc2hfbm9ybWFsOwogICAgICBjb25zdCB0cmlhbmdsZXMgPSBpbnRlcnNlY3RUcmltZXNoX3RyaWFuZ2xlczsKICAgICAgY29uc3QgdHJlZVRyYW5zZm9ybSA9IGludGVyc2VjdFRyaW1lc2hfdHJlZVRyYW5zZm9ybTsKICAgICAgY29uc3QgdmVjdG9yID0gaW50ZXJzZWN0Q29udmV4X3ZlY3RvcjsKICAgICAgY29uc3QgbG9jYWxEaXJlY3Rpb24gPSBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRGlyZWN0aW9uOwogICAgICBjb25zdCBsb2NhbEZyb20gPSBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRnJvbTsKICAgICAgY29uc3QgbG9jYWxUbyA9IGludGVyc2VjdFRyaW1lc2hfbG9jYWxUbzsKICAgICAgY29uc3Qgd29ybGRJbnRlcnNlY3RQb2ludCA9IGludGVyc2VjdFRyaW1lc2hfd29ybGRJbnRlcnNlY3RQb2ludDsKICAgICAgY29uc3Qgd29ybGROb3JtYWwgPSBpbnRlcnNlY3RUcmltZXNoX3dvcmxkTm9ybWFsOyAvLyBDaGVja2luZyBmYWNlcwoKICAgICAgY29uc3QgaW5kaWNlcyA9IG1lc2guaW5kaWNlczsKICAgICAgbWVzaC52ZXJ0aWNlczsgLy8gY29uc3Qgbm9ybWFscyA9IG1lc2guZmFjZU5vcm1hbHMKCiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207CiAgICAgIGNvbnN0IHRvID0gdGhpcy50bzsKICAgICAgY29uc3QgZGlyZWN0aW9uID0gdGhpcy5kaXJlY3Rpb247CiAgICAgIHRyZWVUcmFuc2Zvcm0ucG9zaXRpb24uY29weShwb3NpdGlvbik7CiAgICAgIHRyZWVUcmFuc2Zvcm0ucXVhdGVybmlvbi5jb3B5KHF1YXQpOyAvLyBUcmFuc2Zvcm0gcmF5IHRvIGxvY2FsIHNwYWNlIQoKICAgICAgVHJhbnNmb3JtLnZlY3RvclRvTG9jYWxGcmFtZShwb3NpdGlvbiwgcXVhdCwgZGlyZWN0aW9uLCBsb2NhbERpcmVjdGlvbik7CiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZShwb3NpdGlvbiwgcXVhdCwgZnJvbSwgbG9jYWxGcm9tKTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0LCB0bywgbG9jYWxUbyk7CiAgICAgIGxvY2FsVG8ueCAqPSBtZXNoLnNjYWxlLng7CiAgICAgIGxvY2FsVG8ueSAqPSBtZXNoLnNjYWxlLnk7CiAgICAgIGxvY2FsVG8ueiAqPSBtZXNoLnNjYWxlLno7CiAgICAgIGxvY2FsRnJvbS54ICo9IG1lc2guc2NhbGUueDsKICAgICAgbG9jYWxGcm9tLnkgKj0gbWVzaC5zY2FsZS55OwogICAgICBsb2NhbEZyb20ueiAqPSBtZXNoLnNjYWxlLno7CiAgICAgIGxvY2FsVG8udnN1Yihsb2NhbEZyb20sIGxvY2FsRGlyZWN0aW9uKTsKICAgICAgbG9jYWxEaXJlY3Rpb24ubm9ybWFsaXplKCk7CiAgICAgIGNvbnN0IGZyb21Ub0Rpc3RhbmNlU3F1YXJlZCA9IGxvY2FsRnJvbS5kaXN0YW5jZVNxdWFyZWQobG9jYWxUbyk7CiAgICAgIG1lc2gudHJlZS5yYXlRdWVyeSh0aGlzLCB0cmVlVHJhbnNmb3JtLCB0cmlhbmdsZXMpOwoKICAgICAgZm9yIChsZXQgaSA9IDAsIE4gPSB0cmlhbmdsZXMubGVuZ3RoOyAhdGhpcy5yZXN1bHQuc2hvdWxkU3RvcCAmJiBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCB0cmlhbmdsZXNJbmRleCA9IHRyaWFuZ2xlc1tpXTsKICAgICAgICBtZXNoLmdldE5vcm1hbCh0cmlhbmdsZXNJbmRleCwgbm9ybWFsKTsgLy8gZGV0ZXJtaW5lIGlmIHJheSBpbnRlcnNlY3RzIHRoZSBwbGFuZSBvZiB0aGUgZmFjZQogICAgICAgIC8vIG5vdGU6IHRoaXMgd29ya3MgcmVnYXJkbGVzcyBvZiB0aGUgZGlyZWN0aW9uIG9mIHRoZSBmYWNlIG5vcm1hbAogICAgICAgIC8vIEdldCBwbGFuZSBwb2ludCBpbiB3b3JsZCBjb29yZGluYXRlcy4uLgoKICAgICAgICBtZXNoLmdldFZlcnRleChpbmRpY2VzW3RyaWFuZ2xlc0luZGV4ICogM10sIGEpOyAvLyAuLi5idXQgbWFrZSBpdCByZWxhdGl2ZSB0byB0aGUgcmF5IGZyb20uIFdlJ2xsIGZpeCB0aGlzIGxhdGVyLgoKICAgICAgICBhLnZzdWIobG9jYWxGcm9tLCB2ZWN0b3IpOyAvLyBJZiB0aGlzIGRvdCBwcm9kdWN0IGlzIG5lZ2F0aXZlLCB3ZSBoYXZlIHNvbWV0aGluZyBpbnRlcmVzdGluZwoKICAgICAgICBjb25zdCBkb3QgPSBsb2NhbERpcmVjdGlvbi5kb3Qobm9ybWFsKTsgLy8gQmFpbCBvdXQgaWYgcmF5IGFuZCBwbGFuZSBhcmUgcGFyYWxsZWwKICAgICAgICAvLyBpZiAoTWF0aC5hYnMoIGRvdCApIDwgdGhpcy5wcmVjaXNpb24pewogICAgICAgIC8vICAgICBjb250aW51ZTsKICAgICAgICAvLyB9CiAgICAgICAgLy8gY2FsYyBkaXN0YW5jZSB0byBwbGFuZQoKICAgICAgICBjb25zdCBzY2FsYXIgPSBub3JtYWwuZG90KHZlY3RvcikgLyBkb3Q7IC8vIGlmIG5lZ2F0aXZlIGRpc3RhbmNlLCB0aGVuIHBsYW5lIGlzIGJlaGluZCByYXkKCiAgICAgICAgaWYgKHNjYWxhciA8IDApIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0gLy8gSW50ZXJzZWN0aW9uIHBvaW50IGlzIGZyb20gKyBkaXJlY3Rpb24gKiBzY2FsYXIKCgogICAgICAgIGxvY2FsRGlyZWN0aW9uLnNjYWxlKHNjYWxhciwgaW50ZXJzZWN0UG9pbnQpOwogICAgICAgIGludGVyc2VjdFBvaW50LnZhZGQobG9jYWxGcm9tLCBpbnRlcnNlY3RQb2ludCk7IC8vIEdldCB0cmlhbmdsZSB2ZXJ0aWNlcwoKICAgICAgICBtZXNoLmdldFZlcnRleChpbmRpY2VzW3RyaWFuZ2xlc0luZGV4ICogMyArIDFdLCBiKTsKICAgICAgICBtZXNoLmdldFZlcnRleChpbmRpY2VzW3RyaWFuZ2xlc0luZGV4ICogMyArIDJdLCBjKTsKICAgICAgICBjb25zdCBzcXVhcmVkRGlzdGFuY2UgPSBpbnRlcnNlY3RQb2ludC5kaXN0YW5jZVNxdWFyZWQobG9jYWxGcm9tKTsKCiAgICAgICAgaWYgKCEoUmF5LnBvaW50SW5UcmlhbmdsZShpbnRlcnNlY3RQb2ludCwgYiwgYSwgYykgfHwgUmF5LnBvaW50SW5UcmlhbmdsZShpbnRlcnNlY3RQb2ludCwgYSwgYiwgYykpIHx8IHNxdWFyZWREaXN0YW5jZSA+IGZyb21Ub0Rpc3RhbmNlU3F1YXJlZCkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfSAvLyB0cmFuc2Zvcm0gaW50ZXJzZWN0cG9pbnQgYW5kIG5vcm1hbCB0byB3b3JsZAoKCiAgICAgICAgVHJhbnNmb3JtLnZlY3RvclRvV29ybGRGcmFtZShxdWF0LCBub3JtYWwsIHdvcmxkTm9ybWFsKTsKICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUocG9zaXRpb24sIHF1YXQsIGludGVyc2VjdFBvaW50LCB3b3JsZEludGVyc2VjdFBvaW50KTsKICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbih3b3JsZE5vcm1hbCwgd29ybGRJbnRlcnNlY3RQb2ludCwgcmVwb3J0ZWRTaGFwZSwgYm9keSwgdHJpYW5nbGVzSW5kZXgpOwogICAgICB9CgogICAgICB0cmlhbmdsZXMubGVuZ3RoID0gMDsKICAgIH0KICAgIC8qKgogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSBpbnRlcnNlY3Rpb25zIHNob3VsZCBjb250aW51ZQogICAgICovCgoKICAgIHJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGhpdFBvaW50V29ybGQsIHNoYXBlLCBib2R5LCBoaXRGYWNlSW5kZXgpIHsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCBkaXN0YW5jZSA9IGZyb20uZGlzdGFuY2VUbyhoaXRQb2ludFdvcmxkKTsKICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5yZXN1bHQ7IC8vIFNraXAgYmFjayBmYWNlcz8KCiAgICAgIGlmICh0aGlzLnNraXBCYWNrZmFjZXMgJiYgbm9ybWFsLmRvdCh0aGlzLmRpcmVjdGlvbikgPiAwKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICByZXN1bHQuaGl0RmFjZUluZGV4ID0gdHlwZW9mIGhpdEZhY2VJbmRleCAhPT0gJ3VuZGVmaW5lZCcgPyBoaXRGYWNlSW5kZXggOiAtMTsKCiAgICAgIHN3aXRjaCAodGhpcy5tb2RlKSB7CiAgICAgICAgY2FzZSBSYXkuQUxMOgogICAgICAgICAgdGhpcy5oYXNIaXQgPSB0cnVlOwogICAgICAgICAgcmVzdWx0LnNldChmcm9tLCB0bywgbm9ybWFsLCBoaXRQb2ludFdvcmxkLCBzaGFwZSwgYm9keSwgZGlzdGFuY2UpOwogICAgICAgICAgcmVzdWx0Lmhhc0hpdCA9IHRydWU7CiAgICAgICAgICB0aGlzLmNhbGxiYWNrKHJlc3VsdCk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBSYXkuQ0xPU0VTVDoKICAgICAgICAgIC8vIFN0b3JlIGlmIGNsb3NlciB0aGFuIGN1cnJlbnQgY2xvc2VzdAogICAgICAgICAgaWYgKGRpc3RhbmNlIDwgcmVzdWx0LmRpc3RhbmNlIHx8ICFyZXN1bHQuaGFzSGl0KSB7CiAgICAgICAgICAgIHRoaXMuaGFzSGl0ID0gdHJ1ZTsKICAgICAgICAgICAgcmVzdWx0Lmhhc0hpdCA9IHRydWU7CiAgICAgICAgICAgIHJlc3VsdC5zZXQoZnJvbSwgdG8sIG5vcm1hbCwgaGl0UG9pbnRXb3JsZCwgc2hhcGUsIGJvZHksIGRpc3RhbmNlKTsKICAgICAgICAgIH0KCiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBSYXkuQU5ZOgogICAgICAgICAgLy8gUmVwb3J0IGFuZCBzdG9wLgogICAgICAgICAgdGhpcy5oYXNIaXQgPSB0cnVlOwogICAgICAgICAgcmVzdWx0Lmhhc0hpdCA9IHRydWU7CiAgICAgICAgICByZXN1bHQuc2V0KGZyb20sIHRvLCBub3JtYWwsIGhpdFBvaW50V29ybGQsIHNoYXBlLCBib2R5LCBkaXN0YW5jZSk7CiAgICAgICAgICByZXN1bHQuc2hvdWxkU3RvcCA9IHRydWU7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBBcyBwZXIgIkJhcnljZW50cmljIFRlY2huaXF1ZSIgYXMgbmFtZWQKICAgICAqIHtAbGluayBodHRwczovL3d3dy5ibGFja3Bhd24uY29tL3RleHRzL3BvaW50aW5wb2x5L2RlZmF1bHQuaHRtbCBoZXJlfSBidXQgd2l0aG91dCB0aGUgZGl2aXNpb24KICAgICAqLwoKCiAgICBzdGF0aWMgcG9pbnRJblRyaWFuZ2xlKHAsIGEsIGIsIGMpIHsKICAgICAgYy52c3ViKGEsIHYwKTsKICAgICAgYi52c3ViKGEsIHYxKTsKICAgICAgcC52c3ViKGEsIHYyKTsKICAgICAgY29uc3QgZG90MDAgPSB2MC5kb3QodjApOwogICAgICBjb25zdCBkb3QwMSA9IHYwLmRvdCh2MSk7CiAgICAgIGNvbnN0IGRvdDAyID0gdjAuZG90KHYyKTsKICAgICAgY29uc3QgZG90MTEgPSB2MS5kb3QodjEpOwogICAgICBjb25zdCBkb3QxMiA9IHYxLmRvdCh2Mik7CiAgICAgIGxldCB1OwogICAgICBsZXQgdjsKICAgICAgcmV0dXJuICh1ID0gZG90MTEgKiBkb3QwMiAtIGRvdDAxICogZG90MTIpID49IDAgJiYgKHYgPSBkb3QwMCAqIGRvdDEyIC0gZG90MDEgKiBkb3QwMikgPj0gMCAmJiB1ICsgdiA8IGRvdDAwICogZG90MTEgLSBkb3QwMSAqIGRvdDAxOwogICAgfQoKICB9CiAgUmF5LkNMT1NFU1QgPSBSQVlfTU9ERVMuQ0xPU0VTVDsKICBSYXkuQU5ZID0gUkFZX01PREVTLkFOWTsKICBSYXkuQUxMID0gUkFZX01PREVTLkFMTDsKICBjb25zdCB0bXBBQUJCJDEgPSBuZXcgQUFCQigpOwogIGNvbnN0IHRtcEFycmF5ID0gW107CiAgY29uc3QgdjEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHYyID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RCb2R5X3hpID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RCb2R5X3FpID0gbmV3IFF1YXRlcm5pb24oKTsKICBjb25zdCBpbnRlcnNlY3RQb2ludCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYyA9IG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgUmF5Y2FzdFJlc3VsdCgpOwogIGNvbnN0IGludGVyc2VjdENvbnZleE9wdGlvbnMgPSB7CiAgICBmYWNlTGlzdDogWzBdCiAgfTsKICBjb25zdCB3b3JsZFBpbGxhck9mZnNldCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0SGVpZ2h0ZmllbGRfbG9jYWxSYXkgPSBuZXcgUmF5KCk7CiAgY29uc3QgaW50ZXJzZWN0SGVpZ2h0ZmllbGRfaW5kZXggPSBbXTsKICBjb25zdCBSYXlfaW50ZXJzZWN0U3BoZXJlX2ludGVyc2VjdGlvblBvaW50ID0gbmV3IFZlYzMoKTsKICBjb25zdCBSYXlfaW50ZXJzZWN0U3BoZXJlX25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0Q29udmV4X25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdENvbnZleF92ZWN0b3IgPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdFRyaW1lc2hfbm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRGlyZWN0aW9uID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRnJvbSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF9sb2NhbFRvID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX3dvcmxkTm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX3dvcmxkSW50ZXJzZWN0UG9pbnQgPSBuZXcgVmVjMygpOwogIG5ldyBBQUJCKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF90cmlhbmdsZXMgPSBbXTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX3RyZWVUcmFuc2Zvcm0gPSBuZXcgVHJhbnNmb3JtKCk7CiAgY29uc3QgdjAgPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdCA9IG5ldyBWZWMzKCk7CgogIGZ1bmN0aW9uIGRpc3RhbmNlRnJvbUludGVyc2VjdGlvbihmcm9tLCBkaXJlY3Rpb24sIHBvc2l0aW9uKSB7CiAgICAvLyB2MCBpcyB2ZWN0b3IgZnJvbSBmcm9tIHRvIHBvc2l0aW9uCiAgICBwb3NpdGlvbi52c3ViKGZyb20sIHYwKTsKICAgIGNvbnN0IGRvdCA9IHYwLmRvdChkaXJlY3Rpb24pOyAvLyBpbnRlcnNlY3QgPSBkaXJlY3Rpb24qZG90ICsgZnJvbQoKICAgIGRpcmVjdGlvbi5zY2FsZShkb3QsIGludGVyc2VjdCk7CiAgICBpbnRlcnNlY3QudmFkZChmcm9tLCBpbnRlcnNlY3QpOwogICAgY29uc3QgZGlzdGFuY2UgPSBwb3NpdGlvbi5kaXN0YW5jZVRvKGludGVyc2VjdCk7CiAgICByZXR1cm4gZGlzdGFuY2U7CiAgfQoKICAvKioKICAgKiBTd2VlcCBhbmQgcHJ1bmUgYnJvYWRwaGFzZSBhbG9uZyBvbmUgYXhpcy4KICAgKi8KICBjbGFzcyBTQVBCcm9hZHBoYXNlIGV4dGVuZHMgQnJvYWRwaGFzZSB7CiAgICAvKioKICAgICAqIExpc3Qgb2YgYm9kaWVzIGN1cnJlbnRseSBpbiB0aGUgYnJvYWRwaGFzZS4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHdvcmxkIHRvIHNlYXJjaCBpbi4KICAgICAqLwoKICAgIC8qKgogICAgICogQXhpcyB0byBzb3J0IHRoZSBib2RpZXMgYWxvbmcuCiAgICAgKiBTZXQgdG8gMCBmb3IgeCBheGlzLCBhbmQgMSBmb3IgeSBheGlzLgogICAgICogRm9yIGJlc3QgcGVyZm9ybWFuY2UsIHBpY2sgdGhlIGF4aXMgd2hlcmUgYm9kaWVzIGFyZSBtb3N0IGRpc3RyaWJ1dGVkLgogICAgICovCgogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgYm91bmRzIG9mIHR3byBib2RpZXMgb3ZlcmxhcCwgYWxvbmcgdGhlIGdpdmVuIFNBUCBheGlzLgogICAgICovCiAgICBzdGF0aWMgY2hlY2tCb3VuZHMoYmksIGJqLCBheGlzSW5kZXgpIHsKICAgICAgbGV0IGJpUG9zOwogICAgICBsZXQgYmpQb3M7CgogICAgICBpZiAoYXhpc0luZGV4ID09PSAwKSB7CiAgICAgICAgYmlQb3MgPSBiaS5wb3NpdGlvbi54OwogICAgICAgIGJqUG9zID0gYmoucG9zaXRpb24ueDsKICAgICAgfSBlbHNlIGlmIChheGlzSW5kZXggPT09IDEpIHsKICAgICAgICBiaVBvcyA9IGJpLnBvc2l0aW9uLnk7CiAgICAgICAgYmpQb3MgPSBiai5wb3NpdGlvbi55OwogICAgICB9IGVsc2UgaWYgKGF4aXNJbmRleCA9PT0gMikgewogICAgICAgIGJpUG9zID0gYmkucG9zaXRpb24uejsKICAgICAgICBialBvcyA9IGJqLnBvc2l0aW9uLno7CiAgICAgIH0KCiAgICAgIGNvbnN0IHJpID0gYmkuYm91bmRpbmdSYWRpdXMsCiAgICAgICAgICAgIHJqID0gYmouYm91bmRpbmdSYWRpdXMsCiAgICAgICAgICAgIGJvdW5kQTIgPSBiaVBvcyArIHJpLAogICAgICAgICAgICBib3VuZEIxID0gYmpQb3MgLSByajsKICAgICAgcmV0dXJuIGJvdW5kQjEgPCBib3VuZEEyOwogICAgfSAvLyBOb3RlOiB0aGVzZSBhcmUgaWRlbnRpY2FsLCBzYXZlIGZvciB4L3kveiBsb3dlcmJvdW5kCgogICAgLyoqCiAgICAgKiBpbnNlcnRpb25Tb3J0WAogICAgICovCgoKICAgIHN0YXRpYyBpbnNlcnRpb25Tb3J0WChhKSB7CiAgICAgIGZvciAobGV0IGkgPSAxLCBsID0gYS5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gYVtpXTsKICAgICAgICBsZXQgajsKCiAgICAgICAgZm9yIChqID0gaSAtIDE7IGogPj0gMDsgai0tKSB7CiAgICAgICAgICBpZiAoYVtqXS5hYWJiLmxvd2VyQm91bmQueCA8PSB2LmFhYmIubG93ZXJCb3VuZC54KSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQoKICAgICAgICAgIGFbaiArIDFdID0gYVtqXTsKICAgICAgICB9CgogICAgICAgIGFbaiArIDFdID0gdjsKICAgICAgfQoKICAgICAgcmV0dXJuIGE7CiAgICB9CiAgICAvKioKICAgICAqIGluc2VydGlvblNvcnRZCiAgICAgKi8KCgogICAgc3RhdGljIGluc2VydGlvblNvcnRZKGEpIHsKICAgICAgZm9yIChsZXQgaSA9IDEsIGwgPSBhLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIGNvbnN0IHYgPSBhW2ldOwogICAgICAgIGxldCBqOwoKICAgICAgICBmb3IgKGogPSBpIC0gMTsgaiA+PSAwOyBqLS0pIHsKICAgICAgICAgIGlmIChhW2pdLmFhYmIubG93ZXJCb3VuZC55IDw9IHYuYWFiYi5sb3dlckJvdW5kLnkpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgYVtqICsgMV0gPSBhW2pdOwogICAgICAgIH0KCiAgICAgICAgYVtqICsgMV0gPSB2OwogICAgICB9CgogICAgICByZXR1cm4gYTsKICAgIH0KICAgIC8qKgogICAgICogaW5zZXJ0aW9uU29ydFoKICAgICAqLwoKCiAgICBzdGF0aWMgaW5zZXJ0aW9uU29ydFooYSkgewogICAgICBmb3IgKGxldCBpID0gMSwgbCA9IGEubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgY29uc3QgdiA9IGFbaV07CiAgICAgICAgbGV0IGo7CgogICAgICAgIGZvciAoaiA9IGkgLSAxOyBqID49IDA7IGotLSkgewogICAgICAgICAgaWYgKGFbal0uYWFiYi5sb3dlckJvdW5kLnogPD0gdi5hYWJiLmxvd2VyQm91bmQueikgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICBhW2ogKyAxXSA9IGFbal07CiAgICAgICAgfQoKICAgICAgICBhW2ogKyAxXSA9IHY7CiAgICAgIH0KCiAgICAgIHJldHVybiBhOwogICAgfQoKICAgIGNvbnN0cnVjdG9yKHdvcmxkKSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMuYXhpc0xpc3QgPSBbXTsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICAgIHRoaXMuYXhpc0luZGV4ID0gMDsKICAgICAgY29uc3QgYXhpc0xpc3QgPSB0aGlzLmF4aXNMaXN0OwoKICAgICAgdGhpcy5fYWRkQm9keUhhbmRsZXIgPSBldmVudCA9PiB7CiAgICAgICAgYXhpc0xpc3QucHVzaChldmVudC5ib2R5KTsKICAgICAgfTsKCiAgICAgIHRoaXMuX3JlbW92ZUJvZHlIYW5kbGVyID0gZXZlbnQgPT4gewogICAgICAgIGNvbnN0IGlkeCA9IGF4aXNMaXN0LmluZGV4T2YoZXZlbnQuYm9keSk7CgogICAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgICBheGlzTGlzdC5zcGxpY2UoaWR4LCAxKTsKICAgICAgICB9CiAgICAgIH07CgogICAgICBpZiAod29ybGQpIHsKICAgICAgICB0aGlzLnNldFdvcmxkKHdvcmxkKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDaGFuZ2UgdGhlIHdvcmxkCiAgICAgKi8KCgogICAgc2V0V29ybGQod29ybGQpIHsKICAgICAgLy8gQ2xlYXIgdGhlIG9sZCBheGlzIGFycmF5CiAgICAgIHRoaXMuYXhpc0xpc3QubGVuZ3RoID0gMDsgLy8gQWRkIGFsbCBib2RpZXMgZnJvbSB0aGUgbmV3IHdvcmxkCgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdvcmxkLmJvZGllcy5sZW5ndGg7IGkrKykgewogICAgICAgIHRoaXMuYXhpc0xpc3QucHVzaCh3b3JsZC5ib2RpZXNbaV0pOwogICAgICB9IC8vIFJlbW92ZSBvbGQgaGFuZGxlcnMsIGlmIGFueQoKCiAgICAgIHdvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2FkZEJvZHknLCB0aGlzLl9hZGRCb2R5SGFuZGxlcik7CiAgICAgIHdvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3JlbW92ZUJvZHknLCB0aGlzLl9yZW1vdmVCb2R5SGFuZGxlcik7IC8vIEFkZCBoYW5kbGVycyB0byB1cGRhdGUgdGhlIGxpc3Qgb2YgYm9kaWVzLgoKICAgICAgd29ybGQuYWRkRXZlbnRMaXN0ZW5lcignYWRkQm9keScsIHRoaXMuX2FkZEJvZHlIYW5kbGVyKTsKICAgICAgd29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncmVtb3ZlQm9keScsIHRoaXMuX3JlbW92ZUJvZHlIYW5kbGVyKTsKICAgICAgdGhpcy53b3JsZCA9IHdvcmxkOwogICAgICB0aGlzLmRpcnR5ID0gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ29sbGVjdCBhbGwgY29sbGlzaW9uIHBhaXJzCiAgICAgKi8KCgogICAgY29sbGlzaW9uUGFpcnMod29ybGQsIHAxLCBwMikgewogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmF4aXNMaXN0OwogICAgICBjb25zdCBOID0gYm9kaWVzLmxlbmd0aDsKICAgICAgY29uc3QgYXhpc0luZGV4ID0gdGhpcy5heGlzSW5kZXg7CiAgICAgIGxldCBpOwogICAgICBsZXQgajsKCiAgICAgIGlmICh0aGlzLmRpcnR5KSB7CiAgICAgICAgdGhpcy5zb3J0TGlzdCgpOwogICAgICAgIHRoaXMuZGlydHkgPSBmYWxzZTsKICAgICAgfSAvLyBMb29rIHRocm91Z2ggdGhlIGxpc3QKCgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKCiAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBOOyBqKyspIHsKICAgICAgICAgIGNvbnN0IGJqID0gYm9kaWVzW2pdOwoKICAgICAgICAgIGlmICghdGhpcy5uZWVkQnJvYWRwaGFzZUNvbGxpc2lvbihiaSwgYmopKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICghU0FQQnJvYWRwaGFzZS5jaGVja0JvdW5kcyhiaSwgYmosIGF4aXNJbmRleCkpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5pbnRlcnNlY3Rpb25UZXN0KGJpLCBiaiwgcDEsIHAyKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBzb3J0TGlzdCgpIHsKICAgICAgY29uc3QgYXhpc0xpc3QgPSB0aGlzLmF4aXNMaXN0OwogICAgICBjb25zdCBheGlzSW5kZXggPSB0aGlzLmF4aXNJbmRleDsKICAgICAgY29uc3QgTiA9IGF4aXNMaXN0Lmxlbmd0aDsgLy8gVXBkYXRlIEFBQkJzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYmkgPSBheGlzTGlzdFtpXTsKCiAgICAgICAgaWYgKGJpLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgICAgYmkudXBkYXRlQUFCQigpOwogICAgICAgIH0KICAgICAgfSAvLyBTb3J0IHRoZSBsaXN0CgoKICAgICAgaWYgKGF4aXNJbmRleCA9PT0gMCkgewogICAgICAgIFNBUEJyb2FkcGhhc2UuaW5zZXJ0aW9uU29ydFgoYXhpc0xpc3QpOwogICAgICB9IGVsc2UgaWYgKGF4aXNJbmRleCA9PT0gMSkgewogICAgICAgIFNBUEJyb2FkcGhhc2UuaW5zZXJ0aW9uU29ydFkoYXhpc0xpc3QpOwogICAgICB9IGVsc2UgaWYgKGF4aXNJbmRleCA9PT0gMikgewogICAgICAgIFNBUEJyb2FkcGhhc2UuaW5zZXJ0aW9uU29ydFooYXhpc0xpc3QpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIHRoZSB2YXJpYW5jZSBvZiB0aGUgYm9keSBwb3NpdGlvbnMgYW5kIGVzdGltYXRlcyB0aGUgYmVzdCBheGlzIHRvIHVzZS4KICAgICAqIFdpbGwgYXV0b21hdGljYWxseSBzZXQgcHJvcGVydHkgYGF4aXNJbmRleGAuCiAgICAgKi8KCgogICAgYXV0b0RldGVjdEF4aXMoKSB7CiAgICAgIGxldCBzdW1YID0gMDsKICAgICAgbGV0IHN1bVgyID0gMDsKICAgICAgbGV0IHN1bVkgPSAwOwogICAgICBsZXQgc3VtWTIgPSAwOwogICAgICBsZXQgc3VtWiA9IDA7CiAgICAgIGxldCBzdW1aMiA9IDA7CiAgICAgIGNvbnN0IGJvZGllcyA9IHRoaXMuYXhpc0xpc3Q7CiAgICAgIGNvbnN0IE4gPSBib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBpbnZOID0gMSAvIE47CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYiA9IGJvZGllc1tpXTsKICAgICAgICBjb25zdCBjZW50ZXJYID0gYi5wb3NpdGlvbi54OwogICAgICAgIHN1bVggKz0gY2VudGVyWDsKICAgICAgICBzdW1YMiArPSBjZW50ZXJYICogY2VudGVyWDsKICAgICAgICBjb25zdCBjZW50ZXJZID0gYi5wb3NpdGlvbi55OwogICAgICAgIHN1bVkgKz0gY2VudGVyWTsKICAgICAgICBzdW1ZMiArPSBjZW50ZXJZICogY2VudGVyWTsKICAgICAgICBjb25zdCBjZW50ZXJaID0gYi5wb3NpdGlvbi56OwogICAgICAgIHN1bVogKz0gY2VudGVyWjsKICAgICAgICBzdW1aMiArPSBjZW50ZXJaICogY2VudGVyWjsKICAgICAgfQoKICAgICAgY29uc3QgdmFyaWFuY2VYID0gc3VtWDIgLSBzdW1YICogc3VtWCAqIGludk47CiAgICAgIGNvbnN0IHZhcmlhbmNlWSA9IHN1bVkyIC0gc3VtWSAqIHN1bVkgKiBpbnZOOwogICAgICBjb25zdCB2YXJpYW5jZVogPSBzdW1aMiAtIHN1bVogKiBzdW1aICogaW52TjsKCiAgICAgIGlmICh2YXJpYW5jZVggPiB2YXJpYW5jZVkpIHsKICAgICAgICBpZiAodmFyaWFuY2VYID4gdmFyaWFuY2VaKSB7CiAgICAgICAgICB0aGlzLmF4aXNJbmRleCA9IDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuYXhpc0luZGV4ID0gMjsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodmFyaWFuY2VZID4gdmFyaWFuY2VaKSB7CiAgICAgICAgdGhpcy5heGlzSW5kZXggPSAxOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYXhpc0luZGV4ID0gMjsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFsbCB0aGUgYm9kaWVzIHdpdGhpbiBhbiBBQUJCLgogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSB0byBzdG9yZSByZXN1bHRpbmcgYm9kaWVzIGluLgogICAgICovCgoKICAgIGFhYmJRdWVyeSh3b3JsZCwgYWFiYiwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IFtdOwogICAgICB9CgogICAgICBpZiAodGhpcy5kaXJ0eSkgewogICAgICAgIHRoaXMuc29ydExpc3QoKTsKICAgICAgICB0aGlzLmRpcnR5ID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4aXNJbmRleCA9IHRoaXMuYXhpc0luZGV4OwogICAgICBsZXQgYXhpcyA9ICd4JzsKCiAgICAgIGlmIChheGlzSW5kZXggPT09IDEpIHsKICAgICAgICBheGlzID0gJ3knOwogICAgICB9CgogICAgICBpZiAoYXhpc0luZGV4ID09PSAyKSB7CiAgICAgICAgYXhpcyA9ICd6JzsKICAgICAgfQoKICAgICAgY29uc3QgYXhpc0xpc3QgPSB0aGlzLmF4aXNMaXN0OwogICAgICBhYWJiLmxvd2VyQm91bmRbYXhpc107CiAgICAgIGFhYmIudXBwZXJCb3VuZFtheGlzXTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXhpc0xpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBiID0gYXhpc0xpc3RbaV07CgogICAgICAgIGlmIChiLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgICAgYi51cGRhdGVBQUJCKCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoYi5hYWJiLm92ZXJsYXBzKGFhYmIpKSB7CiAgICAgICAgICByZXN1bHQucHVzaChiKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CgogIH0KCiAgY2xhc3MgVXRpbHMgewogICAgLyoqCiAgICAgKiBFeHRlbmQgYW4gb3B0aW9ucyBvYmplY3Qgd2l0aCBkZWZhdWx0IHZhbHVlcy4KICAgICAqIEBwYXJhbSBvcHRpb25zIFRoZSBvcHRpb25zIG9iamVjdC4gTWF5IGJlIGZhbHN5OiBpbiB0aGlzIGNhc2UsIGEgbmV3IG9iamVjdCBpcyBjcmVhdGVkIGFuZCByZXR1cm5lZC4KICAgICAqIEBwYXJhbSBkZWZhdWx0cyBBbiBvYmplY3QgY29udGFpbmluZyBkZWZhdWx0IHZhbHVlcy4KICAgICAqIEByZXR1cm4gVGhlIG1vZGlmaWVkIG9wdGlvbnMgb2JqZWN0LgogICAgICovCiAgICBzdGF0aWMgZGVmYXVsdHMob3B0aW9ucywgZGVmYXVsdHMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgZm9yIChsZXQga2V5IGluIGRlZmF1bHRzKSB7CiAgICAgICAgaWYgKCEoa2V5IGluIG9wdGlvbnMpKSB7CiAgICAgICAgICBvcHRpb25zW2tleV0gPSBkZWZhdWx0c1trZXldOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG9wdGlvbnM7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQ29uc3RyYWludCBiYXNlIGNsYXNzCiAgICovCiAgY2xhc3MgQ29uc3RyYWludCB7CiAgICAvKioKICAgICAqIEVxdWF0aW9ucyB0byBiZSBzb2x2ZWQgaW4gdGhpcyBjb25zdHJhaW50LgogICAgICovCgogICAgLyoqCiAgICAgKiBCb2R5IEEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEJvZHkgQi4KICAgICAqLwoKICAgIC8qKgogICAgICogU2V0IHRvIGZhbHNlIGlmIHlvdSBkb24ndCB3YW50IHRoZSBib2RpZXMgdG8gY29sbGlkZSB3aGVuIHRoZXkgYXJlIGNvbm5lY3RlZC4KICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIGJvZHlCLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIG9wdGlvbnMgPSBVdGlscy5kZWZhdWx0cyhvcHRpb25zLCB7CiAgICAgICAgY29sbGlkZUNvbm5lY3RlZDogdHJ1ZSwKICAgICAgICB3YWtlVXBCb2RpZXM6IHRydWUKICAgICAgfSk7CiAgICAgIHRoaXMuZXF1YXRpb25zID0gW107CiAgICAgIHRoaXMuYm9keUEgPSBib2R5QTsKICAgICAgdGhpcy5ib2R5QiA9IGJvZHlCOwogICAgICB0aGlzLmlkID0gQ29uc3RyYWludC5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5jb2xsaWRlQ29ubmVjdGVkID0gb3B0aW9ucy5jb2xsaWRlQ29ubmVjdGVkOwoKICAgICAgaWYgKG9wdGlvbnMud2FrZVVwQm9kaWVzKSB7CiAgICAgICAgaWYgKGJvZHlBKSB7CiAgICAgICAgICBib2R5QS53YWtlVXAoKTsKICAgICAgICB9CgogICAgICAgIGlmIChib2R5QikgewogICAgICAgICAgYm9keUIud2FrZVVwKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSBhbGwgdGhlIGVxdWF0aW9ucyB3aXRoIGRhdGEuCiAgICAgKi8KCgogICAgdXBkYXRlKCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ21ldGhvZCB1cGRhdGUoKSBub3QgaW1wbG1lbWVudGVkIGluIHRoaXMgQ29uc3RyYWludCBzdWJjbGFzcyEnKTsKICAgIH0KICAgIC8qKgogICAgICogRW5hYmxlcyBhbGwgZXF1YXRpb25zIGluIHRoZSBjb25zdHJhaW50LgogICAgICovCgoKICAgIGVuYWJsZSgpIHsKICAgICAgY29uc3QgZXFzID0gdGhpcy5lcXVhdGlvbnM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGVxcy5sZW5ndGg7IGkrKykgewogICAgICAgIGVxc1tpXS5lbmFibGVkID0gdHJ1ZTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBEaXNhYmxlcyBhbGwgZXF1YXRpb25zIGluIHRoZSBjb25zdHJhaW50LgogICAgICovCgoKICAgIGRpc2FibGUoKSB7CiAgICAgIGNvbnN0IGVxcyA9IHRoaXMuZXF1YXRpb25zOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBlcXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBlcXNbaV0uZW5hYmxlZCA9IGZhbHNlOwogICAgICB9CiAgICB9CgogIH0KICBDb25zdHJhaW50LmlkQ291bnRlciA9IDA7CgogIC8qKgogICAqIEFuIGVsZW1lbnQgY29udGFpbmluZyA2IGVudHJpZXMsIDMgc3BhdGlhbCBhbmQgMyByb3RhdGlvbmFsIGRlZ3JlZXMgb2YgZnJlZWRvbS4KICAgKi8KCiAgY2xhc3MgSmFjb2JpYW5FbGVtZW50IHsKICAgIC8qKgogICAgICogc3BhdGlhbAogICAgICovCgogICAgLyoqCiAgICAgKiByb3RhdGlvbmFsCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLnNwYXRpYWwgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnJvdGF0aW9uYWwgPSBuZXcgVmVjMygpOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB3aXRoIG90aGVyIEphY29iaWFuRWxlbWVudAogICAgICovCgoKICAgIG11bHRpcGx5RWxlbWVudChlbGVtZW50KSB7CiAgICAgIHJldHVybiBlbGVtZW50LnNwYXRpYWwuZG90KHRoaXMuc3BhdGlhbCkgKyBlbGVtZW50LnJvdGF0aW9uYWwuZG90KHRoaXMucm90YXRpb25hbCk7CiAgICB9CiAgICAvKioKICAgICAqIE11bHRpcGx5IHdpdGggdHdvIHZlY3RvcnMKICAgICAqLwoKCiAgICBtdWx0aXBseVZlY3RvcnMoc3BhdGlhbCwgcm90YXRpb25hbCkgewogICAgICByZXR1cm4gc3BhdGlhbC5kb3QodGhpcy5zcGF0aWFsKSArIHJvdGF0aW9uYWwuZG90KHRoaXMucm90YXRpb25hbCk7CiAgICB9CgogIH0KCiAgLyoqCiAgICogRXF1YXRpb24gYmFzZSBjbGFzcy4KICAgKgogICAqIGBhYCwgYGJgIGFuZCBgZXBzYCBhcmUge0BsaW5rIGh0dHBzOi8vd3d3OC5jcy51bXUuc2Uva3Vyc2VyLzVEVjA1OC9WVDE1L2xlY3R1cmVzL1NQT09LbGFibm90ZXMucGRmIFNQT09LfSBwYXJhbWV0ZXJzIHRoYXQgZGVmYXVsdCB0byBgMC4wYC4gU2VlIHtAbGluayBodHRwczovL2dpdGh1Yi5jb20vc2NodGVwcGUvY2Fubm9uLmpzL2lzc3Vlcy8yMzgjaXNzdWVjb21tZW50LTE0NzE3MjMyNyB0aGlzIGV4Y2hhbmdlfSBmb3IgbW9yZSBkZXRhaWxzIG9uIENhbm5vbidzIHBoeXNpY3MgaW1wbGVtZW50YXRpb24uCiAgICovCiAgY2xhc3MgRXF1YXRpb24gewogICAgLyoqCiAgICAgKiBNaW5pbXVtIChyZWFkOiBuZWdhdGl2ZSBtYXgpIGZvcmNlIHRvIGJlIGFwcGxpZWQgYnkgdGhlIGNvbnN0cmFpbnQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE1heGltdW0gKHJlYWQ6IHBvc2l0aXZlIG1heCkgZm9yY2UgdG8gYmUgYXBwbGllZCBieSB0aGUgY29uc3RyYWludC4KICAgICAqLwoKICAgIC8qKgogICAgICogU1BPT0sgcGFyYW1ldGVyCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNQT09LIHBhcmFtZXRlcgogICAgICovCgogICAgLyoqCiAgICAgKiBTUE9PSyBwYXJhbWV0ZXIKICAgICAqLwoKICAgIC8qKgogICAgICogQSBudW1iZXIsIHByb3BvcnRpb25hbCB0byB0aGUgZm9yY2UgYWRkZWQgdG8gdGhlIGJvZGllcy4KICAgICAqLwogICAgY29uc3RydWN0b3IoYmksIGJqLCBtaW5Gb3JjZSwgbWF4Rm9yY2UpIHsKICAgICAgaWYgKG1pbkZvcmNlID09PSB2b2lkIDApIHsKICAgICAgICBtaW5Gb3JjZSA9IC0xZTY7CiAgICAgIH0KCiAgICAgIGlmIChtYXhGb3JjZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWF4Rm9yY2UgPSAxZTY7CiAgICAgIH0KCiAgICAgIHRoaXMuaWQgPSBFcXVhdGlvbi5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5taW5Gb3JjZSA9IG1pbkZvcmNlOwogICAgICB0aGlzLm1heEZvcmNlID0gbWF4Rm9yY2U7CiAgICAgIHRoaXMuYmkgPSBiaTsKICAgICAgdGhpcy5iaiA9IGJqOwogICAgICB0aGlzLmEgPSAwLjA7IC8vIFNQT09LIHBhcmFtZXRlcgoKICAgICAgdGhpcy5iID0gMC4wOyAvLyBTUE9PSyBwYXJhbWV0ZXIKCiAgICAgIHRoaXMuZXBzID0gMC4wOyAvLyBTUE9PSyBwYXJhbWV0ZXIKCiAgICAgIHRoaXMuamFjb2JpYW5FbGVtZW50QSA9IG5ldyBKYWNvYmlhbkVsZW1lbnQoKTsKICAgICAgdGhpcy5qYWNvYmlhbkVsZW1lbnRCID0gbmV3IEphY29iaWFuRWxlbWVudCgpOwogICAgICB0aGlzLmVuYWJsZWQgPSB0cnVlOwogICAgICB0aGlzLm11bHRpcGxpZXIgPSAwOwogICAgICB0aGlzLnNldFNwb29rUGFyYW1zKDFlNywgNCwgMSAvIDYwKTsgLy8gU2V0IHR5cGljYWwgc3Bvb2sgcGFyYW1zCiAgICB9CiAgICAvKioKICAgICAqIFJlY2FsY3VsYXRlcyBhLCBiLCBhbmQgZXBzLgogICAgICoKICAgICAqIFRoZSBFcXVhdGlvbiBjb25zdHJ1Y3RvciBzZXRzIHR5cGljYWwgU1BPT0sgcGFyYW1ldGVycyBhcyBzdWNoOgogICAgICogKiBgc3RpZmZuZXNzYCA9IDFlNwogICAgICogKiBgcmVsYXhhdGlvbmAgPSA0CiAgICAgKiAqIGB0aW1lU3RlcGA9IDEgLyA2MCwgX25vdGUgdGhlIGhhcmRjb2RlZCByZWZyZXNoIHJhdGUuXwogICAgICovCgoKICAgIHNldFNwb29rUGFyYW1zKHN0aWZmbmVzcywgcmVsYXhhdGlvbiwgdGltZVN0ZXApIHsKICAgICAgY29uc3QgZCA9IHJlbGF4YXRpb247CiAgICAgIGNvbnN0IGsgPSBzdGlmZm5lc3M7CiAgICAgIGNvbnN0IGggPSB0aW1lU3RlcDsKICAgICAgdGhpcy5hID0gNC4wIC8gKGggKiAoMSArIDQgKiBkKSk7CiAgICAgIHRoaXMuYiA9IDQuMCAqIGQgLyAoMSArIDQgKiBkKTsKICAgICAgdGhpcy5lcHMgPSA0LjAgLyAoaCAqIGggKiBrICogKDEgKyA0ICogZCkpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyB0aGUgcmlnaHQgaGFuZCBzaWRlIG9mIHRoZSBTUE9PSyBlcXVhdGlvbgogICAgICovCgoKICAgIGNvbXB1dGVCKGEsIGIsIGgpIHsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHcSA9IHRoaXMuY29tcHV0ZUdxKCk7CiAgICAgIGNvbnN0IEdpTWYgPSB0aGlzLmNvbXB1dGVHaU1mKCk7CiAgICAgIHJldHVybiAtR3EgKiBhIC0gR1cgKiBiIC0gR2lNZiAqIGg7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIEcqcSwgd2hlcmUgcSBhcmUgdGhlIGdlbmVyYWxpemVkIGJvZHkgY29vcmRpbmF0ZXMKICAgICAqLwoKCiAgICBjb21wdXRlR3EoKSB7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgY29uc3QgYmkgPSB0aGlzLmJpOwogICAgICBjb25zdCBiaiA9IHRoaXMuYmo7CiAgICAgIGNvbnN0IHhpID0gYmkucG9zaXRpb247CiAgICAgIGNvbnN0IHhqID0gYmoucG9zaXRpb247CiAgICAgIHJldHVybiBHQS5zcGF0aWFsLmRvdCh4aSkgKyBHQi5zcGF0aWFsLmRvdCh4aik7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIEcqVywgd2hlcmUgVyBhcmUgdGhlIGJvZHkgdmVsb2NpdGllcwogICAgICovCgoKICAgIGNvbXB1dGVHVygpIHsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgdmkgPSBiaS52ZWxvY2l0eTsKICAgICAgY29uc3QgdmogPSBiai52ZWxvY2l0eTsKICAgICAgY29uc3Qgd2kgPSBiaS5hbmd1bGFyVmVsb2NpdHk7CiAgICAgIGNvbnN0IHdqID0gYmouYW5ndWxhclZlbG9jaXR5OwogICAgICByZXR1cm4gR0EubXVsdGlwbHlWZWN0b3JzKHZpLCB3aSkgKyBHQi5tdWx0aXBseVZlY3RvcnModmosIHdqKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgRypXbGFtYmRhLCB3aGVyZSBXIGFyZSB0aGUgYm9keSB2ZWxvY2l0aWVzCiAgICAgKi8KCgogICAgY29tcHV0ZUdXbGFtYmRhKCkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCB2aSA9IGJpLnZsYW1iZGE7CiAgICAgIGNvbnN0IHZqID0gYmoudmxhbWJkYTsKICAgICAgY29uc3Qgd2kgPSBiaS53bGFtYmRhOwogICAgICBjb25zdCB3aiA9IGJqLndsYW1iZGE7CiAgICAgIHJldHVybiBHQS5tdWx0aXBseVZlY3RvcnModmksIHdpKSArIEdCLm11bHRpcGx5VmVjdG9ycyh2aiwgd2opOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyBHKmludihNKSpmLCB3aGVyZSBNIGlzIHRoZSBtYXNzIG1hdHJpeCB3aXRoIGRpYWdvbmFsIGJsb2NrcyBmb3IgZWFjaCBib2R5LCBhbmQgZiBhcmUgdGhlIGZvcmNlcyBvbiB0aGUgYm9kaWVzLgogICAgICovCgoKICAgIGNvbXB1dGVHaU1mKCkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCBmaSA9IGJpLmZvcmNlOwogICAgICBjb25zdCB0aSA9IGJpLnRvcnF1ZTsKICAgICAgY29uc3QgZmogPSBiai5mb3JjZTsKICAgICAgY29uc3QgdGogPSBiai50b3JxdWU7CiAgICAgIGNvbnN0IGludk1hc3NpID0gYmkuaW52TWFzc1NvbHZlOwogICAgICBjb25zdCBpbnZNYXNzaiA9IGJqLmludk1hc3NTb2x2ZTsKICAgICAgZmkuc2NhbGUoaW52TWFzc2ksIGlNZmkpOwogICAgICBmai5zY2FsZShpbnZNYXNzaiwgaU1maik7CiAgICAgIGJpLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KHRpLCBpbnZJaV92bXVsdF90YXVpKTsKICAgICAgYmouaW52SW5lcnRpYVdvcmxkU29sdmUudm11bHQodGosIGludklqX3ZtdWx0X3RhdWopOwogICAgICByZXR1cm4gR0EubXVsdGlwbHlWZWN0b3JzKGlNZmksIGludklpX3ZtdWx0X3RhdWkpICsgR0IubXVsdGlwbHlWZWN0b3JzKGlNZmosIGludklqX3ZtdWx0X3RhdWopOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyBHKmludihNKSpHJwogICAgICovCgoKICAgIGNvbXB1dGVHaU1HdCgpIHsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgaW52TWFzc2kgPSBiaS5pbnZNYXNzU29sdmU7CiAgICAgIGNvbnN0IGludk1hc3NqID0gYmouaW52TWFzc1NvbHZlOwogICAgICBjb25zdCBpbnZJaSA9IGJpLmludkluZXJ0aWFXb3JsZFNvbHZlOwogICAgICBjb25zdCBpbnZJaiA9IGJqLmludkluZXJ0aWFXb3JsZFNvbHZlOwogICAgICBsZXQgcmVzdWx0ID0gaW52TWFzc2kgKyBpbnZNYXNzajsKICAgICAgaW52SWkudm11bHQoR0Eucm90YXRpb25hbCwgdG1wKTsKICAgICAgcmVzdWx0ICs9IHRtcC5kb3QoR0Eucm90YXRpb25hbCk7CiAgICAgIGludklqLnZtdWx0KEdCLnJvdGF0aW9uYWwsIHRtcCk7CiAgICAgIHJlc3VsdCArPSB0bXAuZG90KEdCLnJvdGF0aW9uYWwpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgY29uc3RyYWludCB2ZWxvY2l0eSB0byB0aGUgYm9kaWVzLgogICAgICovCgoKICAgIGFkZFRvV2xhbWJkYShkZWx0YWxhbWJkYSkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCB0ZW1wID0gYWRkVG9XbGFtYmRhX3RlbXA7IC8vIEFkZCB0byBsaW5lYXIgdmVsb2NpdHkKICAgICAgLy8gdl9sYW1iZGEgKz0gaW52KE0pICogZGVsdGFfbGFtYmEgKiBHCgogICAgICBiaS52bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihiaS5pbnZNYXNzU29sdmUgKiBkZWx0YWxhbWJkYSwgR0Euc3BhdGlhbCwgYmkudmxhbWJkYSk7CiAgICAgIGJqLnZsYW1iZGEuYWRkU2NhbGVkVmVjdG9yKGJqLmludk1hc3NTb2x2ZSAqIGRlbHRhbGFtYmRhLCBHQi5zcGF0aWFsLCBiai52bGFtYmRhKTsgLy8gQWRkIHRvIGFuZ3VsYXIgdmVsb2NpdHkKCiAgICAgIGJpLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KEdBLnJvdGF0aW9uYWwsIHRlbXApOwogICAgICBiaS53bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihkZWx0YWxhbWJkYSwgdGVtcCwgYmkud2xhbWJkYSk7CiAgICAgIGJqLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KEdCLnJvdGF0aW9uYWwsIHRlbXApOwogICAgICBiai53bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihkZWx0YWxhbWJkYSwgdGVtcCwgYmoud2xhbWJkYSk7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdGhlIGRlbm9taW5hdG9yIHBhcnQgb2YgdGhlIFNQT09LIGVxdWF0aW9uOiBDID0gRyppbnYoTSkqRycgKyBlcHMKICAgICAqLwoKCiAgICBjb21wdXRlQygpIHsKICAgICAgcmV0dXJuIHRoaXMuY29tcHV0ZUdpTUd0KCkgKyB0aGlzLmVwczsKICAgIH0KCiAgfQogIEVxdWF0aW9uLmlkQ291bnRlciA9IDA7CiAgY29uc3QgaU1maSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaU1maiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW52SWlfdm11bHRfdGF1aSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW52SWpfdm11bHRfdGF1aiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wID0gbmV3IFZlYzMoKTsKICBjb25zdCBhZGRUb1dsYW1iZGFfdGVtcCA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIENvbnRhY3Qvbm9uLXBlbmV0cmF0aW9uIGNvbnN0cmFpbnQgZXF1YXRpb24KICAgKi8KICBjbGFzcyBDb250YWN0RXF1YXRpb24gZXh0ZW5kcyBFcXVhdGlvbiB7CiAgICAvKioKICAgICAqICJib3VuY2luZXNzIjogdTEgPSAtZSp1MAogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZC1vcmllbnRlZCB2ZWN0b3IgdGhhdCBnb2VzIGZyb20gdGhlIGNlbnRlciBvZiBiaSB0byB0aGUgY29udGFjdCBwb2ludC4KICAgICAqLwoKICAgIC8qKgogICAgICogV29ybGQtb3JpZW50ZWQgdmVjdG9yIHRoYXQgc3RhcnRzIGluIGJvZHkgaiBwb3NpdGlvbiBhbmQgZ29lcyB0byB0aGUgY29udGFjdCBwb2ludC4KICAgICAqLwoKICAgIC8qKgogICAgICogQ29udGFjdCBub3JtYWwsIHBvaW50aW5nIG91dCBvZiBib2R5IGkuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5QiwgbWF4Rm9yY2UpIHsKICAgICAgaWYgKG1heEZvcmNlID09PSB2b2lkIDApIHsKICAgICAgICBtYXhGb3JjZSA9IDFlNjsKICAgICAgfQoKICAgICAgc3VwZXIoYm9keUEsIGJvZHlCLCAwLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMucmVzdGl0dXRpb24gPSAwLjA7CiAgICAgIHRoaXMucmkgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnJqID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5uaSA9IG5ldyBWZWMzKCk7CiAgICB9CgogICAgY29tcHV0ZUIoaCkgewogICAgICBjb25zdCBhID0gdGhpcy5hOwogICAgICBjb25zdCBiID0gdGhpcy5iOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgcmkgPSB0aGlzLnJpOwogICAgICBjb25zdCByaiA9IHRoaXMucmo7CiAgICAgIGNvbnN0IHJpeG4gPSBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDE7CiAgICAgIGNvbnN0IHJqeG4gPSBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDI7CiAgICAgIGNvbnN0IHZpID0gYmkudmVsb2NpdHk7CiAgICAgIGNvbnN0IHdpID0gYmkuYW5ndWxhclZlbG9jaXR5OwogICAgICBiaS5mb3JjZTsKICAgICAgYmkudG9ycXVlOwogICAgICBjb25zdCB2aiA9IGJqLnZlbG9jaXR5OwogICAgICBjb25zdCB3aiA9IGJqLmFuZ3VsYXJWZWxvY2l0eTsKICAgICAgYmouZm9yY2U7CiAgICAgIGJqLnRvcnF1ZTsKICAgICAgY29uc3QgcGVuZXRyYXRpb25WZWMgPSBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDM7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgY29uc3QgbiA9IHRoaXMubmk7IC8vIENhbHVjbGF0ZSBjcm9zcyBwcm9kdWN0cwoKICAgICAgcmkuY3Jvc3Mobiwgcml4bik7CiAgICAgIHJqLmNyb3NzKG4sIHJqeG4pOyAvLyBnID0geGorcmogLSh4aStyaSkKICAgICAgLy8gRyA9IFsgLW5pICAtcml4biAgbmkgIHJqeG4gXQoKICAgICAgbi5uZWdhdGUoR0Euc3BhdGlhbCk7CiAgICAgIHJpeG4ubmVnYXRlKEdBLnJvdGF0aW9uYWwpOwogICAgICBHQi5zcGF0aWFsLmNvcHkobik7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShyanhuKTsgLy8gQ2FsY3VsYXRlIHRoZSBwZW5ldHJhdGlvbiB2ZWN0b3IKCiAgICAgIHBlbmV0cmF0aW9uVmVjLmNvcHkoYmoucG9zaXRpb24pOwogICAgICBwZW5ldHJhdGlvblZlYy52YWRkKHJqLCBwZW5ldHJhdGlvblZlYyk7CiAgICAgIHBlbmV0cmF0aW9uVmVjLnZzdWIoYmkucG9zaXRpb24sIHBlbmV0cmF0aW9uVmVjKTsKICAgICAgcGVuZXRyYXRpb25WZWMudnN1YihyaSwgcGVuZXRyYXRpb25WZWMpOwogICAgICBjb25zdCBnID0gbi5kb3QocGVuZXRyYXRpb25WZWMpOyAvLyBDb21wdXRlIGl0ZXJhdGlvbgoKICAgICAgY29uc3QgZVBsdXNPbmUgPSB0aGlzLnJlc3RpdHV0aW9uICsgMTsKICAgICAgY29uc3QgR1cgPSBlUGx1c09uZSAqIHZqLmRvdChuKSAtIGVQbHVzT25lICogdmkuZG90KG4pICsgd2ouZG90KHJqeG4pIC0gd2kuZG90KHJpeG4pOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICBjb25zdCBCID0gLWcgKiBhIC0gR1cgKiBiIC0gaCAqIEdpTWY7CiAgICAgIHJldHVybiBCOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGN1cnJlbnQgcmVsYXRpdmUgdmVsb2NpdHkgaW4gdGhlIGNvbnRhY3QgcG9pbnQuCiAgICAgKi8KCgogICAgZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbCgpIHsKICAgICAgY29uc3QgdmkgPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF92aTsKICAgICAgY29uc3QgdmogPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF92ajsKICAgICAgY29uc3QgeGkgPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF94aTsKICAgICAgY29uc3QgeGogPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF94ajsKICAgICAgY29uc3QgcmVsVmVsID0gQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfcmVsVmVsOwogICAgICB0aGlzLmJpLnBvc2l0aW9uLnZhZGQodGhpcy5yaSwgeGkpOwogICAgICB0aGlzLmJqLnBvc2l0aW9uLnZhZGQodGhpcy5yaiwgeGopOwogICAgICB0aGlzLmJpLmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHhpLCB2aSk7CiAgICAgIHRoaXMuYmouZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQoeGosIHZqKTsKICAgICAgdmkudnN1Yih2aiwgcmVsVmVsKTsKICAgICAgcmV0dXJuIHRoaXMubmkuZG90KHJlbFZlbCk7CiAgICB9CgogIH0KICBjb25zdCBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDEgPSBuZXcgVmVjMygpOyAvLyBUZW1wIHZlY3RvcnMKCiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2NvbXB1dGVCX3RlbXAyID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDMgPSBuZXcgVmVjMygpOwogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsX3ZpID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF92aiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfeGkgPSBuZXcgVmVjMygpOwogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsX3hqID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF9yZWxWZWwgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBDb25uZWN0cyB0d28gYm9kaWVzIGF0IGdpdmVuIG9mZnNldCBwb2ludHMuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3QgYm9keUEgPSBuZXcgQm9keSh7IG1hc3M6IDEgfSkKICAgKiAgICAgY29uc3QgYm9keUIgPSBuZXcgQm9keSh7IG1hc3M6IDEgfSkKICAgKiAgICAgYm9keUEucG9zaXRpb24uc2V0KC0xLCAwLCAwKQogICAqICAgICBib2R5Qi5wb3NpdGlvbi5zZXQoMSwgMCwgMCkKICAgKiAgICAgYm9keUEuYWRkU2hhcGUoc2hhcGVBKQogICAqICAgICBib2R5Qi5hZGRTaGFwZShzaGFwZUIpCiAgICogICAgIHdvcmxkLmFkZEJvZHkoYm9keUEpCiAgICogICAgIHdvcmxkLmFkZEJvZHkoYm9keUIpCiAgICogICAgIGNvbnN0IGxvY2FsUGl2b3RBID0gbmV3IFZlYzMoMSwgMCwgMCkKICAgKiAgICAgY29uc3QgbG9jYWxQaXZvdEIgPSBuZXcgVmVjMygtMSwgMCwgMCkKICAgKiAgICAgY29uc3QgY29uc3RyYWludCA9IG5ldyBQb2ludFRvUG9pbnRDb25zdHJhaW50KGJvZHlBLCBsb2NhbFBpdm90QSwgYm9keUIsIGxvY2FsUGl2b3RCKQogICAqICAgICB3b3JsZC5hZGRDb25zdHJhaW50KGNvbnN0cmFpbnQpCiAgICovCiAgY2xhc3MgUG9pbnRUb1BvaW50Q29uc3RyYWludCBleHRlbmRzIENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBQaXZvdCwgZGVmaW5lZCBsb2NhbGx5IGluIGJvZHlBLgogICAgICovCgogICAgLyoqCiAgICAgKiBQaXZvdCwgZGVmaW5lZCBsb2NhbGx5IGluIGJvZHlCLgogICAgICovCgogICAgLyoqCiAgICAgKiBAcGFyYW0gcGl2b3RBIFRoZSBwb2ludCByZWxhdGl2ZSB0byB0aGUgY2VudGVyIG9mIG1hc3Mgb2YgYm9keUEgd2hpY2ggYm9keUEgaXMgY29uc3RyYWluZWQgdG8uCiAgICAgKiBAcGFyYW0gYm9keUIgQm9keSB0aGF0IHdpbGwgYmUgY29uc3RyYWluZWQgaW4gYSBzaW1pbGFyIHdheSB0byB0aGUgc2FtZSBwb2ludCBhcyBib2R5QS4gV2Ugd2lsbCB0aGVyZWZvcmUgZ2V0IGEgbGluayBiZXR3ZWVuIGJvZHlBIGFuZCBib2R5Qi4gSWYgbm90IHNwZWNpZmllZCwgYm9keUEgd2lsbCBiZSBjb25zdHJhaW5lZCB0byBhIHN0YXRpYyBwb2ludC4KICAgICAqIEBwYXJhbSBwaXZvdEIgVGhlIHBvaW50IHJlbGF0aXZlIHRvIHRoZSBjZW50ZXIgb2YgbWFzcyBvZiBib2R5QiB3aGljaCBib2R5QiBpcyBjb25zdHJhaW5lZCB0by4KICAgICAqIEBwYXJhbSBtYXhGb3JjZSBUaGUgbWF4aW11bSBmb3JjZSB0aGF0IHNob3VsZCBiZSBhcHBsaWVkIHRvIGNvbnN0cmFpbiB0aGUgYm9kaWVzLgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgcGl2b3RBLCBib2R5QiwgcGl2b3RCLCBtYXhGb3JjZSkgewogICAgICBpZiAocGl2b3RBID09PSB2b2lkIDApIHsKICAgICAgICBwaXZvdEEgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAocGl2b3RCID09PSB2b2lkIDApIHsKICAgICAgICBwaXZvdEIgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAobWF4Rm9yY2UgPT09IHZvaWQgMCkgewogICAgICAgIG1heEZvcmNlID0gMWU2OwogICAgICB9CgogICAgICBzdXBlcihib2R5QSwgYm9keUIpOwogICAgICB0aGlzLnBpdm90QSA9IHBpdm90QS5jbG9uZSgpOwogICAgICB0aGlzLnBpdm90QiA9IHBpdm90Qi5jbG9uZSgpOwogICAgICBjb25zdCB4ID0gdGhpcy5lcXVhdGlvblggPSBuZXcgQ29udGFjdEVxdWF0aW9uKGJvZHlBLCBib2R5Qik7CiAgICAgIGNvbnN0IHkgPSB0aGlzLmVxdWF0aW9uWSA9IG5ldyBDb250YWN0RXF1YXRpb24oYm9keUEsIGJvZHlCKTsKICAgICAgY29uc3QgeiA9IHRoaXMuZXF1YXRpb25aID0gbmV3IENvbnRhY3RFcXVhdGlvbihib2R5QSwgYm9keUIpOyAvLyBFcXVhdGlvbnMgdG8gYmUgZmVkIHRvIHRoZSBzb2x2ZXIKCiAgICAgIHRoaXMuZXF1YXRpb25zLnB1c2goeCwgeSwgeik7IC8vIE1ha2UgdGhlIGVxdWF0aW9ucyBiaWRpcmVjdGlvbmFsCgogICAgICB4Lm1pbkZvcmNlID0geS5taW5Gb3JjZSA9IHoubWluRm9yY2UgPSAtbWF4Rm9yY2U7CiAgICAgIHgubWF4Rm9yY2UgPSB5Lm1heEZvcmNlID0gei5tYXhGb3JjZSA9IG1heEZvcmNlOwogICAgICB4Lm5pLnNldCgxLCAwLCAwKTsKICAgICAgeS5uaS5zZXQoMCwgMSwgMCk7CiAgICAgIHoubmkuc2V0KDAsIDAsIDEpOwogICAgfQoKICAgIHVwZGF0ZSgpIHsKICAgICAgY29uc3QgYm9keUEgPSB0aGlzLmJvZHlBOwogICAgICBjb25zdCBib2R5QiA9IHRoaXMuYm9keUI7CiAgICAgIGNvbnN0IHggPSB0aGlzLmVxdWF0aW9uWDsKICAgICAgY29uc3QgeSA9IHRoaXMuZXF1YXRpb25ZOwogICAgICBjb25zdCB6ID0gdGhpcy5lcXVhdGlvblo7IC8vIFJvdGF0ZSB0aGUgcGl2b3RzIHRvIHdvcmxkIHNwYWNlCgogICAgICBib2R5QS5xdWF0ZXJuaW9uLnZtdWx0KHRoaXMucGl2b3RBLCB4LnJpKTsKICAgICAgYm9keUIucXVhdGVybmlvbi52bXVsdCh0aGlzLnBpdm90QiwgeC5yaik7CiAgICAgIHkucmkuY29weSh4LnJpKTsKICAgICAgeS5yai5jb3B5KHgucmopOwogICAgICB6LnJpLmNvcHkoeC5yaSk7CiAgICAgIHoucmouY29weSh4LnJqKTsKICAgIH0KCiAgfQoKICAvKioKICAgKiBDb25lIGVxdWF0aW9uLiBXb3JrcyB0byBrZWVwIHRoZSBnaXZlbiBib2R5IHdvcmxkIHZlY3RvcnMgYWxpZ25lZCwgb3IgdGlsdGVkIHdpdGhpbiBhIGdpdmVuIGFuZ2xlIGZyb20gZWFjaCBvdGhlci4KICAgKi8KICBjbGFzcyBDb25lRXF1YXRpb24gZXh0ZW5kcyBFcXVhdGlvbiB7CiAgICAvKioKICAgICAqIExvY2FsIGF4aXMgaW4gQQogICAgICovCgogICAgLyoqCiAgICAgKiBMb2NhbCBheGlzIGluIEIKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlICJjb25lIGFuZ2xlIiB0byBrZWVwCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7CiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLW1heEZvcmNlLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMCwgMSwgMCk7CiAgICAgIHRoaXMuYW5nbGUgPSB0eXBlb2Ygb3B0aW9ucy5hbmdsZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFuZ2xlIDogMDsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIGNvbnN0IGEgPSB0aGlzLmE7CiAgICAgIGNvbnN0IGIgPSB0aGlzLmI7CiAgICAgIGNvbnN0IG5pID0gdGhpcy5heGlzQTsKICAgICAgY29uc3QgbmogPSB0aGlzLmF4aXNCOwogICAgICBjb25zdCBuaXhuaiA9IHRtcFZlYzEkMjsKICAgICAgY29uc3Qgbmp4bmkgPSB0bXBWZWMyJDI7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsgLy8gQ2FsdWNsYXRlIGNyb3NzIHByb2R1Y3RzCgogICAgICBuaS5jcm9zcyhuaiwgbml4bmopOwogICAgICBuai5jcm9zcyhuaSwgbmp4bmkpOyAvLyBUaGUgYW5nbGUgYmV0d2VlbiB0d28gdmVjdG9yIGlzOgogICAgICAvLyBjb3ModGhldGEpID0gYSAqIGIgLyAobGVuZ3RoKGEpICogbGVuZ3RoKGIpID0geyBsZW4oYSkgPSBsZW4oYikgPSAxIH0gPSBhICogYgogICAgICAvLyBnID0gYSAqIGIKICAgICAgLy8gZ2RvdCA9IChiIHggYSkgKiB3aSArIChhIHggYikgKiB3agogICAgICAvLyBHID0gWzAgYnhhIDAgYXhiXQogICAgICAvLyBXID0gW3ZpIHdpIHZqIHdqXQoKICAgICAgR0Eucm90YXRpb25hbC5jb3B5KG5qeG5pKTsKICAgICAgR0Iucm90YXRpb25hbC5jb3B5KG5peG5qKTsKICAgICAgY29uc3QgZyA9IE1hdGguY29zKHRoaXMuYW5nbGUpIC0gbmkuZG90KG5qKTsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICBjb25zdCBCID0gLWcgKiBhIC0gR1cgKiBiIC0gaCAqIEdpTWY7CiAgICAgIHJldHVybiBCOwogICAgfQoKICB9CiAgY29uc3QgdG1wVmVjMSQyID0gbmV3IFZlYzMoKTsKICBjb25zdCB0bXBWZWMyJDIgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBSb3RhdGlvbmFsIGNvbnN0cmFpbnQuIFdvcmtzIHRvIGtlZXAgdGhlIGxvY2FsIHZlY3RvcnMgb3J0aG9nb25hbCB0byBlYWNoIG90aGVyIGluIHdvcmxkIHNwYWNlLgogICAqLwogIGNsYXNzIFJvdGF0aW9uYWxFcXVhdGlvbiBleHRlbmRzIEVxdWF0aW9uIHsKICAgIC8qKgogICAgICogV29ybGQgb3JpZW50ZWQgcm90YXRpb25hbCBheGlzLgogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZCBvcmllbnRlZCByb3RhdGlvbmFsIGF4aXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIG1heEFuZ2xlCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7CiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLW1heEZvcmNlLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMCwgMSwgMCk7CiAgICAgIHRoaXMubWF4QW5nbGUgPSBNYXRoLlBJIC8gMjsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIGNvbnN0IGEgPSB0aGlzLmE7CiAgICAgIGNvbnN0IGIgPSB0aGlzLmI7CiAgICAgIGNvbnN0IG5pID0gdGhpcy5heGlzQTsKICAgICAgY29uc3QgbmogPSB0aGlzLmF4aXNCOwogICAgICBjb25zdCBuaXhuaiA9IHRtcFZlYzEkMTsKICAgICAgY29uc3Qgbmp4bmkgPSB0bXBWZWMyJDE7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsgLy8gQ2FsdWNsYXRlIGNyb3NzIHByb2R1Y3RzCgogICAgICBuaS5jcm9zcyhuaiwgbml4bmopOwogICAgICBuai5jcm9zcyhuaSwgbmp4bmkpOyAvLyBnID0gbmkgKiBuagogICAgICAvLyBnZG90ID0gKG5qIHggbmkpICogd2kgKyAobmkgeCBuaikgKiB3agogICAgICAvLyBHID0gWzAgbmp4bmkgMCBuaXhual0KICAgICAgLy8gVyA9IFt2aSB3aSB2aiB3al0KCiAgICAgIEdBLnJvdGF0aW9uYWwuY29weShuanhuaSk7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShuaXhuaik7CiAgICAgIGNvbnN0IGcgPSBNYXRoLmNvcyh0aGlzLm1heEFuZ2xlKSAtIG5pLmRvdChuaik7CiAgICAgIGNvbnN0IEdXID0gdGhpcy5jb21wdXRlR1coKTsKICAgICAgY29uc3QgR2lNZiA9IHRoaXMuY29tcHV0ZUdpTWYoKTsKICAgICAgY29uc3QgQiA9IC1nICogYSAtIEdXICogYiAtIGggKiBHaU1mOwogICAgICByZXR1cm4gQjsKICAgIH0KCiAgfQogIGNvbnN0IHRtcFZlYzEkMSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjMiQxID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQSBDb25lIFR3aXN0IGNvbnN0cmFpbnQsIHVzZWZ1bCBmb3IgcmFnZG9sbHMuCiAgICovCiAgY2xhc3MgQ29uZVR3aXN0Q29uc3RyYWludCBleHRlbmRzIFBvaW50VG9Qb2ludENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBUaGUgYXhpcyBkaXJlY3Rpb24gZm9yIHRoZSBjb25zdHJhaW50IG9mIHRoZSBib2R5IEEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBheGlzIGRpcmVjdGlvbiBmb3IgdGhlIGNvbnN0cmFpbnQgb2YgdGhlIGJvZHkgQi4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGFwZXJ0dXJlIGFuZ2xlIG9mIHRoZSBjb25lLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgdHdpc3QgYW5nbGUgb2YgdGhlIGpvaW50LgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgY29uc3QgbWF4Rm9yY2UgPSB0eXBlb2Ygb3B0aW9ucy5tYXhGb3JjZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLm1heEZvcmNlIDogMWU2OyAvLyBTZXQgcGl2b3QgcG9pbnQgaW4gYmV0d2VlbgoKICAgICAgY29uc3QgcGl2b3RBID0gb3B0aW9ucy5waXZvdEEgPyBvcHRpb25zLnBpdm90QS5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcGl2b3RCID0gb3B0aW9ucy5waXZvdEIgPyBvcHRpb25zLnBpdm90Qi5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgc3VwZXIoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpOwogICAgICB0aGlzLmF4aXNBID0gb3B0aW9ucy5heGlzQSA/IG9wdGlvbnMuYXhpc0EuY2xvbmUoKSA6IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgdGhpcy5jb2xsaWRlQ29ubmVjdGVkID0gISFvcHRpb25zLmNvbGxpZGVDb25uZWN0ZWQ7CiAgICAgIHRoaXMuYW5nbGUgPSB0eXBlb2Ygb3B0aW9ucy5hbmdsZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFuZ2xlIDogMDsKICAgICAgY29uc3QgYyA9IHRoaXMuY29uZUVxdWF0aW9uID0gbmV3IENvbmVFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICBjb25zdCB0ID0gdGhpcy50d2lzdEVxdWF0aW9uID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICB0aGlzLnR3aXN0QW5nbGUgPSB0eXBlb2Ygb3B0aW9ucy50d2lzdEFuZ2xlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMudHdpc3RBbmdsZSA6IDA7IC8vIE1ha2UgdGhlIGNvbmUgZXF1YXRpb24gcHVzaCB0aGUgYm9kaWVzIHRvd2FyZCB0aGUgY29uZSBheGlzLCBub3Qgb3V0d2FyZAoKICAgICAgYy5tYXhGb3JjZSA9IDA7CiAgICAgIGMubWluRm9yY2UgPSAtbWF4Rm9yY2U7IC8vIE1ha2UgdGhlIHR3aXN0IGVxdWF0aW9uIGFkZCB0b3JxdWUgdG93YXJkIHRoZSBpbml0aWFsIHBvc2l0aW9uCgogICAgICB0Lm1heEZvcmNlID0gMDsKICAgICAgdC5taW5Gb3JjZSA9IC1tYXhGb3JjZTsKICAgICAgdGhpcy5lcXVhdGlvbnMucHVzaChjLCB0KTsKICAgIH0KCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCBjb25lID0gdGhpcy5jb25lRXF1YXRpb247CiAgICAgIGNvbnN0IHR3aXN0ID0gdGhpcy50d2lzdEVxdWF0aW9uOwogICAgICBzdXBlci51cGRhdGUoKTsgLy8gVXBkYXRlIHRoZSBheGVzIHRvIHRoZSBjb25lIGNvbnN0cmFpbnQKCiAgICAgIGJvZHlBLnZlY3RvclRvV29ybGRGcmFtZSh0aGlzLmF4aXNBLCBjb25lLmF4aXNBKTsKICAgICAgYm9keUIudmVjdG9yVG9Xb3JsZEZyYW1lKHRoaXMuYXhpc0IsIGNvbmUuYXhpc0IpOyAvLyBVcGRhdGUgdGhlIHdvcmxkIGF4ZXMgaW4gdGhlIHR3aXN0IGNvbnN0cmFpbnQKCiAgICAgIHRoaXMuYXhpc0EudGFuZ2VudHModHdpc3QuYXhpc0EsIHR3aXN0LmF4aXNBKTsKICAgICAgYm9keUEudmVjdG9yVG9Xb3JsZEZyYW1lKHR3aXN0LmF4aXNBLCB0d2lzdC5heGlzQSk7CiAgICAgIHRoaXMuYXhpc0IudGFuZ2VudHModHdpc3QuYXhpc0IsIHR3aXN0LmF4aXNCKTsKICAgICAgYm9keUIudmVjdG9yVG9Xb3JsZEZyYW1lKHR3aXN0LmF4aXNCLCB0d2lzdC5heGlzQik7CiAgICAgIGNvbmUuYW5nbGUgPSB0aGlzLmFuZ2xlOwogICAgICB0d2lzdC5tYXhBbmdsZSA9IHRoaXMudHdpc3RBbmdsZTsKICAgIH0KCiAgfQogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQ29uc3RyYWlucyB0d28gYm9kaWVzIHRvIGJlIGF0IGEgY29uc3RhbnQgZGlzdGFuY2UgZnJvbSBlYWNoIG90aGVycyBjZW50ZXIgb2YgbWFzcy4KICAgKi8KICBjbGFzcyBEaXN0YW5jZUNvbnN0cmFpbnQgZXh0ZW5kcyBDb25zdHJhaW50IHsKICAgIC8qKgogICAgICogVGhlIGRpc3RhbmNlIHRvIGtlZXAuIElmIHVuZGVmaW5lZCwgaXQgd2lsbCBiZSBzZXQgdG8gdGhlIGN1cnJlbnQgZGlzdGFuY2UgYmV0d2VlbiBib2R5QSBhbmQgYm9keUIKICAgICAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIGRpc3RhbmNlIFRoZSBkaXN0YW5jZSB0byBrZWVwLiBJZiB1bmRlZmluZWQsIGl0IHdpbGwgYmUgc2V0IHRvIHRoZSBjdXJyZW50IGRpc3RhbmNlIGJldHdlZW4gYm9keUEgYW5kIGJvZHlCLgogICAgICogQHBhcmFtIG1heEZvcmNlIFRoZSBtYXhpbXVtIGZvcmNlIHRoYXQgc2hvdWxkIGJlIGFwcGxpZWQgdG8gY29uc3RyYWluIHRoZSBib2RpZXMuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5QiwgZGlzdGFuY2UsIG1heEZvcmNlKSB7CiAgICAgIGlmIChtYXhGb3JjZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWF4Rm9yY2UgPSAxZTY7CiAgICAgIH0KCiAgICAgIHN1cGVyKGJvZHlBLCBib2R5Qik7CgogICAgICBpZiAodHlwZW9mIGRpc3RhbmNlID09PSAndW5kZWZpbmVkJykgewogICAgICAgIGRpc3RhbmNlID0gYm9keUEucG9zaXRpb24uZGlzdGFuY2VUbyhib2R5Qi5wb3NpdGlvbik7CiAgICAgIH0KCiAgICAgIHRoaXMuZGlzdGFuY2UgPSBkaXN0YW5jZTsKICAgICAgY29uc3QgZXEgPSB0aGlzLmRpc3RhbmNlRXF1YXRpb24gPSBuZXcgQ29udGFjdEVxdWF0aW9uKGJvZHlBLCBib2R5Qik7CiAgICAgIHRoaXMuZXF1YXRpb25zLnB1c2goZXEpOyAvLyBNYWtlIGl0IGJpZGlyZWN0aW9uYWwKCiAgICAgIGVxLm1pbkZvcmNlID0gLW1heEZvcmNlOwogICAgICBlcS5tYXhGb3JjZSA9IG1heEZvcmNlOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGUKICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCBlcSA9IHRoaXMuZGlzdGFuY2VFcXVhdGlvbjsKICAgICAgY29uc3QgaGFsZkRpc3QgPSB0aGlzLmRpc3RhbmNlICogMC41OwogICAgICBjb25zdCBub3JtYWwgPSBlcS5uaTsKICAgICAgYm9keUIucG9zaXRpb24udnN1Yihib2R5QS5wb3NpdGlvbiwgbm9ybWFsKTsKICAgICAgbm9ybWFsLm5vcm1hbGl6ZSgpOwogICAgICBub3JtYWwuc2NhbGUoaGFsZkRpc3QsIGVxLnJpKTsKICAgICAgbm9ybWFsLnNjYWxlKC1oYWxmRGlzdCwgZXEucmopOwogICAgfQoKICB9CgogIC8qKgogICAqIExvY2sgY29uc3RyYWludC4gV2lsbCByZW1vdmUgYWxsIGRlZ3JlZXMgb2YgZnJlZWRvbSBiZXR3ZWVuIHRoZSBib2RpZXMuCiAgICovCiAgY2xhc3MgTG9ja0NvbnN0cmFpbnQgZXh0ZW5kcyBQb2ludFRvUG9pbnRDb25zdHJhaW50IHsKICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7IC8vIFNldCBwaXZvdCBwb2ludCBpbiBiZXR3ZWVuCgogICAgICBjb25zdCBwaXZvdEEgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBwaXZvdEIgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBoYWxmV2F5ID0gbmV3IFZlYzMoKTsKICAgICAgYm9keUEucG9zaXRpb24udmFkZChib2R5Qi5wb3NpdGlvbiwgaGFsZldheSk7CiAgICAgIGhhbGZXYXkuc2NhbGUoMC41LCBoYWxmV2F5KTsKICAgICAgYm9keUIucG9pbnRUb0xvY2FsRnJhbWUoaGFsZldheSwgcGl2b3RCKTsKICAgICAgYm9keUEucG9pbnRUb0xvY2FsRnJhbWUoaGFsZldheSwgcGl2b3RBKTsgLy8gVGhlIHBvaW50LXRvLXBvaW50IGNvbnN0cmFpbnQgd2lsbCBrZWVwIGEgcG9pbnQgc2hhcmVkIGJldHdlZW4gdGhlIGJvZGllcwoKICAgICAgc3VwZXIoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpOyAvLyBTdG9yZSBpbml0aWFsIHJvdGF0aW9uIG9mIHRoZSBib2RpZXMgYXMgdW5pdCB2ZWN0b3JzIGluIHRoZSBsb2NhbCBib2R5IHNwYWNlcwoKICAgICAgdGhpcy54QSA9IGJvZHlBLnZlY3RvclRvTG9jYWxGcmFtZShWZWMzLlVOSVRfWCk7CiAgICAgIHRoaXMueEIgPSBib2R5Qi52ZWN0b3JUb0xvY2FsRnJhbWUoVmVjMy5VTklUX1gpOwogICAgICB0aGlzLnlBID0gYm9keUEudmVjdG9yVG9Mb2NhbEZyYW1lKFZlYzMuVU5JVF9ZKTsKICAgICAgdGhpcy55QiA9IGJvZHlCLnZlY3RvclRvTG9jYWxGcmFtZShWZWMzLlVOSVRfWSk7CiAgICAgIHRoaXMuekEgPSBib2R5QS52ZWN0b3JUb0xvY2FsRnJhbWUoVmVjMy5VTklUX1opOwogICAgICB0aGlzLnpCID0gYm9keUIudmVjdG9yVG9Mb2NhbEZyYW1lKFZlYzMuVU5JVF9aKTsgLy8gLi4uYW5kIHRoZSBmb2xsb3dpbmcgcm90YXRpb25hbCBlcXVhdGlvbnMgd2lsbCBrZWVwIGFsbCByb3RhdGlvbmFsIERPRidzIGluIHBsYWNlCgogICAgICBjb25zdCByMSA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMSA9IG5ldyBSb3RhdGlvbmFsRXF1YXRpb24oYm9keUEsIGJvZHlCLCBvcHRpb25zKTsKICAgICAgY29uc3QgcjIgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjIgPSBuZXcgUm90YXRpb25hbEVxdWF0aW9uKGJvZHlBLCBib2R5Qiwgb3B0aW9ucyk7CiAgICAgIGNvbnN0IHIzID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24zID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICB0aGlzLmVxdWF0aW9ucy5wdXNoKHIxLCByMiwgcjMpOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGUKICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICB0aGlzLm1vdG9yRXF1YXRpb247CiAgICAgIGNvbnN0IHIxID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24xOwogICAgICBjb25zdCByMiA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMjsKICAgICAgY29uc3QgcjMgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjM7CiAgICAgIHN1cGVyLnVwZGF0ZSgpOyAvLyBUaGVzZSB2ZWN0b3IgcGFpcnMgbXVzdCBiZSBvcnRob2dvbmFsCgogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy54QSwgcjEuYXhpc0EpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy55QiwgcjEuYXhpc0IpOwogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy55QSwgcjIuYXhpc0EpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy56QiwgcjIuYXhpc0IpOwogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy56QSwgcjMuYXhpc0EpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy54QiwgcjMuYXhpc0IpOwogICAgfQoKICB9CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwoKICAvKioKICAgKiBSb3RhdGlvbmFsIG1vdG9yIGNvbnN0cmFpbnQuIFRyaWVzIHRvIGtlZXAgdGhlIHJlbGF0aXZlIGFuZ3VsYXIgdmVsb2NpdHkgb2YgdGhlIGJvZGllcyB0byBhIGdpdmVuIHZhbHVlLgogICAqLwogIGNsYXNzIFJvdGF0aW9uYWxNb3RvckVxdWF0aW9uIGV4dGVuZHMgRXF1YXRpb24gewogICAgLyoqCiAgICAgKiBXb3JsZCBvcmllbnRlZCByb3RhdGlvbmFsIGF4aXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdvcmxkIG9yaWVudGVkIHJvdGF0aW9uYWwgYXhpcy4KICAgICAqLwoKICAgIC8qKgogICAgICogTW90b3IgdmVsb2NpdHkuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5QiwgbWF4Rm9yY2UpIHsKICAgICAgaWYgKG1heEZvcmNlID09PSB2b2lkIDApIHsKICAgICAgICBtYXhGb3JjZSA9IDFlNjsKICAgICAgfQoKICAgICAgc3VwZXIoYm9keUEsIGJvZHlCLCAtbWF4Rm9yY2UsIG1heEZvcmNlKTsKICAgICAgdGhpcy5heGlzQSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuYXhpc0IgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnRhcmdldFZlbG9jaXR5ID0gMDsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIHRoaXMuYTsKICAgICAgY29uc3QgYiA9IHRoaXMuYjsKICAgICAgdGhpcy5iaTsKICAgICAgdGhpcy5iajsKICAgICAgY29uc3QgYXhpc0EgPSB0aGlzLmF4aXNBOwogICAgICBjb25zdCBheGlzQiA9IHRoaXMuYXhpc0I7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsgLy8gZyA9IDAKICAgICAgLy8gZ2RvdCA9IGF4aXNBICogd2kgLSBheGlzQiAqIHdqCiAgICAgIC8vIGdkb3QgPSBHICogVyA9IEcgKiBbdmkgd2kgdmogd2pdCiAgICAgIC8vID0+CiAgICAgIC8vIEcgPSBbMCBheGlzQSAwIC1heGlzQl0KCiAgICAgIEdBLnJvdGF0aW9uYWwuY29weShheGlzQSk7CiAgICAgIGF4aXNCLm5lZ2F0ZShHQi5yb3RhdGlvbmFsKTsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpIC0gdGhpcy50YXJnZXRWZWxvY2l0eTsKICAgICAgY29uc3QgR2lNZiA9IHRoaXMuY29tcHV0ZUdpTWYoKTsKICAgICAgY29uc3QgQiA9IC1HVyAqIGIgLSBoICogR2lNZjsKICAgICAgcmV0dXJuIEI7CiAgICB9CgogIH0KCiAgLyoqCiAgICogSGluZ2UgY29uc3RyYWludC4gVGhpbmsgb2YgaXQgYXMgYSBkb29yIGhpbmdlLiBJdCB0cmllcyB0byBrZWVwIHRoZSBkb29yIGluIHRoZSBjb3JyZWN0IHBsYWNlIGFuZCB3aXRoIHRoZSBjb3JyZWN0IG9yaWVudGF0aW9uLgogICAqLwogIGNsYXNzIEhpbmdlQ29uc3RyYWludCBleHRlbmRzIFBvaW50VG9Qb2ludENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBSb3RhdGlvbiBheGlzLCBkZWZpbmVkIGxvY2FsbHkgaW4gYm9keUEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFJvdGF0aW9uIGF4aXMsIGRlZmluZWQgbG9jYWxseSBpbiBib2R5Qi4KICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIGJvZHlCLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IG1heEZvcmNlID0gdHlwZW9mIG9wdGlvbnMubWF4Rm9yY2UgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5tYXhGb3JjZSA6IDFlNjsKICAgICAgY29uc3QgcGl2b3RBID0gb3B0aW9ucy5waXZvdEEgPyBvcHRpb25zLnBpdm90QS5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcGl2b3RCID0gb3B0aW9ucy5waXZvdEIgPyBvcHRpb25zLnBpdm90Qi5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgc3VwZXIoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpOwogICAgICBjb25zdCBheGlzQSA9IHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIGF4aXNBLm5vcm1hbGl6ZSgpOwogICAgICBjb25zdCBheGlzQiA9IHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIGF4aXNCLm5vcm1hbGl6ZSgpOwogICAgICB0aGlzLmNvbGxpZGVDb25uZWN0ZWQgPSAhIW9wdGlvbnMuY29sbGlkZUNvbm5lY3RlZDsKICAgICAgY29uc3Qgcm90YXRpb25hbDEgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjEgPSBuZXcgUm90YXRpb25hbEVxdWF0aW9uKGJvZHlBLCBib2R5Qiwgb3B0aW9ucyk7CiAgICAgIGNvbnN0IHJvdGF0aW9uYWwyID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24yID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICBjb25zdCBtb3RvciA9IHRoaXMubW90b3JFcXVhdGlvbiA9IG5ldyBSb3RhdGlvbmFsTW90b3JFcXVhdGlvbihib2R5QSwgYm9keUIsIG1heEZvcmNlKTsKICAgICAgbW90b3IuZW5hYmxlZCA9IGZhbHNlOyAvLyBOb3QgZW5hYmxlZCBieSBkZWZhdWx0CiAgICAgIC8vIEVxdWF0aW9ucyB0byBiZSBmZWQgdG8gdGhlIHNvbHZlcgoKICAgICAgdGhpcy5lcXVhdGlvbnMucHVzaChyb3RhdGlvbmFsMSwgcm90YXRpb25hbDIsIG1vdG9yKTsKICAgIH0KICAgIC8qKgogICAgICogZW5hYmxlTW90b3IKICAgICAqLwoKCiAgICBlbmFibGVNb3RvcigpIHsKICAgICAgdGhpcy5tb3RvckVxdWF0aW9uLmVuYWJsZWQgPSB0cnVlOwogICAgfQogICAgLyoqCiAgICAgKiBkaXNhYmxlTW90b3IKICAgICAqLwoKCiAgICBkaXNhYmxlTW90b3IoKSB7CiAgICAgIHRoaXMubW90b3JFcXVhdGlvbi5lbmFibGVkID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIHNldE1vdG9yU3BlZWQKICAgICAqLwoKCiAgICBzZXRNb3RvclNwZWVkKHNwZWVkKSB7CiAgICAgIHRoaXMubW90b3JFcXVhdGlvbi50YXJnZXRWZWxvY2l0eSA9IHNwZWVkOwogICAgfQogICAgLyoqCiAgICAgKiBzZXRNb3Rvck1heEZvcmNlCiAgICAgKi8KCgogICAgc2V0TW90b3JNYXhGb3JjZShtYXhGb3JjZSkgewogICAgICB0aGlzLm1vdG9yRXF1YXRpb24ubWF4Rm9yY2UgPSBtYXhGb3JjZTsKICAgICAgdGhpcy5tb3RvckVxdWF0aW9uLm1pbkZvcmNlID0gLW1heEZvcmNlOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGUKICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCBtb3RvciA9IHRoaXMubW90b3JFcXVhdGlvbjsKICAgICAgY29uc3QgcjEgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjE7CiAgICAgIGNvbnN0IHIyID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24yOwogICAgICBjb25zdCB3b3JsZEF4aXNBID0gSGluZ2VDb25zdHJhaW50X3VwZGF0ZV90bXBWZWMxOwogICAgICBjb25zdCB3b3JsZEF4aXNCID0gSGluZ2VDb25zdHJhaW50X3VwZGF0ZV90bXBWZWMyOwogICAgICBjb25zdCBheGlzQSA9IHRoaXMuYXhpc0E7CiAgICAgIGNvbnN0IGF4aXNCID0gdGhpcy5heGlzQjsKICAgICAgc3VwZXIudXBkYXRlKCk7IC8vIEdldCB3b3JsZCBheGVzCgogICAgICBib2R5QS5xdWF0ZXJuaW9uLnZtdWx0KGF4aXNBLCB3b3JsZEF4aXNBKTsKICAgICAgYm9keUIucXVhdGVybmlvbi52bXVsdChheGlzQiwgd29ybGRBeGlzQik7CiAgICAgIHdvcmxkQXhpc0EudGFuZ2VudHMocjEuYXhpc0EsIHIyLmF4aXNBKTsKICAgICAgcjEuYXhpc0IuY29weSh3b3JsZEF4aXNCKTsKICAgICAgcjIuYXhpc0IuY29weSh3b3JsZEF4aXNCKTsKCiAgICAgIGlmICh0aGlzLm1vdG9yRXF1YXRpb24uZW5hYmxlZCkgewogICAgICAgIGJvZHlBLnF1YXRlcm5pb24udm11bHQodGhpcy5heGlzQSwgbW90b3IuYXhpc0EpOwogICAgICAgIGJvZHlCLnF1YXRlcm5pb24udm11bHQodGhpcy5heGlzQiwgbW90b3IuYXhpc0IpOwogICAgICB9CiAgICB9CgogIH0KICBjb25zdCBIaW5nZUNvbnN0cmFpbnRfdXBkYXRlX3RtcFZlYzEgPSBuZXcgVmVjMygpOwogIGNvbnN0IEhpbmdlQ29uc3RyYWludF91cGRhdGVfdG1wVmVjMiA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIENvbnN0cmFpbnMgdGhlIHNsaXBwaW5nIGluIGEgY29udGFjdCBhbG9uZyBhIHRhbmdlbnQKICAgKi8KICBjbGFzcyBGcmljdGlvbkVxdWF0aW9uIGV4dGVuZHMgRXF1YXRpb24gewogICAgLy8gVGFuZ2VudAoKICAgIC8qKgogICAgICogQHBhcmFtIHNsaXBGb3JjZSBzaG91bGQgYmUgKy1GX2ZyaWN0aW9uID0gKy1tdSAqIEZfbm9ybWFsID0gKy1tdSAqIG0gKiBnCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgc2xpcEZvcmNlKSB7CiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLXNsaXBGb3JjZSwgc2xpcEZvcmNlKTsKICAgICAgdGhpcy5yaSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucmogPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnQgPSBuZXcgVmVjMygpOwogICAgfQoKICAgIGNvbXB1dGVCKGgpIHsKICAgICAgdGhpcy5hOwogICAgICBjb25zdCBiID0gdGhpcy5iOwogICAgICB0aGlzLmJpOwogICAgICB0aGlzLmJqOwogICAgICBjb25zdCByaSA9IHRoaXMucmk7CiAgICAgIGNvbnN0IHJqID0gdGhpcy5yajsKICAgICAgY29uc3Qgcml4dCA9IEZyaWN0aW9uRXF1YXRpb25fY29tcHV0ZUJfdGVtcDE7CiAgICAgIGNvbnN0IHJqeHQgPSBGcmljdGlvbkVxdWF0aW9uX2NvbXB1dGVCX3RlbXAyOwogICAgICBjb25zdCB0ID0gdGhpcy50OyAvLyBDYWx1Y2xhdGUgY3Jvc3MgcHJvZHVjdHMKCiAgICAgIHJpLmNyb3NzKHQsIHJpeHQpOwogICAgICByai5jcm9zcyh0LCByanh0KTsgLy8gRyA9IFstdCAtcml4dCB0IHJqeHRdCiAgICAgIC8vIEFuZCByZW1lbWJlciwgdGhpcyBpcyBhIHB1cmUgdmVsb2NpdHkgY29uc3RyYWludCwgZyBpcyBhbHdheXMgemVybyEKCiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgdC5uZWdhdGUoR0Euc3BhdGlhbCk7CiAgICAgIHJpeHQubmVnYXRlKEdBLnJvdGF0aW9uYWwpOwogICAgICBHQi5zcGF0aWFsLmNvcHkodCk7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShyanh0KTsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICBjb25zdCBCID0gLUdXICogYiAtIGggKiBHaU1mOwogICAgICByZXR1cm4gQjsKICAgIH0KCiAgfQogIGNvbnN0IEZyaWN0aW9uRXF1YXRpb25fY29tcHV0ZUJfdGVtcDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IEZyaWN0aW9uRXF1YXRpb25fY29tcHV0ZUJfdGVtcDIgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBEZWZpbmVzIHdoYXQgaGFwcGVucyB3aGVuIHR3byBtYXRlcmlhbHMgbWVldC4KICAgKiBAdG9kbyBSZWZhY3RvciBtYXRlcmlhbHMgdG8gbWF0ZXJpYWxBIGFuZCBtYXRlcmlhbEIKICAgKi8KICBjbGFzcyBDb250YWN0TWF0ZXJpYWwgewogICAgLyoqCiAgICAgKiBJZGVudGlmaWVyIG9mIHRoaXMgbWF0ZXJpYWwuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFBhcnRpY2lwYXRpbmcgbWF0ZXJpYWxzLgogICAgICovCgogICAgLyoqCiAgICAgKiBGcmljdGlvbiBjb2VmZmljaWVudC4KICAgICAqIEBkZWZhdWx0IDAuMwogICAgICovCgogICAgLyoqCiAgICAgKiBSZXN0aXR1dGlvbiBjb2VmZmljaWVudC4KICAgICAqIEBkZWZhdWx0IDAuMwogICAgICovCgogICAgLyoqCiAgICAgKiBTdGlmZm5lc3Mgb2YgdGhlIHByb2R1Y2VkIGNvbnRhY3QgZXF1YXRpb25zLgogICAgICogQGRlZmF1bHQgMWU3CiAgICAgKi8KCiAgICAvKioKICAgICAqIFJlbGF4YXRpb24gdGltZSBvZiB0aGUgcHJvZHVjZWQgY29udGFjdCBlcXVhdGlvbnMuCiAgICAgKiBAZGVmYXVsdCAzCiAgICAgKi8KCiAgICAvKioKICAgICAqIFN0aWZmbmVzcyBvZiB0aGUgcHJvZHVjZWQgZnJpY3Rpb24gZXF1YXRpb25zLgogICAgICogQGRlZmF1bHQgMWU3CiAgICAgKi8KCiAgICAvKioKICAgICAqIFJlbGF4YXRpb24gdGltZSBvZiB0aGUgcHJvZHVjZWQgZnJpY3Rpb24gZXF1YXRpb25zCiAgICAgKiBAZGVmYXVsdCAzCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG0xLCBtMiwgb3B0aW9ucykgewogICAgICBvcHRpb25zID0gVXRpbHMuZGVmYXVsdHMob3B0aW9ucywgewogICAgICAgIGZyaWN0aW9uOiAwLjMsCiAgICAgICAgcmVzdGl0dXRpb246IDAuMywKICAgICAgICBjb250YWN0RXF1YXRpb25TdGlmZm5lc3M6IDFlNywKICAgICAgICBjb250YWN0RXF1YXRpb25SZWxheGF0aW9uOiAzLAogICAgICAgIGZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3M6IDFlNywKICAgICAgICBmcmljdGlvbkVxdWF0aW9uUmVsYXhhdGlvbjogMwogICAgICB9KTsKICAgICAgdGhpcy5pZCA9IENvbnRhY3RNYXRlcmlhbC5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5tYXRlcmlhbHMgPSBbbTEsIG0yXTsKICAgICAgdGhpcy5mcmljdGlvbiA9IG9wdGlvbnMuZnJpY3Rpb247CiAgICAgIHRoaXMucmVzdGl0dXRpb24gPSBvcHRpb25zLnJlc3RpdHV0aW9uOwogICAgICB0aGlzLmNvbnRhY3RFcXVhdGlvblN0aWZmbmVzcyA9IG9wdGlvbnMuY29udGFjdEVxdWF0aW9uU3RpZmZuZXNzOwogICAgICB0aGlzLmNvbnRhY3RFcXVhdGlvblJlbGF4YXRpb24gPSBvcHRpb25zLmNvbnRhY3RFcXVhdGlvblJlbGF4YXRpb247CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcyA9IG9wdGlvbnMuZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzczsKICAgICAgdGhpcy5mcmljdGlvbkVxdWF0aW9uUmVsYXhhdGlvbiA9IG9wdGlvbnMuZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb247CiAgICB9CgogIH0KICBDb250YWN0TWF0ZXJpYWwuaWRDb3VudGVyID0gMDsKCiAgLyoqCiAgICogRGVmaW5lcyBhIHBoeXNpY3MgbWF0ZXJpYWwuCiAgICovCiAgY2xhc3MgTWF0ZXJpYWwgewogICAgLyoqCiAgICAgKiBNYXRlcmlhbCBuYW1lLgogICAgICogSWYgb3B0aW9ucyBpcyBhIHN0cmluZywgbmFtZSB3aWxsIGJlIHNldCB0byB0aGF0IHN0cmluZy4KICAgICAqIEB0b2RvIERlcHJlY2F0ZSB0aGlzCiAgICAgKi8KCiAgICAvKiogTWF0ZXJpYWwgaWQuICovCgogICAgLyoqCiAgICAgKiBGcmljdGlvbiBmb3IgdGhpcyBtYXRlcmlhbC4KICAgICAqIElmIG5vbi1uZWdhdGl2ZSwgaXQgd2lsbCBiZSB1c2VkIGluc3RlYWQgb2YgdGhlIGZyaWN0aW9uIGdpdmVuIGJ5IENvbnRhY3RNYXRlcmlhbHMuIElmIHRoZXJlJ3Mgbm8gbWF0Y2hpbmcgQ29udGFjdE1hdGVyaWFsLCB0aGUgdmFsdWUgZnJvbSBgZGVmYXVsdENvbnRhY3RNYXRlcmlhbGAgaW4gdGhlIFdvcmxkIHdpbGwgYmUgdXNlZC4KICAgICAqLwoKICAgIC8qKgogICAgICogUmVzdGl0dXRpb24gZm9yIHRoaXMgbWF0ZXJpYWwuCiAgICAgKiBJZiBub24tbmVnYXRpdmUsIGl0IHdpbGwgYmUgdXNlZCBpbnN0ZWFkIG9mIHRoZSByZXN0aXR1dGlvbiBnaXZlbiBieSBDb250YWN0TWF0ZXJpYWxzLiBJZiB0aGVyZSdzIG5vIG1hdGNoaW5nIENvbnRhY3RNYXRlcmlhbCwgdGhlIHZhbHVlIGZyb20gYGRlZmF1bHRDb250YWN0TWF0ZXJpYWxgIGluIHRoZSBXb3JsZCB3aWxsIGJlIHVzZWQuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgbGV0IG5hbWUgPSAnJzsgLy8gQmFja3dhcmRzIGNvbXBhdGliaWxpdHkgZml4CgogICAgICBpZiAodHlwZW9mIG9wdGlvbnMgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgLy9jb25zb2xlLndhcm4oYFBhc3NpbmcgYSBzdHJpbmcgdG8gTWF0ZXJpYWxPcHRpb25zIGlzIGRlcHJlY2F0ZWQsIGFuZCBoYXMgbm8gZWZmZWN0YCkKICAgICAgICBuYW1lID0gb3B0aW9uczsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIHRoaXMubmFtZSA9IG5hbWU7CiAgICAgIHRoaXMuaWQgPSBNYXRlcmlhbC5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5mcmljdGlvbiA9IHR5cGVvZiBvcHRpb25zLmZyaWN0aW9uICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuZnJpY3Rpb24gOiAtMTsKICAgICAgdGhpcy5yZXN0aXR1dGlvbiA9IHR5cGVvZiBvcHRpb25zLnJlc3RpdHV0aW9uICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMucmVzdGl0dXRpb24gOiAtMTsKICAgIH0KCiAgfQogIE1hdGVyaWFsLmlkQ291bnRlciA9IDA7CgogIC8qKgogICAqIEEgc3ByaW5nLCBjb25uZWN0aW5nIHR3byBib2RpZXMuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3Qgc3ByaW5nID0gbmV3IFNwcmluZyhib3hCb2R5LCBzcGhlcmVCb2R5LCB7CiAgICogICAgICAgcmVzdExlbmd0aDogMCwKICAgKiAgICAgICBzdGlmZm5lc3M6IDUwLAogICAqICAgICAgIGRhbXBpbmc6IDEsCiAgICogICAgIH0pCiAgICoKICAgKiAgICAgLy8gQ29tcHV0ZSB0aGUgZm9yY2UgYWZ0ZXIgZWFjaCBzdGVwCiAgICogICAgIHdvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgKGV2ZW50KSA9PiB7CiAgICogICAgICAgc3ByaW5nLmFwcGx5Rm9yY2UoKQogICAqICAgICB9KQogICAqLwogIGNsYXNzIFNwcmluZyB7CiAgICAvKioKICAgICAqIFJlc3QgbGVuZ3RoIG9mIHRoZSBzcHJpbmcuIEEgbnVtYmVyID4gMC4KICAgICAqIEBkZWZhdWx0IDEKICAgICAqLwoKICAgIC8qKgogICAgICogU3RpZmZuZXNzIG9mIHRoZSBzcHJpbmcuIEEgbnVtYmVyID49IDAuCiAgICAgKiBAZGVmYXVsdCAxMDAKICAgICAqLwoKICAgIC8qKgogICAgICogRGFtcGluZyBvZiB0aGUgc3ByaW5nLiBBIG51bWJlciA+PSAwLgogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBGaXJzdCBjb25uZWN0ZWQgYm9keS4KICAgICAqLwoKICAgIC8qKgogICAgICogU2Vjb25kIGNvbm5lY3RlZCBib2R5LgogICAgICovCgogICAgLyoqCiAgICAgKiBBbmNob3IgZm9yIGJvZHlBIGluIGxvY2FsIGJvZHlBIGNvb3JkaW5hdGVzLgogICAgICogV2hlcmUgdG8gaG9vayB0aGUgc3ByaW5nIHRvIGJvZHkgQSwgaW4gbG9jYWwgYm9keSBjb29yZGluYXRlcy4KICAgICAqIEBkZWZhdWx0IG5ldyBWZWMzKCkKICAgICAqLwoKICAgIC8qKgogICAgICogQW5jaG9yIGZvciBib2R5QiBpbiBsb2NhbCBib2R5QiBjb29yZGluYXRlcy4KICAgICAqIFdoZXJlIHRvIGhvb2sgdGhlIHNwcmluZyB0byBib2R5IEIsIGluIGxvY2FsIGJvZHkgY29vcmRpbmF0ZXMuCiAgICAgKiBAZGVmYXVsdCBuZXcgVmVjMygpCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLnJlc3RMZW5ndGggPSB0eXBlb2Ygb3B0aW9ucy5yZXN0TGVuZ3RoID09PSAnbnVtYmVyJyA/IG9wdGlvbnMucmVzdExlbmd0aCA6IDE7CiAgICAgIHRoaXMuc3RpZmZuZXNzID0gb3B0aW9ucy5zdGlmZm5lc3MgfHwgMTAwOwogICAgICB0aGlzLmRhbXBpbmcgPSBvcHRpb25zLmRhbXBpbmcgfHwgMTsKICAgICAgdGhpcy5ib2R5QSA9IGJvZHlBOwogICAgICB0aGlzLmJvZHlCID0gYm9keUI7CiAgICAgIHRoaXMubG9jYWxBbmNob3JBID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5sb2NhbEFuY2hvckIgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMubG9jYWxBbmNob3JBKSB7CiAgICAgICAgdGhpcy5sb2NhbEFuY2hvckEuY29weShvcHRpb25zLmxvY2FsQW5jaG9yQSk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLmxvY2FsQW5jaG9yQikgewogICAgICAgIHRoaXMubG9jYWxBbmNob3JCLmNvcHkob3B0aW9ucy5sb2NhbEFuY2hvckIpOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy53b3JsZEFuY2hvckEpIHsKICAgICAgICB0aGlzLnNldFdvcmxkQW5jaG9yQShvcHRpb25zLndvcmxkQW5jaG9yQSk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLndvcmxkQW5jaG9yQikgewogICAgICAgIHRoaXMuc2V0V29ybGRBbmNob3JCKG9wdGlvbnMud29ybGRBbmNob3JCKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIGFuY2hvciBwb2ludCBvbiBib2R5IEEsIHVzaW5nIHdvcmxkIGNvb3JkaW5hdGVzLgogICAgICovCgoKICAgIHNldFdvcmxkQW5jaG9yQSh3b3JsZEFuY2hvckEpIHsKICAgICAgdGhpcy5ib2R5QS5wb2ludFRvTG9jYWxGcmFtZSh3b3JsZEFuY2hvckEsIHRoaXMubG9jYWxBbmNob3JBKTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBhbmNob3IgcG9pbnQgb24gYm9keSBCLCB1c2luZyB3b3JsZCBjb29yZGluYXRlcy4KICAgICAqLwoKCiAgICBzZXRXb3JsZEFuY2hvckIod29ybGRBbmNob3JCKSB7CiAgICAgIHRoaXMuYm9keUIucG9pbnRUb0xvY2FsRnJhbWUod29ybGRBbmNob3JCLCB0aGlzLmxvY2FsQW5jaG9yQik7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgYW5jaG9yIHBvaW50IG9uIGJvZHkgQSwgaW4gd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKiBAcGFyYW0gcmVzdWx0IFRoZSB2ZWN0b3IgdG8gc3RvcmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBnZXRXb3JsZEFuY2hvckEocmVzdWx0KSB7CiAgICAgIHRoaXMuYm9keUEucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5sb2NhbEFuY2hvckEsIHJlc3VsdCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgYW5jaG9yIHBvaW50IG9uIGJvZHkgQiwgaW4gd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKiBAcGFyYW0gcmVzdWx0IFRoZSB2ZWN0b3IgdG8gc3RvcmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBnZXRXb3JsZEFuY2hvckIocmVzdWx0KSB7CiAgICAgIHRoaXMuYm9keUIucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5sb2NhbEFuY2hvckIsIHJlc3VsdCk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IHRoZSBzcHJpbmcgZm9yY2UgdG8gdGhlIGNvbm5lY3RlZCBib2RpZXMuCiAgICAgKi8KCgogICAgYXBwbHlGb3JjZSgpIHsKICAgICAgY29uc3QgayA9IHRoaXMuc3RpZmZuZXNzOwogICAgICBjb25zdCBkID0gdGhpcy5kYW1waW5nOwogICAgICBjb25zdCBsID0gdGhpcy5yZXN0TGVuZ3RoOwogICAgICBjb25zdCBib2R5QSA9IHRoaXMuYm9keUE7CiAgICAgIGNvbnN0IGJvZHlCID0gdGhpcy5ib2R5QjsKICAgICAgY29uc3QgciA9IGFwcGx5Rm9yY2VfcjsKICAgICAgY29uc3Qgcl91bml0ID0gYXBwbHlGb3JjZV9yX3VuaXQ7CiAgICAgIGNvbnN0IHUgPSBhcHBseUZvcmNlX3U7CiAgICAgIGNvbnN0IGYgPSBhcHBseUZvcmNlX2Y7CiAgICAgIGNvbnN0IHRtcCA9IGFwcGx5Rm9yY2VfdG1wOwogICAgICBjb25zdCB3b3JsZEFuY2hvckEgPSBhcHBseUZvcmNlX3dvcmxkQW5jaG9yQTsKICAgICAgY29uc3Qgd29ybGRBbmNob3JCID0gYXBwbHlGb3JjZV93b3JsZEFuY2hvckI7CiAgICAgIGNvbnN0IHJpID0gYXBwbHlGb3JjZV9yaTsKICAgICAgY29uc3QgcmogPSBhcHBseUZvcmNlX3JqOwogICAgICBjb25zdCByaV94X2YgPSBhcHBseUZvcmNlX3JpX3hfZjsKICAgICAgY29uc3QgcmpfeF9mID0gYXBwbHlGb3JjZV9yal94X2Y7IC8vIEdldCB3b3JsZCBhbmNob3JzCgogICAgICB0aGlzLmdldFdvcmxkQW5jaG9yQSh3b3JsZEFuY2hvckEpOwogICAgICB0aGlzLmdldFdvcmxkQW5jaG9yQih3b3JsZEFuY2hvckIpOyAvLyBHZXQgb2Zmc2V0IHBvaW50cwoKICAgICAgd29ybGRBbmNob3JBLnZzdWIoYm9keUEucG9zaXRpb24sIHJpKTsKICAgICAgd29ybGRBbmNob3JCLnZzdWIoYm9keUIucG9zaXRpb24sIHJqKTsgLy8gQ29tcHV0ZSBkaXN0YW5jZSB2ZWN0b3IgYmV0d2VlbiB3b3JsZCBhbmNob3IgcG9pbnRzCgogICAgICB3b3JsZEFuY2hvckIudnN1Yih3b3JsZEFuY2hvckEsIHIpOwogICAgICBjb25zdCBybGVuID0gci5sZW5ndGgoKTsKICAgICAgcl91bml0LmNvcHkocik7CiAgICAgIHJfdW5pdC5ub3JtYWxpemUoKTsgLy8gQ29tcHV0ZSByZWxhdGl2ZSB2ZWxvY2l0eSBvZiB0aGUgYW5jaG9yIHBvaW50cywgdQoKICAgICAgYm9keUIudmVsb2NpdHkudnN1Yihib2R5QS52ZWxvY2l0eSwgdSk7IC8vIEFkZCByb3RhdGlvbmFsIHZlbG9jaXR5CgogICAgICBib2R5Qi5hbmd1bGFyVmVsb2NpdHkuY3Jvc3MocmosIHRtcCk7CiAgICAgIHUudmFkZCh0bXAsIHUpOwogICAgICBib2R5QS5hbmd1bGFyVmVsb2NpdHkuY3Jvc3MocmksIHRtcCk7CiAgICAgIHUudnN1Yih0bXAsIHUpOyAvLyBGID0gLSBrICogKCB4IC0gTCApIC0gRCAqICggdSApCgogICAgICByX3VuaXQuc2NhbGUoLWsgKiAocmxlbiAtIGwpIC0gZCAqIHUuZG90KHJfdW5pdCksIGYpOyAvLyBBZGQgZm9yY2VzIHRvIGJvZGllcwoKICAgICAgYm9keUEuZm9yY2UudnN1YihmLCBib2R5QS5mb3JjZSk7CiAgICAgIGJvZHlCLmZvcmNlLnZhZGQoZiwgYm9keUIuZm9yY2UpOyAvLyBBbmd1bGFyIGZvcmNlCgogICAgICByaS5jcm9zcyhmLCByaV94X2YpOwogICAgICByai5jcm9zcyhmLCByal94X2YpOwogICAgICBib2R5QS50b3JxdWUudnN1YihyaV94X2YsIGJvZHlBLnRvcnF1ZSk7CiAgICAgIGJvZHlCLnRvcnF1ZS52YWRkKHJqX3hfZiwgYm9keUIudG9ycXVlKTsKICAgIH0KCiAgfQogIGNvbnN0IGFwcGx5Rm9yY2VfciA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV9yX3VuaXQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfdSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV9mID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3dvcmxkQW5jaG9yQSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV93b3JsZEFuY2hvckIgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfcmkgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfcmogPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfcmlfeF9mID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3JqX3hfZiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV90bXAgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBXaGVlbEluZm8KICAgKi8KICBjbGFzcyBXaGVlbEluZm8gewogICAgLyoqCiAgICAgKiBNYXggdHJhdmVsIGRpc3RhbmNlIG9mIHRoZSBzdXNwZW5zaW9uLCBpbiBtZXRlcnMuCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNwZWVkIHRvIGFwcGx5IHRvIHRoZSB3aGVlbCByb3RhdGlvbiB3aGVuIHRoZSB3aGVlbCBpcyBzbGlkaW5nLgogICAgICogQGRlZmF1bHQgLTAuMQogICAgICovCgogICAgLyoqCiAgICAgKiBJZiB0aGUgY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZCBzaG91bGQgYmUgdXNlZC4KICAgICAqIEBkZWZhdWx0IGZhbHNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIHNsaWRpbmcKICAgICAqLwoKICAgIC8qKgogICAgICogQ29ubmVjdGlvbiBwb2ludCwgZGVmaW5lZCBsb2NhbGx5IGluIHRoZSBjaGFzc2lzIGJvZHkgZnJhbWUuCiAgICAgKi8KCiAgICAvKioKICAgICAqIGNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiBkaXJlY3Rpb25Mb2NhbAogICAgICovCgogICAgLyoqCiAgICAgKiBkaXJlY3Rpb25Xb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiBheGxlTG9jYWwKICAgICAqLwoKICAgIC8qKgogICAgICogYXhsZVdvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25SZXN0TGVuZ3RoCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25NYXhMZW5ndGgKICAgICAqIEBkZWZhdWx0IDIKICAgICAqLwoKICAgIC8qKgogICAgICogcmFkaXVzCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25TdGlmZm5lc3MKICAgICAqIEBkZWZhdWx0IDEwMAogICAgICovCgogICAgLyoqCiAgICAgKiBkYW1waW5nQ29tcHJlc3Npb24KICAgICAqIEBkZWZhdWx0IDEwCiAgICAgKi8KCiAgICAvKioKICAgICAqIGRhbXBpbmdSZWxheGF0aW9uCiAgICAgKiBAZGVmYXVsdCAxMAogICAgICovCgogICAgLyoqCiAgICAgKiBmcmljdGlvblNsaXAKICAgICAqIEBkZWZhdWx0IDEwLjUKICAgICAqLwoKICAgIC8qKiBmb3J3YXJkQWNjZWxlcmF0aW9uICovCgogICAgLyoqIHNpZGVBY2NlbGVyYXRpb24gKi8KCiAgICAvKioKICAgICAqIHN0ZWVyaW5nCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIFJvdGF0aW9uIHZhbHVlLCBpbiByYWRpYW5zLgogICAgICogQGRlZmF1bHQgMAogICAgICovCgogICAgLyoqCiAgICAgKiBkZWx0YVJvdGF0aW9uCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHJvbGxJbmZsdWVuY2UKICAgICAqIEBkZWZhdWx0IDAuMDEKICAgICAqLwoKICAgIC8qKgogICAgICogbWF4U3VzcGVuc2lvbkZvcmNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGVuZ2luZUZvcmNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGJyYWtlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGlzRnJvbnRXaGVlbAogICAgICogQGRlZmF1bHQgdHJ1ZQogICAgICovCgogICAgLyoqCiAgICAgKiBjbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24KICAgICAqIEBkZWZhdWx0IDEKICAgICAqLwoKICAgIC8qKgogICAgICogc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkKICAgICAqIEBkZWZhdWx0IDAKICAgICAqLwoKICAgIC8qKgogICAgICogc3VzcGVuc2lvbkZvcmNlCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHNsaXBJbmZvCiAgICAgKi8KCiAgICAvKioKICAgICAqIHNraWRJbmZvCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25MZW5ndGgKICAgICAqIEBkZWZhdWx0IDAKICAgICAqLwoKICAgIC8qKgogICAgICogc2lkZUltcHVsc2UKICAgICAqLwoKICAgIC8qKgogICAgICogZm9yd2FyZEltcHVsc2UKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHJlc3VsdCBmcm9tIHJheWNhc3RpbmcuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZWVsIHdvcmxkIHRyYW5zZm9ybS4KICAgICAqLwoKICAgIC8qKgogICAgICogaXNJbkNvbnRhY3QKICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zID0gVXRpbHMuZGVmYXVsdHMob3B0aW9ucywgewogICAgICAgIGNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbDogbmV3IFZlYzMoKSwKICAgICAgICBjaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQ6IG5ldyBWZWMzKCksCiAgICAgICAgZGlyZWN0aW9uTG9jYWw6IG5ldyBWZWMzKCksCiAgICAgICAgZGlyZWN0aW9uV29ybGQ6IG5ldyBWZWMzKCksCiAgICAgICAgYXhsZUxvY2FsOiBuZXcgVmVjMygpLAogICAgICAgIGF4bGVXb3JsZDogbmV3IFZlYzMoKSwKICAgICAgICBzdXNwZW5zaW9uUmVzdExlbmd0aDogMSwKICAgICAgICBzdXNwZW5zaW9uTWF4TGVuZ3RoOiAyLAogICAgICAgIHJhZGl1czogMSwKICAgICAgICBzdXNwZW5zaW9uU3RpZmZuZXNzOiAxMDAsCiAgICAgICAgZGFtcGluZ0NvbXByZXNzaW9uOiAxMCwKICAgICAgICBkYW1waW5nUmVsYXhhdGlvbjogMTAsCiAgICAgICAgZnJpY3Rpb25TbGlwOiAxMC41LAogICAgICAgIGZvcndhcmRBY2NlbGVyYXRpb246IDEsCiAgICAgICAgc2lkZUFjY2VsZXJhdGlvbjogMSwKICAgICAgICBzdGVlcmluZzogMCwKICAgICAgICByb3RhdGlvbjogMCwKICAgICAgICBkZWx0YVJvdGF0aW9uOiAwLAogICAgICAgIHJvbGxJbmZsdWVuY2U6IDAuMDEsCiAgICAgICAgbWF4U3VzcGVuc2lvbkZvcmNlOiBOdW1iZXIuTUFYX1ZBTFVFLAogICAgICAgIGlzRnJvbnRXaGVlbDogdHJ1ZSwKICAgICAgICBjbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb246IDEsCiAgICAgICAgc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHk6IDAsCiAgICAgICAgc3VzcGVuc2lvbkZvcmNlOiAwLAogICAgICAgIHNsaXBJbmZvOiAwLAogICAgICAgIHNraWRJbmZvOiAwLAogICAgICAgIHN1c3BlbnNpb25MZW5ndGg6IDAsCiAgICAgICAgbWF4U3VzcGVuc2lvblRyYXZlbDogMSwKICAgICAgICB1c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOiBmYWxzZSwKICAgICAgICBjdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOiAtMC4xCiAgICAgIH0pOwogICAgICB0aGlzLm1heFN1c3BlbnNpb25UcmF2ZWwgPSBvcHRpb25zLm1heFN1c3BlbnNpb25UcmF2ZWw7CiAgICAgIHRoaXMuY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZCA9IG9wdGlvbnMuY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZDsKICAgICAgdGhpcy51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkID0gb3B0aW9ucy51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOwogICAgICB0aGlzLnNsaWRpbmcgPSBmYWxzZTsKICAgICAgdGhpcy5jaGFzc2lzQ29ubmVjdGlvblBvaW50TG9jYWwgPSBvcHRpb25zLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbC5jbG9uZSgpOwogICAgICB0aGlzLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZCA9IG9wdGlvbnMuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uTG9jYWwgPSBvcHRpb25zLmRpcmVjdGlvbkxvY2FsLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uV29ybGQgPSBvcHRpb25zLmRpcmVjdGlvbldvcmxkLmNsb25lKCk7CiAgICAgIHRoaXMuYXhsZUxvY2FsID0gb3B0aW9ucy5heGxlTG9jYWwuY2xvbmUoKTsKICAgICAgdGhpcy5heGxlV29ybGQgPSBvcHRpb25zLmF4bGVXb3JsZC5jbG9uZSgpOwogICAgICB0aGlzLnN1c3BlbnNpb25SZXN0TGVuZ3RoID0gb3B0aW9ucy5zdXNwZW5zaW9uUmVzdExlbmd0aDsKICAgICAgdGhpcy5zdXNwZW5zaW9uTWF4TGVuZ3RoID0gb3B0aW9ucy5zdXNwZW5zaW9uTWF4TGVuZ3RoOwogICAgICB0aGlzLnJhZGl1cyA9IG9wdGlvbnMucmFkaXVzOwogICAgICB0aGlzLnN1c3BlbnNpb25TdGlmZm5lc3MgPSBvcHRpb25zLnN1c3BlbnNpb25TdGlmZm5lc3M7CiAgICAgIHRoaXMuZGFtcGluZ0NvbXByZXNzaW9uID0gb3B0aW9ucy5kYW1waW5nQ29tcHJlc3Npb247CiAgICAgIHRoaXMuZGFtcGluZ1JlbGF4YXRpb24gPSBvcHRpb25zLmRhbXBpbmdSZWxheGF0aW9uOwogICAgICB0aGlzLmZyaWN0aW9uU2xpcCA9IG9wdGlvbnMuZnJpY3Rpb25TbGlwOwogICAgICB0aGlzLmZvcndhcmRBY2NlbGVyYXRpb24gPSBvcHRpb25zLmZvcndhcmRBY2NlbGVyYXRpb247CiAgICAgIHRoaXMuc2lkZUFjY2VsZXJhdGlvbiA9IG9wdGlvbnMuc2lkZUFjY2VsZXJhdGlvbjsKICAgICAgdGhpcy5zdGVlcmluZyA9IDA7CiAgICAgIHRoaXMucm90YXRpb24gPSAwOwogICAgICB0aGlzLmRlbHRhUm90YXRpb24gPSAwOwogICAgICB0aGlzLnJvbGxJbmZsdWVuY2UgPSBvcHRpb25zLnJvbGxJbmZsdWVuY2U7CiAgICAgIHRoaXMubWF4U3VzcGVuc2lvbkZvcmNlID0gb3B0aW9ucy5tYXhTdXNwZW5zaW9uRm9yY2U7CiAgICAgIHRoaXMuZW5naW5lRm9yY2UgPSAwOwogICAgICB0aGlzLmJyYWtlID0gMDsKICAgICAgdGhpcy5pc0Zyb250V2hlZWwgPSBvcHRpb25zLmlzRnJvbnRXaGVlbDsKICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxOwogICAgICB0aGlzLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMDsKICAgICAgdGhpcy5zdXNwZW5zaW9uRm9yY2UgPSAwOwogICAgICB0aGlzLnNsaXBJbmZvID0gMDsKICAgICAgdGhpcy5za2lkSW5mbyA9IDA7CiAgICAgIHRoaXMuc3VzcGVuc2lvbkxlbmd0aCA9IDA7CiAgICAgIHRoaXMuc2lkZUltcHVsc2UgPSAwOwogICAgICB0aGlzLmZvcndhcmRJbXB1bHNlID0gMDsKICAgICAgdGhpcy5yYXljYXN0UmVzdWx0ID0gbmV3IFJheWNhc3RSZXN1bHQoKTsKICAgICAgdGhpcy53b3JsZFRyYW5zZm9ybSA9IG5ldyBUcmFuc2Zvcm0oKTsKICAgICAgdGhpcy5pc0luQ29udGFjdCA9IGZhbHNlOwogICAgfQoKICAgIHVwZGF0ZVdoZWVsKGNoYXNzaXMpIHsKICAgICAgY29uc3QgcmF5Y2FzdFJlc3VsdCA9IHRoaXMucmF5Y2FzdFJlc3VsdDsKCiAgICAgIGlmICh0aGlzLmlzSW5Db250YWN0KSB7CiAgICAgICAgY29uc3QgcHJvamVjdCA9IHJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KHJheWNhc3RSZXN1bHQuZGlyZWN0aW9uV29ybGQpOwogICAgICAgIHJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGNoYXNzaXMucG9zaXRpb24sIHJlbHBvcyk7CiAgICAgICAgY2hhc3Npcy5nZXRWZWxvY2l0eUF0V29ybGRQb2ludChyZWxwb3MsIGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50KTsKICAgICAgICBjb25zdCBwcm9qVmVsID0gcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZC5kb3QoY2hhc3Npc192ZWxvY2l0eV9hdF9jb250YWN0UG9pbnQpOwoKICAgICAgICBpZiAocHJvamVjdCA+PSAtMC4xKSB7CiAgICAgICAgICB0aGlzLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMC4wOwogICAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjAgLyAwLjE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IGludiA9IC0xIC8gcHJvamVjdDsKICAgICAgICAgIHRoaXMuc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkgPSBwcm9qVmVsICogaW52OwogICAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSBpbnY7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIE5vdCBpbiBjb250YWN0IDogcG9zaXRpb24gd2hlZWwgaW4gYSBuaWNlIChyZXN0IGxlbmd0aCkgcG9zaXRpb24KICAgICAgICByYXljYXN0UmVzdWx0LnN1c3BlbnNpb25MZW5ndGggPSB0aGlzLnN1c3BlbnNpb25SZXN0TGVuZ3RoOwogICAgICAgIHRoaXMuc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkgPSAwLjA7CiAgICAgICAgcmF5Y2FzdFJlc3VsdC5kaXJlY3Rpb25Xb3JsZC5zY2FsZSgtMSwgcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZCk7CiAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjA7CiAgICAgIH0KICAgIH0KCiAgfQogIGNvbnN0IGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50ID0gbmV3IFZlYzMoKTsKICBjb25zdCByZWxwb3MgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBWZWhpY2xlIGhlbHBlciBjbGFzcyB0aGF0IGNhc3RzIHJheXMgZnJvbSB0aGUgd2hlZWwgcG9zaXRpb25zIHRvd2FyZHMgdGhlIGdyb3VuZCBhbmQgYXBwbGllcyBmb3JjZXMuCiAgICovCiAgY2xhc3MgUmF5Y2FzdFZlaGljbGUgewogICAgLyoqIFRoZSBjYXIgY2hhc3NpcyBib2R5LiAqLwoKICAgIC8qKiBUaGUgd2hlZWxzLiAqLwoKICAgIC8qKiBXaWxsIGJlIHNldCB0byB0cnVlIGlmIHRoZSBjYXIgaXMgc2xpZGluZy4gKi8KCiAgICAvKiogSW5kZXggb2YgdGhlIHJpZ2h0IGF4aXMuIHg9MCwgeT0xLCB6PTIgKi8KCiAgICAvKiogSW5kZXggb2YgdGhlIGZvcndhcmQgYXhpcy4geD0wLCB5PTEsIHo9MiAqLwoKICAgIC8qKiBJbmRleCBvZiB0aGUgdXAgYXhpcy4geD0wLCB5PTEsIHo9MiAqLwoKICAgIC8qKiBUaGUgY29uc3RyYWludHMuICovCgogICAgLyoqIE9wdGlvbmFsIHByZS1zdGVwIGNhbGxiYWNrLiAqLwoKICAgIC8qKiBOdW1iZXIgb2Ygd2hlZWxzIG9uIHRoZSBncm91bmQuICovCiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICAgIHRoaXMuY2hhc3Npc0JvZHkgPSBvcHRpb25zLmNoYXNzaXNCb2R5OwogICAgICB0aGlzLndoZWVsSW5mb3MgPSBbXTsKICAgICAgdGhpcy5zbGlkaW5nID0gZmFsc2U7CiAgICAgIHRoaXMud29ybGQgPSBudWxsOwogICAgICB0aGlzLmluZGV4UmlnaHRBeGlzID0gdHlwZW9mIG9wdGlvbnMuaW5kZXhSaWdodEF4aXMgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5pbmRleFJpZ2h0QXhpcyA6IDI7CiAgICAgIHRoaXMuaW5kZXhGb3J3YXJkQXhpcyA9IHR5cGVvZiBvcHRpb25zLmluZGV4Rm9yd2FyZEF4aXMgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5pbmRleEZvcndhcmRBeGlzIDogMDsKICAgICAgdGhpcy5pbmRleFVwQXhpcyA9IHR5cGVvZiBvcHRpb25zLmluZGV4VXBBeGlzICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuaW5kZXhVcEF4aXMgOiAxOwogICAgICB0aGlzLmNvbnN0cmFpbnRzID0gW107CgogICAgICB0aGlzLnByZVN0ZXBDYWxsYmFjayA9ICgpID0+IHt9OwoKICAgICAgdGhpcy5jdXJyZW50VmVoaWNsZVNwZWVkS21Ib3VyID0gMDsKICAgICAgdGhpcy5udW1XaGVlbHNPbkdyb3VuZCA9IDA7CiAgICB9CiAgICAvKioKICAgICAqIEFkZCBhIHdoZWVsLiBGb3IgaW5mb3JtYXRpb24gYWJvdXQgdGhlIG9wdGlvbnMsIHNlZSBgV2hlZWxJbmZvYC4KICAgICAqLwoKCiAgICBhZGRXaGVlbChvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IGluZm8gPSBuZXcgV2hlZWxJbmZvKG9wdGlvbnMpOwogICAgICBjb25zdCBpbmRleCA9IHRoaXMud2hlZWxJbmZvcy5sZW5ndGg7CiAgICAgIHRoaXMud2hlZWxJbmZvcy5wdXNoKGluZm8pOwogICAgICByZXR1cm4gaW5kZXg7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgc3RlZXJpbmcgdmFsdWUgb2YgYSB3aGVlbC4KICAgICAqLwoKCiAgICBzZXRTdGVlcmluZ1ZhbHVlKHZhbHVlLCB3aGVlbEluZGV4KSB7CiAgICAgIGNvbnN0IHdoZWVsID0gdGhpcy53aGVlbEluZm9zW3doZWVsSW5kZXhdOwogICAgICB3aGVlbC5zdGVlcmluZyA9IHZhbHVlOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHdoZWVsIGZvcmNlIHRvIGFwcGx5IG9uIG9uZSBvZiB0aGUgd2hlZWxzIGVhY2ggdGltZSBzdGVwCiAgICAgKi8KCgogICAgYXBwbHlFbmdpbmVGb3JjZSh2YWx1ZSwgd2hlZWxJbmRleCkgewogICAgICB0aGlzLndoZWVsSW5mb3Nbd2hlZWxJbmRleF0uZW5naW5lRm9yY2UgPSB2YWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBicmFraW5nIGZvcmNlIG9mIGEgd2hlZWwKICAgICAqLwoKCiAgICBzZXRCcmFrZShicmFrZSwgd2hlZWxJbmRleCkgewogICAgICB0aGlzLndoZWVsSW5mb3Nbd2hlZWxJbmRleF0uYnJha2UgPSBicmFrZTsKICAgIH0KICAgIC8qKgogICAgICogQWRkIHRoZSB2ZWhpY2xlIGluY2x1ZGluZyBpdHMgY29uc3RyYWludHMgdG8gdGhlIHdvcmxkLgogICAgICovCgoKICAgIGFkZFRvV29ybGQod29ybGQpIHsKICAgICAgd29ybGQuYWRkQm9keSh0aGlzLmNoYXNzaXNCb2R5KTsKICAgICAgY29uc3QgdGhhdCA9IHRoaXM7CgogICAgICB0aGlzLnByZVN0ZXBDYWxsYmFjayA9ICgpID0+IHsKICAgICAgICB0aGF0LnVwZGF0ZVZlaGljbGUod29ybGQuZHQpOwogICAgICB9OwoKICAgICAgd29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHRoaXMucHJlU3RlcENhbGxiYWNrKTsKICAgICAgdGhpcy53b3JsZCA9IHdvcmxkOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgb25lIG9mIHRoZSB3aGVlbCBheGxlcywgd29ybGQtb3JpZW50ZWQuCiAgICAgKi8KCgogICAgZ2V0VmVoaWNsZUF4aXNXb3JsZChheGlzSW5kZXgsIHJlc3VsdCkgewogICAgICByZXN1bHQuc2V0KGF4aXNJbmRleCA9PT0gMCA/IDEgOiAwLCBheGlzSW5kZXggPT09IDEgPyAxIDogMCwgYXhpc0luZGV4ID09PSAyID8gMSA6IDApOwogICAgICB0aGlzLmNoYXNzaXNCb2R5LnZlY3RvclRvV29ybGRGcmFtZShyZXN1bHQsIHJlc3VsdCk7CiAgICB9CgogICAgdXBkYXRlVmVoaWNsZSh0aW1lU3RlcCkgewogICAgICBjb25zdCB3aGVlbEluZm9zID0gdGhpcy53aGVlbEluZm9zOwogICAgICBjb25zdCBudW1XaGVlbHMgPSB3aGVlbEluZm9zLmxlbmd0aDsKICAgICAgY29uc3QgY2hhc3Npc0JvZHkgPSB0aGlzLmNoYXNzaXNCb2R5OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIHRoaXMudXBkYXRlV2hlZWxUcmFuc2Zvcm0oaSk7CiAgICAgIH0KCiAgICAgIHRoaXMuY3VycmVudFZlaGljbGVTcGVlZEttSG91ciA9IDMuNiAqIGNoYXNzaXNCb2R5LnZlbG9jaXR5Lmxlbmd0aCgpOwogICAgICBjb25zdCBmb3J3YXJkV29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmdldFZlaGljbGVBeGlzV29ybGQodGhpcy5pbmRleEZvcndhcmRBeGlzLCBmb3J3YXJkV29ybGQpOwoKICAgICAgaWYgKGZvcndhcmRXb3JsZC5kb3QoY2hhc3Npc0JvZHkudmVsb2NpdHkpIDwgMCkgewogICAgICAgIHRoaXMuY3VycmVudFZlaGljbGVTcGVlZEttSG91ciAqPSAtMTsKICAgICAgfSAvLyBzaW11bGF0ZSBzdXNwZW5zaW9uCgoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIHRoaXMuY2FzdFJheSh3aGVlbEluZm9zW2ldKTsKICAgICAgfQoKICAgICAgdGhpcy51cGRhdGVTdXNwZW5zaW9uKHRpbWVTdGVwKTsKICAgICAgY29uc3QgaW1wdWxzZSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHJlbHBvcyA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgLy9hcHBseSBzdXNwZW5zaW9uIGZvcmNlCiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW2ldOwogICAgICAgIGxldCBzdXNwZW5zaW9uRm9yY2UgPSB3aGVlbC5zdXNwZW5zaW9uRm9yY2U7CgogICAgICAgIGlmIChzdXNwZW5zaW9uRm9yY2UgPiB3aGVlbC5tYXhTdXNwZW5zaW9uRm9yY2UpIHsKICAgICAgICAgIHN1c3BlbnNpb25Gb3JjZSA9IHdoZWVsLm1heFN1c3BlbnNpb25Gb3JjZTsKICAgICAgICB9CgogICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuc2NhbGUoc3VzcGVuc2lvbkZvcmNlICogdGltZVN0ZXAsIGltcHVsc2UpOwogICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGNoYXNzaXNCb2R5LnBvc2l0aW9uLCByZWxwb3MpOwogICAgICAgIGNoYXNzaXNCb2R5LmFwcGx5SW1wdWxzZShpbXB1bHNlLCByZWxwb3MpOwogICAgICB9CgogICAgICB0aGlzLnVwZGF0ZUZyaWN0aW9uKHRpbWVTdGVwKTsKICAgICAgY29uc3QgaGl0Tm9ybWFsV29ybGRTY2FsZWRXaXRoUHJvaiA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGZ3ZCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHZlbCA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW2ldOyAvL2NvbnN0IHJlbHBvcyA9IG5ldyBWZWMzKCk7CiAgICAgICAgLy93aGVlbC5jaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQudnN1YihjaGFzc2lzQm9keS5wb3NpdGlvbiwgcmVscG9zKTsKCiAgICAgICAgY2hhc3Npc0JvZHkuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQod2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLCB2ZWwpOyAvLyBIYWNrIHRvIGdldCB0aGUgcm90YXRpb24gaW4gdGhlIGNvcnJlY3QgZGlyZWN0aW9uCgogICAgICAgIGxldCBtID0gMTsKCiAgICAgICAgc3dpdGNoICh0aGlzLmluZGV4VXBBeGlzKSB7CiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIG0gPSAtMTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICBpZiAod2hlZWwuaXNJbkNvbnRhY3QpIHsKICAgICAgICAgIHRoaXMuZ2V0VmVoaWNsZUF4aXNXb3JsZCh0aGlzLmluZGV4Rm9yd2FyZEF4aXMsIGZ3ZCk7CiAgICAgICAgICBjb25zdCBwcm9qID0gZndkLmRvdCh3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkKTsKICAgICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuc2NhbGUocHJvaiwgaGl0Tm9ybWFsV29ybGRTY2FsZWRXaXRoUHJvaik7CiAgICAgICAgICBmd2QudnN1YihoaXROb3JtYWxXb3JsZFNjYWxlZFdpdGhQcm9qLCBmd2QpOwogICAgICAgICAgY29uc3QgcHJvajIgPSBmd2QuZG90KHZlbCk7CiAgICAgICAgICB3aGVlbC5kZWx0YVJvdGF0aW9uID0gbSAqIHByb2oyICogdGltZVN0ZXAgLyB3aGVlbC5yYWRpdXM7CiAgICAgICAgfQoKICAgICAgICBpZiAoKHdoZWVsLnNsaWRpbmcgfHwgIXdoZWVsLmlzSW5Db250YWN0KSAmJiB3aGVlbC5lbmdpbmVGb3JjZSAhPT0gMCAmJiB3aGVlbC51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkKSB7CiAgICAgICAgICAvLyBBcHBseSBjdXN0b20gcm90YXRpb24gd2hlbiBhY2NlbGVyYXRpbmcgYW5kIHNsaWRpbmcKICAgICAgICAgIHdoZWVsLmRlbHRhUm90YXRpb24gPSAod2hlZWwuZW5naW5lRm9yY2UgPiAwID8gMSA6IC0xKSAqIHdoZWVsLmN1c3RvbVNsaWRpbmdSb3RhdGlvbmFsU3BlZWQgKiB0aW1lU3RlcDsKICAgICAgICB9IC8vIExvY2sgd2hlZWxzCgoKICAgICAgICBpZiAoTWF0aC5hYnMod2hlZWwuYnJha2UpID4gTWF0aC5hYnMod2hlZWwuZW5naW5lRm9yY2UpKSB7CiAgICAgICAgICB3aGVlbC5kZWx0YVJvdGF0aW9uID0gMDsKICAgICAgICB9CgogICAgICAgIHdoZWVsLnJvdGF0aW9uICs9IHdoZWVsLmRlbHRhUm90YXRpb247IC8vIFVzZSB0aGUgb2xkIHZhbHVlCgogICAgICAgIHdoZWVsLmRlbHRhUm90YXRpb24gKj0gMC45OTsgLy8gZGFtcGluZyBvZiByb3RhdGlvbiB3aGVuIG5vdCBpbiBjb250YWN0CiAgICAgIH0KICAgIH0KCiAgICB1cGRhdGVTdXNwZW5zaW9uKGRlbHRhVGltZSkgewogICAgICBjb25zdCBjaGFzc2lzQm9keSA9IHRoaXMuY2hhc3Npc0JvZHk7CiAgICAgIGNvbnN0IGNoYXNzaXNNYXNzID0gY2hhc3Npc0JvZHkubWFzczsKICAgICAgY29uc3Qgd2hlZWxJbmZvcyA9IHRoaXMud2hlZWxJbmZvczsKICAgICAgY29uc3QgbnVtV2hlZWxzID0gd2hlZWxJbmZvcy5sZW5ndGg7CgogICAgICBmb3IgKGxldCB3X2l0ID0gMDsgd19pdCA8IG51bVdoZWVsczsgd19pdCsrKSB7CiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW3dfaXRdOwoKICAgICAgICBpZiAod2hlZWwuaXNJbkNvbnRhY3QpIHsKICAgICAgICAgIGxldCBmb3JjZTsgLy8gU3ByaW5nCgogICAgICAgICAgY29uc3Qgc3VzcF9sZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aDsKICAgICAgICAgIGNvbnN0IGN1cnJlbnRfbGVuZ3RoID0gd2hlZWwuc3VzcGVuc2lvbkxlbmd0aDsKICAgICAgICAgIGNvbnN0IGxlbmd0aF9kaWZmID0gc3VzcF9sZW5ndGggLSBjdXJyZW50X2xlbmd0aDsKICAgICAgICAgIGZvcmNlID0gd2hlZWwuc3VzcGVuc2lvblN0aWZmbmVzcyAqIGxlbmd0aF9kaWZmICogd2hlZWwuY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uOyAvLyBEYW1wZXIKCiAgICAgICAgICBjb25zdCBwcm9qZWN0ZWRfcmVsX3ZlbCA9IHdoZWVsLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5OwogICAgICAgICAgbGV0IHN1c3BfZGFtcGluZzsKCiAgICAgICAgICBpZiAocHJvamVjdGVkX3JlbF92ZWwgPCAwKSB7CiAgICAgICAgICAgIHN1c3BfZGFtcGluZyA9IHdoZWVsLmRhbXBpbmdDb21wcmVzc2lvbjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHN1c3BfZGFtcGluZyA9IHdoZWVsLmRhbXBpbmdSZWxheGF0aW9uOwogICAgICAgICAgfQoKICAgICAgICAgIGZvcmNlIC09IHN1c3BfZGFtcGluZyAqIHByb2plY3RlZF9yZWxfdmVsOwogICAgICAgICAgd2hlZWwuc3VzcGVuc2lvbkZvcmNlID0gZm9yY2UgKiBjaGFzc2lzTWFzczsKCiAgICAgICAgICBpZiAod2hlZWwuc3VzcGVuc2lvbkZvcmNlIDwgMCkgewogICAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uRm9yY2UgPSAwOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uRm9yY2UgPSAwOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmUgdGhlIHZlaGljbGUgaW5jbHVkaW5nIGl0cyBjb25zdHJhaW50cyBmcm9tIHRoZSB3b3JsZC4KICAgICAqLwoKCiAgICByZW1vdmVGcm9tV29ybGQod29ybGQpIHsKICAgICAgdGhpcy5jb25zdHJhaW50czsKICAgICAgd29ybGQucmVtb3ZlQm9keSh0aGlzLmNoYXNzaXNCb2R5KTsKICAgICAgd29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHRoaXMucHJlU3RlcENhbGxiYWNrKTsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICB9CgogICAgY2FzdFJheSh3aGVlbCkgewogICAgICBjb25zdCByYXl2ZWN0b3IgPSBjYXN0UmF5X3JheXZlY3RvcjsKICAgICAgY29uc3QgdGFyZ2V0ID0gY2FzdFJheV90YXJnZXQ7CiAgICAgIHRoaXMudXBkYXRlV2hlZWxUcmFuc2Zvcm1Xb3JsZCh3aGVlbCk7CiAgICAgIGNvbnN0IGNoYXNzaXNCb2R5ID0gdGhpcy5jaGFzc2lzQm9keTsKICAgICAgbGV0IGRlcHRoID0gLTE7CiAgICAgIGNvbnN0IHJheWxlbiA9IHdoZWVsLnN1c3BlbnNpb25SZXN0TGVuZ3RoICsgd2hlZWwucmFkaXVzOwogICAgICB3aGVlbC5kaXJlY3Rpb25Xb3JsZC5zY2FsZShyYXlsZW4sIHJheXZlY3Rvcik7CiAgICAgIGNvbnN0IHNvdXJjZSA9IHdoZWVsLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZDsKICAgICAgc291cmNlLnZhZGQocmF5dmVjdG9yLCB0YXJnZXQpOwogICAgICBjb25zdCByYXljYXN0UmVzdWx0ID0gd2hlZWwucmF5Y2FzdFJlc3VsdDsKICAgICAgcmF5Y2FzdFJlc3VsdC5yZXNldCgpOyAvLyBUdXJuIG9mZiByYXkgY29sbGlzaW9uIHdpdGggdGhlIGNoYXNzaXMgdGVtcG9yYXJpbHkKCiAgICAgIGNvbnN0IG9sZFN0YXRlID0gY2hhc3Npc0JvZHkuY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIGNoYXNzaXNCb2R5LmNvbGxpc2lvblJlc3BvbnNlID0gZmFsc2U7IC8vIENhc3QgcmF5IGFnYWluc3Qgd29ybGQKCiAgICAgIHRoaXMud29ybGQucmF5VGVzdChzb3VyY2UsIHRhcmdldCwgcmF5Y2FzdFJlc3VsdCk7CiAgICAgIGNoYXNzaXNCb2R5LmNvbGxpc2lvblJlc3BvbnNlID0gb2xkU3RhdGU7CiAgICAgIGNvbnN0IG9iamVjdCA9IHJheWNhc3RSZXN1bHQuYm9keTsKICAgICAgd2hlZWwucmF5Y2FzdFJlc3VsdC5ncm91bmRPYmplY3QgPSAwOwoKICAgICAgaWYgKG9iamVjdCkgewogICAgICAgIGRlcHRoID0gcmF5Y2FzdFJlc3VsdC5kaXN0YW5jZTsKICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkID0gcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZDsKICAgICAgICB3aGVlbC5pc0luQ29udGFjdCA9IHRydWU7CiAgICAgICAgY29uc3QgaGl0RGlzdGFuY2UgPSByYXljYXN0UmVzdWx0LmRpc3RhbmNlOwogICAgICAgIHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPSBoaXREaXN0YW5jZSAtIHdoZWVsLnJhZGl1czsgLy8gY2xhbXAgb24gbWF4IHN1c3BlbnNpb24gdHJhdmVsCgogICAgICAgIGNvbnN0IG1pblN1c3BlbnNpb25MZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aCAtIHdoZWVsLm1heFN1c3BlbnNpb25UcmF2ZWw7CiAgICAgICAgY29uc3QgbWF4U3VzcGVuc2lvbkxlbmd0aCA9IHdoZWVsLnN1c3BlbnNpb25SZXN0TGVuZ3RoICsgd2hlZWwubWF4U3VzcGVuc2lvblRyYXZlbDsKCiAgICAgICAgaWYgKHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPCBtaW5TdXNwZW5zaW9uTGVuZ3RoKSB7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoID0gbWluU3VzcGVuc2lvbkxlbmd0aDsKICAgICAgICB9CgogICAgICAgIGlmICh3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoID4gbWF4U3VzcGVuc2lvbkxlbmd0aCkgewogICAgICAgICAgd2hlZWwuc3VzcGVuc2lvbkxlbmd0aCA9IG1heFN1c3BlbnNpb25MZW5ndGg7CiAgICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LnJlc2V0KCk7CiAgICAgICAgfQoKICAgICAgICBjb25zdCBkZW5vbWluYXRvciA9IHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KHdoZWVsLmRpcmVjdGlvbldvcmxkKTsKICAgICAgICBjb25zdCBjaGFzc2lzX3ZlbG9jaXR5X2F0X2NvbnRhY3RQb2ludCA9IG5ldyBWZWMzKCk7CiAgICAgICAgY2hhc3Npc0JvZHkuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLCBjaGFzc2lzX3ZlbG9jaXR5X2F0X2NvbnRhY3RQb2ludCk7CiAgICAgICAgY29uc3QgcHJvalZlbCA9IHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50KTsKCiAgICAgICAgaWYgKGRlbm9taW5hdG9yID49IC0wLjEpIHsKICAgICAgICAgIHdoZWVsLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMDsKICAgICAgICAgIHdoZWVsLmNsaXBwZWRJbnZDb250YWN0RG90U3VzcGVuc2lvbiA9IDEgLyAwLjE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IGludiA9IC0xIC8gZGVub21pbmF0b3I7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uUmVsYXRpdmVWZWxvY2l0eSA9IHByb2pWZWwgKiBpbnY7CiAgICAgICAgICB3aGVlbC5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSBpbnY7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vcHV0IHdoZWVsIGluZm8gYXMgaW4gcmVzdCBwb3NpdGlvbgogICAgICAgIHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aCArIDAgKiB3aGVlbC5tYXhTdXNwZW5zaW9uVHJhdmVsOwogICAgICAgIHdoZWVsLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMC4wOwogICAgICAgIHdoZWVsLmRpcmVjdGlvbldvcmxkLnNjYWxlKC0xLCB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkKTsKICAgICAgICB3aGVlbC5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjA7CiAgICAgIH0KCiAgICAgIHJldHVybiBkZXB0aDsKICAgIH0KCiAgICB1cGRhdGVXaGVlbFRyYW5zZm9ybVdvcmxkKHdoZWVsKSB7CiAgICAgIHdoZWVsLmlzSW5Db250YWN0ID0gZmFsc2U7CiAgICAgIGNvbnN0IGNoYXNzaXNCb2R5ID0gdGhpcy5jaGFzc2lzQm9keTsKICAgICAgY2hhc3Npc0JvZHkucG9pbnRUb1dvcmxkRnJhbWUod2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludExvY2FsLCB3aGVlbC5jaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQpOwogICAgICBjaGFzc2lzQm9keS52ZWN0b3JUb1dvcmxkRnJhbWUod2hlZWwuZGlyZWN0aW9uTG9jYWwsIHdoZWVsLmRpcmVjdGlvbldvcmxkKTsKICAgICAgY2hhc3Npc0JvZHkudmVjdG9yVG9Xb3JsZEZyYW1lKHdoZWVsLmF4bGVMb2NhbCwgd2hlZWwuYXhsZVdvcmxkKTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIG9uZSBvZiB0aGUgd2hlZWwgdHJhbnNmb3JtLgogICAgICogTm90ZSB3aGVuIHJlbmRlcmluZyB3aGVlbHM6IGR1cmluZyBlYWNoIHN0ZXAsIHdoZWVsIHRyYW5zZm9ybXMgYXJlIHVwZGF0ZWQgQkVGT1JFIHRoZSBjaGFzc2lzOyBpZS4gdGhlaXIgcG9zaXRpb24gYmVjb21lcyBpbnZhbGlkIGFmdGVyIHRoZSBzdGVwLiBUaHVzIHdoZW4geW91IHJlbmRlciB3aGVlbHMsIHlvdSBtdXN0IHVwZGF0ZSB3aGVlbCB0cmFuc2Zvcm1zIGJlZm9yZSByZW5kZXJpbmcgdGhlbS4gU2VlIHJheWNhc3RWZWhpY2xlIGRlbW8gZm9yIGFuIGV4YW1wbGUuCiAgICAgKiBAcGFyYW0gd2hlZWxJbmRleCBUaGUgd2hlZWwgaW5kZXggdG8gdXBkYXRlLgogICAgICovCgoKICAgIHVwZGF0ZVdoZWVsVHJhbnNmb3JtKHdoZWVsSW5kZXgpIHsKICAgICAgY29uc3QgdXAgPSB0bXBWZWM0OwogICAgICBjb25zdCByaWdodCA9IHRtcFZlYzU7CiAgICAgIGNvbnN0IGZ3ZCA9IHRtcFZlYzY7CiAgICAgIGNvbnN0IHdoZWVsID0gdGhpcy53aGVlbEluZm9zW3doZWVsSW5kZXhdOwogICAgICB0aGlzLnVwZGF0ZVdoZWVsVHJhbnNmb3JtV29ybGQod2hlZWwpOwogICAgICB3aGVlbC5kaXJlY3Rpb25Mb2NhbC5zY2FsZSgtMSwgdXApOwogICAgICByaWdodC5jb3B5KHdoZWVsLmF4bGVMb2NhbCk7CiAgICAgIHVwLmNyb3NzKHJpZ2h0LCBmd2QpOwogICAgICBmd2Qubm9ybWFsaXplKCk7CiAgICAgIHJpZ2h0Lm5vcm1hbGl6ZSgpOyAvLyBSb3RhdGUgYXJvdW5kIHN0ZWVyaW5nIG92ZXIgdGhlIHdoZWVsQXhsZQoKICAgICAgY29uc3Qgc3RlZXJpbmcgPSB3aGVlbC5zdGVlcmluZzsKICAgICAgY29uc3Qgc3RlZXJpbmdPcm4gPSBuZXcgUXVhdGVybmlvbigpOwogICAgICBzdGVlcmluZ09ybi5zZXRGcm9tQXhpc0FuZ2xlKHVwLCBzdGVlcmluZyk7CiAgICAgIGNvbnN0IHJvdGF0aW5nT3JuID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgcm90YXRpbmdPcm4uc2V0RnJvbUF4aXNBbmdsZShyaWdodCwgd2hlZWwucm90YXRpb24pOyAvLyBXb3JsZCByb3RhdGlvbiBvZiB0aGUgd2hlZWwKCiAgICAgIGNvbnN0IHEgPSB3aGVlbC53b3JsZFRyYW5zZm9ybS5xdWF0ZXJuaW9uOwogICAgICB0aGlzLmNoYXNzaXNCb2R5LnF1YXRlcm5pb24ubXVsdChzdGVlcmluZ09ybiwgcSk7CiAgICAgIHEubXVsdChyb3RhdGluZ09ybiwgcSk7CiAgICAgIHEubm9ybWFsaXplKCk7IC8vIHdvcmxkIHBvc2l0aW9uIG9mIHRoZSB3aGVlbAoKICAgICAgY29uc3QgcCA9IHdoZWVsLndvcmxkVHJhbnNmb3JtLnBvc2l0aW9uOwogICAgICBwLmNvcHkod2hlZWwuZGlyZWN0aW9uV29ybGQpOwogICAgICBwLnNjYWxlKHdoZWVsLnN1c3BlbnNpb25MZW5ndGgsIHApOwogICAgICBwLnZhZGQod2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLCBwKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSB3b3JsZCB0cmFuc2Zvcm0gb2Ygb25lIG9mIHRoZSB3aGVlbHMKICAgICAqLwoKCiAgICBnZXRXaGVlbFRyYW5zZm9ybVdvcmxkKHdoZWVsSW5kZXgpIHsKICAgICAgcmV0dXJuIHRoaXMud2hlZWxJbmZvc1t3aGVlbEluZGV4XS53b3JsZFRyYW5zZm9ybTsKICAgIH0KCiAgICB1cGRhdGVGcmljdGlvbih0aW1lU3RlcCkgewogICAgICBjb25zdCBzdXJmTm9ybWFsV1Nfc2NhbGVkX3Byb2ogPSB1cGRhdGVGcmljdGlvbl9zdXJmTm9ybWFsV1Nfc2NhbGVkX3Byb2o7IC8vY2FsY3VsYXRlIHRoZSBpbXB1bHNlLCBzbyB0aGF0IHRoZSB3aGVlbHMgZG9uJ3QgbW92ZSBzaWRld2FyZHMKCiAgICAgIGNvbnN0IHdoZWVsSW5mb3MgPSB0aGlzLndoZWVsSW5mb3M7CiAgICAgIGNvbnN0IG51bVdoZWVscyA9IHdoZWVsSW5mb3MubGVuZ3RoOwogICAgICBjb25zdCBjaGFzc2lzQm9keSA9IHRoaXMuY2hhc3Npc0JvZHk7CiAgICAgIGNvbnN0IGZvcndhcmRXUyA9IHVwZGF0ZUZyaWN0aW9uX2ZvcndhcmRXUzsKICAgICAgY29uc3QgYXhsZSA9IHVwZGF0ZUZyaWN0aW9uX2F4bGU7CiAgICAgIHRoaXMubnVtV2hlZWxzT25Hcm91bmQgPSAwOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsKICAgICAgICBjb25zdCBncm91bmRPYmplY3QgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmJvZHk7CgogICAgICAgIGlmIChncm91bmRPYmplY3QpIHsKICAgICAgICAgIHRoaXMubnVtV2hlZWxzT25Hcm91bmQrKzsKICAgICAgICB9CgogICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlID0gMDsKICAgICAgICB3aGVlbC5mb3J3YXJkSW1wdWxzZSA9IDA7CgogICAgICAgIGlmICghZm9yd2FyZFdTW2ldKSB7CiAgICAgICAgICBmb3J3YXJkV1NbaV0gPSBuZXcgVmVjMygpOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFheGxlW2ldKSB7CiAgICAgICAgICBheGxlW2ldID0gbmV3IFZlYzMoKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICBjb25zdCB3aGVlbCA9IHdoZWVsSW5mb3NbaV07CiAgICAgICAgY29uc3QgZ3JvdW5kT2JqZWN0ID0gd2hlZWwucmF5Y2FzdFJlc3VsdC5ib2R5OwoKICAgICAgICBpZiAoZ3JvdW5kT2JqZWN0KSB7CiAgICAgICAgICBjb25zdCBheGxlaSA9IGF4bGVbaV07CiAgICAgICAgICBjb25zdCB3aGVlbFRyYW5zID0gdGhpcy5nZXRXaGVlbFRyYW5zZm9ybVdvcmxkKGkpOyAvLyBHZXQgd29ybGQgYXhsZQoKICAgICAgICAgIHdoZWVsVHJhbnMudmVjdG9yVG9Xb3JsZEZyYW1lKGRpcmVjdGlvbnNbdGhpcy5pbmRleFJpZ2h0QXhpc10sIGF4bGVpKTsKICAgICAgICAgIGNvbnN0IHN1cmZOb3JtYWxXUyA9IHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQ7CiAgICAgICAgICBjb25zdCBwcm9qID0gYXhsZWkuZG90KHN1cmZOb3JtYWxXUyk7CiAgICAgICAgICBzdXJmTm9ybWFsV1Muc2NhbGUocHJvaiwgc3VyZk5vcm1hbFdTX3NjYWxlZF9wcm9qKTsKICAgICAgICAgIGF4bGVpLnZzdWIoc3VyZk5vcm1hbFdTX3NjYWxlZF9wcm9qLCBheGxlaSk7CiAgICAgICAgICBheGxlaS5ub3JtYWxpemUoKTsKICAgICAgICAgIHN1cmZOb3JtYWxXUy5jcm9zcyhheGxlaSwgZm9yd2FyZFdTW2ldKTsKICAgICAgICAgIGZvcndhcmRXU1tpXS5ub3JtYWxpemUoKTsKICAgICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlID0gcmVzb2x2ZVNpbmdsZUJpbGF0ZXJhbChjaGFzc2lzQm9keSwgd2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLCBncm91bmRPYmplY3QsIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZCwgYXhsZWkpOwogICAgICAgICAgd2hlZWwuc2lkZUltcHVsc2UgKj0gc2lkZUZyaWN0aW9uU3RpZmZuZXNzMjsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IHNpZGVGYWN0b3IgPSAxOwogICAgICBjb25zdCBmd2RGYWN0b3IgPSAwLjU7CiAgICAgIHRoaXMuc2xpZGluZyA9IGZhbHNlOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsKICAgICAgICBjb25zdCBncm91bmRPYmplY3QgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmJvZHk7CiAgICAgICAgbGV0IHJvbGxpbmdGcmljdGlvbiA9IDA7CiAgICAgICAgd2hlZWwuc2xpcEluZm8gPSAxOwoKICAgICAgICBpZiAoZ3JvdW5kT2JqZWN0KSB7CiAgICAgICAgICBjb25zdCBkZWZhdWx0Um9sbGluZ0ZyaWN0aW9uSW1wdWxzZSA9IDA7CiAgICAgICAgICBjb25zdCBtYXhJbXB1bHNlID0gd2hlZWwuYnJha2UgPyB3aGVlbC5icmFrZSA6IGRlZmF1bHRSb2xsaW5nRnJpY3Rpb25JbXB1bHNlOyAvLyBidFdoZWVsQ29udGFjdFBvaW50IGNvbnRhY3RQdChjaGFzc2lzQm9keSxncm91bmRPYmplY3Qsd2hlZWxJbmZyYXljYXN0SW5mby5oaXRQb2ludFdvcmxkLGZvcndhcmRXU1t3aGVlbF0sbWF4SW1wdWxzZSk7CiAgICAgICAgICAvLyByb2xsaW5nRnJpY3Rpb24gPSBjYWxjUm9sbGluZ0ZyaWN0aW9uKGNvbnRhY3RQdCk7CgogICAgICAgICAgcm9sbGluZ0ZyaWN0aW9uID0gY2FsY1JvbGxpbmdGcmljdGlvbihjaGFzc2lzQm9keSwgZ3JvdW5kT2JqZWN0LCB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdFBvaW50V29ybGQsIGZvcndhcmRXU1tpXSwgbWF4SW1wdWxzZSk7CiAgICAgICAgICByb2xsaW5nRnJpY3Rpb24gKz0gd2hlZWwuZW5naW5lRm9yY2UgKiB0aW1lU3RlcDsgLy8gcm9sbGluZ0ZyaWN0aW9uID0gMDsKCiAgICAgICAgICBjb25zdCBmYWN0b3IgPSBtYXhJbXB1bHNlIC8gcm9sbGluZ0ZyaWN0aW9uOwogICAgICAgICAgd2hlZWwuc2xpcEluZm8gKj0gZmFjdG9yOwogICAgICAgIH0gLy9zd2l0Y2ggYmV0d2VlbiBhY3RpdmUgcm9sbGluZyAodGhyb3R0bGUpLCBicmFraW5nIGFuZCBub24tYWN0aXZlIHJvbGxpbmcgZnJpY3Rpb24gKG50aHJvdHRsZS9icmVhaykKCgogICAgICAgIHdoZWVsLmZvcndhcmRJbXB1bHNlID0gMDsKICAgICAgICB3aGVlbC5za2lkSW5mbyA9IDE7CgogICAgICAgIGlmIChncm91bmRPYmplY3QpIHsKICAgICAgICAgIHdoZWVsLnNraWRJbmZvID0gMTsKICAgICAgICAgIGNvbnN0IG1heGltcCA9IHdoZWVsLnN1c3BlbnNpb25Gb3JjZSAqIHRpbWVTdGVwICogd2hlZWwuZnJpY3Rpb25TbGlwOwogICAgICAgICAgY29uc3QgbWF4aW1wU2lkZSA9IG1heGltcDsKICAgICAgICAgIGNvbnN0IG1heGltcFNxdWFyZWQgPSBtYXhpbXAgKiBtYXhpbXBTaWRlOwogICAgICAgICAgd2hlZWwuZm9yd2FyZEltcHVsc2UgPSByb2xsaW5nRnJpY3Rpb247IC8vd2hlZWxJbmZvLmVuZ2luZUZvcmNlKiB0aW1lU3RlcDsKCiAgICAgICAgICBjb25zdCB4ID0gd2hlZWwuZm9yd2FyZEltcHVsc2UgKiBmd2RGYWN0b3IgLyB3aGVlbC5mb3J3YXJkQWNjZWxlcmF0aW9uOwogICAgICAgICAgY29uc3QgeSA9IHdoZWVsLnNpZGVJbXB1bHNlICogc2lkZUZhY3RvciAvIHdoZWVsLnNpZGVBY2NlbGVyYXRpb247CiAgICAgICAgICBjb25zdCBpbXB1bHNlU3F1YXJlZCA9IHggKiB4ICsgeSAqIHk7CiAgICAgICAgICB3aGVlbC5zbGlkaW5nID0gZmFsc2U7CgogICAgICAgICAgaWYgKGltcHVsc2VTcXVhcmVkID4gbWF4aW1wU3F1YXJlZCkgewogICAgICAgICAgICB0aGlzLnNsaWRpbmcgPSB0cnVlOwogICAgICAgICAgICB3aGVlbC5zbGlkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgY29uc3QgZmFjdG9yID0gbWF4aW1wIC8gTWF0aC5zcXJ0KGltcHVsc2VTcXVhcmVkKTsKICAgICAgICAgICAgd2hlZWwuc2tpZEluZm8gKj0gZmFjdG9yOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHRoaXMuc2xpZGluZykgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsKCiAgICAgICAgICBpZiAod2hlZWwuc2lkZUltcHVsc2UgIT09IDApIHsKICAgICAgICAgICAgaWYgKHdoZWVsLnNraWRJbmZvIDwgMSkgewogICAgICAgICAgICAgIHdoZWVsLmZvcndhcmRJbXB1bHNlICo9IHdoZWVsLnNraWRJbmZvOwogICAgICAgICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlICo9IHdoZWVsLnNraWRJbmZvOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIGFwcGx5IHRoZSBpbXB1bHNlcwoKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICBjb25zdCB3aGVlbCA9IHdoZWVsSW5mb3NbaV07CiAgICAgICAgY29uc3QgcmVsX3BvcyA9IG5ldyBWZWMzKCk7CiAgICAgICAgd2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLnZzdWIoY2hhc3Npc0JvZHkucG9zaXRpb24sIHJlbF9wb3MpOyAvLyBjYW5ub25zIGFwcGx5aW1wdWxzZSBpcyB1c2luZyB3b3JsZCBjb29yZCBmb3IgdGhlIHBvc2l0aW9uCiAgICAgICAgLy9yZWxfcG9zLmNvcHkod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkKTsKCiAgICAgICAgaWYgKHdoZWVsLmZvcndhcmRJbXB1bHNlICE9PSAwKSB7CiAgICAgICAgICBjb25zdCBpbXB1bHNlID0gbmV3IFZlYzMoKTsKICAgICAgICAgIGZvcndhcmRXU1tpXS5zY2FsZSh3aGVlbC5mb3J3YXJkSW1wdWxzZSwgaW1wdWxzZSk7CiAgICAgICAgICBjaGFzc2lzQm9keS5hcHBseUltcHVsc2UoaW1wdWxzZSwgcmVsX3Bvcyk7CiAgICAgICAgfQoKICAgICAgICBpZiAod2hlZWwuc2lkZUltcHVsc2UgIT09IDApIHsKICAgICAgICAgIGNvbnN0IGdyb3VuZE9iamVjdCA9IHdoZWVsLnJheWNhc3RSZXN1bHQuYm9keTsKICAgICAgICAgIGNvbnN0IHJlbF9wb3MyID0gbmV3IFZlYzMoKTsKICAgICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGdyb3VuZE9iamVjdC5wb3NpdGlvbiwgcmVsX3BvczIpOyAvL3JlbF9wb3MyLmNvcHkod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkKTsKCiAgICAgICAgICBjb25zdCBzaWRlSW1wID0gbmV3IFZlYzMoKTsKICAgICAgICAgIGF4bGVbaV0uc2NhbGUod2hlZWwuc2lkZUltcHVsc2UsIHNpZGVJbXApOyAvLyBTY2FsZSB0aGUgcmVsYXRpdmUgcG9zaXRpb24gaW4gdGhlIHVwIGRpcmVjdGlvbiB3aXRoIHJvbGxJbmZsdWVuY2UuCiAgICAgICAgICAvLyBJZiByb2xsSW5mbHVlbmNlIGlzIDEsIHRoZSBpbXB1bHNlIHdpbGwgYmUgYXBwbGllZCBvbiB0aGUgaGl0UG9pbnQgKGVhc3kgdG8gcm9sbCBvdmVyKSwgaWYgaXQgaXMgemVybyBpdCB3aWxsIGJlIGFwcGxpZWQgaW4gdGhlIHNhbWUgcGxhbmUgYXMgdGhlIGNlbnRlciBvZiBtYXNzIChub3QgZWFzeSB0byByb2xsIG92ZXIpLgoKICAgICAgICAgIGNoYXNzaXNCb2R5LnZlY3RvclRvTG9jYWxGcmFtZShyZWxfcG9zLCByZWxfcG9zKTsKICAgICAgICAgIHJlbF9wb3NbJ3h5eidbdGhpcy5pbmRleFVwQXhpc11dICo9IHdoZWVsLnJvbGxJbmZsdWVuY2U7CiAgICAgICAgICBjaGFzc2lzQm9keS52ZWN0b3JUb1dvcmxkRnJhbWUocmVsX3BvcywgcmVsX3Bvcyk7CiAgICAgICAgICBjaGFzc2lzQm9keS5hcHBseUltcHVsc2Uoc2lkZUltcCwgcmVsX3Bvcyk7IC8vYXBwbHkgZnJpY3Rpb24gaW1wdWxzZSBvbiB0aGUgZ3JvdW5kCgogICAgICAgICAgc2lkZUltcC5zY2FsZSgtMSwgc2lkZUltcCk7CiAgICAgICAgICBncm91bmRPYmplY3QuYXBwbHlJbXB1bHNlKHNpZGVJbXAsIHJlbF9wb3MyKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgfQogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzQgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzUgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzYgPSBuZXcgVmVjMygpOwogIG5ldyBSYXkoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IGNhc3RSYXlfcmF5dmVjdG9yID0gbmV3IFZlYzMoKTsKICBjb25zdCBjYXN0UmF5X3RhcmdldCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZGlyZWN0aW9ucyA9IFtuZXcgVmVjMygxLCAwLCAwKSwgbmV3IFZlYzMoMCwgMSwgMCksIG5ldyBWZWMzKDAsIDAsIDEpXTsKICBjb25zdCB1cGRhdGVGcmljdGlvbl9zdXJmTm9ybWFsV1Nfc2NhbGVkX3Byb2ogPSBuZXcgVmVjMygpOwogIGNvbnN0IHVwZGF0ZUZyaWN0aW9uX2F4bGUgPSBbXTsKICBjb25zdCB1cGRhdGVGcmljdGlvbl9mb3J3YXJkV1MgPSBbXTsKICBjb25zdCBzaWRlRnJpY3Rpb25TdGlmZm5lc3MyID0gMTsKICBjb25zdCBjYWxjUm9sbGluZ0ZyaWN0aW9uX3ZlbDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY2FsY1JvbGxpbmdGcmljdGlvbl92ZWwgPSBuZXcgVmVjMygpOwoKICBmdW5jdGlvbiBjYWxjUm9sbGluZ0ZyaWN0aW9uKGJvZHkwLCBib2R5MSwgZnJpY3Rpb25Qb3NXb3JsZCwgZnJpY3Rpb25EaXJlY3Rpb25Xb3JsZCwgbWF4SW1wdWxzZSkgewogICAgbGV0IGoxID0gMDsKICAgIGNvbnN0IGNvbnRhY3RQb3NXb3JsZCA9IGZyaWN0aW9uUG9zV29ybGQ7IC8vIGNvbnN0IHJlbF9wb3MxID0gbmV3IFZlYzMoKTsKICAgIC8vIGNvbnN0IHJlbF9wb3MyID0gbmV3IFZlYzMoKTsKCiAgICBjb25zdCB2ZWwxID0gY2FsY1JvbGxpbmdGcmljdGlvbl92ZWwxOwogICAgY29uc3QgdmVsMiA9IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsMjsKICAgIGNvbnN0IHZlbCA9IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsOyAvLyBjb250YWN0UG9zV29ybGQudnN1Yihib2R5MC5wb3NpdGlvbiwgcmVsX3BvczEpOwogICAgLy8gY29udGFjdFBvc1dvcmxkLnZzdWIoYm9keTEucG9zaXRpb24sIHJlbF9wb3MyKTsKCiAgICBib2R5MC5nZXRWZWxvY2l0eUF0V29ybGRQb2ludChjb250YWN0UG9zV29ybGQsIHZlbDEpOwogICAgYm9keTEuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQoY29udGFjdFBvc1dvcmxkLCB2ZWwyKTsKICAgIHZlbDEudnN1Yih2ZWwyLCB2ZWwpOwogICAgY29uc3QgdnJlbCA9IGZyaWN0aW9uRGlyZWN0aW9uV29ybGQuZG90KHZlbCk7CiAgICBjb25zdCBkZW5vbTAgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yKGJvZHkwLCBmcmljdGlvblBvc1dvcmxkLCBmcmljdGlvbkRpcmVjdGlvbldvcmxkKTsKICAgIGNvbnN0IGRlbm9tMSA9IGNvbXB1dGVJbXB1bHNlRGVub21pbmF0b3IoYm9keTEsIGZyaWN0aW9uUG9zV29ybGQsIGZyaWN0aW9uRGlyZWN0aW9uV29ybGQpOwogICAgY29uc3QgcmVsYXhhdGlvbiA9IDE7CiAgICBjb25zdCBqYWNEaWFnQUJJbnYgPSByZWxheGF0aW9uIC8gKGRlbm9tMCArIGRlbm9tMSk7IC8vIGNhbGN1bGF0ZSBqIHRoYXQgbW92ZXMgdXMgdG8gemVybyByZWxhdGl2ZSB2ZWxvY2l0eQoKICAgIGoxID0gLXZyZWwgKiBqYWNEaWFnQUJJbnY7CgogICAgaWYgKG1heEltcHVsc2UgPCBqMSkgewogICAgICBqMSA9IG1heEltcHVsc2U7CiAgICB9CgogICAgaWYgKGoxIDwgLW1heEltcHVsc2UpIHsKICAgICAgajEgPSAtbWF4SW1wdWxzZTsKICAgIH0KCiAgICByZXR1cm4gajE7CiAgfQoKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3IwID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX2MwID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3ZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl9tID0gbmV3IFZlYzMoKTsKCiAgZnVuY3Rpb24gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcihib2R5LCBwb3MsIG5vcm1hbCkgewogICAgY29uc3QgcjAgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3IwOwogICAgY29uc3QgYzAgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX2MwOwogICAgY29uc3QgdmVjID0gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl92ZWM7CiAgICBjb25zdCBtID0gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl9tOwogICAgcG9zLnZzdWIoYm9keS5wb3NpdGlvbiwgcjApOwogICAgcjAuY3Jvc3Mobm9ybWFsLCBjMCk7CiAgICBib2R5LmludkluZXJ0aWFXb3JsZC52bXVsdChjMCwgbSk7CiAgICBtLmNyb3NzKHIwLCB2ZWMpOwogICAgcmV0dXJuIGJvZHkuaW52TWFzcyArIG5vcm1hbC5kb3QodmVjKTsKICB9CgogIGNvbnN0IHJlc29sdmVTaW5nbGVCaWxhdGVyYWxfdmVsMSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcmVzb2x2ZVNpbmdsZUJpbGF0ZXJhbF92ZWwyID0gbmV3IFZlYzMoKTsKICBjb25zdCByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbCA9IG5ldyBWZWMzKCk7IC8vIGJpbGF0ZXJhbCBjb25zdHJhaW50IGJldHdlZW4gdHdvIGR5bmFtaWMgb2JqZWN0cwoKICBmdW5jdGlvbiByZXNvbHZlU2luZ2xlQmlsYXRlcmFsKGJvZHkxLCBwb3MxLCBib2R5MiwgcG9zMiwgbm9ybWFsKSB7CiAgICBjb25zdCBub3JtYWxMZW5TcXIgPSBub3JtYWwubGVuZ3RoU3F1YXJlZCgpOwoKICAgIGlmIChub3JtYWxMZW5TcXIgPiAxLjEpIHsKICAgICAgcmV0dXJuIDA7IC8vIG5vIGltcHVsc2UKICAgIH0gLy8gY29uc3QgcmVsX3BvczEgPSBuZXcgVmVjMygpOwogICAgLy8gY29uc3QgcmVsX3BvczIgPSBuZXcgVmVjMygpOwogICAgLy8gcG9zMS52c3ViKGJvZHkxLnBvc2l0aW9uLCByZWxfcG9zMSk7CiAgICAvLyBwb3MyLnZzdWIoYm9keTIucG9zaXRpb24sIHJlbF9wb3MyKTsKCgogICAgY29uc3QgdmVsMSA9IHJlc29sdmVTaW5nbGVCaWxhdGVyYWxfdmVsMTsKICAgIGNvbnN0IHZlbDIgPSByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbDI7CiAgICBjb25zdCB2ZWwgPSByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbDsKICAgIGJvZHkxLmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHBvczEsIHZlbDEpOwogICAgYm9keTIuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQocG9zMiwgdmVsMik7CiAgICB2ZWwxLnZzdWIodmVsMiwgdmVsKTsKICAgIGNvbnN0IHJlbF92ZWwgPSBub3JtYWwuZG90KHZlbCk7CiAgICBjb25zdCBjb250YWN0RGFtcGluZyA9IDAuMjsKICAgIGNvbnN0IG1hc3NUZXJtID0gMSAvIChib2R5MS5pbnZNYXNzICsgYm9keTIuaW52TWFzcyk7CiAgICBjb25zdCBpbXB1bHNlID0gLWNvbnRhY3REYW1waW5nICogcmVsX3ZlbCAqIG1hc3NUZXJtOwogICAgcmV0dXJuIGltcHVsc2U7CiAgfQoKICAvKioKICAgKiBTcGhlcmljYWwgc2hhcGUKICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCByYWRpdXMgPSAxCiAgICogICAgIGNvbnN0IHNwaGVyZVNoYXBlID0gbmV3IENBTk5PTi5TcGhlcmUocmFkaXVzKQogICAqICAgICBjb25zdCBzcGhlcmVCb2R5ID0gbmV3IENBTk5PTi5Cb2R5KHsgbWFzczogMSwgc2hhcGU6IHNwaGVyZVNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoc3BoZXJlQm9keSkKICAgKi8KICBjbGFzcyBTcGhlcmUgZXh0ZW5kcyBTaGFwZSB7CiAgICAvKioKICAgICAqIFRoZSByYWRpdXMgb2YgdGhlIHNwaGVyZS4KICAgICAqLwoKICAgIC8qKgogICAgICoKICAgICAqIEBwYXJhbSByYWRpdXMgVGhlIHJhZGl1cyBvZiB0aGUgc3BoZXJlLCBhIG5vbi1uZWdhdGl2ZSBudW1iZXIuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKHJhZGl1cykgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuU1BIRVJFCiAgICAgIH0pOwogICAgICB0aGlzLnJhZGl1cyA9IHJhZGl1cyAhPT0gdW5kZWZpbmVkID8gcmFkaXVzIDogMS4wOwoKICAgICAgaWYgKHRoaXMucmFkaXVzIDwgMCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIHNwaGVyZSByYWRpdXMgY2Fubm90IGJlIG5lZ2F0aXZlLicpOwogICAgICB9CgogICAgICB0aGlzLnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICB9CiAgICAvKiogY2FsY3VsYXRlTG9jYWxJbmVydGlhICovCgoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgY29uc3QgSSA9IDIuMCAqIG1hc3MgKiB0aGlzLnJhZGl1cyAqIHRoaXMucmFkaXVzIC8gNS4wOwogICAgICB0YXJnZXQueCA9IEk7CiAgICAgIHRhcmdldC55ID0gSTsKICAgICAgdGFyZ2V0LnogPSBJOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqIHZvbHVtZSAqLwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiA0LjAgKiBNYXRoLlBJICogTWF0aC5wb3codGhpcy5yYWRpdXMsIDMpIC8gMy4wOwogICAgfQoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gdGhpcy5yYWRpdXM7CiAgICB9CgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgY29uc3QgciA9IHRoaXMucmFkaXVzOwogICAgICBjb25zdCBheGVzID0gWyd4JywgJ3knLCAneiddOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBheGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgYXggPSBheGVzW2ldOwogICAgICAgIG1pbltheF0gPSBwb3NbYXhdIC0gcjsKICAgICAgICBtYXhbYXhdID0gcG9zW2F4XSArIHI7CiAgICAgIH0KICAgIH0KCiAgfQogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOyAvLyBUZW1wIHZlY3RvcnMgZm9yIGNhbGN1bGF0aW9uCgogIG5ldyBWZWMzKCk7IC8vIFJlbGF0aXZlIHZlbG9jaXR5CgogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQ3lsaW5kZXIgY2xhc3MuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3QgcmFkaXVzVG9wID0gMC41CiAgICogICAgIGNvbnN0IHJhZGl1c0JvdHRvbSA9IDAuNQogICAqICAgICBjb25zdCBoZWlnaHQgPSAyCiAgICogICAgIGNvbnN0IG51bVNlZ21lbnRzID0gMTIKICAgKiAgICAgY29uc3QgY3lsaW5kZXJTaGFwZSA9IG5ldyBDQU5OT04uQ3lsaW5kZXIocmFkaXVzVG9wLCByYWRpdXNCb3R0b20sIGhlaWdodCwgbnVtU2VnbWVudHMpCiAgICogICAgIGNvbnN0IGN5bGluZGVyQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBjeWxpbmRlclNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoY3lsaW5kZXJCb2R5KQogICAqLwoKICBjbGFzcyBDeWxpbmRlciBleHRlbmRzIENvbnZleFBvbHloZWRyb24gewogICAgLyoqIFRoZSByYWRpdXMgb2YgdGhlIHRvcCBvZiB0aGUgQ3lsaW5kZXIuICovCgogICAgLyoqIFRoZSByYWRpdXMgb2YgdGhlIGJvdHRvbSBvZiB0aGUgQ3lsaW5kZXIuICovCgogICAgLyoqIFRoZSBoZWlnaHQgb2YgdGhlIEN5bGluZGVyLiAqLwoKICAgIC8qKiBUaGUgbnVtYmVyIG9mIHNlZ21lbnRzIHRvIGJ1aWxkIHRoZSBjeWxpbmRlciBvdXQgb2YuICovCgogICAgLyoqCiAgICAgKiBAcGFyYW0gcmFkaXVzVG9wIFRoZSByYWRpdXMgb2YgdGhlIHRvcCBvZiB0aGUgQ3lsaW5kZXIuCiAgICAgKiBAcGFyYW0gcmFkaXVzQm90dG9tIFRoZSByYWRpdXMgb2YgdGhlIGJvdHRvbSBvZiB0aGUgQ3lsaW5kZXIuCiAgICAgKiBAcGFyYW0gaGVpZ2h0IFRoZSBoZWlnaHQgb2YgdGhlIEN5bGluZGVyLgogICAgICogQHBhcmFtIG51bVNlZ21lbnRzIFRoZSBudW1iZXIgb2Ygc2VnbWVudHMgdG8gYnVpbGQgdGhlIGN5bGluZGVyIG91dCBvZi4KICAgICAqLwogICAgY29uc3RydWN0b3IocmFkaXVzVG9wLCByYWRpdXNCb3R0b20sIGhlaWdodCwgbnVtU2VnbWVudHMpIHsKICAgICAgaWYgKHJhZGl1c1RvcCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmFkaXVzVG9wID0gMTsKICAgICAgfQoKICAgICAgaWYgKHJhZGl1c0JvdHRvbSA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmFkaXVzQm90dG9tID0gMTsKICAgICAgfQoKICAgICAgaWYgKGhlaWdodCA9PT0gdm9pZCAwKSB7CiAgICAgICAgaGVpZ2h0ID0gMTsKICAgICAgfQoKICAgICAgaWYgKG51bVNlZ21lbnRzID09PSB2b2lkIDApIHsKICAgICAgICBudW1TZWdtZW50cyA9IDg7CiAgICAgIH0KCiAgICAgIGlmIChyYWRpdXNUb3AgPCAwKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgY3lsaW5kZXIgcmFkaXVzVG9wIGNhbm5vdCBiZSBuZWdhdGl2ZS4nKTsKICAgICAgfQoKICAgICAgaWYgKHJhZGl1c0JvdHRvbSA8IDApIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBjeWxpbmRlciByYWRpdXNCb3R0b20gY2Fubm90IGJlIG5lZ2F0aXZlLicpOwogICAgICB9CgogICAgICBjb25zdCBOID0gbnVtU2VnbWVudHM7CiAgICAgIGNvbnN0IHZlcnRpY2VzID0gW107CiAgICAgIGNvbnN0IGF4ZXMgPSBbXTsKICAgICAgY29uc3QgZmFjZXMgPSBbXTsKICAgICAgY29uc3QgYm90dG9tZmFjZSA9IFtdOwogICAgICBjb25zdCB0b3BmYWNlID0gW107CiAgICAgIGNvbnN0IGNvcyA9IE1hdGguY29zOwogICAgICBjb25zdCBzaW4gPSBNYXRoLnNpbjsgLy8gRmlyc3QgYm90dG9tIHBvaW50CgogICAgICB2ZXJ0aWNlcy5wdXNoKG5ldyBWZWMzKC1yYWRpdXNCb3R0b20gKiBzaW4oMCksIC1oZWlnaHQgKiAwLjUsIHJhZGl1c0JvdHRvbSAqIGNvcygwKSkpOwogICAgICBib3R0b21mYWNlLnB1c2goMCk7IC8vIEZpcnN0IHRvcCBwb2ludAoKICAgICAgdmVydGljZXMucHVzaChuZXcgVmVjMygtcmFkaXVzVG9wICogc2luKDApLCBoZWlnaHQgKiAwLjUsIHJhZGl1c1RvcCAqIGNvcygwKSkpOwogICAgICB0b3BmYWNlLnB1c2goMSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IE47IGkrKykgewogICAgICAgIGNvbnN0IHRoZXRhID0gMiAqIE1hdGguUEkgLyBOICogKGkgKyAxKTsKICAgICAgICBjb25zdCB0aGV0YU4gPSAyICogTWF0aC5QSSAvIE4gKiAoaSArIDAuNSk7CgogICAgICAgIGlmIChpIDwgTiAtIDEpIHsKICAgICAgICAgIC8vIEJvdHRvbQogICAgICAgICAgdmVydGljZXMucHVzaChuZXcgVmVjMygtcmFkaXVzQm90dG9tICogc2luKHRoZXRhKSwgLWhlaWdodCAqIDAuNSwgcmFkaXVzQm90dG9tICogY29zKHRoZXRhKSkpOwogICAgICAgICAgYm90dG9tZmFjZS5wdXNoKDIgKiBpICsgMik7IC8vIFRvcAoKICAgICAgICAgIHZlcnRpY2VzLnB1c2gobmV3IFZlYzMoLXJhZGl1c1RvcCAqIHNpbih0aGV0YSksIGhlaWdodCAqIDAuNSwgcmFkaXVzVG9wICogY29zKHRoZXRhKSkpOwogICAgICAgICAgdG9wZmFjZS5wdXNoKDIgKiBpICsgMyk7IC8vIEZhY2UKCiAgICAgICAgICBmYWNlcy5wdXNoKFsyICogaSwgMiAqIGkgKyAxLCAyICogaSArIDMsIDIgKiBpICsgMl0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBmYWNlcy5wdXNoKFsyICogaSwgMiAqIGkgKyAxLCAxLCAwXSk7IC8vIENvbm5lY3QKICAgICAgICB9IC8vIEF4aXM6IHdlIGNhbiBjdXQgb2ZmIGhhbGYgb2YgdGhlbSBpZiB3ZSBoYXZlIGV2ZW4gbnVtYmVyIG9mIHNlZ21lbnRzCgoKICAgICAgICBpZiAoTiAlIDIgPT09IDEgfHwgaSA8IE4gLyAyKSB7CiAgICAgICAgICBheGVzLnB1c2gobmV3IFZlYzMoLXNpbih0aGV0YU4pLCAwLCBjb3ModGhldGFOKSkpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgZmFjZXMucHVzaChib3R0b21mYWNlKTsKICAgICAgYXhlcy5wdXNoKG5ldyBWZWMzKDAsIDEsIDApKTsgLy8gUmVvcmRlciB0b3AgZmFjZQoKICAgICAgY29uc3QgdGVtcCA9IFtdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0b3BmYWNlLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGVtcC5wdXNoKHRvcGZhY2VbdG9wZmFjZS5sZW5ndGggLSBpIC0gMV0pOwogICAgICB9CgogICAgICBmYWNlcy5wdXNoKHRlbXApOwogICAgICBzdXBlcih7CiAgICAgICAgdmVydGljZXMsCiAgICAgICAgZmFjZXMsCiAgICAgICAgYXhlcwogICAgICB9KTsKICAgICAgdGhpcy50eXBlID0gU2hhcGUudHlwZXMuQ1lMSU5ERVI7CiAgICAgIHRoaXMucmFkaXVzVG9wID0gcmFkaXVzVG9wOwogICAgICB0aGlzLnJhZGl1c0JvdHRvbSA9IHJhZGl1c0JvdHRvbTsKICAgICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7CiAgICAgIHRoaXMubnVtU2VnbWVudHMgPSBudW1TZWdtZW50czsKICAgIH0KCiAgfQoKICAvKioKICAgKiBQYXJ0aWNsZSBzaGFwZS4KICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCBwYXJ0aWNsZVNoYXBlID0gbmV3IENBTk5PTi5QYXJ0aWNsZSgpCiAgICogICAgIGNvbnN0IHBhcnRpY2xlQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBwYXJ0aWNsZVNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkocGFydGljbGVCb2R5KQogICAqLwogIGNsYXNzIFBhcnRpY2xlIGV4dGVuZHMgU2hhcGUgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHN1cGVyKHsKICAgICAgICB0eXBlOiBTaGFwZS50eXBlcy5QQVJUSUNMRQogICAgICB9KTsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlTG9jYWxJbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQuc2V0KDAsIDAsIDApOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQoKICAgIHZvbHVtZSgpIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSAwOwogICAgfQoKICAgIGNhbGN1bGF0ZVdvcmxkQUFCQihwb3MsIHF1YXQsIG1pbiwgbWF4KSB7CiAgICAgIC8vIEdldCBlYWNoIGF4aXMgbWF4CiAgICAgIG1pbi5jb3B5KHBvcyk7CiAgICAgIG1heC5jb3B5KHBvcyk7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQSBwbGFuZSwgZmFjaW5nIGluIHRoZSBaIGRpcmVjdGlvbi4gVGhlIHBsYW5lIGhhcyBpdHMgc3VyZmFjZSBhdCB6PTAgYW5kIGV2ZXJ5dGhpbmcgYmVsb3cgej0wIGlzIGFzc3VtZWQgdG8gYmUgc29saWQgcGxhbmUuIFRvIG1ha2UgdGhlIHBsYW5lIGZhY2UgaW4gc29tZSBvdGhlciBkaXJlY3Rpb24gdGhhbiB6LCB5b3UgbXVzdCBwdXQgaXQgaW5zaWRlIGEgQm9keSBhbmQgcm90YXRlIHRoYXQgYm9keS4gU2VlIHRoZSBkZW1vcy4KICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCBwbGFuZVNoYXBlID0gbmV3IENBTk5PTi5QbGFuZSgpCiAgICogICAgIGNvbnN0IHBsYW5lQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDAsIHNoYXBlOiAgcGxhbmVTaGFwZSB9KQogICAqICAgICBwbGFuZUJvZHkucXVhdGVybmlvbi5zZXRGcm9tRXVsZXIoLU1hdGguUEkgLyAyLCAwLCAwKSAvLyBtYWtlIGl0IGZhY2UgdXAKICAgKiAgICAgd29ybGQuYWRkQm9keShwbGFuZUJvZHkpCiAgICovCiAgY2xhc3MgUGxhbmUgZXh0ZW5kcyBTaGFwZSB7CiAgICAvKiogd29ybGROb3JtYWwgKi8KCiAgICAvKiogd29ybGROb3JtYWxOZWVkc1VwZGF0ZSAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHN1cGVyKHsKICAgICAgICB0eXBlOiBTaGFwZS50eXBlcy5QTEFORQogICAgICB9KTsgLy8gV29ybGQgb3JpZW50ZWQgbm9ybWFsCgogICAgICB0aGlzLndvcmxkTm9ybWFsID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy53b3JsZE5vcm1hbE5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IE51bWJlci5NQVhfVkFMVUU7CiAgICB9CiAgICAvKiogY29tcHV0ZVdvcmxkTm9ybWFsICovCgoKICAgIGNvbXB1dGVXb3JsZE5vcm1hbChxdWF0KSB7CiAgICAgIGNvbnN0IG4gPSB0aGlzLndvcmxkTm9ybWFsOwogICAgICBuLnNldCgwLCAwLCAxKTsKICAgICAgcXVhdC52bXVsdChuLCBuKTsKICAgICAgdGhpcy53b3JsZE5vcm1hbE5lZWRzVXBkYXRlID0gZmFsc2U7CiAgICB9CgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQoKICAgIHZvbHVtZSgpIHsKICAgICAgcmV0dXJuICgvLyBUaGUgcGxhbmUgaXMgaW5maW5pdGUuLi4KICAgICAgICBOdW1iZXIuTUFYX1ZBTFVFCiAgICAgICk7CiAgICB9CgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgLy8gVGhlIHBsYW5lIEFBQkIgaXMgaW5maW5pdGUsIGV4Y2VwdCBpZiB0aGUgbm9ybWFsIGlzIHBvaW50aW5nIGFsb25nIGFueSBheGlzCiAgICAgIHRlbXBOb3JtYWwuc2V0KDAsIDAsIDEpOyAvLyBEZWZhdWx0IHBsYW5lIG5vcm1hbCBpcyB6CgogICAgICBxdWF0LnZtdWx0KHRlbXBOb3JtYWwsIHRlbXBOb3JtYWwpOwogICAgICBjb25zdCBtYXhWYWwgPSBOdW1iZXIuTUFYX1ZBTFVFOwogICAgICBtaW4uc2V0KC1tYXhWYWwsIC1tYXhWYWwsIC1tYXhWYWwpOwogICAgICBtYXguc2V0KG1heFZhbCwgbWF4VmFsLCBtYXhWYWwpOwoKICAgICAgaWYgKHRlbXBOb3JtYWwueCA9PT0gMSkgewogICAgICAgIG1heC54ID0gcG9zLng7CiAgICAgIH0gZWxzZSBpZiAodGVtcE5vcm1hbC54ID09PSAtMSkgewogICAgICAgIG1pbi54ID0gcG9zLng7CiAgICAgIH0KCiAgICAgIGlmICh0ZW1wTm9ybWFsLnkgPT09IDEpIHsKICAgICAgICBtYXgueSA9IHBvcy55OwogICAgICB9IGVsc2UgaWYgKHRlbXBOb3JtYWwueSA9PT0gLTEpIHsKICAgICAgICBtaW4ueSA9IHBvcy55OwogICAgICB9CgogICAgICBpZiAodGVtcE5vcm1hbC56ID09PSAxKSB7CiAgICAgICAgbWF4LnogPSBwb3MuejsKICAgICAgfSBlbHNlIGlmICh0ZW1wTm9ybWFsLnogPT09IC0xKSB7CiAgICAgICAgbWluLnogPSBwb3MuejsKICAgICAgfQogICAgfQoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gTnVtYmVyLk1BWF9WQUxVRTsKICAgIH0KCiAgfQogIGNvbnN0IHRlbXBOb3JtYWwgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBIZWlnaHRmaWVsZCBzaGFwZSBjbGFzcy4gSGVpZ2h0IGRhdGEgaXMgZ2l2ZW4gYXMgYW4gYXJyYXkuIFRoZXNlIGRhdGEgcG9pbnRzIGFyZSBzcHJlYWQgb3V0IGV2ZW5seSB3aXRoIGEgZ2l2ZW4gZGlzdGFuY2UuCiAgICogQHRvZG8gU2hvdWxkIGJlIHBvc3NpYmxlIHRvIHVzZSBhbG9uZyBhbGwgYXhlcywgbm90IGp1c3QgeQogICAqIEB0b2RvIHNob3VsZCBiZSBwb3NzaWJsZSB0byBzY2FsZSBhbG9uZyBhbGwgYXhlcwogICAqIEB0b2RvIFJlZmFjdG9yIGVsZW1lbnRTaXplIHRvIGVsZW1lbnRTaXplWCBhbmQgZWxlbWVudFNpemVZCiAgICoKICAgKiBAZXhhbXBsZQogICAqICAgICAvLyBHZW5lcmF0ZSBzb21lIGhlaWdodCBkYXRhICh5LXZhbHVlcykuCiAgICogICAgIGNvbnN0IGRhdGEgPSBbXQogICAqICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwMDA7IGkrKykgewogICAqICAgICAgICAgY29uc3QgeSA9IDAuNSAqIE1hdGguY29zKDAuMiAqIGkpCiAgICogICAgICAgICBkYXRhLnB1c2goeSkKICAgKiAgICAgfQogICAqCiAgICogICAgIC8vIENyZWF0ZSB0aGUgaGVpZ2h0ZmllbGQgc2hhcGUKICAgKiAgICAgY29uc3QgaGVpZ2h0ZmllbGRTaGFwZSA9IG5ldyBDQU5OT04uSGVpZ2h0ZmllbGQoZGF0YSwgewogICAqICAgICAgICAgZWxlbWVudFNpemU6IDEgLy8gRGlzdGFuY2UgYmV0d2VlbiB0aGUgZGF0YSBwb2ludHMgaW4gWCBhbmQgWSBkaXJlY3Rpb25zCiAgICogICAgIH0pCiAgICogICAgIGNvbnN0IGhlaWdodGZpZWxkQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IHNoYXBlOiBoZWlnaHRmaWVsZFNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoaGVpZ2h0ZmllbGRCb2R5KQogICAqLwogIGNsYXNzIEhlaWdodGZpZWxkIGV4dGVuZHMgU2hhcGUgewogICAgLyoqCiAgICAgKiBBbiBhcnJheSBvZiBudW1iZXJzLCBvciBoZWlnaHQgdmFsdWVzLCB0aGF0IGFyZSBzcHJlYWQgb3V0IGFsb25nIHRoZSB4IGF4aXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE1heCB2YWx1ZSBvZiB0aGUgZGF0YSBwb2ludHMgaW4gdGhlIGRhdGEgYXJyYXkuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE1pbmltdW0gdmFsdWUgb2YgdGhlIGRhdGEgcG9pbnRzIGluIHRoZSBkYXRhIGFycmF5LgogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZCBzcGFjaW5nIGJldHdlZW4gdGhlIGRhdGEgcG9pbnRzIGluIFggYW5kIFkgZGlyZWN0aW9uLgogICAgICogQHRvZG8gZWxlbWVudFNpemVYIGFuZCBZCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIGRhdGEgQW4gYXJyYXkgb2YgbnVtYmVycywgb3IgaGVpZ2h0IHZhbHVlcywgdGhhdCBhcmUgc3ByZWFkIG91dCBhbG9uZyB0aGUgeCBheGlzLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihkYXRhLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIG9wdGlvbnMgPSBVdGlscy5kZWZhdWx0cyhvcHRpb25zLCB7CiAgICAgICAgbWF4VmFsdWU6IG51bGwsCiAgICAgICAgbWluVmFsdWU6IG51bGwsCiAgICAgICAgZWxlbWVudFNpemU6IDEKICAgICAgfSk7CiAgICAgIHN1cGVyKHsKICAgICAgICB0eXBlOiBTaGFwZS50eXBlcy5IRUlHSFRGSUVMRAogICAgICB9KTsKICAgICAgdGhpcy5kYXRhID0gZGF0YTsKICAgICAgdGhpcy5tYXhWYWx1ZSA9IG9wdGlvbnMubWF4VmFsdWU7CiAgICAgIHRoaXMubWluVmFsdWUgPSBvcHRpb25zLm1pblZhbHVlOwogICAgICB0aGlzLmVsZW1lbnRTaXplID0gb3B0aW9ucy5lbGVtZW50U2l6ZTsKCiAgICAgIGlmIChvcHRpb25zLm1pblZhbHVlID09PSBudWxsKSB7CiAgICAgICAgdGhpcy51cGRhdGVNaW5WYWx1ZSgpOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy5tYXhWYWx1ZSA9PT0gbnVsbCkgewogICAgICAgIHRoaXMudXBkYXRlTWF4VmFsdWUoKTsKICAgICAgfQoKICAgICAgdGhpcy5jYWNoZUVuYWJsZWQgPSB0cnVlOwogICAgICB0aGlzLnBpbGxhckNvbnZleCA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKCk7CiAgICAgIHRoaXMucGlsbGFyT2Zmc2V0ID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOyAvLyAiaV9qX2lzVXBwZXIiID0+IHsgY29udmV4OiAuLi4sIG9mZnNldDogLi4uIH0KICAgICAgLy8gZm9yIGV4YW1wbGU6CiAgICAgIC8vIF9jYWNoZWRQaWxsYXJzWyIwXzJfMSJdCgogICAgICB0aGlzLl9jYWNoZWRQaWxsYXJzID0ge307CiAgICB9CiAgICAvKioKICAgICAqIENhbGwgd2hlbmV2ZXIgeW91IGNoYW5nZSB0aGUgZGF0YSBhcnJheS4KICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIHRoaXMuX2NhY2hlZFBpbGxhcnMgPSB7fTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIHRoZSBgbWluVmFsdWVgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlTWluVmFsdWUoKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGxldCBtaW5WYWx1ZSA9IGRhdGFbMF1bMF07CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZGF0YS5sZW5ndGg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBkYXRhW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCB2ID0gZGF0YVtpXVtqXTsKCiAgICAgICAgICBpZiAodiA8IG1pblZhbHVlKSB7CiAgICAgICAgICAgIG1pblZhbHVlID0gdjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMubWluVmFsdWUgPSBtaW5WYWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIHRoZSBgbWF4VmFsdWVgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlTWF4VmFsdWUoKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGxldCBtYXhWYWx1ZSA9IGRhdGFbMF1bMF07CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZGF0YS5sZW5ndGg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBkYXRhW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCB2ID0gZGF0YVtpXVtqXTsKCiAgICAgICAgICBpZiAodiA+IG1heFZhbHVlKSB7CiAgICAgICAgICAgIG1heFZhbHVlID0gdjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMubWF4VmFsdWUgPSBtYXhWYWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBoZWlnaHQgdmFsdWUgYXQgYW4gaW5kZXguIERvbid0IGZvcmdldCB0byB1cGRhdGUgbWF4VmFsdWUgYW5kIG1pblZhbHVlIGFmdGVyIHlvdSdyZSBkb25lLgogICAgICovCgoKICAgIHNldEhlaWdodFZhbHVlQXRJbmRleCh4aSwgeWksIHZhbHVlKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGRhdGFbeGldW3lpXSA9IHZhbHVlOyAvLyBJbnZhbGlkYXRlIGNhY2hlCgogICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBmYWxzZSk7CgogICAgICBpZiAoeGkgPiAwKSB7CiAgICAgICAgdGhpcy5jbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpIC0gMSwgeWksIHRydWUpOwogICAgICAgIHRoaXMuY2xlYXJDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSAtIDEsIHlpLCBmYWxzZSk7CiAgICAgIH0KCiAgICAgIGlmICh5aSA+IDApIHsKICAgICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpIC0gMSwgdHJ1ZSk7CiAgICAgICAgdGhpcy5jbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSAtIDEsIGZhbHNlKTsKICAgICAgfQoKICAgICAgaWYgKHlpID4gMCAmJiB4aSA+IDApIHsKICAgICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGkgLSAxLCB5aSAtIDEsIHRydWUpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBtYXgvbWluIGluIGEgcmVjdGFuZ2xlIGluIHRoZSBtYXRyaXggZGF0YQogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSB0byBzdG9yZSB0aGUgcmVzdWx0cyBpbi4KICAgICAqIEByZXR1cm4gVGhlIHJlc3VsdCBhcnJheSwgaWYgaXQgd2FzIHBhc3NlZCBpbi4gTWluaW11bSB3aWxsIGJlIGF0IHBvc2l0aW9uIDAgYW5kIG1heCBhdCAxLgogICAgICovCgoKICAgIGdldFJlY3RNaW5NYXgoaU1pblgsIGlNaW5ZLCBpTWF4WCwgaU1heFksIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBbXTsKICAgICAgfQoKICAgICAgLy8gR2V0IG1heCBhbmQgbWluIG9mIHRoZSBkYXRhCiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7IC8vIFNldCBmaXJzdCB2YWx1ZQoKICAgICAgbGV0IG1heCA9IHRoaXMubWluVmFsdWU7CgogICAgICBmb3IgKGxldCBpID0gaU1pblg7IGkgPD0gaU1heFg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSBpTWluWTsgaiA8PSBpTWF4WTsgaisrKSB7CiAgICAgICAgICBjb25zdCBoZWlnaHQgPSBkYXRhW2ldW2pdOwoKICAgICAgICAgIGlmIChoZWlnaHQgPiBtYXgpIHsKICAgICAgICAgICAgbWF4ID0gaGVpZ2h0OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmVzdWx0WzBdID0gdGhpcy5taW5WYWx1ZTsKICAgICAgcmVzdWx0WzFdID0gbWF4OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGluZGV4IG9mIGEgbG9jYWwgcG9zaXRpb24gb24gdGhlIGhlaWdodGZpZWxkLiBUaGUgaW5kZXhlcyBpbmRpY2F0ZSB0aGUgcmVjdGFuZ2xlcywgc28gaWYgeW91ciB0ZXJyYWluIGlzIG1hZGUgb2YgTiB4IE4gaGVpZ2h0IGRhdGEgcG9pbnRzLCB5b3Ugd2lsbCBoYXZlIHJlY3RhbmdsZSBpbmRleGVzIHJhbmdpbmcgZnJvbSAwIHRvIE4tMS4KICAgICAqIEBwYXJhbSByZXN1bHQgVHdvLWVsZW1lbnQgYXJyYXkKICAgICAqIEBwYXJhbSBjbGFtcCBJZiB0aGUgcG9zaXRpb24gc2hvdWxkIGJlIGNsYW1wZWQgdG8gdGhlIGhlaWdodGZpZWxkIGVkZ2UuCiAgICAgKi8KCgogICAgZ2V0SW5kZXhPZlBvc2l0aW9uKHgsIHksIHJlc3VsdCwgY2xhbXApIHsKICAgICAgLy8gR2V0IHRoZSBpbmRleCBvZiB0aGUgZGF0YSBwb2ludHMgdG8gdGVzdCBhZ2FpbnN0CiAgICAgIGNvbnN0IHcgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBsZXQgeGkgPSBNYXRoLmZsb29yKHggLyB3KTsKICAgICAgbGV0IHlpID0gTWF0aC5mbG9vcih5IC8gdyk7CiAgICAgIHJlc3VsdFswXSA9IHhpOwogICAgICByZXN1bHRbMV0gPSB5aTsKCiAgICAgIGlmIChjbGFtcCkgewogICAgICAgIC8vIENsYW1wIGluZGV4IHRvIGVkZ2VzCiAgICAgICAgaWYgKHhpIDwgMCkgewogICAgICAgICAgeGkgPSAwOwogICAgICAgIH0KCiAgICAgICAgaWYgKHlpIDwgMCkgewogICAgICAgICAgeWkgPSAwOwogICAgICAgIH0KCiAgICAgICAgaWYgKHhpID49IGRhdGEubGVuZ3RoIC0gMSkgewogICAgICAgICAgeGkgPSBkYXRhLmxlbmd0aCAtIDE7CiAgICAgICAgfQoKICAgICAgICBpZiAoeWkgPj0gZGF0YVswXS5sZW5ndGggLSAxKSB7CiAgICAgICAgICB5aSA9IGRhdGFbMF0ubGVuZ3RoIC0gMTsKICAgICAgICB9CiAgICAgIH0gLy8gQmFpbCBvdXQgaWYgd2UgYXJlIG91dCBvZiB0aGUgdGVycmFpbgoKCiAgICAgIGlmICh4aSA8IDAgfHwgeWkgPCAwIHx8IHhpID49IGRhdGEubGVuZ3RoIC0gMSB8fCB5aSA+PSBkYXRhWzBdLmxlbmd0aCAtIDEpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGdldFRyaWFuZ2xlQXQoeCwgeSwgZWRnZUNsYW1wLCBhLCBiLCBjKSB7CiAgICAgIGNvbnN0IGlkeCA9IGdldEhlaWdodEF0X2lkeDsKICAgICAgdGhpcy5nZXRJbmRleE9mUG9zaXRpb24oeCwgeSwgaWR4LCBlZGdlQ2xhbXApOwogICAgICBsZXQgeGkgPSBpZHhbMF07CiAgICAgIGxldCB5aSA9IGlkeFsxXTsKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKCiAgICAgIGlmIChlZGdlQ2xhbXApIHsKICAgICAgICB4aSA9IE1hdGgubWluKGRhdGEubGVuZ3RoIC0gMiwgTWF0aC5tYXgoMCwgeGkpKTsKICAgICAgICB5aSA9IE1hdGgubWluKGRhdGFbMF0ubGVuZ3RoIC0gMiwgTWF0aC5tYXgoMCwgeWkpKTsKICAgICAgfQoKICAgICAgY29uc3QgZWxlbWVudFNpemUgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICBjb25zdCBsb3dlckRpc3QyID0gKHggLyBlbGVtZW50U2l6ZSAtIHhpKSAqKiAyICsgKHkgLyBlbGVtZW50U2l6ZSAtIHlpKSAqKiAyOwogICAgICBjb25zdCB1cHBlckRpc3QyID0gKHggLyBlbGVtZW50U2l6ZSAtICh4aSArIDEpKSAqKiAyICsgKHkgLyBlbGVtZW50U2l6ZSAtICh5aSArIDEpKSAqKiAyOwogICAgICBjb25zdCB1cHBlciA9IGxvd2VyRGlzdDIgPiB1cHBlckRpc3QyOwogICAgICB0aGlzLmdldFRyaWFuZ2xlKHhpLCB5aSwgdXBwZXIsIGEsIGIsIGMpOwogICAgICByZXR1cm4gdXBwZXI7CiAgICB9CgogICAgZ2V0Tm9ybWFsQXQoeCwgeSwgZWRnZUNsYW1wLCByZXN1bHQpIHsKICAgICAgY29uc3QgYSA9IGdldE5vcm1hbEF0X2E7CiAgICAgIGNvbnN0IGIgPSBnZXROb3JtYWxBdF9iOwogICAgICBjb25zdCBjID0gZ2V0Tm9ybWFsQXRfYzsKICAgICAgY29uc3QgZTAgPSBnZXROb3JtYWxBdF9lMDsKICAgICAgY29uc3QgZTEgPSBnZXROb3JtYWxBdF9lMTsKICAgICAgdGhpcy5nZXRUcmlhbmdsZUF0KHgsIHksIGVkZ2VDbGFtcCwgYSwgYiwgYyk7CiAgICAgIGIudnN1YihhLCBlMCk7CiAgICAgIGMudnN1YihhLCBlMSk7CiAgICAgIGUwLmNyb3NzKGUxLCByZXN1bHQpOwogICAgICByZXN1bHQubm9ybWFsaXplKCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBBQUJCIG9mIGEgc3F1YXJlIGluIHRoZSBoZWlnaHRmaWVsZAogICAgICogQHBhcmFtIHhpCiAgICAgKiBAcGFyYW0geWkKICAgICAqIEBwYXJhbSByZXN1bHQKICAgICAqLwoKCiAgICBnZXRBYWJiQXRJbmRleCh4aSwgeWksIF9yZWYpIHsKICAgICAgbGV0IHsKICAgICAgICBsb3dlckJvdW5kLAogICAgICAgIHVwcGVyQm91bmQKICAgICAgfSA9IF9yZWY7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IGVsZW1lbnRTaXplID0gdGhpcy5lbGVtZW50U2l6ZTsKICAgICAgbG93ZXJCb3VuZC5zZXQoeGkgKiBlbGVtZW50U2l6ZSwgeWkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWldKTsKICAgICAgdXBwZXJCb3VuZC5zZXQoKHhpICsgMSkgKiBlbGVtZW50U2l6ZSwgKHlpICsgMSkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aSArIDFdW3lpICsgMV0pOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGhlaWdodCBpbiB0aGUgaGVpZ2h0ZmllbGQgYXQgYSBnaXZlbiBwb3NpdGlvbgogICAgICovCgoKICAgIGdldEhlaWdodEF0KHgsIHksIGVkZ2VDbGFtcCkgewogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBjb25zdCBhID0gZ2V0SGVpZ2h0QXRfYTsKICAgICAgY29uc3QgYiA9IGdldEhlaWdodEF0X2I7CiAgICAgIGNvbnN0IGMgPSBnZXRIZWlnaHRBdF9jOwogICAgICBjb25zdCBpZHggPSBnZXRIZWlnaHRBdF9pZHg7CiAgICAgIHRoaXMuZ2V0SW5kZXhPZlBvc2l0aW9uKHgsIHksIGlkeCwgZWRnZUNsYW1wKTsKICAgICAgbGV0IHhpID0gaWR4WzBdOwogICAgICBsZXQgeWkgPSBpZHhbMV07CgogICAgICBpZiAoZWRnZUNsYW1wKSB7CiAgICAgICAgeGkgPSBNYXRoLm1pbihkYXRhLmxlbmd0aCAtIDIsIE1hdGgubWF4KDAsIHhpKSk7CiAgICAgICAgeWkgPSBNYXRoLm1pbihkYXRhWzBdLmxlbmd0aCAtIDIsIE1hdGgubWF4KDAsIHlpKSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHVwcGVyID0gdGhpcy5nZXRUcmlhbmdsZUF0KHgsIHksIGVkZ2VDbGFtcCwgYSwgYiwgYyk7CiAgICAgIGJhcnljZW50cmljV2VpZ2h0cyh4LCB5LCBhLngsIGEueSwgYi54LCBiLnksIGMueCwgYy55LCBnZXRIZWlnaHRBdF93ZWlnaHRzKTsKICAgICAgY29uc3QgdyA9IGdldEhlaWdodEF0X3dlaWdodHM7CgogICAgICBpZiAodXBwZXIpIHsKICAgICAgICAvLyBUb3AgdHJpYW5nbGUgdmVydHMKICAgICAgICByZXR1cm4gZGF0YVt4aSArIDFdW3lpICsgMV0gKiB3LnggKyBkYXRhW3hpXVt5aSArIDFdICogdy55ICsgZGF0YVt4aSArIDFdW3lpXSAqIHcuejsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBUb3AgdHJpYW5nbGUgdmVydHMKICAgICAgICByZXR1cm4gZGF0YVt4aV1beWldICogdy54ICsgZGF0YVt4aSArIDFdW3lpXSAqIHcueSArIGRhdGFbeGldW3lpICsgMV0gKiB3Lno7CiAgICAgIH0KICAgIH0KCiAgICBnZXRDYWNoZUNvbnZleFRyaWFuZ2xlUGlsbGFyS2V5KHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICByZXR1cm4gYCR7eGl9XyR7eWl9XyR7Z2V0VXBwZXJUcmlhbmdsZSA/IDEgOiAwfWA7CiAgICB9CgogICAgZ2V0Q2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlKSB7CiAgICAgIHJldHVybiB0aGlzLl9jYWNoZWRQaWxsYXJzW3RoaXMuZ2V0Q2FjaGVDb252ZXhUcmlhbmdsZVBpbGxhcktleSh4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUpXTsKICAgIH0KCiAgICBzZXRDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUsIGNvbnZleCwgb2Zmc2V0KSB7CiAgICAgIHRoaXMuX2NhY2hlZFBpbGxhcnNbdGhpcy5nZXRDYWNoZUNvbnZleFRyaWFuZ2xlUGlsbGFyS2V5KHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSldID0gewogICAgICAgIGNvbnZleCwKICAgICAgICBvZmZzZXQKICAgICAgfTsKICAgIH0KCiAgICBjbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICBkZWxldGUgdGhpcy5fY2FjaGVkUGlsbGFyc1t0aGlzLmdldENhY2hlQ29udmV4VHJpYW5nbGVQaWxsYXJLZXkoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlKV07CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIHRyaWFuZ2xlIGZyb20gdGhlIGhlaWdodGZpZWxkCiAgICAgKi8KCgogICAgZ2V0VHJpYW5nbGUoeGksIHlpLCB1cHBlciwgYSwgYiwgYykgewogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBjb25zdCBlbGVtZW50U2l6ZSA9IHRoaXMuZWxlbWVudFNpemU7CgogICAgICBpZiAodXBwZXIpIHsKICAgICAgICAvLyBUb3AgdHJpYW5nbGUgdmVydHMKICAgICAgICBhLnNldCgoeGkgKyAxKSAqIGVsZW1lbnRTaXplLCAoeWkgKyAxKSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpICsgMV1beWkgKyAxXSk7CiAgICAgICAgYi5zZXQoeGkgKiBlbGVtZW50U2l6ZSwgKHlpICsgMSkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWkgKyAxXSk7CiAgICAgICAgYy5zZXQoKHhpICsgMSkgKiBlbGVtZW50U2l6ZSwgeWkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aSArIDFdW3lpXSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gVG9wIHRyaWFuZ2xlIHZlcnRzCiAgICAgICAgYS5zZXQoeGkgKiBlbGVtZW50U2l6ZSwgeWkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWldKTsKICAgICAgICBiLnNldCgoeGkgKyAxKSAqIGVsZW1lbnRTaXplLCB5aSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpICsgMV1beWldKTsKICAgICAgICBjLnNldCh4aSAqIGVsZW1lbnRTaXplLCAoeWkgKyAxKSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpXVt5aSArIDFdKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYSB0cmlhbmdsZSBpbiB0aGUgdGVycmFpbiBpbiB0aGUgZm9ybSBvZiBhIHRyaWFuZ3VsYXIgY29udmV4IHNoYXBlLgogICAgICovCgoKICAgIGdldENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICBsZXQgcmVzdWx0ID0gdGhpcy5waWxsYXJDb252ZXg7CiAgICAgIGxldCBvZmZzZXRSZXN1bHQgPSB0aGlzLnBpbGxhck9mZnNldDsKCiAgICAgIGlmICh0aGlzLmNhY2hlRW5hYmxlZCkgewogICAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmdldENhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSk7CgogICAgICAgIGlmIChkYXRhKSB7CiAgICAgICAgICB0aGlzLnBpbGxhckNvbnZleCA9IGRhdGEuY29udmV4OwogICAgICAgICAgdGhpcy5waWxsYXJPZmZzZXQgPSBkYXRhLm9mZnNldDsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHJlc3VsdCA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKCk7CiAgICAgICAgb2Zmc2V0UmVzdWx0ID0gbmV3IFZlYzMoKTsKICAgICAgICB0aGlzLnBpbGxhckNvbnZleCA9IHJlc3VsdDsKICAgICAgICB0aGlzLnBpbGxhck9mZnNldCA9IG9mZnNldFJlc3VsdDsKICAgICAgfQoKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKICAgICAgY29uc3QgZWxlbWVudFNpemUgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICBjb25zdCBmYWNlcyA9IHJlc3VsdC5mYWNlczsgLy8gUmV1c2UgdmVydHMgaWYgcG9zc2libGUKCiAgICAgIHJlc3VsdC52ZXJ0aWNlcy5sZW5ndGggPSA2OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA2OyBpKyspIHsKICAgICAgICBpZiAoIXJlc3VsdC52ZXJ0aWNlc1tpXSkgewogICAgICAgICAgcmVzdWx0LnZlcnRpY2VzW2ldID0gbmV3IFZlYzMoKTsKICAgICAgICB9CiAgICAgIH0gLy8gUmV1c2UgZmFjZXMgaWYgcG9zc2libGUKCgogICAgICBmYWNlcy5sZW5ndGggPSA1OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA1OyBpKyspIHsKICAgICAgICBpZiAoIWZhY2VzW2ldKSB7CiAgICAgICAgICBmYWNlc1tpXSA9IFtdOwogICAgICAgIH0KICAgICAgfQoKICAgICAgY29uc3QgdmVydHMgPSByZXN1bHQudmVydGljZXM7CiAgICAgIGNvbnN0IGggPSAoTWF0aC5taW4oZGF0YVt4aV1beWldLCBkYXRhW3hpICsgMV1beWldLCBkYXRhW3hpXVt5aSArIDFdLCBkYXRhW3hpICsgMV1beWkgKyAxXSkgLSB0aGlzLm1pblZhbHVlKSAvIDIgKyB0aGlzLm1pblZhbHVlOwoKICAgICAgaWYgKCFnZXRVcHBlclRyaWFuZ2xlKSB7CiAgICAgICAgLy8gQ2VudGVyIG9mIHRoZSB0cmlhbmdsZSBwaWxsYXIgLSBhbGwgcG9seWdvbnMgYXJlIGdpdmVuIHJlbGF0aXZlIHRvIHRoaXMgb25lCiAgICAgICAgb2Zmc2V0UmVzdWx0LnNldCgoeGkgKyAwLjI1KSAqIGVsZW1lbnRTaXplLCAvLyBzb3J0IG9mIGNlbnRlciBvZiBhIHRyaWFuZ2xlCiAgICAgICAgKHlpICsgMC4yNSkgKiBlbGVtZW50U2l6ZSwgaCAvLyB2ZXJ0aWNhbCBjZW50ZXIKICAgICAgICApOyAvLyBUb3AgdHJpYW5nbGUgdmVydHMKCiAgICAgICAgdmVydHNbMF0uc2V0KC0wLjI1ICogZWxlbWVudFNpemUsIC0wLjI1ICogZWxlbWVudFNpemUsIGRhdGFbeGldW3lpXSAtIGgpOwogICAgICAgIHZlcnRzWzFdLnNldCgwLjc1ICogZWxlbWVudFNpemUsIC0wLjI1ICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aV0gLSBoKTsKICAgICAgICB2ZXJ0c1syXS5zZXQoLTAuMjUgKiBlbGVtZW50U2l6ZSwgMC43NSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpXVt5aSArIDFdIC0gaCk7IC8vIGJvdHRvbSB0cmlhbmdsZSB2ZXJ0cwoKICAgICAgICB2ZXJ0c1szXS5zZXQoLTAuMjUgKiBlbGVtZW50U2l6ZSwgLTAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNF0uc2V0KDAuNzUgKiBlbGVtZW50U2l6ZSwgLTAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNV0uc2V0KC0wLjI1ICogZWxlbWVudFNpemUsIDAuNzUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7IC8vIHRvcCB0cmlhbmdsZQoKICAgICAgICBmYWNlc1swXVswXSA9IDA7CiAgICAgICAgZmFjZXNbMF1bMV0gPSAxOwogICAgICAgIGZhY2VzWzBdWzJdID0gMjsgLy8gYm90dG9tIHRyaWFuZ2xlCgogICAgICAgIGZhY2VzWzFdWzBdID0gNTsKICAgICAgICBmYWNlc1sxXVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbMV1bMl0gPSAzOyAvLyAteCBmYWNpbmcgcXVhZAoKICAgICAgICBmYWNlc1syXVswXSA9IDA7CiAgICAgICAgZmFjZXNbMl1bMV0gPSAyOwogICAgICAgIGZhY2VzWzJdWzJdID0gNTsKICAgICAgICBmYWNlc1syXVszXSA9IDM7IC8vIC15IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzNdWzBdID0gMTsKICAgICAgICBmYWNlc1szXVsxXSA9IDA7CiAgICAgICAgZmFjZXNbM11bMl0gPSAzOwogICAgICAgIGZhY2VzWzNdWzNdID0gNDsgLy8gK3h5IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzRdWzBdID0gNDsKICAgICAgICBmYWNlc1s0XVsxXSA9IDU7CiAgICAgICAgZmFjZXNbNF1bMl0gPSAyOwogICAgICAgIGZhY2VzWzRdWzNdID0gMTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBDZW50ZXIgb2YgdGhlIHRyaWFuZ2xlIHBpbGxhciAtIGFsbCBwb2x5Z29ucyBhcmUgZ2l2ZW4gcmVsYXRpdmUgdG8gdGhpcyBvbmUKICAgICAgICBvZmZzZXRSZXN1bHQuc2V0KCh4aSArIDAuNzUpICogZWxlbWVudFNpemUsIC8vIHNvcnQgb2YgY2VudGVyIG9mIGEgdHJpYW5nbGUKICAgICAgICAoeWkgKyAwLjc1KSAqIGVsZW1lbnRTaXplLCBoIC8vIHZlcnRpY2FsIGNlbnRlcgogICAgICAgICk7IC8vIFRvcCB0cmlhbmdsZSB2ZXJ0cwoKICAgICAgICB2ZXJ0c1swXS5zZXQoMC4yNSAqIGVsZW1lbnRTaXplLCAwLjI1ICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aSArIDFdIC0gaCk7CiAgICAgICAgdmVydHNbMV0uc2V0KC0wLjc1ICogZWxlbWVudFNpemUsIDAuMjUgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWkgKyAxXSAtIGgpOwogICAgICAgIHZlcnRzWzJdLnNldCgwLjI1ICogZWxlbWVudFNpemUsIC0wLjc1ICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aV0gLSBoKTsgLy8gYm90dG9tIHRyaWFuZ2xlIHZlcnRzCgogICAgICAgIHZlcnRzWzNdLnNldCgwLjI1ICogZWxlbWVudFNpemUsIDAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNF0uc2V0KC0wLjc1ICogZWxlbWVudFNpemUsIDAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNV0uc2V0KDAuMjUgKiBlbGVtZW50U2l6ZSwgLTAuNzUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7IC8vIFRvcCB0cmlhbmdsZQoKICAgICAgICBmYWNlc1swXVswXSA9IDA7CiAgICAgICAgZmFjZXNbMF1bMV0gPSAxOwogICAgICAgIGZhY2VzWzBdWzJdID0gMjsgLy8gYm90dG9tIHRyaWFuZ2xlCgogICAgICAgIGZhY2VzWzFdWzBdID0gNTsKICAgICAgICBmYWNlc1sxXVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbMV1bMl0gPSAzOyAvLyAreCBmYWNpbmcgcXVhZAoKICAgICAgICBmYWNlc1syXVswXSA9IDI7CiAgICAgICAgZmFjZXNbMl1bMV0gPSA1OwogICAgICAgIGZhY2VzWzJdWzJdID0gMzsKICAgICAgICBmYWNlc1syXVszXSA9IDA7IC8vICt5IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzNdWzBdID0gMzsKICAgICAgICBmYWNlc1szXVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbM11bMl0gPSAxOwogICAgICAgIGZhY2VzWzNdWzNdID0gMDsgLy8gLXh5IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzRdWzBdID0gMTsKICAgICAgICBmYWNlc1s0XVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbNF1bMl0gPSA1OwogICAgICAgIGZhY2VzWzRdWzNdID0gMjsKICAgICAgfQoKICAgICAgcmVzdWx0LmNvbXB1dGVOb3JtYWxzKCk7CiAgICAgIHJlc3VsdC5jb21wdXRlRWRnZXMoKTsKICAgICAgcmVzdWx0LnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICAgIHRoaXMuc2V0Q2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlLCByZXN1bHQsIG9mZnNldFJlc3VsdCk7CiAgICB9CgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQuc2V0KDAsIDAsIDApOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQoKICAgIHZvbHVtZSgpIHsKICAgICAgcmV0dXJuICgvLyBUaGUgdGVycmFpbiBpcyBpbmZpbml0ZQogICAgICAgIE51bWJlci5NQVhfVkFMVUUKICAgICAgKTsKICAgIH0KCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICAvKiogQFRPRE8gZG8gaXQgcHJvcGVybHkgKi8KICAgICAgbWluLnNldCgtTnVtYmVyLk1BWF9WQUxVRSwgLU51bWJlci5NQVhfVkFMVUUsIC1OdW1iZXIuTUFYX1ZBTFVFKTsKICAgICAgbWF4LnNldChOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFKTsKICAgIH0KCiAgICB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIHsKICAgICAgLy8gVXNlIHRoZSBib3VuZGluZyBib3ggb2YgdGhlIG1pbi9tYXggdmFsdWVzCiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IHMgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gbmV3IFZlYzMoZGF0YS5sZW5ndGggKiBzLCBkYXRhWzBdLmxlbmd0aCAqIHMsIE1hdGgubWF4KE1hdGguYWJzKHRoaXMubWF4VmFsdWUpLCBNYXRoLmFicyh0aGlzLm1pblZhbHVlKSkpLmxlbmd0aCgpOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIHRoZSBoZWlnaHQgdmFsdWVzIGZyb20gYW4gaW1hZ2UuIEN1cnJlbnRseSBvbmx5IHN1cHBvcnRlZCBpbiBicm93c2VyLgogICAgICovCgoKICAgIHNldEhlaWdodHNGcm9tSW1hZ2UoaW1hZ2UsIHNjYWxlKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICB4LAogICAgICAgIHosCiAgICAgICAgeQogICAgICB9ID0gc2NhbGU7CiAgICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwogICAgICBjYW52YXMud2lkdGggPSBpbWFnZS53aWR0aDsKICAgICAgY2FudmFzLmhlaWdodCA9IGltYWdlLmhlaWdodDsKICAgICAgY29uc3QgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpOwogICAgICBjb250ZXh0LmRyYXdJbWFnZShpbWFnZSwgMCwgMCk7CiAgICAgIGNvbnN0IGltYWdlRGF0YSA9IGNvbnRleHQuZ2V0SW1hZ2VEYXRhKDAsIDAsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQpOwogICAgICBjb25zdCBtYXRyaXggPSB0aGlzLmRhdGE7CiAgICAgIG1hdHJpeC5sZW5ndGggPSAwOwogICAgICB0aGlzLmVsZW1lbnRTaXplID0gTWF0aC5hYnMoeCkgLyBpbWFnZURhdGEud2lkdGg7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGltYWdlRGF0YS5oZWlnaHQ7IGkrKykgewogICAgICAgIGNvbnN0IHJvdyA9IFtdOwoKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGltYWdlRGF0YS53aWR0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCBhID0gaW1hZ2VEYXRhLmRhdGFbKGkgKiBpbWFnZURhdGEuaGVpZ2h0ICsgaikgKiA0XTsKICAgICAgICAgIGNvbnN0IGIgPSBpbWFnZURhdGEuZGF0YVsoaSAqIGltYWdlRGF0YS5oZWlnaHQgKyBqKSAqIDQgKyAxXTsKICAgICAgICAgIGNvbnN0IGMgPSBpbWFnZURhdGEuZGF0YVsoaSAqIGltYWdlRGF0YS5oZWlnaHQgKyBqKSAqIDQgKyAyXTsKICAgICAgICAgIGNvbnN0IGhlaWdodCA9IChhICsgYiArIGMpIC8gNCAvIDI1NSAqIHo7CgogICAgICAgICAgaWYgKHggPCAwKSB7CiAgICAgICAgICAgIHJvdy5wdXNoKGhlaWdodCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByb3cudW5zaGlmdChoZWlnaHQpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHkgPCAwKSB7CiAgICAgICAgICBtYXRyaXgudW5zaGlmdChyb3cpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBtYXRyaXgucHVzaChyb3cpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy51cGRhdGVNYXhWYWx1ZSgpOwogICAgICB0aGlzLnVwZGF0ZU1pblZhbHVlKCk7CiAgICAgIHRoaXMudXBkYXRlKCk7CiAgICB9CgogIH0KICBjb25zdCBnZXRIZWlnaHRBdF9pZHggPSBbXTsKICBjb25zdCBnZXRIZWlnaHRBdF93ZWlnaHRzID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXRIZWlnaHRBdF9hID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXRIZWlnaHRBdF9iID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXRIZWlnaHRBdF9jID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9hID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9iID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9jID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9lMCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0Tm9ybWFsQXRfZTEgPSBuZXcgVmVjMygpOyAvLyBmcm9tIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0JhcnljZW50cmljX2Nvb3JkaW5hdGVfc3lzdGVtCgogIGZ1bmN0aW9uIGJhcnljZW50cmljV2VpZ2h0cyh4LCB5LCBheCwgYXksIGJ4LCBieSwgY3gsIGN5LCByZXN1bHQpIHsKICAgIHJlc3VsdC54ID0gKChieSAtIGN5KSAqICh4IC0gY3gpICsgKGN4IC0gYngpICogKHkgLSBjeSkpIC8gKChieSAtIGN5KSAqIChheCAtIGN4KSArIChjeCAtIGJ4KSAqIChheSAtIGN5KSk7CiAgICByZXN1bHQueSA9ICgoY3kgLSBheSkgKiAoeCAtIGN4KSArIChheCAtIGN4KSAqICh5IC0gY3kpKSAvICgoYnkgLSBjeSkgKiAoYXggLSBjeCkgKyAoY3ggLSBieCkgKiAoYXkgLSBjeSkpOwogICAgcmVzdWx0LnogPSAxIC0gcmVzdWx0LnggLSByZXN1bHQueTsKICB9CgogIC8qKgogICAqIE9jdHJlZU5vZGUKICAgKi8KICBjbGFzcyBPY3RyZWVOb2RlIHsKICAgIC8qKiBUaGUgcm9vdCBub2RlICovCgogICAgLyoqIEJvdW5kYXJ5IG9mIHRoaXMgbm9kZSAqLwoKICAgIC8qKiBDb250YWluZWQgZGF0YSBhdCB0aGUgY3VycmVudCBub2RlIGxldmVsICovCgogICAgLyoqIENoaWxkcmVuIHRvIHRoaXMgbm9kZSAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLnJvb3QgPSBvcHRpb25zLnJvb3QgfHwgbnVsbDsKICAgICAgdGhpcy5hYWJiID0gb3B0aW9ucy5hYWJiID8gb3B0aW9ucy5hYWJiLmNsb25lKCkgOiBuZXcgQUFCQigpOwogICAgICB0aGlzLmRhdGEgPSBbXTsKICAgICAgdGhpcy5jaGlsZHJlbiA9IFtdOwogICAgfQogICAgLyoqCiAgICAgKiByZXNldAogICAgICovCgoKICAgIHJlc2V0KCkgewogICAgICB0aGlzLmNoaWxkcmVuLmxlbmd0aCA9IHRoaXMuZGF0YS5sZW5ndGggPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBJbnNlcnQgZGF0YSBpbnRvIHRoaXMgbm9kZQogICAgICogQHJldHVybiBUcnVlIGlmIHN1Y2Nlc3NmdWwsIG90aGVyd2lzZSBmYWxzZQogICAgICovCgoKICAgIGluc2VydChhYWJiLCBlbGVtZW50RGF0YSwgbGV2ZWwpIHsKICAgICAgaWYgKGxldmVsID09PSB2b2lkIDApIHsKICAgICAgICBsZXZlbCA9IDA7CiAgICAgIH0KCiAgICAgIGNvbnN0IG5vZGVEYXRhID0gdGhpcy5kYXRhOyAvLyBJZ25vcmUgb2JqZWN0cyB0aGF0IGRvIG5vdCBiZWxvbmcgaW4gdGhpcyBub2RlCgogICAgICBpZiAoIXRoaXMuYWFiYi5jb250YWlucyhhYWJiKSkgewogICAgICAgIHJldHVybiBmYWxzZTsgLy8gb2JqZWN0IGNhbm5vdCBiZSBhZGRlZAogICAgICB9CgogICAgICBjb25zdCBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47CiAgICAgIGNvbnN0IG1heERlcHRoID0gdGhpcy5tYXhEZXB0aCB8fCB0aGlzLnJvb3QubWF4RGVwdGg7CgogICAgICBpZiAobGV2ZWwgPCBtYXhEZXB0aCkgewogICAgICAgIC8vIFN1YmRpdmlkZSBpZiB0aGVyZSBhcmUgbm8gY2hpbGRyZW4geWV0CiAgICAgICAgbGV0IHN1YmRpdmlkZWQgPSBmYWxzZTsKCiAgICAgICAgaWYgKCFjaGlsZHJlbi5sZW5ndGgpIHsKICAgICAgICAgIHRoaXMuc3ViZGl2aWRlKCk7CiAgICAgICAgICBzdWJkaXZpZGVkID0gdHJ1ZTsKICAgICAgICB9IC8vIGFkZCB0byB3aGljaGV2ZXIgbm9kZSB3aWxsIGFjY2VwdCBpdAoKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgICAgaWYgKGNoaWxkcmVuW2ldLmluc2VydChhYWJiLCBlbGVtZW50RGF0YSwgbGV2ZWwgKyAxKSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChzdWJkaXZpZGVkKSB7CiAgICAgICAgICAvLyBObyBjaGlsZHJlbiBhY2NlcHRlZCEgTWlnaHQgYXMgd2VsbCBqdXN0IHJlbW92ZSBlbSBzaW5jZSB0aGV5IGNvbnRhaW4gbm9uZQogICAgICAgICAgY2hpbGRyZW4ubGVuZ3RoID0gMDsKICAgICAgICB9CiAgICAgIH0gLy8gVG9vIGRlZXAsIG9yIGNoaWxkcmVuIGRpZG50IHdhbnQgaXQuIGFkZCBpdCBpbiBjdXJyZW50IG5vZGUKCgogICAgICBub2RlRGF0YS5wdXNoKGVsZW1lbnREYXRhKTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIENyZWF0ZSA4IGVxdWFsbHkgc2l6ZWQgY2hpbGRyZW4gbm9kZXMgYW5kIHB1dCB0aGVtIGluIHRoZSBgY2hpbGRyZW5gIGFycmF5LgogICAgICovCgoKICAgIHN1YmRpdmlkZSgpIHsKICAgICAgY29uc3QgYWFiYiA9IHRoaXMuYWFiYjsKICAgICAgY29uc3QgbCA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdSA9IGFhYmIudXBwZXJCb3VuZDsKICAgICAgY29uc3QgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuOwogICAgICBjaGlsZHJlbi5wdXNoKG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygwLCAwLCAwKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMSwgMCwgMCkKICAgICAgICB9KQogICAgICB9KSwgbmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDEsIDEsIDApCiAgICAgICAgfSkKICAgICAgfSksIG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygxLCAxLCAxKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMCwgMSwgMSkKICAgICAgICB9KQogICAgICB9KSwgbmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDAsIDAsIDEpCiAgICAgICAgfSkKICAgICAgfSksIG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygxLCAwLCAxKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMCwgMSwgMCkKICAgICAgICB9KQogICAgICB9KSk7CiAgICAgIHUudnN1YihsLCBoYWxmRGlhZ29uYWwpOwogICAgICBoYWxmRGlhZ29uYWwuc2NhbGUoMC41LCBoYWxmRGlhZ29uYWwpOwogICAgICBjb25zdCByb290ID0gdGhpcy5yb290IHx8IHRoaXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gODsgaSsrKSB7CiAgICAgICAgY29uc3QgY2hpbGQgPSBjaGlsZHJlbltpXTsgLy8gU2V0IGN1cnJlbnQgbm9kZSBhcyByb290CgogICAgICAgIGNoaWxkLnJvb3QgPSByb290OyAvLyBDb21wdXRlIGJvdW5kcwoKICAgICAgICBjb25zdCBsb3dlckJvdW5kID0gY2hpbGQuYWFiYi5sb3dlckJvdW5kOwogICAgICAgIGxvd2VyQm91bmQueCAqPSBoYWxmRGlhZ29uYWwueDsKICAgICAgICBsb3dlckJvdW5kLnkgKj0gaGFsZkRpYWdvbmFsLnk7CiAgICAgICAgbG93ZXJCb3VuZC56ICo9IGhhbGZEaWFnb25hbC56OwogICAgICAgIGxvd2VyQm91bmQudmFkZChsLCBsb3dlckJvdW5kKTsgLy8gVXBwZXIgYm91bmQgaXMgYWx3YXlzIGxvd2VyIGJvdW5kICsgaGFsZkRpYWdvbmFsCgogICAgICAgIGxvd2VyQm91bmQudmFkZChoYWxmRGlhZ29uYWwsIGNoaWxkLmFhYmIudXBwZXJCb3VuZCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogR2V0IGFsbCBkYXRhLCBwb3RlbnRpYWxseSB3aXRoaW4gYW4gQUFCQgogICAgICogQHJldHVybiBUaGUgInJlc3VsdCIgb2JqZWN0CiAgICAgKi8KCgogICAgYWFiYlF1ZXJ5KGFhYmIsIHJlc3VsdCkgewogICAgICB0aGlzLmRhdGE7IC8vIGFib3J0IGlmIHRoZSByYW5nZSBkb2VzIG5vdCBpbnRlcnNlY3QgdGhpcyBub2RlCiAgICAgIC8vIGlmICghdGhpcy5hYWJiLm92ZXJsYXBzKGFhYmIpKXsKICAgICAgLy8gICAgIHJldHVybiByZXN1bHQ7CiAgICAgIC8vIH0KICAgICAgLy8gQWRkIG9iamVjdHMgYXQgdGhpcyBsZXZlbAogICAgICAvLyBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShyZXN1bHQsIG5vZGVEYXRhKTsKICAgICAgLy8gQWRkIGNoaWxkIGRhdGEKICAgICAgLy8gQHRvZG8gdW53cmFwIHJlY3Vyc2lvbiBpbnRvIGEgcXVldWUgLyBsb29wLCB0aGF0J3MgZmFzdGVyIGluIEpTCgogICAgICB0aGlzLmNoaWxkcmVuOyAvLyBmb3IgKGxldCBpID0gMCwgTiA9IHRoaXMuY2hpbGRyZW4ubGVuZ3RoOyBpICE9PSBOOyBpKyspIHsKICAgICAgLy8gICAgIGNoaWxkcmVuW2ldLmFhYmJRdWVyeShhYWJiLCByZXN1bHQpOwogICAgICAvLyB9CgogICAgICBjb25zdCBxdWV1ZSA9IFt0aGlzXTsKCiAgICAgIHdoaWxlIChxdWV1ZS5sZW5ndGgpIHsKICAgICAgICBjb25zdCBub2RlID0gcXVldWUucG9wKCk7CgogICAgICAgIGlmIChub2RlLmFhYmIub3ZlcmxhcHMoYWFiYikpIHsKICAgICAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KHJlc3VsdCwgbm9kZS5kYXRhKTsKICAgICAgICB9CgogICAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KHF1ZXVlLCBub2RlLmNoaWxkcmVuKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFsbCBkYXRhLCBwb3RlbnRpYWxseSBpbnRlcnNlY3RlZCBieSBhIHJheS4KICAgICAqIEByZXR1cm4gVGhlICJyZXN1bHQiIG9iamVjdAogICAgICovCgoKICAgIHJheVF1ZXJ5KHJheSwgdHJlZVRyYW5zZm9ybSwgcmVzdWx0KSB7CiAgICAgIC8vIFVzZSBhYWJiIHF1ZXJ5IGZvciBub3cuCgogICAgICAvKiogQHRvZG8gaW1wbGVtZW50IHJlYWwgcmF5IHF1ZXJ5IHdoaWNoIG5lZWRzIGxlc3MgbG9va3VwcyAqLwogICAgICByYXkuZ2V0QUFCQih0bXBBQUJCKTsKICAgICAgdG1wQUFCQi50b0xvY2FsRnJhbWUodHJlZVRyYW5zZm9ybSwgdG1wQUFCQik7CiAgICAgIHRoaXMuYWFiYlF1ZXJ5KHRtcEFBQkIsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHJlbW92ZUVtcHR5Tm9kZXMKICAgICAqLwoKCiAgICByZW1vdmVFbXB0eU5vZGVzKCkgewogICAgICBmb3IgKGxldCBpID0gdGhpcy5jaGlsZHJlbi5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgIHRoaXMuY2hpbGRyZW5baV0ucmVtb3ZlRW1wdHlOb2RlcygpOwoKICAgICAgICBpZiAoIXRoaXMuY2hpbGRyZW5baV0uY2hpbGRyZW4ubGVuZ3RoICYmICF0aGlzLmNoaWxkcmVuW2ldLmRhdGEubGVuZ3RoKSB7CiAgICAgICAgICB0aGlzLmNoaWxkcmVuLnNwbGljZShpLCAxKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgfQogIC8qKgogICAqIE9jdHJlZQogICAqLwoKCiAgY2xhc3MgT2N0cmVlIGV4dGVuZHMgT2N0cmVlTm9kZSB7CiAgICAvKioKICAgICAqIE1heGltdW0gc3ViZGl2aXNpb24gZGVwdGgKICAgICAqIEBkZWZhdWx0IDgKICAgICAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIGFhYmIgVGhlIHRvdGFsIEFBQkIgb2YgdGhlIHRyZWUKICAgICAqLwogICAgY29uc3RydWN0b3IoYWFiYiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBzdXBlcih7CiAgICAgICAgcm9vdDogbnVsbCwKICAgICAgICBhYWJiCiAgICAgIH0pOwogICAgICB0aGlzLm1heERlcHRoID0gdHlwZW9mIG9wdGlvbnMubWF4RGVwdGggIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5tYXhEZXB0aCA6IDg7CiAgICB9CgogIH0KICBjb25zdCBoYWxmRGlhZ29uYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcEFBQkIgPSBuZXcgQUFCQigpOwoKICAvKioKICAgKiBUcmltZXNoLgogICAqIEBleGFtcGxlCiAgICogICAgIC8vIEhvdyB0byBtYWtlIGEgbWVzaCB3aXRoIGEgc2luZ2xlIHRyaWFuZ2xlCiAgICogICAgIGNvbnN0IHZlcnRpY2VzID0gWwogICAqICAgICAgICAgMCwgMCwgMCwgLy8gdmVydGV4IDAKICAgKiAgICAgICAgIDEsIDAsIDAsIC8vIHZlcnRleCAxCiAgICogICAgICAgICAwLCAxLCAwICAvLyB2ZXJ0ZXggMgogICAqICAgICBdCiAgICogICAgIGNvbnN0IGluZGljZXMgPSBbCiAgICogICAgICAgICAwLCAxLCAyICAvLyB0cmlhbmdsZSAwCiAgICogICAgIF0KICAgKiAgICAgY29uc3QgdHJpbWVzaFNoYXBlID0gbmV3IENBTk5PTi5UcmltZXNoKHZlcnRpY2VzLCBpbmRpY2VzKQogICAqLwogIGNsYXNzIFRyaW1lc2ggZXh0ZW5kcyBTaGFwZSB7CiAgICAvKioKICAgICAqIHZlcnRpY2VzCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFycmF5IG9mIGludGVnZXJzLCBpbmRpY2F0aW5nIHdoaWNoIHZlcnRpY2VzIGVhY2ggdHJpYW5nbGUgY29uc2lzdHMgb2YuIFRoZSBsZW5ndGggb2YgdGhpcyBhcnJheSBpcyB0aHVzIDMgdGltZXMgdGhlIG51bWJlciBvZiB0cmlhbmdsZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBub3JtYWxzIGRhdGEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBsb2NhbCBBQUJCIG9mIHRoZSBtZXNoLgogICAgICovCgogICAgLyoqCiAgICAgKiBSZWZlcmVuY2VzIHRvIHZlcnRleCBwYWlycywgbWFraW5nIHVwIGFsbCB1bmlxdWUgZWRnZXMgaW4gdGhlIHRyaW1lc2guCiAgICAgKi8KCiAgICAvKioKICAgICAqIExvY2FsIHNjYWxpbmcgb2YgdGhlIG1lc2guIFVzZSAuc2V0U2NhbGUoKSB0byBzZXQgaXQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBpbmRleGVkIHRyaWFuZ2xlcy4gVXNlIC51cGRhdGVUcmVlKCkgdG8gdXBkYXRlIGl0LgogICAgICovCiAgICBjb25zdHJ1Y3Rvcih2ZXJ0aWNlcywgaW5kaWNlcykgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuVFJJTUVTSAogICAgICB9KTsKICAgICAgdGhpcy52ZXJ0aWNlcyA9IG5ldyBGbG9hdDMyQXJyYXkodmVydGljZXMpOwogICAgICB0aGlzLmluZGljZXMgPSBuZXcgSW50MTZBcnJheShpbmRpY2VzKTsKICAgICAgdGhpcy5ub3JtYWxzID0gbmV3IEZsb2F0MzJBcnJheShpbmRpY2VzLmxlbmd0aCk7CiAgICAgIHRoaXMuYWFiYiA9IG5ldyBBQUJCKCk7CiAgICAgIHRoaXMuZWRnZXMgPSBudWxsOwogICAgICB0aGlzLnNjYWxlID0gbmV3IFZlYzMoMSwgMSwgMSk7CiAgICAgIHRoaXMudHJlZSA9IG5ldyBPY3RyZWUoKTsKICAgICAgdGhpcy51cGRhdGVFZGdlcygpOwogICAgICB0aGlzLnVwZGF0ZU5vcm1hbHMoKTsKICAgICAgdGhpcy51cGRhdGVBQUJCKCk7CiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKTsKICAgICAgdGhpcy51cGRhdGVUcmVlKCk7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZVRyZWUKICAgICAqLwoKCiAgICB1cGRhdGVUcmVlKCkgewogICAgICBjb25zdCB0cmVlID0gdGhpcy50cmVlOwogICAgICB0cmVlLnJlc2V0KCk7CiAgICAgIHRyZWUuYWFiYi5jb3B5KHRoaXMuYWFiYik7CiAgICAgIGNvbnN0IHNjYWxlID0gdGhpcy5zY2FsZTsgLy8gVGhlIGxvY2FsIG1lc2ggQUFCQiBpcyBzY2FsZWQsIGJ1dCB0aGUgb2N0cmVlIEFBQkIgc2hvdWxkIGJlIHVuc2NhbGVkCgogICAgICB0cmVlLmFhYmIubG93ZXJCb3VuZC54ICo9IDEgLyBzY2FsZS54OwogICAgICB0cmVlLmFhYmIubG93ZXJCb3VuZC55ICo9IDEgLyBzY2FsZS55OwogICAgICB0cmVlLmFhYmIubG93ZXJCb3VuZC56ICo9IDEgLyBzY2FsZS56OwogICAgICB0cmVlLmFhYmIudXBwZXJCb3VuZC54ICo9IDEgLyBzY2FsZS54OwogICAgICB0cmVlLmFhYmIudXBwZXJCb3VuZC55ICo9IDEgLyBzY2FsZS55OwogICAgICB0cmVlLmFhYmIudXBwZXJCb3VuZC56ICo9IDEgLyBzY2FsZS56OyAvLyBJbnNlcnQgYWxsIHRyaWFuZ2xlcwoKICAgICAgY29uc3QgdHJpYW5nbGVBQUJCID0gbmV3IEFBQkIoKTsKICAgICAgY29uc3QgYSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGIgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBjID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcG9pbnRzID0gW2EsIGIsIGNdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgLy90aGlzLmdldFRyaWFuZ2xlVmVydGljZXMoaSwgYSwgYiwgYyk7CiAgICAgICAgLy8gR2V0IHVuc2NhbGVkIHRyaWFuZ2xlIHZlcnRzCiAgICAgICAgY29uc3QgaTMgPSBpICogMzsKCiAgICAgICAgdGhpcy5fZ2V0VW5zY2FsZWRWZXJ0ZXgodGhpcy5pbmRpY2VzW2kzXSwgYSk7CgogICAgICAgIHRoaXMuX2dldFVuc2NhbGVkVmVydGV4KHRoaXMuaW5kaWNlc1tpMyArIDFdLCBiKTsKCiAgICAgICAgdGhpcy5fZ2V0VW5zY2FsZWRWZXJ0ZXgodGhpcy5pbmRpY2VzW2kzICsgMl0sIGMpOwoKICAgICAgICB0cmlhbmdsZUFBQkIuc2V0RnJvbVBvaW50cyhwb2ludHMpOwogICAgICAgIHRyZWUuaW5zZXJ0KHRyaWFuZ2xlQUFCQiwgaSk7CiAgICAgIH0KCiAgICAgIHRyZWUucmVtb3ZlRW1wdHlOb2RlcygpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdHJpYW5nbGVzIGluIGEgbG9jYWwgQUFCQiBmcm9tIHRoZSB0cmltZXNoLgogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSBvZiBpbnRlZ2VycywgcmVmZXJlbmNpbmcgdGhlIHF1ZXJpZWQgdHJpYW5nbGVzLgogICAgICovCgoKICAgIGdldFRyaWFuZ2xlc0luQUFCQihhYWJiLCByZXN1bHQpIHsKICAgICAgdW5zY2FsZWRBQUJCLmNvcHkoYWFiYik7IC8vIFNjYWxlIGl0IHRvIGxvY2FsCgogICAgICBjb25zdCBzY2FsZSA9IHRoaXMuc2NhbGU7CiAgICAgIGNvbnN0IGlzeCA9IHNjYWxlLng7CiAgICAgIGNvbnN0IGlzeSA9IHNjYWxlLnk7CiAgICAgIGNvbnN0IGlzeiA9IHNjYWxlLno7CiAgICAgIGNvbnN0IGwgPSB1bnNjYWxlZEFBQkIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdSA9IHVuc2NhbGVkQUFCQi51cHBlckJvdW5kOwogICAgICBsLnggLz0gaXN4OwogICAgICBsLnkgLz0gaXN5OwogICAgICBsLnogLz0gaXN6OwogICAgICB1LnggLz0gaXN4OwogICAgICB1LnkgLz0gaXN5OwogICAgICB1LnogLz0gaXN6OwogICAgICByZXR1cm4gdGhpcy50cmVlLmFhYmJRdWVyeSh1bnNjYWxlZEFBQkIsIHJlc3VsdCk7CiAgICB9CiAgICAvKioKICAgICAqIHNldFNjYWxlCiAgICAgKi8KCgogICAgc2V0U2NhbGUoc2NhbGUpIHsKICAgICAgY29uc3Qgd2FzVW5pZm9ybSA9IHRoaXMuc2NhbGUueCA9PT0gdGhpcy5zY2FsZS55ICYmIHRoaXMuc2NhbGUueSA9PT0gdGhpcy5zY2FsZS56OwogICAgICBjb25zdCBpc1VuaWZvcm0gPSBzY2FsZS54ID09PSBzY2FsZS55ICYmIHNjYWxlLnkgPT09IHNjYWxlLno7CgogICAgICBpZiAoISh3YXNVbmlmb3JtICYmIGlzVW5pZm9ybSkpIHsKICAgICAgICAvLyBOb24tdW5pZm9ybSBzY2FsaW5nLiBOZWVkIHRvIHVwZGF0ZSBub3JtYWxzLgogICAgICAgIHRoaXMudXBkYXRlTm9ybWFscygpOwogICAgICB9CgogICAgICB0aGlzLnNjYWxlLmNvcHkoc2NhbGUpOwogICAgICB0aGlzLnVwZGF0ZUFBQkIoKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlIHRoZSBub3JtYWxzIG9mIHRoZSBmYWNlcy4gV2lsbCBzYXZlIGluIHRoZSBgLm5vcm1hbHNgIGFycmF5LgogICAgICovCgoKICAgIHVwZGF0ZU5vcm1hbHMoKSB7CiAgICAgIGNvbnN0IG4gPSBjb21wdXRlTm9ybWFsc19uOyAvLyBHZW5lcmF0ZSBub3JtYWxzCgogICAgICBjb25zdCBub3JtYWxzID0gdGhpcy5ub3JtYWxzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgY29uc3QgaTMgPSBpICogMzsKICAgICAgICBjb25zdCBhID0gdGhpcy5pbmRpY2VzW2kzXTsKICAgICAgICBjb25zdCBiID0gdGhpcy5pbmRpY2VzW2kzICsgMV07CiAgICAgICAgY29uc3QgYyA9IHRoaXMuaW5kaWNlc1tpMyArIDJdOwogICAgICAgIHRoaXMuZ2V0VmVydGV4KGEsIHZhKTsKICAgICAgICB0aGlzLmdldFZlcnRleChiLCB2Yik7CiAgICAgICAgdGhpcy5nZXRWZXJ0ZXgoYywgdmMpOwogICAgICAgIFRyaW1lc2guY29tcHV0ZU5vcm1hbCh2YiwgdmEsIHZjLCBuKTsKICAgICAgICBub3JtYWxzW2kzXSA9IG4ueDsKICAgICAgICBub3JtYWxzW2kzICsgMV0gPSBuLnk7CiAgICAgICAgbm9ybWFsc1tpMyArIDJdID0gbi56OwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSB0aGUgYC5lZGdlc2AgcHJvcGVydHkKICAgICAqLwoKCiAgICB1cGRhdGVFZGdlcygpIHsKICAgICAgY29uc3QgZWRnZXMgPSB7fTsKCiAgICAgIGNvbnN0IGFkZCA9IChhLCBiKSA9PiB7CiAgICAgICAgY29uc3Qga2V5ID0gYSA8IGIgPyBgJHthfV8ke2J9YCA6IGAke2J9XyR7YX1gOwogICAgICAgIGVkZ2VzW2tleV0gPSB0cnVlOwogICAgICB9OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgY29uc3QgaTMgPSBpICogMzsKICAgICAgICBjb25zdCBhID0gdGhpcy5pbmRpY2VzW2kzXTsKICAgICAgICBjb25zdCBiID0gdGhpcy5pbmRpY2VzW2kzICsgMV07CiAgICAgICAgY29uc3QgYyA9IHRoaXMuaW5kaWNlc1tpMyArIDJdOwogICAgICAgIGFkZChhLCBiKTsKICAgICAgICBhZGQoYiwgYyk7CiAgICAgICAgYWRkKGMsIGEpOwogICAgICB9CgogICAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMoZWRnZXMpOwogICAgICB0aGlzLmVkZ2VzID0gbmV3IEludDE2QXJyYXkoa2V5cy5sZW5ndGggKiAyKTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGluZGljZXMgPSBrZXlzW2ldLnNwbGl0KCdfJyk7CiAgICAgICAgdGhpcy5lZGdlc1syICogaV0gPSBwYXJzZUludChpbmRpY2VzWzBdLCAxMCk7CiAgICAgICAgdGhpcy5lZGdlc1syICogaSArIDFdID0gcGFyc2VJbnQoaW5kaWNlc1sxXSwgMTApOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBlZGdlIHZlcnRleAogICAgICogQHBhcmFtIGZpcnN0T3JTZWNvbmQgMCBvciAxLCBkZXBlbmRpbmcgb24gd2hpY2ggb25lIG9mIHRoZSB2ZXJ0aWNlcyB5b3UgbmVlZC4KICAgICAqIEBwYXJhbSB2ZXJ0ZXhTdG9yZSBXaGVyZSB0byBzdG9yZSB0aGUgcmVzdWx0CiAgICAgKi8KCgogICAgZ2V0RWRnZVZlcnRleChlZGdlSW5kZXgsIGZpcnN0T3JTZWNvbmQsIHZlcnRleFN0b3JlKSB7CiAgICAgIGNvbnN0IHZlcnRleEluZGV4ID0gdGhpcy5lZGdlc1tlZGdlSW5kZXggKiAyICsgKGZpcnN0T3JTZWNvbmQgPyAxIDogMCldOwogICAgICB0aGlzLmdldFZlcnRleCh2ZXJ0ZXhJbmRleCwgdmVydGV4U3RvcmUpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYSB2ZWN0b3IgYWxvbmcgYW4gZWRnZS4KICAgICAqLwoKCiAgICBnZXRFZGdlVmVjdG9yKGVkZ2VJbmRleCwgdmVjdG9yU3RvcmUpIHsKICAgICAgY29uc3QgdmEgPSBnZXRFZGdlVmVjdG9yX3ZhOwogICAgICBjb25zdCB2YiA9IGdldEVkZ2VWZWN0b3JfdmI7CiAgICAgIHRoaXMuZ2V0RWRnZVZlcnRleChlZGdlSW5kZXgsIDAsIHZhKTsKICAgICAgdGhpcy5nZXRFZGdlVmVydGV4KGVkZ2VJbmRleCwgMSwgdmIpOwogICAgICB2Yi52c3ViKHZhLCB2ZWN0b3JTdG9yZSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBmYWNlIG5vcm1hbCBnaXZlbiAzIHZlcnRpY2VzCiAgICAgKi8KCgogICAgc3RhdGljIGNvbXB1dGVOb3JtYWwodmEsIHZiLCB2YywgdGFyZ2V0KSB7CiAgICAgIHZiLnZzdWIodmEsIGFiKTsKICAgICAgdmMudnN1Yih2YiwgY2IpOwogICAgICBjYi5jcm9zcyhhYiwgdGFyZ2V0KTsKCiAgICAgIGlmICghdGFyZ2V0LmlzWmVybygpKSB7CiAgICAgICAgdGFyZ2V0Lm5vcm1hbGl6ZSgpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCB2ZXJ0ZXggaS4KICAgICAqIEByZXR1cm4gVGhlICJvdXQiIHZlY3RvciBvYmplY3QKICAgICAqLwoKCiAgICBnZXRWZXJ0ZXgoaSwgb3V0KSB7CiAgICAgIGNvbnN0IHNjYWxlID0gdGhpcy5zY2FsZTsKCiAgICAgIHRoaXMuX2dldFVuc2NhbGVkVmVydGV4KGksIG91dCk7CgogICAgICBvdXQueCAqPSBzY2FsZS54OwogICAgICBvdXQueSAqPSBzY2FsZS55OwogICAgICBvdXQueiAqPSBzY2FsZS56OwogICAgICByZXR1cm4gb3V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgcmF3IHZlcnRleCBpCiAgICAgKiBAcmV0dXJuIFRoZSAib3V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgX2dldFVuc2NhbGVkVmVydGV4KGksIG91dCkgewogICAgICBjb25zdCBpMyA9IGkgKiAzOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIHJldHVybiBvdXQuc2V0KHZlcnRpY2VzW2kzXSwgdmVydGljZXNbaTMgKyAxXSwgdmVydGljZXNbaTMgKyAyXSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIHZlcnRleCBmcm9tIHRoZSB0cmltZXNoLHRyYW5zZm9ybWVkIGJ5IHRoZSBnaXZlbiBwb3NpdGlvbiBhbmQgcXVhdGVybmlvbi4KICAgICAqIEByZXR1cm4gVGhlICJvdXQiIHZlY3RvciBvYmplY3QKICAgICAqLwoKCiAgICBnZXRXb3JsZFZlcnRleChpLCBwb3MsIHF1YXQsIG91dCkgewogICAgICB0aGlzLmdldFZlcnRleChpLCBvdXQpOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUocG9zLCBxdWF0LCBvdXQsIG91dCk7CiAgICAgIHJldHVybiBvdXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgdGhyZWUgdmVydGljZXMgZm9yIHRyaWFuZ2xlIGkuCiAgICAgKi8KCgogICAgZ2V0VHJpYW5nbGVWZXJ0aWNlcyhpLCBhLCBiLCBjKSB7CiAgICAgIGNvbnN0IGkzID0gaSAqIDM7CiAgICAgIHRoaXMuZ2V0VmVydGV4KHRoaXMuaW5kaWNlc1tpM10sIGEpOwogICAgICB0aGlzLmdldFZlcnRleCh0aGlzLmluZGljZXNbaTMgKyAxXSwgYik7CiAgICAgIHRoaXMuZ2V0VmVydGV4KHRoaXMuaW5kaWNlc1tpMyArIDJdLCBjKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbm9ybWFsIG9mIHRyaWFuZ2xlIGkuCiAgICAgKiBAcmV0dXJuIFRoZSAidGFyZ2V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgZ2V0Tm9ybWFsKGksIHRhcmdldCkgewogICAgICBjb25zdCBpMyA9IGkgKiAzOwogICAgICByZXR1cm4gdGFyZ2V0LnNldCh0aGlzLm5vcm1hbHNbaTNdLCB0aGlzLm5vcm1hbHNbaTMgKyAxXSwgdGhpcy5ub3JtYWxzW2kzICsgMl0pOwogICAgfQogICAgLyoqCiAgICAgKiBAcmV0dXJuIFRoZSAidGFyZ2V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICAvLyBBcHByb3hpbWF0ZSB3aXRoIGJveCBpbmVydGlhCiAgICAgIC8vIEV4YWN0IGluZXJ0aWEgY2FsY3VsYXRpb24gaXMgb3ZlcmtpbGwsIGJ1dCBzZWUgaHR0cDovL2dlb21ldHJpY3Rvb2xzLmNvbS9Eb2N1bWVudGF0aW9uL1BvbHloZWRyYWxNYXNzUHJvcGVydGllcy5wZGYgZm9yIHRoZSBjb3JyZWN0IHdheSB0byBkbyBpdAogICAgICB0aGlzLmNvbXB1dGVMb2NhbEFBQkIoY2xpX2FhYmIpOwogICAgICBjb25zdCB4ID0gY2xpX2FhYmIudXBwZXJCb3VuZC54IC0gY2xpX2FhYmIubG93ZXJCb3VuZC54OwogICAgICBjb25zdCB5ID0gY2xpX2FhYmIudXBwZXJCb3VuZC55IC0gY2xpX2FhYmIubG93ZXJCb3VuZC55OwogICAgICBjb25zdCB6ID0gY2xpX2FhYmIudXBwZXJCb3VuZC56IC0gY2xpX2FhYmIubG93ZXJCb3VuZC56OwogICAgICByZXR1cm4gdGFyZ2V0LnNldCgxLjAgLyAxMi4wICogbWFzcyAqICgyICogeSAqIDIgKiB5ICsgMiAqIHogKiAyICogeiksIDEuMCAvIDEyLjAgKiBtYXNzICogKDIgKiB4ICogMiAqIHggKyAyICogeiAqIDIgKiB6KSwgMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIHkgKiAyICogeSArIDIgKiB4ICogMiAqIHgpKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbG9jYWwgQUFCQiBmb3IgdGhlIHRyaW1lc2gKICAgICAqLwoKCiAgICBjb21wdXRlTG9jYWxBQUJCKGFhYmIpIHsKICAgICAgY29uc3QgbCA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdSA9IGFhYmIudXBwZXJCb3VuZDsKICAgICAgY29uc3QgbiA9IHRoaXMudmVydGljZXMubGVuZ3RoOwogICAgICB0aGlzLnZlcnRpY2VzOwogICAgICBjb25zdCB2ID0gY29tcHV0ZUxvY2FsQUFCQl93b3JsZFZlcnQ7CiAgICAgIHRoaXMuZ2V0VmVydGV4KDAsIHYpOwogICAgICBsLmNvcHkodik7CiAgICAgIHUuY29weSh2KTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBuOyBpKyspIHsKICAgICAgICB0aGlzLmdldFZlcnRleChpLCB2KTsKCiAgICAgICAgaWYgKHYueCA8IGwueCkgewogICAgICAgICAgbC54ID0gdi54OwogICAgICAgIH0gZWxzZSBpZiAodi54ID4gdS54KSB7CiAgICAgICAgICB1LnggPSB2Lng7CiAgICAgICAgfQoKICAgICAgICBpZiAodi55IDwgbC55KSB7CiAgICAgICAgICBsLnkgPSB2Lnk7CiAgICAgICAgfSBlbHNlIGlmICh2LnkgPiB1LnkpIHsKICAgICAgICAgIHUueSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmICh2LnogPCBsLnopIHsKICAgICAgICAgIGwueiA9IHYuejsKICAgICAgICB9IGVsc2UgaWYgKHYueiA+IHUueikgewogICAgICAgICAgdS56ID0gdi56OwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgdGhlIGAuYWFiYmAgcHJvcGVydHkKICAgICAqLwoKCiAgICB1cGRhdGVBQUJCKCkgewogICAgICB0aGlzLmNvbXB1dGVMb2NhbEFBQkIodGhpcy5hYWJiKTsKICAgIH0KICAgIC8qKgogICAgICogV2lsbCB1cGRhdGUgdGhlIGAuYm91bmRpbmdTcGhlcmVSYWRpdXNgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIC8vIEFzc3VtZSBwb2ludHMgYXJlIGRpc3RyaWJ1dGVkIHdpdGggbG9jYWwgKDAsMCwwKSBhcyBjZW50ZXIKICAgICAgbGV0IG1heDIgPSAwOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIGNvbnN0IHYgPSBuZXcgVmVjMygpOwoKICAgICAgZm9yIChsZXQgaSA9IDAsIE4gPSB2ZXJ0aWNlcy5sZW5ndGggLyAzOyBpICE9PSBOOyBpKyspIHsKICAgICAgICB0aGlzLmdldFZlcnRleChpLCB2KTsKICAgICAgICBjb25zdCBub3JtMiA9IHYubGVuZ3RoU3F1YXJlZCgpOwoKICAgICAgICBpZiAobm9ybTIgPiBtYXgyKSB7CiAgICAgICAgICBtYXgyID0gbm9ybTI7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gTWF0aC5zcXJ0KG1heDIpOwogICAgfQogICAgLyoqCiAgICAgKiBjYWxjdWxhdGVXb3JsZEFBQkIKICAgICAqLwoKCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICAvKgogICAgICAgICAgY29uc3QgbiA9IHRoaXMudmVydGljZXMubGVuZ3RoIC8gMywKICAgICAgICAgICAgICB2ZXJ0cyA9IHRoaXMudmVydGljZXM7CiAgICAgICAgICBjb25zdCBtaW54LG1pbnksbWlueixtYXh4LG1heHksbWF4ejsKICAgICAgICAgICBjb25zdCB2ID0gdGVtcFdvcmxkVmVydGV4OwogICAgICAgICAgZm9yKGxldCBpPTA7IGk8bjsgaSsrKXsKICAgICAgICAgICAgICB0aGlzLmdldFZlcnRleChpLCB2KTsKICAgICAgICAgICAgICBxdWF0LnZtdWx0KHYsIHYpOwogICAgICAgICAgICAgIHBvcy52YWRkKHYsIHYpOwogICAgICAgICAgICAgIGlmICh2LnggPCBtaW54IHx8IG1pbng9PT11bmRlZmluZWQpewogICAgICAgICAgICAgICAgICBtaW54ID0gdi54OwogICAgICAgICAgICAgIH0gZWxzZSBpZih2LnggPiBtYXh4IHx8IG1heHg9PT11bmRlZmluZWQpewogICAgICAgICAgICAgICAgICBtYXh4ID0gdi54OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgaWYgKHYueSA8IG1pbnkgfHwgbWlueT09PXVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICAgIG1pbnkgPSB2Lnk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmKHYueSA+IG1heHkgfHwgbWF4eT09PXVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICAgIG1heHkgPSB2Lnk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICBpZiAodi56IDwgbWlueiB8fCBtaW56PT09dW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgbWlueiA9IHYuejsKICAgICAgICAgICAgICB9IGVsc2UgaWYodi56ID4gbWF4eiB8fCBtYXh6PT09dW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgbWF4eiA9IHYuejsKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBtaW4uc2V0KG1pbngsbWlueSxtaW56KTsKICAgICAgICAgIG1heC5zZXQobWF4eCxtYXh5LG1heHopOwogICAgICAgICAgKi8KICAgICAgLy8gRmFzdGVyIGFwcHJveGltYXRpb24gdXNpbmcgbG9jYWwgQUFCQgogICAgICBjb25zdCBmcmFtZSA9IGNhbGN1bGF0ZVdvcmxkQUFCQl9mcmFtZTsKICAgICAgY29uc3QgcmVzdWx0ID0gY2FsY3VsYXRlV29ybGRBQUJCX2FhYmI7CiAgICAgIGZyYW1lLnBvc2l0aW9uID0gcG9zOwogICAgICBmcmFtZS5xdWF0ZXJuaW9uID0gcXVhdDsKICAgICAgdGhpcy5hYWJiLnRvV29ybGRGcmFtZShmcmFtZSwgcmVzdWx0KTsKICAgICAgbWluLmNvcHkocmVzdWx0Lmxvd2VyQm91bmQpOwogICAgICBtYXguY29weShyZXN1bHQudXBwZXJCb3VuZCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhcHByb3hpbWF0ZSB2b2x1bWUKICAgICAqLwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiA0LjAgKiBNYXRoLlBJICogdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyAvIDMuMDsKICAgIH0KICAgIC8qKgogICAgICogQ3JlYXRlIGEgVHJpbWVzaCBpbnN0YW5jZSwgc2hhcGVkIGFzIGEgdG9ydXMuCiAgICAgKi8KCgogICAgc3RhdGljIGNyZWF0ZVRvcnVzKHJhZGl1cywgdHViZSwgcmFkaWFsU2VnbWVudHMsIHR1YnVsYXJTZWdtZW50cywgYXJjKSB7CiAgICAgIGlmIChyYWRpdXMgPT09IHZvaWQgMCkgewogICAgICAgIHJhZGl1cyA9IDE7CiAgICAgIH0KCiAgICAgIGlmICh0dWJlID09PSB2b2lkIDApIHsKICAgICAgICB0dWJlID0gMC41OwogICAgICB9CgogICAgICBpZiAocmFkaWFsU2VnbWVudHMgPT09IHZvaWQgMCkgewogICAgICAgIHJhZGlhbFNlZ21lbnRzID0gODsKICAgICAgfQoKICAgICAgaWYgKHR1YnVsYXJTZWdtZW50cyA9PT0gdm9pZCAwKSB7CiAgICAgICAgdHVidWxhclNlZ21lbnRzID0gNjsKICAgICAgfQoKICAgICAgaWYgKGFyYyA9PT0gdm9pZCAwKSB7CiAgICAgICAgYXJjID0gTWF0aC5QSSAqIDI7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRpY2VzID0gW107CiAgICAgIGNvbnN0IGluZGljZXMgPSBbXTsKCiAgICAgIGZvciAobGV0IGogPSAwOyBqIDw9IHJhZGlhbFNlZ21lbnRzOyBqKyspIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8PSB0dWJ1bGFyU2VnbWVudHM7IGkrKykgewogICAgICAgICAgY29uc3QgdSA9IGkgLyB0dWJ1bGFyU2VnbWVudHMgKiBhcmM7CiAgICAgICAgICBjb25zdCB2ID0gaiAvIHJhZGlhbFNlZ21lbnRzICogTWF0aC5QSSAqIDI7CiAgICAgICAgICBjb25zdCB4ID0gKHJhZGl1cyArIHR1YmUgKiBNYXRoLmNvcyh2KSkgKiBNYXRoLmNvcyh1KTsKICAgICAgICAgIGNvbnN0IHkgPSAocmFkaXVzICsgdHViZSAqIE1hdGguY29zKHYpKSAqIE1hdGguc2luKHUpOwogICAgICAgICAgY29uc3QgeiA9IHR1YmUgKiBNYXRoLnNpbih2KTsKICAgICAgICAgIHZlcnRpY2VzLnB1c2goeCwgeSwgeik7CiAgICAgICAgfQogICAgICB9CgogICAgICBmb3IgKGxldCBqID0gMTsgaiA8PSByYWRpYWxTZWdtZW50czsgaisrKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gdHVidWxhclNlZ21lbnRzOyBpKyspIHsKICAgICAgICAgIGNvbnN0IGEgPSAodHVidWxhclNlZ21lbnRzICsgMSkgKiBqICsgaSAtIDE7CiAgICAgICAgICBjb25zdCBiID0gKHR1YnVsYXJTZWdtZW50cyArIDEpICogKGogLSAxKSArIGkgLSAxOwogICAgICAgICAgY29uc3QgYyA9ICh0dWJ1bGFyU2VnbWVudHMgKyAxKSAqIChqIC0gMSkgKyBpOwogICAgICAgICAgY29uc3QgZCA9ICh0dWJ1bGFyU2VnbWVudHMgKyAxKSAqIGogKyBpOwogICAgICAgICAgaW5kaWNlcy5wdXNoKGEsIGIsIGQpOwogICAgICAgICAgaW5kaWNlcy5wdXNoKGIsIGMsIGQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG5ldyBUcmltZXNoKHZlcnRpY2VzLCBpbmRpY2VzKTsKICAgIH0KCiAgfQogIGNvbnN0IGNvbXB1dGVOb3JtYWxzX24gPSBuZXcgVmVjMygpOwogIGNvbnN0IHVuc2NhbGVkQUFCQiA9IG5ldyBBQUJCKCk7CiAgY29uc3QgZ2V0RWRnZVZlY3Rvcl92YSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0RWRnZVZlY3Rvcl92YiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY2IgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFiID0gbmV3IFZlYzMoKTsKICBjb25zdCB2YSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdmIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHZjID0gbmV3IFZlYzMoKTsKICBjb25zdCBjbGlfYWFiYiA9IG5ldyBBQUJCKCk7CiAgY29uc3QgY29tcHV0ZUxvY2FsQUFCQl93b3JsZFZlcnQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNhbGN1bGF0ZVdvcmxkQUFCQl9mcmFtZSA9IG5ldyBUcmFuc2Zvcm0oKTsKICBjb25zdCBjYWxjdWxhdGVXb3JsZEFBQkJfYWFiYiA9IG5ldyBBQUJCKCk7CgogIC8qKgogICAqIENvbnN0cmFpbnQgZXF1YXRpb24gc29sdmVyIGJhc2UgY2xhc3MuCiAgICovCiAgY2xhc3MgU29sdmVyIHsKICAgIC8qKgogICAgICogQWxsIGVxdWF0aW9ucyB0byBiZSBzb2x2ZWQKICAgICAqLwoKICAgIC8qKgogICAgICogQHRvZG8gcmVtb3ZlIHVzZWxlc3MgY29uc3RydWN0b3IKICAgICAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMuZXF1YXRpb25zID0gW107CiAgICB9CiAgICAvKioKICAgICAqIFNob3VsZCBiZSBpbXBsZW1lbnRlZCBpbiBzdWJjbGFzc2VzIQogICAgICogQHRvZG8gdXNlIGFic3RyYWN0CiAgICAgKiBAcmV0dXJuIG51bWJlciBvZiBpdGVyYXRpb25zIHBlcmZvcm1lZAogICAgICovCgoKICAgIHNvbHZlKGR0LCB3b3JsZCkgewogICAgICByZXR1cm4gKC8vIFNob3VsZCByZXR1cm4gdGhlIG51bWJlciBvZiBpdGVyYXRpb25zIGRvbmUhCiAgICAgICAgMAogICAgICApOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYW4gZXF1YXRpb24KICAgICAqLwoKCiAgICBhZGRFcXVhdGlvbihlcSkgewogICAgICBpZiAoZXEuZW5hYmxlZCAmJiAhZXEuYmkuaXNUcmlnZ2VyICYmICFlcS5iai5pc1RyaWdnZXIpIHsKICAgICAgICB0aGlzLmVxdWF0aW9ucy5wdXNoKGVxKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmUgYW4gZXF1YXRpb24KICAgICAqLwoKCiAgICByZW1vdmVFcXVhdGlvbihlcSkgewogICAgICBjb25zdCBlcXMgPSB0aGlzLmVxdWF0aW9uczsKICAgICAgY29uc3QgaSA9IGVxcy5pbmRleE9mKGVxKTsKCiAgICAgIGlmIChpICE9PSAtMSkgewogICAgICAgIGVxcy5zcGxpY2UoaSwgMSk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQWRkIGFsbCBlcXVhdGlvbnMKICAgICAqLwoKCiAgICByZW1vdmVBbGxFcXVhdGlvbnMoKSB7CiAgICAgIHRoaXMuZXF1YXRpb25zLmxlbmd0aCA9IDA7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQ29uc3RyYWludCBlcXVhdGlvbiBHYXVzcy1TZWlkZWwgc29sdmVyLgogICAqIEB0b2RvIFRoZSBzcG9vayBwYXJhbWV0ZXJzIHNob3VsZCBiZSBzcGVjaWZpZWQgZm9yIGVhY2ggY29uc3RyYWludCwgbm90IGdsb2JhbGx5LgogICAqIEBzZWUgaHR0cHM6Ly93d3c4LmNzLnVtdS5zZS9rdXJzZXIvNURWMDU4L1ZUMDkvbGVjdHVyZXMvc3Bvb2tub3Rlcy5wZGYKICAgKi8KICBjbGFzcyBHU1NvbHZlciBleHRlbmRzIFNvbHZlciB7CiAgICAvKioKICAgICAqIFRoZSBudW1iZXIgb2Ygc29sdmVyIGl0ZXJhdGlvbnMgZGV0ZXJtaW5lcyBxdWFsaXR5IG9mIHRoZSBjb25zdHJhaW50cyBpbiB0aGUgd29ybGQuCiAgICAgKiBUaGUgbW9yZSBpdGVyYXRpb25zLCB0aGUgbW9yZSBjb3JyZWN0IHNpbXVsYXRpb24uIE1vcmUgaXRlcmF0aW9ucyBuZWVkIG1vcmUgY29tcHV0YXRpb25zIHRob3VnaC4gSWYgeW91IGhhdmUgYSBsYXJnZSBncmF2aXR5IGZvcmNlIGluIHlvdXIgd29ybGQsIHlvdSB3aWxsIG5lZWQgbW9yZSBpdGVyYXRpb25zLgogICAgICovCgogICAgLyoqCiAgICAgKiBXaGVuIHRvbGVyYW5jZSBpcyByZWFjaGVkLCB0aGUgc3lzdGVtIGlzIGFzc3VtZWQgdG8gYmUgY29udmVyZ2VkLgogICAgICovCgogICAgLyoqCiAgICAgKiBAdG9kbyByZW1vdmUgdXNlbGVzcyBjb25zdHJ1Y3RvcgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5pdGVyYXRpb25zID0gMTA7CiAgICAgIHRoaXMudG9sZXJhbmNlID0gMWUtNzsKICAgIH0KICAgIC8qKgogICAgICogU29sdmUKICAgICAqIEByZXR1cm4gbnVtYmVyIG9mIGl0ZXJhdGlvbnMgcGVyZm9ybWVkCiAgICAgKi8KCgogICAgc29sdmUoZHQsIHdvcmxkKSB7CiAgICAgIGxldCBpdGVyID0gMDsKICAgICAgY29uc3QgbWF4SXRlciA9IHRoaXMuaXRlcmF0aW9uczsKICAgICAgY29uc3QgdG9sU3F1YXJlZCA9IHRoaXMudG9sZXJhbmNlICogdGhpcy50b2xlcmFuY2U7CiAgICAgIGNvbnN0IGVxdWF0aW9ucyA9IHRoaXMuZXF1YXRpb25zOwogICAgICBjb25zdCBOZXEgPSBlcXVhdGlvbnMubGVuZ3RoOwogICAgICBjb25zdCBib2RpZXMgPSB3b3JsZC5ib2RpZXM7CiAgICAgIGNvbnN0IE5ib2RpZXMgPSBib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBoID0gZHQ7CiAgICAgIGxldCBCOwogICAgICBsZXQgaW52QzsKICAgICAgbGV0IGRlbHRhbGFtYmRhOwogICAgICBsZXQgZGVsdGFsYW1iZGFUb3Q7CiAgICAgIGxldCBHV2xhbWJkYTsKICAgICAgbGV0IGxhbWJkYWo7IC8vIFVwZGF0ZSBzb2x2ZSBtYXNzCgogICAgICBpZiAoTmVxICE9PSAwKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5ib2RpZXM7IGkrKykgewogICAgICAgICAgYm9kaWVzW2ldLnVwZGF0ZVNvbHZlTWFzc1Byb3BlcnRpZXMoKTsKICAgICAgICB9CiAgICAgIH0gLy8gVGhpbmdzIHRoYXQgZG8gbm90IGNoYW5nZSBkdXJpbmcgaXRlcmF0aW9uIGNhbiBiZSBjb21wdXRlZCBvbmNlCgoKICAgICAgY29uc3QgaW52Q3MgPSBHU1NvbHZlcl9zb2x2ZV9pbnZDczsKICAgICAgY29uc3QgQnMgPSBHU1NvbHZlcl9zb2x2ZV9CczsKICAgICAgY29uc3QgbGFtYmRhID0gR1NTb2x2ZXJfc29sdmVfbGFtYmRhOwogICAgICBpbnZDcy5sZW5ndGggPSBOZXE7CiAgICAgIEJzLmxlbmd0aCA9IE5lcTsKICAgICAgbGFtYmRhLmxlbmd0aCA9IE5lcTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOZXE7IGkrKykgewogICAgICAgIGNvbnN0IGMgPSBlcXVhdGlvbnNbaV07CiAgICAgICAgbGFtYmRhW2ldID0gMC4wOwogICAgICAgIEJzW2ldID0gYy5jb21wdXRlQihoKTsKICAgICAgICBpbnZDc1tpXSA9IDEuMCAvIGMuY29tcHV0ZUMoKTsKICAgICAgfQoKICAgICAgaWYgKE5lcSAhPT0gMCkgewogICAgICAgIC8vIFJlc2V0IHZsYW1iZGEKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmJvZGllczsgaSsrKSB7CiAgICAgICAgICBjb25zdCBiID0gYm9kaWVzW2ldOwogICAgICAgICAgY29uc3QgdmxhbWJkYSA9IGIudmxhbWJkYTsKICAgICAgICAgIGNvbnN0IHdsYW1iZGEgPSBiLndsYW1iZGE7CiAgICAgICAgICB2bGFtYmRhLnNldCgwLCAwLCAwKTsKICAgICAgICAgIHdsYW1iZGEuc2V0KDAsIDAsIDApOwogICAgICAgIH0gLy8gSXRlcmF0ZSBvdmVyIGVxdWF0aW9ucwoKCiAgICAgICAgZm9yIChpdGVyID0gMDsgaXRlciAhPT0gbWF4SXRlcjsgaXRlcisrKSB7CiAgICAgICAgICAvLyBBY2N1bXVsYXRlIHRoZSB0b3RhbCBlcnJvciBmb3IgZWFjaCBpdGVyYXRpb24uCiAgICAgICAgICBkZWx0YWxhbWJkYVRvdCA9IDAuMDsKCiAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gTmVxOyBqKyspIHsKICAgICAgICAgICAgY29uc3QgYyA9IGVxdWF0aW9uc1tqXTsgLy8gQ29tcHV0ZSBpdGVyYXRpb24KCiAgICAgICAgICAgIEIgPSBCc1tqXTsKICAgICAgICAgICAgaW52QyA9IGludkNzW2pdOwogICAgICAgICAgICBsYW1iZGFqID0gbGFtYmRhW2pdOwogICAgICAgICAgICBHV2xhbWJkYSA9IGMuY29tcHV0ZUdXbGFtYmRhKCk7CiAgICAgICAgICAgIGRlbHRhbGFtYmRhID0gaW52QyAqIChCIC0gR1dsYW1iZGEgLSBjLmVwcyAqIGxhbWJkYWopOyAvLyBDbGFtcCBpZiB3ZSBhcmUgbm90IHdpdGhpbiB0aGUgbWluL21heCBpbnRlcnZhbAoKICAgICAgICAgICAgaWYgKGxhbWJkYWogKyBkZWx0YWxhbWJkYSA8IGMubWluRm9yY2UpIHsKICAgICAgICAgICAgICBkZWx0YWxhbWJkYSA9IGMubWluRm9yY2UgLSBsYW1iZGFqOwogICAgICAgICAgICB9IGVsc2UgaWYgKGxhbWJkYWogKyBkZWx0YWxhbWJkYSA+IGMubWF4Rm9yY2UpIHsKICAgICAgICAgICAgICBkZWx0YWxhbWJkYSA9IGMubWF4Rm9yY2UgLSBsYW1iZGFqOwogICAgICAgICAgICB9CgogICAgICAgICAgICBsYW1iZGFbal0gKz0gZGVsdGFsYW1iZGE7CiAgICAgICAgICAgIGRlbHRhbGFtYmRhVG90ICs9IGRlbHRhbGFtYmRhID4gMC4wID8gZGVsdGFsYW1iZGEgOiAtZGVsdGFsYW1iZGE7IC8vIGFicyhkZWx0YWxhbWJkYSkKCiAgICAgICAgICAgIGMuYWRkVG9XbGFtYmRhKGRlbHRhbGFtYmRhKTsKICAgICAgICAgIH0gLy8gSWYgdGhlIHRvdGFsIGVycm9yIGlzIHNtYWxsIGVub3VnaCAtIHN0b3AgaXRlcmF0ZQoKCiAgICAgICAgICBpZiAoZGVsdGFsYW1iZGFUb3QgKiBkZWx0YWxhbWJkYVRvdCA8IHRvbFNxdWFyZWQpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBBZGQgcmVzdWx0IHRvIHZlbG9jaXR5CgoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmJvZGllczsgaSsrKSB7CiAgICAgICAgICBjb25zdCBiID0gYm9kaWVzW2ldOwogICAgICAgICAgY29uc3QgdiA9IGIudmVsb2NpdHk7CiAgICAgICAgICBjb25zdCB3ID0gYi5hbmd1bGFyVmVsb2NpdHk7CiAgICAgICAgICBiLnZsYW1iZGEudm11bChiLmxpbmVhckZhY3RvciwgYi52bGFtYmRhKTsKICAgICAgICAgIHYudmFkZChiLnZsYW1iZGEsIHYpOwogICAgICAgICAgYi53bGFtYmRhLnZtdWwoYi5hbmd1bGFyRmFjdG9yLCBiLndsYW1iZGEpOwogICAgICAgICAgdy52YWRkKGIud2xhbWJkYSwgdyk7CiAgICAgICAgfSAvLyBTZXQgdGhlIGAubXVsdGlwbGllcmAgcHJvcGVydHkgb2YgZWFjaCBlcXVhdGlvbgoKCiAgICAgICAgbGV0IGwgPSBlcXVhdGlvbnMubGVuZ3RoOwogICAgICAgIGNvbnN0IGludkR0ID0gMSAvIGg7CgogICAgICAgIHdoaWxlIChsLS0pIHsKICAgICAgICAgIGVxdWF0aW9uc1tsXS5tdWx0aXBsaWVyID0gbGFtYmRhW2xdICogaW52RHQ7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gaXRlcjsKICAgIH0KCiAgfSAvLyBKdXN0IHRlbXBvcmFyeSBudW1iZXIgaG9sZGVycyB0aGF0IHdlIHdhbnQgdG8gcmV1c2UgZWFjaCBpdGVyYXRpb24uCgogIGNvbnN0IEdTU29sdmVyX3NvbHZlX2xhbWJkYSA9IFtdOwogIGNvbnN0IEdTU29sdmVyX3NvbHZlX2ludkNzID0gW107CiAgY29uc3QgR1NTb2x2ZXJfc29sdmVfQnMgPSBbXTsKCiAgLyoqCiAgICogU3BsaXRzIHRoZSBlcXVhdGlvbnMgaW50byBpc2xhbmRzIGFuZCBzb2x2ZXMgdGhlbSBpbmRlcGVuZGVudGx5LiBDYW4gaW1wcm92ZSBwZXJmb3JtYW5jZS4KICAgKi8KICBjbGFzcyBTcGxpdFNvbHZlciBleHRlbmRzIFNvbHZlciB7CiAgICAvKioKICAgICAqIFRoZSBudW1iZXIgb2Ygc29sdmVyIGl0ZXJhdGlvbnMgZGV0ZXJtaW5lcyBxdWFsaXR5IG9mIHRoZSBjb25zdHJhaW50cyBpbiB0aGUgd29ybGQuIFRoZSBtb3JlIGl0ZXJhdGlvbnMsIHRoZSBtb3JlIGNvcnJlY3Qgc2ltdWxhdGlvbi4gTW9yZSBpdGVyYXRpb25zIG5lZWQgbW9yZSBjb21wdXRhdGlvbnMgdGhvdWdoLiBJZiB5b3UgaGF2ZSBhIGxhcmdlIGdyYXZpdHkgZm9yY2UgaW4geW91ciB3b3JsZCwgeW91IHdpbGwgbmVlZCBtb3JlIGl0ZXJhdGlvbnMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZW4gdG9sZXJhbmNlIGlzIHJlYWNoZWQsIHRoZSBzeXN0ZW0gaXMgYXNzdW1lZCB0byBiZSBjb252ZXJnZWQuCiAgICAgKi8KCiAgICAvKiogc3Vic29sdmVyICovCiAgICBjb25zdHJ1Y3RvcihzdWJzb2x2ZXIpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5pdGVyYXRpb25zID0gMTA7CiAgICAgIHRoaXMudG9sZXJhbmNlID0gMWUtNzsKICAgICAgdGhpcy5zdWJzb2x2ZXIgPSBzdWJzb2x2ZXI7CiAgICAgIHRoaXMubm9kZXMgPSBbXTsKICAgICAgdGhpcy5ub2RlUG9vbCA9IFtdOyAvLyBDcmVhdGUgbmVlZGVkIG5vZGVzLCByZXVzZSBpZiBwb3NzaWJsZQoKICAgICAgd2hpbGUgKHRoaXMubm9kZVBvb2wubGVuZ3RoIDwgMTI4KSB7CiAgICAgICAgdGhpcy5ub2RlUG9vbC5wdXNoKHRoaXMuY3JlYXRlTm9kZSgpKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBjcmVhdGVOb2RlCiAgICAgKi8KCgogICAgY3JlYXRlTm9kZSgpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBib2R5OiBudWxsLAogICAgICAgIGNoaWxkcmVuOiBbXSwKICAgICAgICBlcXM6IFtdLAogICAgICAgIHZpc2l0ZWQ6IGZhbHNlCiAgICAgIH07CiAgICB9CiAgICAvKioKICAgICAqIFNvbHZlIHRoZSBzdWJzeXN0ZW1zCiAgICAgKiBAcmV0dXJuIG51bWJlciBvZiBpdGVyYXRpb25zIHBlcmZvcm1lZAogICAgICovCgoKICAgIHNvbHZlKGR0LCB3b3JsZCkgewogICAgICBjb25zdCBub2RlcyA9IFNwbGl0U29sdmVyX3NvbHZlX25vZGVzOwogICAgICBjb25zdCBub2RlUG9vbCA9IHRoaXMubm9kZVBvb2w7CiAgICAgIGNvbnN0IGJvZGllcyA9IHdvcmxkLmJvZGllczsKICAgICAgY29uc3QgZXF1YXRpb25zID0gdGhpcy5lcXVhdGlvbnM7CiAgICAgIGNvbnN0IE5lcSA9IGVxdWF0aW9ucy5sZW5ndGg7CiAgICAgIGNvbnN0IE5ib2RpZXMgPSBib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBzdWJzb2x2ZXIgPSB0aGlzLnN1YnNvbHZlcjsgLy8gQ3JlYXRlIG5lZWRlZCBub2RlcywgcmV1c2UgaWYgcG9zc2libGUKCiAgICAgIHdoaWxlIChub2RlUG9vbC5sZW5ndGggPCBOYm9kaWVzKSB7CiAgICAgICAgbm9kZVBvb2wucHVzaCh0aGlzLmNyZWF0ZU5vZGUoKSk7CiAgICAgIH0KCiAgICAgIG5vZGVzLmxlbmd0aCA9IE5ib2RpZXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IE5ib2RpZXM7IGkrKykgewogICAgICAgIG5vZGVzW2ldID0gbm9kZVBvb2xbaV07CiAgICAgIH0gLy8gUmVzZXQgbm9kZSB2YWx1ZXMKCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmJvZGllczsgaSsrKSB7CiAgICAgICAgY29uc3Qgbm9kZSA9IG5vZGVzW2ldOwogICAgICAgIG5vZGUuYm9keSA9IGJvZGllc1tpXTsKICAgICAgICBub2RlLmNoaWxkcmVuLmxlbmd0aCA9IDA7CiAgICAgICAgbm9kZS5lcXMubGVuZ3RoID0gMDsKICAgICAgICBub2RlLnZpc2l0ZWQgPSBmYWxzZTsKICAgICAgfQoKICAgICAgZm9yIChsZXQgayA9IDA7IGsgIT09IE5lcTsgaysrKSB7CiAgICAgICAgY29uc3QgZXEgPSBlcXVhdGlvbnNba107CiAgICAgICAgY29uc3QgaSA9IGJvZGllcy5pbmRleE9mKGVxLmJpKTsKICAgICAgICBjb25zdCBqID0gYm9kaWVzLmluZGV4T2YoZXEuYmopOwogICAgICAgIGNvbnN0IG5pID0gbm9kZXNbaV07CiAgICAgICAgY29uc3QgbmogPSBub2Rlc1tqXTsKICAgICAgICBuaS5jaGlsZHJlbi5wdXNoKG5qKTsKICAgICAgICBuaS5lcXMucHVzaChlcSk7CiAgICAgICAgbmouY2hpbGRyZW4ucHVzaChuaSk7CiAgICAgICAgbmouZXFzLnB1c2goZXEpOwogICAgICB9CgogICAgICBsZXQgY2hpbGQ7CiAgICAgIGxldCBuID0gMDsKICAgICAgbGV0IGVxcyA9IFNwbGl0U29sdmVyX3NvbHZlX2VxczsKICAgICAgc3Vic29sdmVyLnRvbGVyYW5jZSA9IHRoaXMudG9sZXJhbmNlOwogICAgICBzdWJzb2x2ZXIuaXRlcmF0aW9ucyA9IHRoaXMuaXRlcmF0aW9uczsKICAgICAgY29uc3QgZHVtbXlXb3JsZCA9IFNwbGl0U29sdmVyX3NvbHZlX2R1bW15V29ybGQ7CgogICAgICB3aGlsZSAoY2hpbGQgPSBnZXRVbnZpc2l0ZWROb2RlKG5vZGVzKSkgewogICAgICAgIGVxcy5sZW5ndGggPSAwOwogICAgICAgIGR1bW15V29ybGQuYm9kaWVzLmxlbmd0aCA9IDA7CiAgICAgICAgYmZzKGNoaWxkLCB2aXNpdEZ1bmMsIGR1bW15V29ybGQuYm9kaWVzLCBlcXMpOwogICAgICAgIGNvbnN0IE5lcXMgPSBlcXMubGVuZ3RoOwogICAgICAgIGVxcyA9IGVxcy5zb3J0KHNvcnRCeUlkKTsKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5lcXM7IGkrKykgewogICAgICAgICAgc3Vic29sdmVyLmFkZEVxdWF0aW9uKGVxc1tpXSk7CiAgICAgICAgfQoKICAgICAgICBzdWJzb2x2ZXIuc29sdmUoZHQsIGR1bW15V29ybGQpOwogICAgICAgIHN1YnNvbHZlci5yZW1vdmVBbGxFcXVhdGlvbnMoKTsKICAgICAgICBuKys7CiAgICAgIH0KCiAgICAgIHJldHVybiBuOwogICAgfQoKICB9IC8vIFJldHVybnMgdGhlIG51bWJlciBvZiBzdWJzeXN0ZW1zCgogIGNvbnN0IFNwbGl0U29sdmVyX3NvbHZlX25vZGVzID0gW107IC8vIEFsbCBhbGxvY2F0ZWQgbm9kZSBvYmplY3RzCgogIGNvbnN0IFNwbGl0U29sdmVyX3NvbHZlX2VxcyA9IFtdOyAvLyBUZW1wIGFycmF5CgogIGNvbnN0IFNwbGl0U29sdmVyX3NvbHZlX2R1bW15V29ybGQgPSB7CiAgICBib2RpZXM6IFtdCiAgfTsgLy8gVGVtcCBvYmplY3QKCiAgY29uc3QgU1RBVElDID0gQm9keS5TVEFUSUM7CgogIGZ1bmN0aW9uIGdldFVudmlzaXRlZE5vZGUobm9kZXMpIHsKICAgIGNvbnN0IE5ub2RlcyA9IG5vZGVzLmxlbmd0aDsKCiAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTm5vZGVzOyBpKyspIHsKICAgICAgY29uc3Qgbm9kZSA9IG5vZGVzW2ldOwoKICAgICAgaWYgKCFub2RlLnZpc2l0ZWQgJiYgIShub2RlLmJvZHkudHlwZSAmIFNUQVRJQykpIHsKICAgICAgICByZXR1cm4gbm9kZTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiBmYWxzZTsKICB9CgogIGNvbnN0IHF1ZXVlID0gW107CgogIGZ1bmN0aW9uIGJmcyhyb290LCB2aXNpdEZ1bmMsIGJkcywgZXFzKSB7CiAgICBxdWV1ZS5wdXNoKHJvb3QpOwogICAgcm9vdC52aXNpdGVkID0gdHJ1ZTsKICAgIHZpc2l0RnVuYyhyb290LCBiZHMsIGVxcyk7CgogICAgd2hpbGUgKHF1ZXVlLmxlbmd0aCkgewogICAgICBjb25zdCBub2RlID0gcXVldWUucG9wKCk7IC8vIExvb3Agb3ZlciB1bnZpc2l0ZWQgY2hpbGQgbm9kZXMKCiAgICAgIGxldCBjaGlsZDsKCiAgICAgIHdoaWxlIChjaGlsZCA9IGdldFVudmlzaXRlZE5vZGUobm9kZS5jaGlsZHJlbikpIHsKICAgICAgICBjaGlsZC52aXNpdGVkID0gdHJ1ZTsKICAgICAgICB2aXNpdEZ1bmMoY2hpbGQsIGJkcywgZXFzKTsKICAgICAgICBxdWV1ZS5wdXNoKGNoaWxkKTsKICAgICAgfQogICAgfQogIH0KCiAgZnVuY3Rpb24gdmlzaXRGdW5jKG5vZGUsIGJkcywgZXFzKSB7CiAgICBiZHMucHVzaChub2RlLmJvZHkpOwogICAgY29uc3QgTmVxcyA9IG5vZGUuZXFzLmxlbmd0aDsKCiAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmVxczsgaSsrKSB7CiAgICAgIGNvbnN0IGVxID0gbm9kZS5lcXNbaV07CgogICAgICBpZiAoIWVxcy5pbmNsdWRlcyhlcSkpIHsKICAgICAgICBlcXMucHVzaChlcSk7CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIHNvcnRCeUlkKGEsIGIpIHsKICAgIHJldHVybiBiLmlkIC0gYS5pZDsKICB9CgogIC8qKgogICAqIEZvciBwb29saW5nIG9iamVjdHMgdGhhdCBjYW4gYmUgcmV1c2VkLgogICAqLwogIGNsYXNzIFBvb2wgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMub2JqZWN0cyA9IFtdOwogICAgICB0aGlzLnR5cGUgPSBPYmplY3Q7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWxlYXNlIGFuIG9iamVjdCBhZnRlciB1c2UKICAgICAqLwogICAgcmVsZWFzZSgpIHsKICAgICAgY29uc3QgTmFyZ3MgPSBhcmd1bWVudHMubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5hcmdzOyBpKyspIHsKICAgICAgICB0aGlzLm9iamVjdHMucHVzaChpIDwgMCB8fCBhcmd1bWVudHMubGVuZ3RoIDw9IGkgPyB1bmRlZmluZWQgOiBhcmd1bWVudHNbaV0pOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFuIG9iamVjdAogICAgICovCgoKICAgIGdldCgpIHsKICAgICAgaWYgKHRoaXMub2JqZWN0cy5sZW5ndGggPT09IDApIHsKICAgICAgICByZXR1cm4gdGhpcy5jb25zdHJ1Y3RPYmplY3QoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gdGhpcy5vYmplY3RzLnBvcCgpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbnN0cnVjdCBhbiBvYmplY3QuIFNob3VsZCBiZSBpbXBsZW1lbnRlZCBpbiBlYWNoIHN1YmNsYXNzLgogICAgICovCgoKICAgIGNvbnN0cnVjdE9iamVjdCgpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdjb25zdHJ1Y3RPYmplY3QoKSBub3QgaW1wbGVtZW50ZWQgaW4gdGhpcyBQb29sIHN1YmNsYXNzIHlldCEnKTsKICAgIH0KICAgIC8qKgogICAgICogQHJldHVybiBTZWxmLCBmb3IgY2hhaW5pbmcKICAgICAqLwoKCiAgICByZXNpemUoc2l6ZSkgewogICAgICBjb25zdCBvYmplY3RzID0gdGhpcy5vYmplY3RzOwoKICAgICAgd2hpbGUgKG9iamVjdHMubGVuZ3RoID4gc2l6ZSkgewogICAgICAgIG9iamVjdHMucG9wKCk7CiAgICAgIH0KCiAgICAgIHdoaWxlIChvYmplY3RzLmxlbmd0aCA8IHNpemUpIHsKICAgICAgICBvYmplY3RzLnB1c2godGhpcy5jb25zdHJ1Y3RPYmplY3QoKSk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICB9CgogIC8qKgogICAqIFZlYzNQb29sCiAgICovCgogIGNsYXNzIFZlYzNQb29sIGV4dGVuZHMgUG9vbCB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoLi4uYXJndW1lbnRzKTsKICAgICAgdGhpcy50eXBlID0gVmVjMzsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnN0cnVjdCBhIHZlY3RvcgogICAgICovCiAgICBjb25zdHJ1Y3RPYmplY3QoKSB7CiAgICAgIHJldHVybiBuZXcgVmVjMygpOwogICAgfQoKICB9CgogIC8vIE5hbWluZyBydWxlOiBiYXNlZCBvZiB0aGUgb3JkZXIgaW4gU0hBUEVfVFlQRVMsCiAgLy8gdGhlIGZpcnN0IHBhcnQgb2YgdGhlIG1ldGhvZCBpcyBmb3JtZWQgYnkgdGhlCiAgLy8gc2hhcGUgdHlwZSB0aGF0IGNvbWVzIGJlZm9yZSwgaW4gdGhlIHNlY29uZCBwYXJ0CiAgLy8gdGhlcmUgaXMgdGhlIHNoYXBlIHR5cGUgdGhhdCBjb21lcyBhZnRlciBpbiB0aGUgU0hBUEVfVFlQRVMgbGlzdAogIGNvbnN0IENPTExJU0lPTl9UWVBFUyA9IHsKICAgIHNwaGVyZVNwaGVyZTogU2hhcGUudHlwZXMuU1BIRVJFLAogICAgc3BoZXJlUGxhbmU6IFNoYXBlLnR5cGVzLlNQSEVSRSB8IFNoYXBlLnR5cGVzLlBMQU5FLAogICAgYm94Qm94OiBTaGFwZS50eXBlcy5CT1ggfCBTaGFwZS50eXBlcy5CT1gsCiAgICBzcGhlcmVCb3g6IFNoYXBlLnR5cGVzLlNQSEVSRSB8IFNoYXBlLnR5cGVzLkJPWCwKICAgIHBsYW5lQm94OiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLkJPWCwKICAgIGNvbnZleENvbnZleDogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiwKICAgIHNwaGVyZUNvbnZleDogU2hhcGUudHlwZXMuU1BIRVJFIHwgU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiwKICAgIHBsYW5lQ29udmV4OiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBib3hDb252ZXg6IFNoYXBlLnR5cGVzLkJPWCB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBzcGhlcmVIZWlnaHRmaWVsZDogU2hhcGUudHlwZXMuU1BIRVJFIHwgU2hhcGUudHlwZXMuSEVJR0hURklFTEQsCiAgICBib3hIZWlnaHRmaWVsZDogU2hhcGUudHlwZXMuQk9YIHwgU2hhcGUudHlwZXMuSEVJR0hURklFTEQsCiAgICBjb252ZXhIZWlnaHRmaWVsZDogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiB8IFNoYXBlLnR5cGVzLkhFSUdIVEZJRUxELAogICAgc3BoZXJlUGFydGljbGU6IFNoYXBlLnR5cGVzLlBBUlRJQ0xFIHwgU2hhcGUudHlwZXMuU1BIRVJFLAogICAgcGxhbmVQYXJ0aWNsZTogU2hhcGUudHlwZXMuUExBTkUgfCBTaGFwZS50eXBlcy5QQVJUSUNMRSwKICAgIGJveFBhcnRpY2xlOiBTaGFwZS50eXBlcy5CT1ggfCBTaGFwZS50eXBlcy5QQVJUSUNMRSwKICAgIGNvbnZleFBhcnRpY2xlOiBTaGFwZS50eXBlcy5QQVJUSUNMRSB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBjeWxpbmRlckN5bGluZGVyOiBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIHNwaGVyZUN5bGluZGVyOiBTaGFwZS50eXBlcy5TUEhFUkUgfCBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIHBsYW5lQ3lsaW5kZXI6IFNoYXBlLnR5cGVzLlBMQU5FIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBib3hDeWxpbmRlcjogU2hhcGUudHlwZXMuQk9YIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBjb252ZXhDeWxpbmRlcjogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiB8IFNoYXBlLnR5cGVzLkNZTElOREVSLAogICAgaGVpZ2h0ZmllbGRDeWxpbmRlcjogU2hhcGUudHlwZXMuSEVJR0hURklFTEQgfCBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIHBhcnRpY2xlQ3lsaW5kZXI6IFNoYXBlLnR5cGVzLlBBUlRJQ0xFIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBzcGhlcmVUcmltZXNoOiBTaGFwZS50eXBlcy5TUEhFUkUgfCBTaGFwZS50eXBlcy5UUklNRVNILAogICAgcGxhbmVUcmltZXNoOiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLlRSSU1FU0gKICB9OwoKICAvKioKICAgKiBIZWxwZXIgY2xhc3MgZm9yIHRoZSBXb3JsZC4gR2VuZXJhdGVzIENvbnRhY3RFcXVhdGlvbnMuCiAgICogQHRvZG8gU3BoZXJlLUNvbnZleFBvbHloZWRyb24gY29udGFjdHMKICAgKiBAdG9kbyBDb250YWN0IHJlZHVjdGlvbgogICAqIEB0b2RvIHNob3VsZCBtb3ZlIG1ldGhvZHMgdG8gcHJvdG90eXBlCiAgICovCiAgY2xhc3MgTmFycm93cGhhc2UgewogICAgLyoqCiAgICAgKiBJbnRlcm5hbCBzdG9yYWdlIG9mIHBvb2xlZCBjb250YWN0IHBvaW50cy4KICAgICAqLwoKICAgIC8qKgogICAgICogUG9vbGVkIHZlY3RvcnMuCiAgICAgKi8KICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZVNwaGVyZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLnNwaGVyZVNwaGVyZTsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5zcGhlcmVQbGFuZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLnNwaGVyZVBsYW5lOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmJveEJveF0oKSB7CiAgICAgIHJldHVybiB0aGlzLmJveEJveDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5zcGhlcmVCb3hdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVCb3g7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMucGxhbmVCb3hdKCkgewogICAgICByZXR1cm4gdGhpcy5wbGFuZUJveDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5jb252ZXhDb252ZXhdKCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuc3BoZXJlQ29udmV4XSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlQ29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBsYW5lQ29udmV4XSgpIHsKICAgICAgcmV0dXJuIHRoaXMucGxhbmVDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuYm94Q29udmV4XSgpIHsKICAgICAgcmV0dXJuIHRoaXMuYm94Q29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZUhlaWdodGZpZWxkXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlSGVpZ2h0ZmllbGQ7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuYm94SGVpZ2h0ZmllbGRdKCkgewogICAgICByZXR1cm4gdGhpcy5ib3hIZWlnaHRmaWVsZDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5jb252ZXhIZWlnaHRmaWVsZF0oKSB7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleEhlaWdodGZpZWxkOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZVBhcnRpY2xlXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlUGFydGljbGU7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMucGxhbmVQYXJ0aWNsZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lUGFydGljbGU7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuYm94UGFydGljbGVdKCkgewogICAgICByZXR1cm4gdGhpcy5ib3hQYXJ0aWNsZTsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5jb252ZXhQYXJ0aWNsZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleFBhcnRpY2xlOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmN5bGluZGVyQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuc3BoZXJlQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMucGxhbmVDeWxpbmRlcl0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lQ29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmJveEN5bGluZGVyXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuYm94Q29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmNvbnZleEN5bGluZGVyXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4Q29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmhlaWdodGZpZWxkQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5oZWlnaHRmaWVsZEN5bGluZGVyOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBhcnRpY2xlQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5wYXJ0aWNsZUN5bGluZGVyOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZVRyaW1lc2hdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVUcmltZXNoOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBsYW5lVHJpbWVzaF0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lVHJpbWVzaDsKICAgIH0gLy8gZ2V0IFtDT0xMSVNJT05fVFlQRVMuY29udmV4VHJpbWVzaF0oKSB7CiAgICAvLyAgIHJldHVybiB0aGlzLmNvbnZleFRyaW1lc2gKICAgIC8vIH0KCgogICAgY29uc3RydWN0b3Iod29ybGQpIHsKICAgICAgdGhpcy5jb250YWN0UG9pbnRQb29sID0gW107CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblBvb2wgPSBbXTsKICAgICAgdGhpcy5yZXN1bHQgPSBbXTsKICAgICAgdGhpcy5mcmljdGlvblJlc3VsdCA9IFtdOwogICAgICB0aGlzLnYzcG9vbCA9IG5ldyBWZWMzUG9vbCgpOwogICAgICB0aGlzLndvcmxkID0gd29ybGQ7CiAgICAgIHRoaXMuY3VycmVudENvbnRhY3RNYXRlcmlhbCA9IHdvcmxkLmRlZmF1bHRDb250YWN0TWF0ZXJpYWw7CiAgICAgIHRoaXMuZW5hYmxlRnJpY3Rpb25SZWR1Y3Rpb24gPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogTWFrZSBhIGNvbnRhY3Qgb2JqZWN0LCBieSB1c2luZyB0aGUgaW50ZXJuYWwgcG9vbCBvciBjcmVhdGluZyBhIG5ldyBvbmUuCiAgICAgKi8KCgogICAgY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCBvdmVycmlkZVNoYXBlQSwgb3ZlcnJpZGVTaGFwZUIpIHsKICAgICAgbGV0IGM7CgogICAgICBpZiAodGhpcy5jb250YWN0UG9pbnRQb29sLmxlbmd0aCkgewogICAgICAgIGMgPSB0aGlzLmNvbnRhY3RQb2ludFBvb2wucG9wKCk7CiAgICAgICAgYy5iaSA9IGJpOwogICAgICAgIGMuYmogPSBiajsKICAgICAgfSBlbHNlIHsKICAgICAgICBjID0gbmV3IENvbnRhY3RFcXVhdGlvbihiaSwgYmopOwogICAgICB9CgogICAgICBjLmVuYWJsZWQgPSBiaS5jb2xsaXNpb25SZXNwb25zZSAmJiBiai5jb2xsaXNpb25SZXNwb25zZSAmJiBzaS5jb2xsaXNpb25SZXNwb25zZSAmJiBzai5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgY29uc3QgY20gPSB0aGlzLmN1cnJlbnRDb250YWN0TWF0ZXJpYWw7CiAgICAgIGMucmVzdGl0dXRpb24gPSBjbS5yZXN0aXR1dGlvbjsKICAgICAgYy5zZXRTcG9va1BhcmFtcyhjbS5jb250YWN0RXF1YXRpb25TdGlmZm5lc3MsIGNtLmNvbnRhY3RFcXVhdGlvblJlbGF4YXRpb24sIHRoaXMud29ybGQuZHQpOwogICAgICBjb25zdCBtYXRBID0gc2kubWF0ZXJpYWwgfHwgYmkubWF0ZXJpYWw7CiAgICAgIGNvbnN0IG1hdEIgPSBzai5tYXRlcmlhbCB8fCBiai5tYXRlcmlhbDsKCiAgICAgIGlmIChtYXRBICYmIG1hdEIgJiYgbWF0QS5yZXN0aXR1dGlvbiA+PSAwICYmIG1hdEIucmVzdGl0dXRpb24gPj0gMCkgewogICAgICAgIGMucmVzdGl0dXRpb24gPSBtYXRBLnJlc3RpdHV0aW9uICogbWF0Qi5yZXN0aXR1dGlvbjsKICAgICAgfQoKICAgICAgYy5zaSA9IG92ZXJyaWRlU2hhcGVBIHx8IHNpOwogICAgICBjLnNqID0gb3ZlcnJpZGVTaGFwZUIgfHwgc2o7CiAgICAgIHJldHVybiBjOwogICAgfQoKICAgIGNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QoY29udGFjdEVxdWF0aW9uLCBvdXRBcnJheSkgewogICAgICBjb25zdCBib2R5QSA9IGNvbnRhY3RFcXVhdGlvbi5iaTsKICAgICAgY29uc3QgYm9keUIgPSBjb250YWN0RXF1YXRpb24uYmo7CiAgICAgIGNvbnN0IHNoYXBlQSA9IGNvbnRhY3RFcXVhdGlvbi5zaTsKICAgICAgY29uc3Qgc2hhcGVCID0gY29udGFjdEVxdWF0aW9uLnNqOwogICAgICBjb25zdCB3b3JsZCA9IHRoaXMud29ybGQ7CiAgICAgIGNvbnN0IGNtID0gdGhpcy5jdXJyZW50Q29udGFjdE1hdGVyaWFsOyAvLyBJZiBmcmljdGlvbiBvciByZXN0aXR1dGlvbiB3ZXJlIHNwZWNpZmllZCBpbiB0aGUgbWF0ZXJpYWwsIHVzZSB0aGVtCgogICAgICBsZXQgZnJpY3Rpb24gPSBjbS5mcmljdGlvbjsKICAgICAgY29uc3QgbWF0QSA9IHNoYXBlQS5tYXRlcmlhbCB8fCBib2R5QS5tYXRlcmlhbDsKICAgICAgY29uc3QgbWF0QiA9IHNoYXBlQi5tYXRlcmlhbCB8fCBib2R5Qi5tYXRlcmlhbDsKCiAgICAgIGlmIChtYXRBICYmIG1hdEIgJiYgbWF0QS5mcmljdGlvbiA+PSAwICYmIG1hdEIuZnJpY3Rpb24gPj0gMCkgewogICAgICAgIGZyaWN0aW9uID0gbWF0QS5mcmljdGlvbiAqIG1hdEIuZnJpY3Rpb247CiAgICAgIH0KCiAgICAgIGlmIChmcmljdGlvbiA+IDApIHsKICAgICAgICAvLyBDcmVhdGUgMiB0YW5nZW50IGVxdWF0aW9ucwogICAgICAgIC8vIFVzZXJzIG1heSBwcm92aWRlIGEgZm9yY2UgZGlmZmVyZW50IGZyb20gZ2xvYmFsIGdyYXZpdHkgdG8gdXNlIHdoZW4gY29tcHV0aW5nIGNvbnRhY3QgZnJpY3Rpb24uCiAgICAgICAgY29uc3QgbXVnID0gZnJpY3Rpb24gKiAod29ybGQuZnJpY3Rpb25HcmF2aXR5IHx8IHdvcmxkLmdyYXZpdHkpLmxlbmd0aCgpOwogICAgICAgIGxldCByZWR1Y2VkTWFzcyA9IGJvZHlBLmludk1hc3MgKyBib2R5Qi5pbnZNYXNzOwoKICAgICAgICBpZiAocmVkdWNlZE1hc3MgPiAwKSB7CiAgICAgICAgICByZWR1Y2VkTWFzcyA9IDEgLyByZWR1Y2VkTWFzczsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHBvb2wgPSB0aGlzLmZyaWN0aW9uRXF1YXRpb25Qb29sOwogICAgICAgIGNvbnN0IGMxID0gcG9vbC5sZW5ndGggPyBwb29sLnBvcCgpIDogbmV3IEZyaWN0aW9uRXF1YXRpb24oYm9keUEsIGJvZHlCLCBtdWcgKiByZWR1Y2VkTWFzcyk7CiAgICAgICAgY29uc3QgYzIgPSBwb29sLmxlbmd0aCA/IHBvb2wucG9wKCkgOiBuZXcgRnJpY3Rpb25FcXVhdGlvbihib2R5QSwgYm9keUIsIG11ZyAqIHJlZHVjZWRNYXNzKTsKICAgICAgICBjMS5iaSA9IGMyLmJpID0gYm9keUE7CiAgICAgICAgYzEuYmogPSBjMi5iaiA9IGJvZHlCOwogICAgICAgIGMxLm1pbkZvcmNlID0gYzIubWluRm9yY2UgPSAtbXVnICogcmVkdWNlZE1hc3M7CiAgICAgICAgYzEubWF4Rm9yY2UgPSBjMi5tYXhGb3JjZSA9IG11ZyAqIHJlZHVjZWRNYXNzOyAvLyBDb3B5IG92ZXIgdGhlIHJlbGF0aXZlIHZlY3RvcnMKCiAgICAgICAgYzEucmkuY29weShjb250YWN0RXF1YXRpb24ucmkpOwogICAgICAgIGMxLnJqLmNvcHkoY29udGFjdEVxdWF0aW9uLnJqKTsKICAgICAgICBjMi5yaS5jb3B5KGNvbnRhY3RFcXVhdGlvbi5yaSk7CiAgICAgICAgYzIucmouY29weShjb250YWN0RXF1YXRpb24ucmopOyAvLyBDb25zdHJ1Y3QgdGFuZ2VudHMKCiAgICAgICAgY29udGFjdEVxdWF0aW9uLm5pLnRhbmdlbnRzKGMxLnQsIGMyLnQpOyAvLyBTZXQgc3Bvb2sgcGFyYW1zCgogICAgICAgIGMxLnNldFNwb29rUGFyYW1zKGNtLmZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3MsIGNtLmZyaWN0aW9uRXF1YXRpb25SZWxheGF0aW9uLCB3b3JsZC5kdCk7CiAgICAgICAgYzIuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIHdvcmxkLmR0KTsKICAgICAgICBjMS5lbmFibGVkID0gYzIuZW5hYmxlZCA9IGNvbnRhY3RFcXVhdGlvbi5lbmFibGVkOwogICAgICAgIG91dEFycmF5LnB1c2goYzEsIGMyKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQoKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgLyoqCiAgICAgKiBUYWtlIHRoZSBhdmVyYWdlIE4gbGF0ZXN0IGNvbnRhY3QgcG9pbnQgb24gdGhlIHBsYW5lLgogICAgICovCgoKICAgIGNyZWF0ZUZyaWN0aW9uRnJvbUF2ZXJhZ2UobnVtQ29udGFjdHMpIHsKICAgICAgLy8gVGhlIGxhc3QgY29udGFjdEVxdWF0aW9uCiAgICAgIGxldCBjID0gdGhpcy5yZXN1bHRbdGhpcy5yZXN1bHQubGVuZ3RoIC0gMV07IC8vIENyZWF0ZSB0aGUgcmVzdWx0OiB0d28gImF2ZXJhZ2UiIGZyaWN0aW9uIGVxdWF0aW9ucwoKICAgICAgaWYgKCF0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QoYywgdGhpcy5mcmljdGlvblJlc3VsdCkgfHwgbnVtQ29udGFjdHMgPT09IDEpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IGYxID0gdGhpcy5mcmljdGlvblJlc3VsdFt0aGlzLmZyaWN0aW9uUmVzdWx0Lmxlbmd0aCAtIDJdOwogICAgICBjb25zdCBmMiA9IHRoaXMuZnJpY3Rpb25SZXN1bHRbdGhpcy5mcmljdGlvblJlc3VsdC5sZW5ndGggLSAxXTsKICAgICAgYXZlcmFnZU5vcm1hbC5zZXRaZXJvKCk7CiAgICAgIGF2ZXJhZ2VDb250YWN0UG9pbnRBLnNldFplcm8oKTsKICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEIuc2V0WmVybygpOwogICAgICBjb25zdCBib2R5QSA9IGMuYmk7CiAgICAgIGMuYmo7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gbnVtQ29udGFjdHM7IGkrKykgewogICAgICAgIGMgPSB0aGlzLnJlc3VsdFt0aGlzLnJlc3VsdC5sZW5ndGggLSAxIC0gaV07CgogICAgICAgIGlmIChjLmJpICE9PSBib2R5QSkgewogICAgICAgICAgYXZlcmFnZU5vcm1hbC52YWRkKGMubmksIGF2ZXJhZ2VOb3JtYWwpOwogICAgICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEEudmFkZChjLnJpLCBhdmVyYWdlQ29udGFjdFBvaW50QSk7CiAgICAgICAgICBhdmVyYWdlQ29udGFjdFBvaW50Qi52YWRkKGMucmosIGF2ZXJhZ2VDb250YWN0UG9pbnRCKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYXZlcmFnZU5vcm1hbC52c3ViKGMubmksIGF2ZXJhZ2VOb3JtYWwpOwogICAgICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEEudmFkZChjLnJqLCBhdmVyYWdlQ29udGFjdFBvaW50QSk7CiAgICAgICAgICBhdmVyYWdlQ29udGFjdFBvaW50Qi52YWRkKGMucmksIGF2ZXJhZ2VDb250YWN0UG9pbnRCKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IGludk51bUNvbnRhY3RzID0gMSAvIG51bUNvbnRhY3RzOwogICAgICBhdmVyYWdlQ29udGFjdFBvaW50QS5zY2FsZShpbnZOdW1Db250YWN0cywgZjEucmkpOwogICAgICBhdmVyYWdlQ29udGFjdFBvaW50Qi5zY2FsZShpbnZOdW1Db250YWN0cywgZjEucmopOwogICAgICBmMi5yaS5jb3B5KGYxLnJpKTsgLy8gU2hvdWxkIGJlIHRoZSBzYW1lCgogICAgICBmMi5yai5jb3B5KGYxLnJqKTsKICAgICAgYXZlcmFnZU5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgYXZlcmFnZU5vcm1hbC50YW5nZW50cyhmMS50LCBmMi50KTsgLy8gcmV0dXJuIGVxOwogICAgfQogICAgLyoqCiAgICAgKiBHZW5lcmF0ZSBhbGwgY29udGFjdHMgYmV0d2VlbiBhIGxpc3Qgb2YgYm9keSBwYWlycwogICAgICogQHBhcmFtIHAxIEFycmF5IG9mIGJvZHkgaW5kaWNlcwogICAgICogQHBhcmFtIHAyIEFycmF5IG9mIGJvZHkgaW5kaWNlcwogICAgICogQHBhcmFtIHJlc3VsdCBBcnJheSB0byBzdG9yZSBnZW5lcmF0ZWQgY29udGFjdHMKICAgICAqIEBwYXJhbSBvbGRjb250YWN0cyBPcHRpb25hbC4gQXJyYXkgb2YgcmV1c2FibGUgY29udGFjdCBvYmplY3RzCiAgICAgKi8KCgogICAgZ2V0Q29udGFjdHMocDEsIHAyLCB3b3JsZCwgcmVzdWx0LCBvbGRjb250YWN0cywgZnJpY3Rpb25SZXN1bHQsIGZyaWN0aW9uUG9vbCkgewogICAgICAvLyBTYXZlIG9sZCBjb250YWN0IG9iamVjdHMKICAgICAgdGhpcy5jb250YWN0UG9pbnRQb29sID0gb2xkY29udGFjdHM7CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblBvb2wgPSBmcmljdGlvblBvb2w7CiAgICAgIHRoaXMucmVzdWx0ID0gcmVzdWx0OwogICAgICB0aGlzLmZyaWN0aW9uUmVzdWx0ID0gZnJpY3Rpb25SZXN1bHQ7CiAgICAgIGNvbnN0IHFpID0gdG1wUXVhdDE7CiAgICAgIGNvbnN0IHFqID0gdG1wUXVhdDI7CiAgICAgIGNvbnN0IHhpID0gdG1wVmVjMTsKICAgICAgY29uc3QgeGogPSB0bXBWZWMyOwoKICAgICAgZm9yIChsZXQgayA9IDAsIE4gPSBwMS5sZW5ndGg7IGsgIT09IE47IGsrKykgewogICAgICAgIC8vIEdldCBjdXJyZW50IGNvbGxpc2lvbiBib2RpZXMKICAgICAgICBjb25zdCBiaSA9IHAxW2tdOwogICAgICAgIGNvbnN0IGJqID0gcDJba107IC8vIEdldCBjb250YWN0IG1hdGVyaWFsCgogICAgICAgIGxldCBib2R5Q29udGFjdE1hdGVyaWFsID0gbnVsbDsKCiAgICAgICAgaWYgKGJpLm1hdGVyaWFsICYmIGJqLm1hdGVyaWFsKSB7CiAgICAgICAgICBib2R5Q29udGFjdE1hdGVyaWFsID0gd29ybGQuZ2V0Q29udGFjdE1hdGVyaWFsKGJpLm1hdGVyaWFsLCBiai5tYXRlcmlhbCkgfHwgbnVsbDsKICAgICAgICB9CgogICAgICAgIGNvbnN0IGp1c3RUZXN0ID0gYmkudHlwZSAmIEJvZHkuS0lORU1BVElDICYmIGJqLnR5cGUgJiBCb2R5LlNUQVRJQyB8fCBiaS50eXBlICYgQm9keS5TVEFUSUMgJiYgYmoudHlwZSAmIEJvZHkuS0lORU1BVElDIHx8IGJpLnR5cGUgJiBCb2R5LktJTkVNQVRJQyAmJiBiai50eXBlICYgQm9keS5LSU5FTUFUSUM7CgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYmkuc2hhcGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBiaS5xdWF0ZXJuaW9uLm11bHQoYmkuc2hhcGVPcmllbnRhdGlvbnNbaV0sIHFpKTsKICAgICAgICAgIGJpLnF1YXRlcm5pb24udm11bHQoYmkuc2hhcGVPZmZzZXRzW2ldLCB4aSk7CiAgICAgICAgICB4aS52YWRkKGJpLnBvc2l0aW9uLCB4aSk7CiAgICAgICAgICBjb25zdCBzaSA9IGJpLnNoYXBlc1tpXTsKCiAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGJqLnNoYXBlcy5sZW5ndGg7IGorKykgewogICAgICAgICAgICAvLyBDb21wdXRlIHdvcmxkIHRyYW5zZm9ybSBvZiBzaGFwZXMKICAgICAgICAgICAgYmoucXVhdGVybmlvbi5tdWx0KGJqLnNoYXBlT3JpZW50YXRpb25zW2pdLCBxaik7CiAgICAgICAgICAgIGJqLnF1YXRlcm5pb24udm11bHQoYmouc2hhcGVPZmZzZXRzW2pdLCB4aik7CiAgICAgICAgICAgIHhqLnZhZGQoYmoucG9zaXRpb24sIHhqKTsKICAgICAgICAgICAgY29uc3Qgc2ogPSBiai5zaGFwZXNbal07CgogICAgICAgICAgICBpZiAoIShzaS5jb2xsaXNpb25GaWx0ZXJNYXNrICYgc2ouY29sbGlzaW9uRmlsdGVyR3JvdXAgJiYgc2ouY29sbGlzaW9uRmlsdGVyTWFzayAmIHNpLmNvbGxpc2lvbkZpbHRlckdyb3VwKSkgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoeGkuZGlzdGFuY2VUbyh4aikgPiBzaS5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNqLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0gLy8gR2V0IGNvbGxpc2lvbiBtYXRlcmlhbAoKCiAgICAgICAgICAgIGxldCBzaGFwZUNvbnRhY3RNYXRlcmlhbCA9IG51bGw7CgogICAgICAgICAgICBpZiAoc2kubWF0ZXJpYWwgJiYgc2oubWF0ZXJpYWwpIHsKICAgICAgICAgICAgICBzaGFwZUNvbnRhY3RNYXRlcmlhbCA9IHdvcmxkLmdldENvbnRhY3RNYXRlcmlhbChzaS5tYXRlcmlhbCwgc2oubWF0ZXJpYWwpIHx8IG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMuY3VycmVudENvbnRhY3RNYXRlcmlhbCA9IHNoYXBlQ29udGFjdE1hdGVyaWFsIHx8IGJvZHlDb250YWN0TWF0ZXJpYWwgfHwgd29ybGQuZGVmYXVsdENvbnRhY3RNYXRlcmlhbDsgLy8gR2V0IGNvbnRhY3RzCgogICAgICAgICAgICBjb25zdCByZXNvbHZlckluZGV4ID0gc2kudHlwZSB8IHNqLnR5cGU7CiAgICAgICAgICAgIGNvbnN0IHJlc29sdmVyID0gdGhpc1tyZXNvbHZlckluZGV4XTsKCiAgICAgICAgICAgIGlmIChyZXNvbHZlcikgewogICAgICAgICAgICAgIGxldCByZXR2YWwgPSBmYWxzZTsgLy8gVE8gRE86IGludmVzdGlnYXRlIHdoeSBzcGhlcmVQYXJ0aWNsZSBhbmQgY29udmV4UGFydGljbGUKICAgICAgICAgICAgICAvLyByZXNvbHZlcnMgZXhwZWN0IHNpIGFuZCBzaiBzaGFwZXMgdG8gYmUgaW4gcmV2ZXJzZSBvcmRlcgogICAgICAgICAgICAgIC8vIChpLmUuIGxhcmdlciBpbnRlZ2VyIHZhbHVlIHR5cGUgZmlyc3QgaW5zdGVhZCBvZiBzbWFsbGVyIGZpcnN0KQoKICAgICAgICAgICAgICBpZiAoc2kudHlwZSA8IHNqLnR5cGUpIHsKICAgICAgICAgICAgICAgIHJldHZhbCA9IHJlc29sdmVyLmNhbGwodGhpcywgc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dmFsID0gcmVzb2x2ZXIuY2FsbCh0aGlzLCBzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHNpLCBzaiwganVzdFRlc3QpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKHJldHZhbCAmJiBqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgLy8gUmVnaXN0ZXIgb3ZlcmxhcAogICAgICAgICAgICAgICAgd29ybGQuc2hhcGVPdmVybGFwS2VlcGVyLnNldChzaS5pZCwgc2ouaWQpOwogICAgICAgICAgICAgICAgd29ybGQuYm9keU92ZXJsYXBLZWVwZXIuc2V0KGJpLmlkLCBiai5pZCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgc3BoZXJlU3BoZXJlKHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgIHJldHVybiB4aS5kaXN0YW5jZVNxdWFyZWQoeGopIDwgKHNpLnJhZGl1cyArIHNqLnJhZGl1cykgKiogMjsKICAgICAgfSAvLyBXZSB3aWxsIGhhdmUgb25seSBvbmUgY29udGFjdCBpbiB0aGlzIGNhc2UKCgogICAgICBjb25zdCBjb250YWN0RXEgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOyAvLyBDb250YWN0IG5vcm1hbAoKICAgICAgeGoudnN1Yih4aSwgY29udGFjdEVxLm5pKTsKICAgICAgY29udGFjdEVxLm5pLm5vcm1hbGl6ZSgpOyAvLyBDb250YWN0IHBvaW50IGxvY2F0aW9ucwoKICAgICAgY29udGFjdEVxLnJpLmNvcHkoY29udGFjdEVxLm5pKTsKICAgICAgY29udGFjdEVxLnJqLmNvcHkoY29udGFjdEVxLm5pKTsKICAgICAgY29udGFjdEVxLnJpLnNjYWxlKHNpLnJhZGl1cywgY29udGFjdEVxLnJpKTsKICAgICAgY29udGFjdEVxLnJqLnNjYWxlKC1zai5yYWRpdXMsIGNvbnRhY3RFcS5yaik7CiAgICAgIGNvbnRhY3RFcS5yaS52YWRkKHhpLCBjb250YWN0RXEucmkpOwogICAgICBjb250YWN0RXEucmkudnN1YihiaS5wb3NpdGlvbiwgY29udGFjdEVxLnJpKTsKICAgICAgY29udGFjdEVxLnJqLnZhZGQoeGosIGNvbnRhY3RFcS5yaik7CiAgICAgIGNvbnRhY3RFcS5yai52c3ViKGJqLnBvc2l0aW9uLCBjb250YWN0RXEucmopOwogICAgICB0aGlzLnJlc3VsdC5wdXNoKGNvbnRhY3RFcSk7CiAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChjb250YWN0RXEsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgfQoKICAgIHNwaGVyZVBsYW5lKHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIC8vIFdlIHdpbGwgaGF2ZSBvbmUgY29udGFjdCBpbiB0aGlzIGNhc2UKICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7IC8vIENvbnRhY3Qgbm9ybWFsCgogICAgICByLm5pLnNldCgwLCAwLCAxKTsKICAgICAgcWoudm11bHQoci5uaSwgci5uaSk7CiAgICAgIHIubmkubmVnYXRlKHIubmkpOyAvLyBib2R5IGkgaXMgdGhlIHNwaGVyZSwgZmxpcCBub3JtYWwKCiAgICAgIHIubmkubm9ybWFsaXplKCk7IC8vIE5lZWRlZD8KICAgICAgLy8gVmVjdG9yIGZyb20gc3BoZXJlIGNlbnRlciB0byBjb250YWN0IHBvaW50CgogICAgICByLm5pLnNjYWxlKHNpLnJhZGl1cywgci5yaSk7IC8vIFByb2plY3QgZG93biBzcGhlcmUgb24gcGxhbmUKCiAgICAgIHhpLnZzdWIoeGosIHBvaW50X29uX3BsYW5lX3RvX3NwaGVyZSk7CiAgICAgIHIubmkuc2NhbGUoci5uaS5kb3QocG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlKSwgcGxhbmVfdG9fc3BoZXJlX29ydGhvKTsKICAgICAgcG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlLnZzdWIocGxhbmVfdG9fc3BoZXJlX29ydGhvLCByLnJqKTsgLy8gVGhlIHNwaGVyZSBwb3NpdGlvbiBwcm9qZWN0ZWQgdG8gcGxhbmUKCiAgICAgIGlmICgtcG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlLmRvdChyLm5pKSA8PSBzaS5yYWRpdXMpIHsKICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gLy8gTWFrZSBpdCByZWxhdGl2ZSB0byB0aGUgYm9keQoKCiAgICAgICAgY29uc3QgcmkgPSByLnJpOwogICAgICAgIGNvbnN0IHJqID0gci5yajsKICAgICAgICByaS52YWRkKHhpLCByaSk7CiAgICAgICAgcmkudnN1YihiaS5wb3NpdGlvbiwgcmkpOwogICAgICAgIHJqLnZhZGQoeGosIHJqKTsKICAgICAgICByai52c3ViKGJqLnBvc2l0aW9uLCByaik7CiAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgIH0KICAgIH0KCiAgICBib3hCb3goc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2kubWF0ZXJpYWw7CiAgICAgIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5tYXRlcmlhbCA9IHNqLm1hdGVyaWFsOwogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uY29sbGlzaW9uUmVzcG9uc2UgPSBzaS5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgc2ouY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLmNvbGxpc2lvblJlc3BvbnNlID0gc2ouY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleENvbnZleChzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgc2ksIHNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgc3BoZXJlQm94KHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGNvbnN0IHYzcG9vbCA9IHRoaXMudjNwb29sOyAvLyB3ZSByZWZlciB0byB0aGUgYm94IGFzIGJvZHkgagoKICAgICAgY29uc3Qgc2lkZXMgPSBzcGhlcmVCb3hfc2lkZXM7CiAgICAgIHhpLnZzdWIoeGosIGJveF90b19zcGhlcmUpOwogICAgICBzai5nZXRTaWRlTm9ybWFscyhzaWRlcywgcWopOwogICAgICBjb25zdCBSID0gc2kucmFkaXVzOwoKICAgICAgbGV0IGZvdW5kID0gZmFsc2U7IC8vIFN0b3JlIHRoZSByZXN1bHRpbmcgc2lkZSBwZW5ldHJhdGlvbiBpbmZvCgogICAgICBjb25zdCBzaWRlX25zID0gc3BoZXJlQm94X3NpZGVfbnM7CiAgICAgIGNvbnN0IHNpZGVfbnMxID0gc3BoZXJlQm94X3NpZGVfbnMxOwogICAgICBjb25zdCBzaWRlX25zMiA9IHNwaGVyZUJveF9zaWRlX25zMjsKICAgICAgbGV0IHNpZGVfaCA9IG51bGw7CiAgICAgIGxldCBzaWRlX3BlbmV0cmF0aW9ucyA9IDA7CiAgICAgIGxldCBzaWRlX2RvdDEgPSAwOwogICAgICBsZXQgc2lkZV9kb3QyID0gMDsKICAgICAgbGV0IHNpZGVfZGlzdGFuY2UgPSBudWxsOwoKICAgICAgZm9yIChsZXQgaWR4ID0gMCwgbnNpZGVzID0gc2lkZXMubGVuZ3RoOyBpZHggIT09IG5zaWRlcyAmJiBmb3VuZCA9PT0gZmFsc2U7IGlkeCsrKSB7CiAgICAgICAgLy8gR2V0IHRoZSBwbGFuZSBzaWRlIG5vcm1hbCAobnMpCiAgICAgICAgY29uc3QgbnMgPSBzcGhlcmVCb3hfbnM7CiAgICAgICAgbnMuY29weShzaWRlc1tpZHhdKTsKICAgICAgICBjb25zdCBoID0gbnMubGVuZ3RoKCk7CiAgICAgICAgbnMubm9ybWFsaXplKCk7IC8vIFRoZSBub3JtYWwvZGlzdGFuY2UgZG90IHByb2R1Y3QgdGVsbHMgd2hpY2ggc2lkZSBvZiB0aGUgcGxhbmUgd2UgYXJlCgogICAgICAgIGNvbnN0IGRvdCA9IGJveF90b19zcGhlcmUuZG90KG5zKTsKCiAgICAgICAgaWYgKGRvdCA8IGggKyBSICYmIGRvdCA+IDApIHsKICAgICAgICAgIC8vIEludGVyc2VjdHMgcGxhbmUuIE5vdyBjaGVjayB0aGUgb3RoZXIgdHdvIGRpbWVuc2lvbnMKICAgICAgICAgIGNvbnN0IG5zMSA9IHNwaGVyZUJveF9uczE7CiAgICAgICAgICBjb25zdCBuczIgPSBzcGhlcmVCb3hfbnMyOwogICAgICAgICAgbnMxLmNvcHkoc2lkZXNbKGlkeCArIDEpICUgM10pOwogICAgICAgICAgbnMyLmNvcHkoc2lkZXNbKGlkeCArIDIpICUgM10pOwogICAgICAgICAgY29uc3QgaDEgPSBuczEubGVuZ3RoKCk7CiAgICAgICAgICBjb25zdCBoMiA9IG5zMi5sZW5ndGgoKTsKICAgICAgICAgIG5zMS5ub3JtYWxpemUoKTsKICAgICAgICAgIG5zMi5ub3JtYWxpemUoKTsKICAgICAgICAgIGNvbnN0IGRvdDEgPSBib3hfdG9fc3BoZXJlLmRvdChuczEpOwogICAgICAgICAgY29uc3QgZG90MiA9IGJveF90b19zcGhlcmUuZG90KG5zMik7CgogICAgICAgICAgaWYgKGRvdDEgPCBoMSAmJiBkb3QxID4gLWgxICYmIGRvdDIgPCBoMiAmJiBkb3QyID4gLWgyKSB7CiAgICAgICAgICAgIGNvbnN0IGRpc3QgPSBNYXRoLmFicyhkb3QgLSBoIC0gUik7CgogICAgICAgICAgICBpZiAoc2lkZV9kaXN0YW5jZSA9PT0gbnVsbCB8fCBkaXN0IDwgc2lkZV9kaXN0YW5jZSkgewogICAgICAgICAgICAgIHNpZGVfZGlzdGFuY2UgPSBkaXN0OwogICAgICAgICAgICAgIHNpZGVfZG90MSA9IGRvdDE7CiAgICAgICAgICAgICAgc2lkZV9kb3QyID0gZG90MjsKICAgICAgICAgICAgICBzaWRlX2ggPSBoOwogICAgICAgICAgICAgIHNpZGVfbnMuY29weShucyk7CiAgICAgICAgICAgICAgc2lkZV9uczEuY29weShuczEpOwogICAgICAgICAgICAgIHNpZGVfbnMyLmNvcHkobnMyKTsKICAgICAgICAgICAgICBzaWRlX3BlbmV0cmF0aW9ucysrOwoKICAgICAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHNpZGVfcGVuZXRyYXRpb25zKSB7CiAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgIHNpZGVfbnMuc2NhbGUoLVIsIHIucmkpOyAvLyBTcGhlcmUgcgoKICAgICAgICByLm5pLmNvcHkoc2lkZV9ucyk7CiAgICAgICAgci5uaS5uZWdhdGUoci5uaSk7IC8vIE5vcm1hbCBzaG91bGQgYmUgb3V0IG9mIHNwaGVyZQoKICAgICAgICBzaWRlX25zLnNjYWxlKHNpZGVfaCwgc2lkZV9ucyk7CiAgICAgICAgc2lkZV9uczEuc2NhbGUoc2lkZV9kb3QxLCBzaWRlX25zMSk7CiAgICAgICAgc2lkZV9ucy52YWRkKHNpZGVfbnMxLCBzaWRlX25zKTsKICAgICAgICBzaWRlX25zMi5zY2FsZShzaWRlX2RvdDIsIHNpZGVfbnMyKTsKICAgICAgICBzaWRlX25zLnZhZGQoc2lkZV9uczIsIHIucmopOyAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwoKICAgICAgICByLnJpLnZhZGQoeGksIHIucmkpOwogICAgICAgIHIucmkudnN1YihiaS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgci5yai52YWRkKHhqLCByLnJqKTsKICAgICAgICByLnJqLnZzdWIoYmoucG9zaXRpb24sIHIucmopOwogICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICB9IC8vIENoZWNrIGNvcm5lcnMKCgogICAgICBsZXQgcmogPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IHNwaGVyZV90b19jb3JuZXIgPSBzcGhlcmVCb3hfc3BoZXJlX3RvX2Nvcm5lcjsKCiAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSAyICYmICFmb3VuZDsgaisrKSB7CiAgICAgICAgZm9yIChsZXQgayA9IDA7IGsgIT09IDIgJiYgIWZvdW5kOyBrKyspIHsKICAgICAgICAgIGZvciAobGV0IGwgPSAwOyBsICE9PSAyICYmICFmb3VuZDsgbCsrKSB7CiAgICAgICAgICAgIHJqLnNldCgwLCAwLCAwKTsKCiAgICAgICAgICAgIGlmIChqKSB7CiAgICAgICAgICAgICAgcmoudmFkZChzaWRlc1swXSwgcmopOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJqLnZzdWIoc2lkZXNbMF0sIHJqKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGspIHsKICAgICAgICAgICAgICByai52YWRkKHNpZGVzWzFdLCByaik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmoudnN1YihzaWRlc1sxXSwgcmopOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAobCkgewogICAgICAgICAgICAgIHJqLnZhZGQoc2lkZXNbMl0sIHJqKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByai52c3ViKHNpZGVzWzJdLCByaik7CiAgICAgICAgICAgIH0gLy8gV29ybGQgcG9zaXRpb24gb2YgY29ybmVyCgoKICAgICAgICAgICAgeGoudmFkZChyaiwgc3BoZXJlX3RvX2Nvcm5lcik7CiAgICAgICAgICAgIHNwaGVyZV90b19jb3JuZXIudnN1Yih4aSwgc3BoZXJlX3RvX2Nvcm5lcik7CgogICAgICAgICAgICBpZiAoc3BoZXJlX3RvX2Nvcm5lci5sZW5ndGhTcXVhcmVkKCkgPCBSICogUikgewogICAgICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICAgICAgci5yaS5jb3B5KHNwaGVyZV90b19jb3JuZXIpOwogICAgICAgICAgICAgIHIucmkubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgci5uaS5jb3B5KHIucmkpOwogICAgICAgICAgICAgIHIucmkuc2NhbGUoUiwgci5yaSk7CiAgICAgICAgICAgICAgci5yai5jb3B5KHJqKTsgLy8gTWFrZSByZWxhdGl2ZSB0byBib2RpZXMKCiAgICAgICAgICAgICAgci5yaS52YWRkKHhpLCByLnJpKTsKICAgICAgICAgICAgICByLnJpLnZzdWIoYmkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgICAgIHIucmoudmFkZCh4aiwgci5yaik7CiAgICAgICAgICAgICAgci5yai52c3ViKGJqLnBvc2l0aW9uLCByLnJqKTsKICAgICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgdjNwb29sLnJlbGVhc2UocmopOwogICAgICByaiA9IG51bGw7IC8vIENoZWNrIGVkZ2VzCgogICAgICBjb25zdCBlZGdlVGFuZ2VudCA9IHYzcG9vbC5nZXQoKTsKICAgICAgY29uc3QgZWRnZUNlbnRlciA9IHYzcG9vbC5nZXQoKTsKICAgICAgY29uc3QgciA9IHYzcG9vbC5nZXQoKTsgLy8gciA9IGVkZ2UgY2VudGVyIHRvIHNwaGVyZSBjZW50ZXIKCiAgICAgIGNvbnN0IG9ydGhvZ29uYWwgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IGRpc3QgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IE5zaWRlcyA9IHNpZGVzLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBOc2lkZXMgJiYgIWZvdW5kOyBqKyspIHsKICAgICAgICBmb3IgKGxldCBrID0gMDsgayAhPT0gTnNpZGVzICYmICFmb3VuZDsgaysrKSB7CiAgICAgICAgICBpZiAoaiAlIDMgIT09IGsgJSAzKSB7CiAgICAgICAgICAgIC8vIEdldCBlZGdlIHRhbmdlbnQKICAgICAgICAgICAgc2lkZXNba10uY3Jvc3Moc2lkZXNbal0sIGVkZ2VUYW5nZW50KTsKICAgICAgICAgICAgZWRnZVRhbmdlbnQubm9ybWFsaXplKCk7CiAgICAgICAgICAgIHNpZGVzW2pdLnZhZGQoc2lkZXNba10sIGVkZ2VDZW50ZXIpOwogICAgICAgICAgICByLmNvcHkoeGkpOwogICAgICAgICAgICByLnZzdWIoZWRnZUNlbnRlciwgcik7CiAgICAgICAgICAgIHIudnN1Yih4aiwgcik7CiAgICAgICAgICAgIGNvbnN0IG9ydGhvbm9ybSA9IHIuZG90KGVkZ2VUYW5nZW50KTsgLy8gZGlzdGFuY2UgZnJvbSBlZGdlIGNlbnRlciB0byBzcGhlcmUgY2VudGVyIGluIHRoZSB0YW5nZW50IGRpcmVjdGlvbgoKICAgICAgICAgICAgZWRnZVRhbmdlbnQuc2NhbGUob3J0aG9ub3JtLCBvcnRob2dvbmFsKTsgLy8gVmVjdG9yIGZyb20gZWRnZSBjZW50ZXIgdG8gc3BoZXJlIGNlbnRlciBpbiB0aGUgdGFuZ2VudCBkaXJlY3Rpb24KICAgICAgICAgICAgLy8gRmluZCB0aGUgdGhpcmQgc2lkZSBvcnRob2dvbmFsIHRvIHRoaXMgb25lCgogICAgICAgICAgICBsZXQgbCA9IDA7CgogICAgICAgICAgICB3aGlsZSAobCA9PT0gaiAlIDMgfHwgbCA9PT0gayAlIDMpIHsKICAgICAgICAgICAgICBsKys7CiAgICAgICAgICAgIH0gLy8gdmVjIGZyb20gZWRnZSBjZW50ZXIgdG8gc3BoZXJlIHByb2plY3RlZCB0byB0aGUgcGxhbmUgb3J0aG9nb25hbCB0byB0aGUgZWRnZSB0YW5nZW50CgoKICAgICAgICAgICAgZGlzdC5jb3B5KHhpKTsKICAgICAgICAgICAgZGlzdC52c3ViKG9ydGhvZ29uYWwsIGRpc3QpOwogICAgICAgICAgICBkaXN0LnZzdWIoZWRnZUNlbnRlciwgZGlzdCk7CiAgICAgICAgICAgIGRpc3QudnN1Yih4aiwgZGlzdCk7IC8vIERpc3RhbmNlcyBpbiB0YW5nZW50IGRpcmVjdGlvbiBhbmQgZGlzdGFuY2UgaW4gdGhlIHBsYW5lIG9ydGhvZ29uYWwgdG8gaXQKCiAgICAgICAgICAgIGNvbnN0IHRkaXN0ID0gTWF0aC5hYnMob3J0aG9ub3JtKTsKICAgICAgICAgICAgY29uc3QgbmRpc3QgPSBkaXN0Lmxlbmd0aCgpOwoKICAgICAgICAgICAgaWYgKHRkaXN0IDwgc2lkZXNbbF0ubGVuZ3RoKCkgJiYgbmRpc3QgPCBSKSB7CiAgICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgICBjb25zdCByZXMgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgICAgIGVkZ2VDZW50ZXIudmFkZChvcnRob2dvbmFsLCByZXMucmopOyAvLyBib3ggcmoKCiAgICAgICAgICAgICAgcmVzLnJqLmNvcHkocmVzLnJqKTsKICAgICAgICAgICAgICBkaXN0Lm5lZ2F0ZShyZXMubmkpOwogICAgICAgICAgICAgIHJlcy5uaS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICByZXMucmkuY29weShyZXMucmopOwogICAgICAgICAgICAgIHJlcy5yaS52YWRkKHhqLCByZXMucmkpOwogICAgICAgICAgICAgIHJlcy5yaS52c3ViKHhpLCByZXMucmkpOwogICAgICAgICAgICAgIHJlcy5yaS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICByZXMucmkuc2NhbGUoUiwgcmVzLnJpKTsgLy8gTWFrZSByZWxhdGl2ZSB0byBib2RpZXMKCiAgICAgICAgICAgICAgcmVzLnJpLnZhZGQoeGksIHJlcy5yaSk7CiAgICAgICAgICAgICAgcmVzLnJpLnZzdWIoYmkucG9zaXRpb24sIHJlcy5yaSk7CiAgICAgICAgICAgICAgcmVzLnJqLnZhZGQoeGosIHJlcy5yaik7CiAgICAgICAgICAgICAgcmVzLnJqLnZzdWIoYmoucG9zaXRpb24sIHJlcy5yaik7CiAgICAgICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyZXMpOwogICAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyZXMsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB2M3Bvb2wucmVsZWFzZShlZGdlVGFuZ2VudCwgZWRnZUNlbnRlciwgciwgb3J0aG9nb25hbCwgZGlzdCk7CiAgICB9CgogICAgcGxhbmVCb3goc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2ouY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2oubWF0ZXJpYWw7CiAgICAgIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNqLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICBzai5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uaWQgPSBzai5pZDsKICAgICAgcmV0dXJuIHRoaXMucGxhbmVDb252ZXgoc2ksIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgc2ksIHNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgY29udmV4Q29udmV4KHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0LCBmYWNlTGlzdEEsIGZhY2VMaXN0QikgewogICAgICBjb25zdCBzZXBBeGlzID0gY29udmV4Q29udmV4X3NlcEF4aXM7CgogICAgICBpZiAoeGkuZGlzdGFuY2VUbyh4aikgPiBzaS5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNqLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoc2kuZmluZFNlcGFyYXRpbmdBeGlzKHNqLCB4aSwgcWksIHhqLCBxaiwgc2VwQXhpcywgZmFjZUxpc3RBLCBmYWNlTGlzdEIpKSB7CiAgICAgICAgY29uc3QgcmVzID0gW107CiAgICAgICAgY29uc3QgcSA9IGNvbnZleENvbnZleF9xOwogICAgICAgIHNpLmNsaXBBZ2FpbnN0SHVsbCh4aSwgcWksIHNqLCB4aiwgcWosIHNlcEF4aXMsIC0xMDAsIDEwMCwgcmVzKTsKICAgICAgICBsZXQgbnVtQ29udGFjdHMgPSAwOwoKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gcmVzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICBjb25zdCByaSA9IHIucmk7CiAgICAgICAgICBjb25zdCByaiA9IHIucmo7CiAgICAgICAgICBzZXBBeGlzLm5lZ2F0ZShyLm5pKTsKICAgICAgICAgIHJlc1tqXS5ub3JtYWwubmVnYXRlKHEpOwogICAgICAgICAgcS5zY2FsZShyZXNbal0uZGVwdGgsIHEpOwogICAgICAgICAgcmVzW2pdLnBvaW50LnZhZGQocSwgcmkpOwogICAgICAgICAgcmouY29weShyZXNbal0ucG9pbnQpOyAvLyBDb250YWN0IHBvaW50cyBhcmUgaW4gd29ybGQgY29vcmRpbmF0ZXMuIFRyYW5zZm9ybSBiYWNrIHRvIHJlbGF0aXZlCgogICAgICAgICAgcmkudnN1Yih4aSwgcmkpOwogICAgICAgICAgcmoudnN1Yih4aiwgcmopOyAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwoKICAgICAgICAgIHJpLnZhZGQoeGksIHJpKTsKICAgICAgICAgIHJpLnZzdWIoYmkucG9zaXRpb24sIHJpKTsKICAgICAgICAgIHJqLnZhZGQoeGosIHJqKTsKICAgICAgICAgIHJqLnZzdWIoYmoucG9zaXRpb24sIHJqKTsKICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICBudW1Db250YWN0cysrOwoKICAgICAgICAgIGlmICghdGhpcy5lbmFibGVGcmljdGlvblJlZHVjdGlvbikgewogICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5lbmFibGVGcmljdGlvblJlZHVjdGlvbiAmJiBudW1Db250YWN0cykgewogICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkZyb21BdmVyYWdlKG51bUNvbnRhY3RzKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBzcGhlcmVDb252ZXgoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgY29uc3QgdjNwb29sID0gdGhpcy52M3Bvb2w7CiAgICAgIHhpLnZzdWIoeGosIGNvbnZleF90b19zcGhlcmUpOwogICAgICBjb25zdCBub3JtYWxzID0gc2ouZmFjZU5vcm1hbHM7CiAgICAgIGNvbnN0IGZhY2VzID0gc2ouZmFjZXM7CiAgICAgIGNvbnN0IHZlcnRzID0gc2oudmVydGljZXM7CiAgICAgIGNvbnN0IFIgPSBzaS5yYWRpdXM7CiAgICAgIC8vICAgICByZXR1cm47CiAgICAgIC8vIH0KCiAgICAgIGxldCBmb3VuZCA9IGZhbHNlOyAvLyBDaGVjayBjb3JuZXJzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gdmVydHNbaV07IC8vIFdvcmxkIHBvc2l0aW9uIG9mIGNvcm5lcgoKICAgICAgICBjb25zdCB3b3JsZENvcm5lciA9IHNwaGVyZUNvbnZleF93b3JsZENvcm5lcjsKICAgICAgICBxai52bXVsdCh2LCB3b3JsZENvcm5lcik7CiAgICAgICAgeGoudmFkZCh3b3JsZENvcm5lciwgd29ybGRDb3JuZXIpOwogICAgICAgIGNvbnN0IHNwaGVyZV90b19jb3JuZXIgPSBzcGhlcmVDb252ZXhfc3BoZXJlVG9Db3JuZXI7CiAgICAgICAgd29ybGRDb3JuZXIudnN1Yih4aSwgc3BoZXJlX3RvX2Nvcm5lcik7CgogICAgICAgIGlmIChzcGhlcmVfdG9fY29ybmVyLmxlbmd0aFNxdWFyZWQoKSA8IFIgKiBSKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICByLnJpLmNvcHkoc3BoZXJlX3RvX2Nvcm5lcik7CiAgICAgICAgICByLnJpLm5vcm1hbGl6ZSgpOwogICAgICAgICAgci5uaS5jb3B5KHIucmkpOwogICAgICAgICAgci5yaS5zY2FsZShSLCByLnJpKTsKICAgICAgICAgIHdvcmxkQ29ybmVyLnZzdWIoeGosIHIucmopOyAvLyBTaG91bGQgYmUgcmVsYXRpdmUgdG8gdGhlIGJvZHkuCgogICAgICAgICAgci5yaS52YWRkKHhpLCByLnJpKTsKICAgICAgICAgIHIucmkudnN1YihiaS5wb3NpdGlvbiwgci5yaSk7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICByLnJqLnZhZGQoeGosIHIucmopOwogICAgICAgICAgci5yai52c3ViKGJqLnBvc2l0aW9uLCByLnJqKTsKICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICB9IC8vIENoZWNrIHNpZGUgKHBsYW5lKSBpbnRlcnNlY3Rpb25zCgoKICAgICAgZm9yIChsZXQgaSA9IDAsIG5mYWNlcyA9IGZhY2VzLmxlbmd0aDsgaSAhPT0gbmZhY2VzICYmIGZvdW5kID09PSBmYWxzZTsgaSsrKSB7CiAgICAgICAgY29uc3Qgbm9ybWFsID0gbm9ybWFsc1tpXTsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbaV07IC8vIEdldCB3b3JsZC10cmFuc2Zvcm1lZCBub3JtYWwgb2YgdGhlIGZhY2UKCiAgICAgICAgY29uc3Qgd29ybGROb3JtYWwgPSBzcGhlcmVDb252ZXhfd29ybGROb3JtYWw7CiAgICAgICAgcWoudm11bHQobm9ybWFsLCB3b3JsZE5vcm1hbCk7IC8vIEdldCBhIHdvcmxkIHZlcnRleCBmcm9tIHRoZSBmYWNlCgogICAgICAgIGNvbnN0IHdvcmxkUG9pbnQgPSBzcGhlcmVDb252ZXhfd29ybGRQb2ludDsKICAgICAgICBxai52bXVsdCh2ZXJ0c1tmYWNlWzBdXSwgd29ybGRQb2ludCk7CiAgICAgICAgd29ybGRQb2ludC52YWRkKHhqLCB3b3JsZFBvaW50KTsgLy8gR2V0IGEgcG9pbnQgb24gdGhlIHNwaGVyZSwgY2xvc2VzdCB0byB0aGUgZmFjZSBub3JtYWwKCiAgICAgICAgY29uc3Qgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lID0gc3BoZXJlQ29udmV4X3dvcmxkU3BoZXJlUG9pbnRDbG9zZXN0VG9QbGFuZTsKICAgICAgICB3b3JsZE5vcm1hbC5zY2FsZSgtUiwgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lKTsKICAgICAgICB4aS52YWRkKHdvcmxkU3BoZXJlUG9pbnRDbG9zZXN0VG9QbGFuZSwgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lKTsgLy8gVmVjdG9yIGZyb20gYSBmYWNlIHBvaW50IHRvIHRoZSBjbG9zZXN0IHBvaW50IG9uIHRoZSBzcGhlcmUKCiAgICAgICAgY29uc3QgcGVuZXRyYXRpb25WZWMgPSBzcGhlcmVDb252ZXhfcGVuZXRyYXRpb25WZWM7CiAgICAgICAgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lLnZzdWIod29ybGRQb2ludCwgcGVuZXRyYXRpb25WZWMpOyAvLyBUaGUgcGVuZXRyYXRpb24uIE5lZ2F0aXZlIHZhbHVlIG1lYW5zIG92ZXJsYXAuCgogICAgICAgIGNvbnN0IHBlbmV0cmF0aW9uID0gcGVuZXRyYXRpb25WZWMuZG90KHdvcmxkTm9ybWFsKTsKICAgICAgICBjb25zdCB3b3JsZFBvaW50VG9TcGhlcmUgPSBzcGhlcmVDb252ZXhfc3BoZXJlVG9Xb3JsZFBvaW50OwogICAgICAgIHhpLnZzdWIod29ybGRQb2ludCwgd29ybGRQb2ludFRvU3BoZXJlKTsKCiAgICAgICAgaWYgKHBlbmV0cmF0aW9uIDwgMCAmJiB3b3JsZFBvaW50VG9TcGhlcmUuZG90KHdvcmxkTm9ybWFsKSA+IDApIHsKICAgICAgICAgIC8vIEludGVyc2VjdHMgcGxhbmUuIE5vdyBjaGVjayBpZiB0aGUgc3BoZXJlIGlzIGluc2lkZSB0aGUgZmFjZSBwb2x5Z29uCiAgICAgICAgICBjb25zdCBmYWNlVmVydHMgPSBbXTsgLy8gRmFjZSB2ZXJ0aWNlcywgaW4gd29ybGQgY29vcmRzCgogICAgICAgICAgZm9yIChsZXQgaiA9IDAsIE52ZXJ0cyA9IGZhY2UubGVuZ3RoOyBqICE9PSBOdmVydHM7IGorKykgewogICAgICAgICAgICBjb25zdCB3b3JsZFZlcnRleCA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgcWoudm11bHQodmVydHNbZmFjZVtqXV0sIHdvcmxkVmVydGV4KTsKICAgICAgICAgICAgeGoudmFkZCh3b3JsZFZlcnRleCwgd29ybGRWZXJ0ZXgpOwogICAgICAgICAgICBmYWNlVmVydHMucHVzaCh3b3JsZFZlcnRleCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHBvaW50SW5Qb2x5Z29uKGZhY2VWZXJ0cywgd29ybGROb3JtYWwsIHhpKSkgewogICAgICAgICAgICAvLyBJcyB0aGUgc3BoZXJlIGNlbnRlciBpbiB0aGUgZmFjZSBwb2x5Z29uPwogICAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICAgICAgd29ybGROb3JtYWwuc2NhbGUoLVIsIHIucmkpOyAvLyBDb250YWN0IG9mZnNldCwgZnJvbSBzcGhlcmUgY2VudGVyIHRvIGNvbnRhY3QKCiAgICAgICAgICAgIHdvcmxkTm9ybWFsLm5lZ2F0ZShyLm5pKTsgLy8gTm9ybWFsIHBvaW50aW5nIG91dCBvZiBzcGhlcmUKCiAgICAgICAgICAgIGNvbnN0IHBlbmV0cmF0aW9uVmVjMiA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgd29ybGROb3JtYWwuc2NhbGUoLXBlbmV0cmF0aW9uLCBwZW5ldHJhdGlvblZlYzIpOwogICAgICAgICAgICBjb25zdCBwZW5ldHJhdGlvblNwaGVyZVBvaW50ID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICB3b3JsZE5vcm1hbC5zY2FsZSgtUiwgcGVuZXRyYXRpb25TcGhlcmVQb2ludCk7IC8veGkudnN1Yih4aikudmFkZChwZW5ldHJhdGlvblNwaGVyZVBvaW50KS52YWRkKHBlbmV0cmF0aW9uVmVjMiAsIHIucmopOwoKICAgICAgICAgICAgeGkudnN1Yih4aiwgci5yaik7CiAgICAgICAgICAgIHIucmoudmFkZChwZW5ldHJhdGlvblNwaGVyZVBvaW50LCByLnJqKTsKICAgICAgICAgICAgci5yai52YWRkKHBlbmV0cmF0aW9uVmVjMiwgci5yaik7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICAgIHIucmoudmFkZCh4aiwgci5yaik7CiAgICAgICAgICAgIHIucmoudnN1Yihiai5wb3NpdGlvbiwgci5yaik7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICAgIHIucmkudmFkZCh4aSwgci5yaSk7CiAgICAgICAgICAgIHIucmkudnN1YihiaS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHBlbmV0cmF0aW9uVmVjMik7CiAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHBlbmV0cmF0aW9uU3BoZXJlUG9pbnQpOwogICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7IC8vIFJlbGVhc2Ugd29ybGQgdmVydGljZXMKCiAgICAgICAgICAgIGZvciAobGV0IGogPSAwLCBOZmFjZXZlcnRzID0gZmFjZVZlcnRzLmxlbmd0aDsgaiAhPT0gTmZhY2V2ZXJ0czsgaisrKSB7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UoZmFjZVZlcnRzW2pdKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuOyAvLyBXZSBvbmx5IGV4cGVjdCAqb25lKiBmYWNlIGNvbnRhY3QKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIEVkZ2U/CiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBmYWNlLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgLy8gR2V0IHR3byB3b3JsZCB0cmFuc2Zvcm1lZCB2ZXJ0aWNlcwogICAgICAgICAgICAgIGNvbnN0IHYxID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIGNvbnN0IHYyID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIHFqLnZtdWx0KHZlcnRzW2ZhY2VbKGogKyAxKSAlIGZhY2UubGVuZ3RoXV0sIHYxKTsKICAgICAgICAgICAgICBxai52bXVsdCh2ZXJ0c1tmYWNlWyhqICsgMikgJSBmYWNlLmxlbmd0aF1dLCB2Mik7CiAgICAgICAgICAgICAgeGoudmFkZCh2MSwgdjEpOwogICAgICAgICAgICAgIHhqLnZhZGQodjIsIHYyKTsgLy8gQ29uc3RydWN0IGVkZ2UgdmVjdG9yCgogICAgICAgICAgICAgIGNvbnN0IGVkZ2UgPSBzcGhlcmVDb252ZXhfZWRnZTsKICAgICAgICAgICAgICB2Mi52c3ViKHYxLCBlZGdlKTsgLy8gQ29uc3RydWN0IHRoZSBzYW1lIHZlY3RvciwgYnV0IG5vcm1hbGl6ZWQKCiAgICAgICAgICAgICAgY29uc3QgZWRnZVVuaXQgPSBzcGhlcmVDb252ZXhfZWRnZVVuaXQ7CiAgICAgICAgICAgICAgZWRnZS51bml0KGVkZ2VVbml0KTsgLy8gcCBpcyB4aSBwcm9qZWN0ZWQgb250byB0aGUgZWRnZQoKICAgICAgICAgICAgICBjb25zdCBwID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIGNvbnN0IHYxX3RvX3hpID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIHhpLnZzdWIodjEsIHYxX3RvX3hpKTsKICAgICAgICAgICAgICBjb25zdCBkb3QgPSB2MV90b194aS5kb3QoZWRnZVVuaXQpOwogICAgICAgICAgICAgIGVkZ2VVbml0LnNjYWxlKGRvdCwgcCk7CiAgICAgICAgICAgICAgcC52YWRkKHYxLCBwKTsgLy8gQ29tcHV0ZSBhIHZlY3RvciBmcm9tIHAgdG8gdGhlIGNlbnRlciBvZiB0aGUgc3BoZXJlCgogICAgICAgICAgICAgIGNvbnN0IHhpX3RvX3AgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgICAgICAgICAgcC52c3ViKHhpLCB4aV90b19wKTsgLy8gQ29sbGlzaW9uIGlmIHRoZSBlZGdlLXNwaGVyZSBkaXN0YW5jZSBpcyBsZXNzIHRoYW4gdGhlIHJhZGl1cwogICAgICAgICAgICAgIC8vIEFORCBpZiBwIGlzIGluIGJldHdlZW4gdjEgYW5kIHYyCgogICAgICAgICAgICAgIGlmIChkb3QgPiAwICYmIGRvdCAqIGRvdCA8IGVkZ2UubGVuZ3RoU3F1YXJlZCgpICYmIHhpX3RvX3AubGVuZ3RoU3F1YXJlZCgpIDwgUiAqIFIpIHsKICAgICAgICAgICAgICAgIC8vIENvbGxpc2lvbiBpZiB0aGUgZWRnZS1zcGhlcmUgZGlzdGFuY2UgaXMgbGVzcyB0aGFuIHRoZSByYWRpdXMKICAgICAgICAgICAgICAgIC8vIEVkZ2UgY29udGFjdCEKICAgICAgICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICAgICAgICAgIHAudnN1Yih4aiwgci5yaik7CiAgICAgICAgICAgICAgICBwLnZzdWIoeGksIHIubmkpOwogICAgICAgICAgICAgICAgci5uaS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICAgIHIubmkuc2NhbGUoUiwgci5yaSk7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICAgICAgICByLnJqLnZhZGQoeGosIHIucmopOwogICAgICAgICAgICAgICAgci5yai52c3ViKGJqLnBvc2l0aW9uLCByLnJqKTsgLy8gU2hvdWxkIGJlIHJlbGF0aXZlIHRvIHRoZSBib2R5LgoKICAgICAgICAgICAgICAgIHIucmkudmFkZCh4aSwgci5yaSk7CiAgICAgICAgICAgICAgICByLnJpLnZzdWIoYmkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsgLy8gUmVsZWFzZSB3b3JsZCB2ZXJ0aWNlcwoKICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwLCBOZmFjZXZlcnRzID0gZmFjZVZlcnRzLmxlbmd0aDsgaiAhPT0gTmZhY2V2ZXJ0czsgaisrKSB7CiAgICAgICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKGZhY2VWZXJ0c1tqXSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjEpOwogICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjIpOwogICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UocCk7CiAgICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZSh4aV90b19wKTsKICAgICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHYxX3RvX3hpKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHYxKTsKICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZSh2Mik7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UocCk7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UoeGlfdG9fcCk7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjFfdG9feGkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IC8vIFJlbGVhc2Ugd29ybGQgdmVydGljZXMKCgogICAgICAgICAgZm9yIChsZXQgaiA9IDAsIE5mYWNldmVydHMgPSBmYWNlVmVydHMubGVuZ3RoOyBqICE9PSBOZmFjZXZlcnRzOyBqKyspIHsKICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UoZmFjZVZlcnRzW2pdKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBwbGFuZUNvbnZleChwbGFuZVNoYXBlLCBjb252ZXhTaGFwZSwgcGxhbmVQb3NpdGlvbiwgY29udmV4UG9zaXRpb24sIHBsYW5lUXVhdCwgY29udmV4UXVhdCwgcGxhbmVCb2R5LCBjb252ZXhCb2R5LCBzaSwgc2osIGp1c3RUZXN0KSB7CiAgICAgIC8vIFNpbXBseSByZXR1cm4gdGhlIHBvaW50cyBiZWhpbmQgdGhlIHBsYW5lLgogICAgICBjb25zdCB3b3JsZFZlcnRleCA9IHBsYW5lQ29udmV4X3Y7CiAgICAgIGNvbnN0IHdvcmxkTm9ybWFsID0gcGxhbmVDb252ZXhfbm9ybWFsOwogICAgICB3b3JsZE5vcm1hbC5zZXQoMCwgMCwgMSk7CiAgICAgIHBsYW5lUXVhdC52bXVsdCh3b3JsZE5vcm1hbCwgd29ybGROb3JtYWwpOyAvLyBUdXJuIG5vcm1hbCBhY2NvcmRpbmcgdG8gcGxhbmUgb3JpZW50YXRpb24KCiAgICAgIGxldCBudW1Db250YWN0cyA9IDA7CiAgICAgIGNvbnN0IHJlbHBvcyA9IHBsYW5lQ29udmV4X3JlbHBvczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBjb252ZXhTaGFwZS52ZXJ0aWNlcy5sZW5ndGg7IGkrKykgewogICAgICAgIC8vIEdldCB3b3JsZCBjb252ZXggdmVydGV4CiAgICAgICAgd29ybGRWZXJ0ZXguY29weShjb252ZXhTaGFwZS52ZXJ0aWNlc1tpXSk7CiAgICAgICAgY29udmV4UXVhdC52bXVsdCh3b3JsZFZlcnRleCwgd29ybGRWZXJ0ZXgpOwogICAgICAgIGNvbnZleFBvc2l0aW9uLnZhZGQod29ybGRWZXJ0ZXgsIHdvcmxkVmVydGV4KTsKICAgICAgICB3b3JsZFZlcnRleC52c3ViKHBsYW5lUG9zaXRpb24sIHJlbHBvcyk7CiAgICAgICAgY29uc3QgZG90ID0gd29ybGROb3JtYWwuZG90KHJlbHBvcyk7CgogICAgICAgIGlmIChkb3QgPD0gMC4wKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKHBsYW5lQm9keSwgY29udmV4Qm9keSwgcGxhbmVTaGFwZSwgY29udmV4U2hhcGUsIHNpLCBzaik7IC8vIEdldCB2ZXJ0ZXggcG9zaXRpb24gcHJvamVjdGVkIG9uIHBsYW5lCgogICAgICAgICAgY29uc3QgcHJvamVjdGVkID0gcGxhbmVDb252ZXhfcHJvamVjdGVkOwogICAgICAgICAgd29ybGROb3JtYWwuc2NhbGUod29ybGROb3JtYWwuZG90KHJlbHBvcyksIHByb2plY3RlZCk7CiAgICAgICAgICB3b3JsZFZlcnRleC52c3ViKHByb2plY3RlZCwgcHJvamVjdGVkKTsKICAgICAgICAgIHByb2plY3RlZC52c3ViKHBsYW5lUG9zaXRpb24sIHIucmkpOyAvLyBGcm9tIHBsYW5lIHRvIHZlcnRleCBwcm9qZWN0ZWQgb24gcGxhbmUKCiAgICAgICAgICByLm5pLmNvcHkod29ybGROb3JtYWwpOyAvLyBDb250YWN0IG5vcm1hbCBpcyB0aGUgcGxhbmUgbm9ybWFsIG91dCBmcm9tIHBsYW5lCiAgICAgICAgICAvLyByaiBpcyBub3cganVzdCB0aGUgdmVjdG9yIGZyb20gdGhlIGNvbnZleCBjZW50ZXIgdG8gdGhlIHZlcnRleAoKICAgICAgICAgIHdvcmxkVmVydGV4LnZzdWIoY29udmV4UG9zaXRpb24sIHIucmopOyAvLyBNYWtlIGl0IHJlbGF0aXZlIHRvIHRoZSBib2R5CgogICAgICAgICAgci5yaS52YWRkKHBsYW5lUG9zaXRpb24sIHIucmkpOwogICAgICAgICAgci5yaS52c3ViKHBsYW5lQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICByLnJqLnZhZGQoY29udmV4UG9zaXRpb24sIHIucmopOwogICAgICAgICAgci5yai52c3ViKGNvbnZleEJvZHkucG9zaXRpb24sIHIucmopOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIG51bUNvbnRhY3RzKys7CgogICAgICAgICAgaWYgKCF0aGlzLmVuYWJsZUZyaWN0aW9uUmVkdWN0aW9uKSB7CiAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmVuYWJsZUZyaWN0aW9uUmVkdWN0aW9uICYmIG51bUNvbnRhY3RzKSB7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkZyb21BdmVyYWdlKG51bUNvbnRhY3RzKTsKICAgICAgfQogICAgfQoKICAgIGJveENvbnZleChzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24ubWF0ZXJpYWwgPSBzaS5tYXRlcmlhbDsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLmNvbGxpc2lvblJlc3BvbnNlID0gc2kuY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleENvbnZleChzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBzcGhlcmVIZWlnaHRmaWVsZChzcGhlcmVTaGFwZSwgaGZTaGFwZSwgc3BoZXJlUG9zLCBoZlBvcywgc3BoZXJlUXVhdCwgaGZRdWF0LCBzcGhlcmVCb2R5LCBoZkJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBjb25zdCBkYXRhID0gaGZTaGFwZS5kYXRhOwogICAgICBjb25zdCByYWRpdXMgPSBzcGhlcmVTaGFwZS5yYWRpdXM7CiAgICAgIGNvbnN0IHcgPSBoZlNoYXBlLmVsZW1lbnRTaXplOwogICAgICBjb25zdCB3b3JsZFBpbGxhck9mZnNldCA9IHNwaGVyZUhlaWdodGZpZWxkX3RtcDI7IC8vIEdldCBzcGhlcmUgcG9zaXRpb24gdG8gaGVpZ2h0ZmllbGQgbG9jYWwhCgogICAgICBjb25zdCBsb2NhbFNwaGVyZVBvcyA9IHNwaGVyZUhlaWdodGZpZWxkX3RtcDE7CiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZShoZlBvcywgaGZRdWF0LCBzcGhlcmVQb3MsIGxvY2FsU3BoZXJlUG9zKTsgLy8gR2V0IHRoZSBpbmRleCBvZiB0aGUgZGF0YSBwb2ludHMgdG8gdGVzdCBhZ2FpbnN0CgogICAgICBsZXQgaU1pblggPSBNYXRoLmZsb29yKChsb2NhbFNwaGVyZVBvcy54IC0gcmFkaXVzKSAvIHcpIC0gMTsKICAgICAgbGV0IGlNYXhYID0gTWF0aC5jZWlsKChsb2NhbFNwaGVyZVBvcy54ICsgcmFkaXVzKSAvIHcpICsgMTsKICAgICAgbGV0IGlNaW5ZID0gTWF0aC5mbG9vcigobG9jYWxTcGhlcmVQb3MueSAtIHJhZGl1cykgLyB3KSAtIDE7CiAgICAgIGxldCBpTWF4WSA9IE1hdGguY2VpbCgobG9jYWxTcGhlcmVQb3MueSArIHJhZGl1cykgLyB3KSArIDE7IC8vIEJhaWwgb3V0IGlmIHdlIGFyZSBvdXQgb2YgdGhlIHRlcnJhaW4KCiAgICAgIGlmIChpTWF4WCA8IDAgfHwgaU1heFkgPCAwIHx8IGlNaW5YID4gZGF0YS5sZW5ndGggfHwgaU1pblkgPiBkYXRhWzBdLmxlbmd0aCkgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBDbGFtcCBpbmRleCB0byBlZGdlcwoKCiAgICAgIGlmIChpTWluWCA8IDApIHsKICAgICAgICBpTWluWCA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WCA8IDApIHsKICAgICAgICBpTWF4WCA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWSA8IDApIHsKICAgICAgICBpTWluWSA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WSA8IDApIHsKICAgICAgICBpTWF4WSA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWCA+PSBkYXRhLmxlbmd0aCkgewogICAgICAgIGlNaW5YID0gZGF0YS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBpZiAoaU1heFggPj0gZGF0YS5sZW5ndGgpIHsKICAgICAgICBpTWF4WCA9IGRhdGEubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgaWYgKGlNYXhZID49IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgaU1heFkgPSBkYXRhWzBdLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWSA+PSBkYXRhWzBdLmxlbmd0aCkgewogICAgICAgIGlNaW5ZID0gZGF0YVswXS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBjb25zdCBtaW5NYXggPSBbXTsKICAgICAgaGZTaGFwZS5nZXRSZWN0TWluTWF4KGlNaW5YLCBpTWluWSwgaU1heFgsIGlNYXhZLCBtaW5NYXgpOwogICAgICBjb25zdCBtaW4gPSBtaW5NYXhbMF07CiAgICAgIGNvbnN0IG1heCA9IG1pbk1heFsxXTsgLy8gQmFpbCBvdXQgaWYgd2UgY2FuJ3QgdG91Y2ggdGhlIGJvdW5kaW5nIGhlaWdodCBib3gKCiAgICAgIGlmIChsb2NhbFNwaGVyZVBvcy56IC0gcmFkaXVzID4gbWF4IHx8IGxvY2FsU3BoZXJlUG9zLnogKyByYWRpdXMgPCBtaW4pIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMucmVzdWx0OwoKICAgICAgZm9yIChsZXQgaSA9IGlNaW5YOyBpIDwgaU1heFg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSBpTWluWTsgaiA8IGlNYXhZOyBqKyspIHsKICAgICAgICAgIGNvbnN0IG51bUNvbnRhY3RzQmVmb3JlID0gcmVzdWx0Lmxlbmd0aDsKICAgICAgICAgIGxldCBpbnRlcnNlY3RpbmcgPSBmYWxzZTsgLy8gTG93ZXIgdHJpYW5nbGUKCiAgICAgICAgICBoZlNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIGZhbHNlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShoZlBvcywgaGZRdWF0LCBoZlNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIGlmIChzcGhlcmVQb3MuZGlzdGFuY2VUbyh3b3JsZFBpbGxhck9mZnNldCkgPCBoZlNoYXBlLnBpbGxhckNvbnZleC5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNwaGVyZVNoYXBlLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgIGludGVyc2VjdGluZyA9IHRoaXMuc3BoZXJlQ29udmV4KHNwaGVyZVNoYXBlLCBoZlNoYXBlLnBpbGxhckNvbnZleCwgc3BoZXJlUG9zLCB3b3JsZFBpbGxhck9mZnNldCwgc3BoZXJlUXVhdCwgaGZRdWF0LCBzcGhlcmVCb2R5LCBoZkJvZHksIHNwaGVyZVNoYXBlLCBoZlNoYXBlLCBqdXN0VGVzdCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGp1c3RUZXN0ICYmIGludGVyc2VjdGluZykgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0gLy8gVXBwZXIgdHJpYW5nbGUKCgogICAgICAgICAgaGZTaGFwZS5nZXRDb252ZXhUcmlhbmdsZVBpbGxhcihpLCBqLCB0cnVlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShoZlBvcywgaGZRdWF0LCBoZlNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIGlmIChzcGhlcmVQb3MuZGlzdGFuY2VUbyh3b3JsZFBpbGxhck9mZnNldCkgPCBoZlNoYXBlLnBpbGxhckNvbnZleC5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNwaGVyZVNoYXBlLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgIGludGVyc2VjdGluZyA9IHRoaXMuc3BoZXJlQ29udmV4KHNwaGVyZVNoYXBlLCBoZlNoYXBlLnBpbGxhckNvbnZleCwgc3BoZXJlUG9zLCB3b3JsZFBpbGxhck9mZnNldCwgc3BoZXJlUXVhdCwgaGZRdWF0LCBzcGhlcmVCb2R5LCBoZkJvZHksIHNwaGVyZVNoYXBlLCBoZlNoYXBlLCBqdXN0VGVzdCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGp1c3RUZXN0ICYmIGludGVyc2VjdGluZykgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBjb25zdCBudW1Db250YWN0cyA9IHJlc3VsdC5sZW5ndGggLSBudW1Db250YWN0c0JlZm9yZTsKCiAgICAgICAgICBpZiAobnVtQ29udGFjdHMgPiAyKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIC8qCiAgICAgICAgICAgIC8vIFNraXAgYWxsIGJ1dCAxCiAgICAgICAgICAgIGZvciAobGV0IGsgPSAwOyBrIDwgbnVtQ29udGFjdHMgLSAxOyBrKyspIHsKICAgICAgICAgICAgICAgIHJlc3VsdC5wb3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgKi8KCiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgYm94SGVpZ2h0ZmllbGQoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2kubWF0ZXJpYWw7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNpLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICByZXR1cm4gdGhpcy5jb252ZXhIZWlnaHRmaWVsZChzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBjb252ZXhIZWlnaHRmaWVsZChjb252ZXhTaGFwZSwgaGZTaGFwZSwgY29udmV4UG9zLCBoZlBvcywgY29udmV4UXVhdCwgaGZRdWF0LCBjb252ZXhCb2R5LCBoZkJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBjb25zdCBkYXRhID0gaGZTaGFwZS5kYXRhOwogICAgICBjb25zdCB3ID0gaGZTaGFwZS5lbGVtZW50U2l6ZTsKICAgICAgY29uc3QgcmFkaXVzID0gY29udmV4U2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXM7CiAgICAgIGNvbnN0IHdvcmxkUGlsbGFyT2Zmc2V0ID0gY29udmV4SGVpZ2h0ZmllbGRfdG1wMjsKICAgICAgY29uc3QgZmFjZUxpc3QgPSBjb252ZXhIZWlnaHRmaWVsZF9mYWNlTGlzdDsgLy8gR2V0IHNwaGVyZSBwb3NpdGlvbiB0byBoZWlnaHRmaWVsZCBsb2NhbCEKCiAgICAgIGNvbnN0IGxvY2FsQ29udmV4UG9zID0gY29udmV4SGVpZ2h0ZmllbGRfdG1wMTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKGhmUG9zLCBoZlF1YXQsIGNvbnZleFBvcywgbG9jYWxDb252ZXhQb3MpOyAvLyBHZXQgdGhlIGluZGV4IG9mIHRoZSBkYXRhIHBvaW50cyB0byB0ZXN0IGFnYWluc3QKCiAgICAgIGxldCBpTWluWCA9IE1hdGguZmxvb3IoKGxvY2FsQ29udmV4UG9zLnggLSByYWRpdXMpIC8gdykgLSAxOwogICAgICBsZXQgaU1heFggPSBNYXRoLmNlaWwoKGxvY2FsQ29udmV4UG9zLnggKyByYWRpdXMpIC8gdykgKyAxOwogICAgICBsZXQgaU1pblkgPSBNYXRoLmZsb29yKChsb2NhbENvbnZleFBvcy55IC0gcmFkaXVzKSAvIHcpIC0gMTsKICAgICAgbGV0IGlNYXhZID0gTWF0aC5jZWlsKChsb2NhbENvbnZleFBvcy55ICsgcmFkaXVzKSAvIHcpICsgMTsgLy8gQmFpbCBvdXQgaWYgd2UgYXJlIG91dCBvZiB0aGUgdGVycmFpbgoKICAgICAgaWYgKGlNYXhYIDwgMCB8fCBpTWF4WSA8IDAgfHwgaU1pblggPiBkYXRhLmxlbmd0aCB8fCBpTWluWSA+IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIENsYW1wIGluZGV4IHRvIGVkZ2VzCgoKICAgICAgaWYgKGlNaW5YIDwgMCkgewogICAgICAgIGlNaW5YID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNYXhYIDwgMCkgewogICAgICAgIGlNYXhYID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNaW5ZIDwgMCkgewogICAgICAgIGlNaW5ZID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNYXhZIDwgMCkgewogICAgICAgIGlNYXhZID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNaW5YID49IGRhdGEubGVuZ3RoKSB7CiAgICAgICAgaU1pblggPSBkYXRhLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WCA+PSBkYXRhLmxlbmd0aCkgewogICAgICAgIGlNYXhYID0gZGF0YS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBpZiAoaU1heFkgPj0gZGF0YVswXS5sZW5ndGgpIHsKICAgICAgICBpTWF4WSA9IGRhdGFbMF0ubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgaWYgKGlNaW5ZID49IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgaU1pblkgPSBkYXRhWzBdLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGNvbnN0IG1pbk1heCA9IFtdOwogICAgICBoZlNoYXBlLmdldFJlY3RNaW5NYXgoaU1pblgsIGlNaW5ZLCBpTWF4WCwgaU1heFksIG1pbk1heCk7CiAgICAgIGNvbnN0IG1pbiA9IG1pbk1heFswXTsKICAgICAgY29uc3QgbWF4ID0gbWluTWF4WzFdOyAvLyBCYWlsIG91dCBpZiB3ZSdyZSBjYW50IHRvdWNoIHRoZSBib3VuZGluZyBoZWlnaHQgYm94CgogICAgICBpZiAobG9jYWxDb252ZXhQb3MueiAtIHJhZGl1cyA+IG1heCB8fCBsb2NhbENvbnZleFBvcy56ICsgcmFkaXVzIDwgbWluKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBmb3IgKGxldCBpID0gaU1pblg7IGkgPCBpTWF4WDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IGlNaW5ZOyBqIDwgaU1heFk7IGorKykgewogICAgICAgICAgbGV0IGludGVyc2VjdGluZyA9IGZhbHNlOyAvLyBMb3dlciB0cmlhbmdsZQoKICAgICAgICAgIGhmU2hhcGUuZ2V0Q29udmV4VHJpYW5nbGVQaWxsYXIoaSwgaiwgZmFsc2UpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKGhmUG9zLCBoZlF1YXQsIGhmU2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgaWYgKGNvbnZleFBvcy5kaXN0YW5jZVRvKHdvcmxkUGlsbGFyT2Zmc2V0KSA8IGhmU2hhcGUucGlsbGFyQ29udmV4LmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgY29udmV4U2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICAgICAgaW50ZXJzZWN0aW5nID0gdGhpcy5jb252ZXhDb252ZXgoY29udmV4U2hhcGUsIGhmU2hhcGUucGlsbGFyQ29udmV4LCBjb252ZXhQb3MsIHdvcmxkUGlsbGFyT2Zmc2V0LCBjb252ZXhRdWF0LCBoZlF1YXQsIGNvbnZleEJvZHksIGhmQm9keSwgbnVsbCwgbnVsbCwganVzdFRlc3QsIGZhY2VMaXN0LCBudWxsKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoanVzdFRlc3QgJiYgaW50ZXJzZWN0aW5nKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfSAvLyBVcHBlciB0cmlhbmdsZQoKCiAgICAgICAgICBoZlNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIHRydWUpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKGhmUG9zLCBoZlF1YXQsIGhmU2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgaWYgKGNvbnZleFBvcy5kaXN0YW5jZVRvKHdvcmxkUGlsbGFyT2Zmc2V0KSA8IGhmU2hhcGUucGlsbGFyQ29udmV4LmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgY29udmV4U2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICAgICAgaW50ZXJzZWN0aW5nID0gdGhpcy5jb252ZXhDb252ZXgoY29udmV4U2hhcGUsIGhmU2hhcGUucGlsbGFyQ29udmV4LCBjb252ZXhQb3MsIHdvcmxkUGlsbGFyT2Zmc2V0LCBjb252ZXhRdWF0LCBoZlF1YXQsIGNvbnZleEJvZHksIGhmQm9keSwgbnVsbCwgbnVsbCwganVzdFRlc3QsIGZhY2VMaXN0LCBudWxsKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoanVzdFRlc3QgJiYgaW50ZXJzZWN0aW5nKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHNwaGVyZVBhcnRpY2xlKHNqLCBzaSwgeGosIHhpLCBxaiwgcWksIGJqLCBiaSwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIC8vIFRoZSBub3JtYWwgaXMgdGhlIHVuaXQgdmVjdG9yIGZyb20gc3BoZXJlIGNlbnRlciB0byBwYXJ0aWNsZSBjZW50ZXIKICAgICAgY29uc3Qgbm9ybWFsID0gcGFydGljbGVTcGhlcmVfbm9ybWFsOwogICAgICBub3JtYWwuc2V0KDAsIDAsIDEpOwogICAgICB4aS52c3ViKHhqLCBub3JtYWwpOwogICAgICBjb25zdCBsZW5ndGhTcXVhcmVkID0gbm9ybWFsLmxlbmd0aFNxdWFyZWQoKTsKCiAgICAgIGlmIChsZW5ndGhTcXVhcmVkIDw9IHNqLnJhZGl1cyAqIHNqLnJhZGl1cykgewogICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICBub3JtYWwubm9ybWFsaXplKCk7CiAgICAgICAgci5yai5jb3B5KG5vcm1hbCk7CiAgICAgICAgci5yai5zY2FsZShzai5yYWRpdXMsIHIucmopOwogICAgICAgIHIubmkuY29weShub3JtYWwpOyAvLyBDb250YWN0IG5vcm1hbAoKICAgICAgICByLm5pLm5lZ2F0ZShyLm5pKTsKICAgICAgICByLnJpLnNldCgwLCAwLCAwKTsgLy8gQ2VudGVyIG9mIHBhcnRpY2xlCgogICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICB9CiAgICB9CgogICAgcGxhbmVQYXJ0aWNsZShzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBjb25zdCBub3JtYWwgPSBwYXJ0aWNsZVBsYW5lX25vcm1hbDsKICAgICAgbm9ybWFsLnNldCgwLCAwLCAxKTsKICAgICAgYmoucXVhdGVybmlvbi52bXVsdChub3JtYWwsIG5vcm1hbCk7IC8vIFR1cm4gbm9ybWFsIGFjY29yZGluZyB0byBwbGFuZSBvcmllbnRhdGlvbgoKICAgICAgY29uc3QgcmVscG9zID0gcGFydGljbGVQbGFuZV9yZWxwb3M7CiAgICAgIHhpLnZzdWIoYmoucG9zaXRpb24sIHJlbHBvcyk7CiAgICAgIGNvbnN0IGRvdCA9IG5vcm1hbC5kb3QocmVscG9zKTsKCiAgICAgIGlmIChkb3QgPD0gMC4wKSB7CiAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgIHIubmkuY29weShub3JtYWwpOyAvLyBDb250YWN0IG5vcm1hbCBpcyB0aGUgcGxhbmUgbm9ybWFsCgogICAgICAgIHIubmkubmVnYXRlKHIubmkpOwogICAgICAgIHIucmkuc2V0KDAsIDAsIDApOyAvLyBDZW50ZXIgb2YgcGFydGljbGUKICAgICAgICAvLyBHZXQgcGFydGljbGUgcG9zaXRpb24gcHJvamVjdGVkIG9uIHBsYW5lCgogICAgICAgIGNvbnN0IHByb2plY3RlZCA9IHBhcnRpY2xlUGxhbmVfcHJvamVjdGVkOwogICAgICAgIG5vcm1hbC5zY2FsZShub3JtYWwuZG90KHhpKSwgcHJvamVjdGVkKTsKICAgICAgICB4aS52c3ViKHByb2plY3RlZCwgcHJvamVjdGVkKTsgLy9wcm9qZWN0ZWQudmFkZChiai5wb3NpdGlvbixwcm9qZWN0ZWQpOwogICAgICAgIC8vIHJqIGlzIG5vdyB0aGUgcHJvamVjdGVkIHdvcmxkIHBvc2l0aW9uIG1pbnVzIHBsYW5lIHBvc2l0aW9uCgogICAgICAgIHIucmouY29weShwcm9qZWN0ZWQpOwogICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICB9CiAgICB9CgogICAgYm94UGFydGljbGUoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2kubWF0ZXJpYWw7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNpLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICByZXR1cm4gdGhpcy5jb252ZXhQYXJ0aWNsZShzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBjb252ZXhQYXJ0aWNsZShzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBsZXQgcGVuZXRyYXRlZEZhY2VJbmRleCA9IC0xOwogICAgICBjb25zdCBwZW5ldHJhdGVkRmFjZU5vcm1hbCA9IGNvbnZleFBhcnRpY2xlX3BlbmV0cmF0ZWRGYWNlTm9ybWFsOwogICAgICBjb25zdCB3b3JsZFBlbmV0cmF0aW9uVmVjID0gY29udmV4UGFydGljbGVfd29ybGRQZW5ldHJhdGlvblZlYzsKICAgICAgbGV0IG1pblBlbmV0cmF0aW9uID0gbnVsbDsKCiAgICAgIGNvbnN0IGxvY2FsID0gY29udmV4UGFydGljbGVfbG9jYWw7CiAgICAgIGxvY2FsLmNvcHkoeGkpOwogICAgICBsb2NhbC52c3ViKHhqLCBsb2NhbCk7IC8vIENvbnZlcnQgcG9zaXRpb24gdG8gcmVsYXRpdmUgdGhlIGNvbnZleCBvcmlnaW4KCiAgICAgIHFqLmNvbmp1Z2F0ZShjcWopOwogICAgICBjcWoudm11bHQobG9jYWwsIGxvY2FsKTsKCiAgICAgIGlmIChzai5wb2ludElzSW5zaWRlKGxvY2FsKSkgewogICAgICAgIGlmIChzai53b3JsZFZlcnRpY2VzTmVlZHNVcGRhdGUpIHsKICAgICAgICAgIHNqLmNvbXB1dGVXb3JsZFZlcnRpY2VzKHhqLCBxaik7CiAgICAgICAgfQoKICAgICAgICBpZiAoc2oud29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlKSB7CiAgICAgICAgICBzai5jb21wdXRlV29ybGRGYWNlTm9ybWFscyhxaik7CiAgICAgICAgfSAvLyBGb3IgZWFjaCB3b3JsZCBwb2x5Z29uIGluIHRoZSBwb2x5aGVkcmEKCgogICAgICAgIGZvciAobGV0IGkgPSAwLCBuZmFjZXMgPSBzai5mYWNlcy5sZW5ndGg7IGkgIT09IG5mYWNlczsgaSsrKSB7CiAgICAgICAgICAvLyBDb25zdHJ1Y3Qgd29ybGQgZmFjZSB2ZXJ0aWNlcwogICAgICAgICAgY29uc3QgdmVydHMgPSBbc2oud29ybGRWZXJ0aWNlc1tzai5mYWNlc1tpXVswXV1dOwogICAgICAgICAgY29uc3Qgbm9ybWFsID0gc2oud29ybGRGYWNlTm9ybWFsc1tpXTsgLy8gQ2hlY2sgaG93IG11Y2ggdGhlIHBhcnRpY2xlIHBlbmV0cmF0ZXMgdGhlIHBvbHlnb24gcGxhbmUuCgogICAgICAgICAgeGkudnN1Yih2ZXJ0c1swXSwgY29udmV4UGFydGljbGVfdmVydGV4VG9QYXJ0aWNsZSk7CiAgICAgICAgICBjb25zdCBwZW5ldHJhdGlvbiA9IC1ub3JtYWwuZG90KGNvbnZleFBhcnRpY2xlX3ZlcnRleFRvUGFydGljbGUpOwoKICAgICAgICAgIGlmIChtaW5QZW5ldHJhdGlvbiA9PT0gbnVsbCB8fCBNYXRoLmFicyhwZW5ldHJhdGlvbikgPCBNYXRoLmFicyhtaW5QZW5ldHJhdGlvbikpIHsKICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG1pblBlbmV0cmF0aW9uID0gcGVuZXRyYXRpb247CiAgICAgICAgICAgIHBlbmV0cmF0ZWRGYWNlSW5kZXggPSBpOwogICAgICAgICAgICBwZW5ldHJhdGVkRmFjZU5vcm1hbC5jb3B5KG5vcm1hbCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAocGVuZXRyYXRlZEZhY2VJbmRleCAhPT0gLTEpIHsKICAgICAgICAgIC8vIFNldHVwIGNvbnRhY3QKICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgcGVuZXRyYXRlZEZhY2VOb3JtYWwuc2NhbGUobWluUGVuZXRyYXRpb24sIHdvcmxkUGVuZXRyYXRpb25WZWMpOyAvLyByaiBpcyB0aGUgcGFydGljbGUgcG9zaXRpb24gcHJvamVjdGVkIHRvIHRoZSBmYWNlCgogICAgICAgICAgd29ybGRQZW5ldHJhdGlvblZlYy52YWRkKHhpLCB3b3JsZFBlbmV0cmF0aW9uVmVjKTsKICAgICAgICAgIHdvcmxkUGVuZXRyYXRpb25WZWMudnN1Yih4aiwgd29ybGRQZW5ldHJhdGlvblZlYyk7CiAgICAgICAgICByLnJqLmNvcHkod29ybGRQZW5ldHJhdGlvblZlYyk7IC8vY29uc3QgcHJvamVjdGVkVG9GYWNlID0geGkudnN1Yih4aikudmFkZCh3b3JsZFBlbmV0cmF0aW9uVmVjKTsKICAgICAgICAgIC8vcHJvamVjdGVkVG9GYWNlLmNvcHkoci5yaik7CiAgICAgICAgICAvL3FqLnZtdWx0KHIucmosci5yaik7CgogICAgICAgICAgcGVuZXRyYXRlZEZhY2VOb3JtYWwubmVnYXRlKHIubmkpOyAvLyBDb250YWN0IG5vcm1hbAoKICAgICAgICAgIHIucmkuc2V0KDAsIDAsIDApOyAvLyBDZW50ZXIgb2YgcGFydGljbGUKCiAgICAgICAgICBjb25zdCByaSA9IHIucmk7CiAgICAgICAgICBjb25zdCByaiA9IHIucmo7IC8vIE1ha2UgcmVsYXRpdmUgdG8gYm9kaWVzCgogICAgICAgICAgcmkudmFkZCh4aSwgcmkpOwogICAgICAgICAgcmkudnN1YihiaS5wb3NpdGlvbiwgcmkpOwogICAgICAgICAgcmoudmFkZCh4aiwgcmopOwogICAgICAgICAgcmoudnN1Yihiai5wb3NpdGlvbiwgcmopOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc29sZS53YXJuKCdQb2ludCBmb3VuZCBpbnNpZGUgY29udmV4LCBidXQgZGlkIG5vdCBmaW5kIHBlbmV0cmF0aW5nIGZhY2UhJyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgaGVpZ2h0ZmllbGRDeWxpbmRlcihoZlNoYXBlLCBjb252ZXhTaGFwZSwgaGZQb3MsIGNvbnZleFBvcywgaGZRdWF0LCBjb252ZXhRdWF0LCBoZkJvZHksIGNvbnZleEJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhIZWlnaHRmaWVsZChjb252ZXhTaGFwZSwgaGZTaGFwZSwgY29udmV4UG9zLCBoZlBvcywgY29udmV4UXVhdCwgaGZRdWF0LCBjb252ZXhCb2R5LCBoZkJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgcGFydGljbGVDeWxpbmRlcihzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhQYXJ0aWNsZShzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHJzaSwgcnNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgc3BoZXJlVHJpbWVzaChzcGhlcmVTaGFwZSwgdHJpbWVzaFNoYXBlLCBzcGhlcmVQb3MsIHRyaW1lc2hQb3MsIHNwaGVyZVF1YXQsIHRyaW1lc2hRdWF0LCBzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGNvbnN0IGVkZ2VWZXJ0ZXhBID0gc3BoZXJlVHJpbWVzaF9lZGdlVmVydGV4QTsKICAgICAgY29uc3QgZWRnZVZlcnRleEIgPSBzcGhlcmVUcmltZXNoX2VkZ2VWZXJ0ZXhCOwogICAgICBjb25zdCBlZGdlVmVjdG9yID0gc3BoZXJlVHJpbWVzaF9lZGdlVmVjdG9yOwogICAgICBjb25zdCBlZGdlVmVjdG9yVW5pdCA9IHNwaGVyZVRyaW1lc2hfZWRnZVZlY3RvclVuaXQ7CiAgICAgIGNvbnN0IGxvY2FsU3BoZXJlUG9zID0gc3BoZXJlVHJpbWVzaF9sb2NhbFNwaGVyZVBvczsKICAgICAgY29uc3QgdG1wID0gc3BoZXJlVHJpbWVzaF90bXA7CiAgICAgIGNvbnN0IGxvY2FsU3BoZXJlQUFCQiA9IHNwaGVyZVRyaW1lc2hfbG9jYWxTcGhlcmVBQUJCOwogICAgICBjb25zdCB2MiA9IHNwaGVyZVRyaW1lc2hfdjI7CiAgICAgIGNvbnN0IHJlbHBvcyA9IHNwaGVyZVRyaW1lc2hfcmVscG9zOwogICAgICBjb25zdCB0cmlhbmdsZXMgPSBzcGhlcmVUcmltZXNoX3RyaWFuZ2xlczsgLy8gQ29udmVydCBzcGhlcmUgcG9zaXRpb24gdG8gbG9jYWwgaW4gdGhlIHRyaW1lc2gKCiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgc3BoZXJlUG9zLCBsb2NhbFNwaGVyZVBvcyk7IC8vIEdldCB0aGUgYWFiYiBvZiB0aGUgc3BoZXJlIGxvY2FsbHkgaW4gdGhlIHRyaW1lc2gKCiAgICAgIGNvbnN0IHNwaGVyZVJhZGl1cyA9IHNwaGVyZVNoYXBlLnJhZGl1czsKICAgICAgbG9jYWxTcGhlcmVBQUJCLmxvd2VyQm91bmQuc2V0KGxvY2FsU3BoZXJlUG9zLnggLSBzcGhlcmVSYWRpdXMsIGxvY2FsU3BoZXJlUG9zLnkgLSBzcGhlcmVSYWRpdXMsIGxvY2FsU3BoZXJlUG9zLnogLSBzcGhlcmVSYWRpdXMpOwogICAgICBsb2NhbFNwaGVyZUFBQkIudXBwZXJCb3VuZC5zZXQobG9jYWxTcGhlcmVQb3MueCArIHNwaGVyZVJhZGl1cywgbG9jYWxTcGhlcmVQb3MueSArIHNwaGVyZVJhZGl1cywgbG9jYWxTcGhlcmVQb3MueiArIHNwaGVyZVJhZGl1cyk7CiAgICAgIHRyaW1lc2hTaGFwZS5nZXRUcmlhbmdsZXNJbkFBQkIobG9jYWxTcGhlcmVBQUJCLCB0cmlhbmdsZXMpOyAvL2ZvciAobGV0IGkgPSAwOyBpIDwgdHJpbWVzaFNoYXBlLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB0cmlhbmdsZXMucHVzaChpKTsgLy8gQWxsCiAgICAgIC8vIFZlcnRpY2VzCgogICAgICBjb25zdCB2ID0gc3BoZXJlVHJpbWVzaF92OwogICAgICBjb25zdCByYWRpdXNTcXVhcmVkID0gc3BoZXJlU2hhcGUucmFkaXVzICogc3BoZXJlU2hhcGUucmFkaXVzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0cmlhbmdsZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDM7IGorKykgewogICAgICAgICAgdHJpbWVzaFNoYXBlLmdldFZlcnRleCh0cmltZXNoU2hhcGUuaW5kaWNlc1t0cmlhbmdsZXNbaV0gKiAzICsgal0sIHYpOyAvLyBDaGVjayB2ZXJ0ZXggb3ZlcmxhcCBpbiBzcGhlcmUKCiAgICAgICAgICB2LnZzdWIobG9jYWxTcGhlcmVQb3MsIHJlbHBvcyk7CgogICAgICAgICAgaWYgKHJlbHBvcy5sZW5ndGhTcXVhcmVkKCkgPD0gcmFkaXVzU3F1YXJlZCkgewogICAgICAgICAgICAvLyBTYWZlIHVwCiAgICAgICAgICAgIHYyLmNvcHkodik7CiAgICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgdjIsIHYpOwogICAgICAgICAgICB2LnZzdWIoc3BoZXJlUG9zLCByZWxwb3MpOwoKICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxldCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oc3BoZXJlQm9keSwgdHJpbWVzaEJvZHksIHNwaGVyZVNoYXBlLCB0cmltZXNoU2hhcGUsIHJzaSwgcnNqKTsKICAgICAgICAgICAgci5uaS5jb3B5KHJlbHBvcyk7CiAgICAgICAgICAgIHIubmkubm9ybWFsaXplKCk7IC8vIHJpIGlzIHRoZSB2ZWN0b3IgZnJvbSBzcGhlcmUgY2VudGVyIHRvIHRoZSBzcGhlcmUgc3VyZmFjZQoKICAgICAgICAgICAgci5yaS5jb3B5KHIubmkpOwogICAgICAgICAgICByLnJpLnNjYWxlKHNwaGVyZVNoYXBlLnJhZGl1cywgci5yaSk7CiAgICAgICAgICAgIHIucmkudmFkZChzcGhlcmVQb3MsIHIucmkpOwogICAgICAgICAgICByLnJpLnZzdWIoc3BoZXJlQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgIHIucmouY29weSh2KTsKICAgICAgICAgICAgci5yai52c3ViKHRyaW1lc2hCb2R5LnBvc2l0aW9uLCByLnJqKTsgLy8gU3RvcmUgcmVzdWx0CgogICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIENoZWNrIGFsbCBlZGdlcwoKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdHJpYW5nbGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCAzOyBqKyspIHsKICAgICAgICAgIHRyaW1lc2hTaGFwZS5nZXRWZXJ0ZXgodHJpbWVzaFNoYXBlLmluZGljZXNbdHJpYW5nbGVzW2ldICogMyArIGpdLCBlZGdlVmVydGV4QSk7CiAgICAgICAgICB0cmltZXNoU2hhcGUuZ2V0VmVydGV4KHRyaW1lc2hTaGFwZS5pbmRpY2VzW3RyaWFuZ2xlc1tpXSAqIDMgKyAoaiArIDEpICUgM10sIGVkZ2VWZXJ0ZXhCKTsKICAgICAgICAgIGVkZ2VWZXJ0ZXhCLnZzdWIoZWRnZVZlcnRleEEsIGVkZ2VWZWN0b3IpOyAvLyBQcm9qZWN0IHNwaGVyZSBwb3NpdGlvbiB0byB0aGUgZWRnZQoKICAgICAgICAgIGxvY2FsU3BoZXJlUG9zLnZzdWIoZWRnZVZlcnRleEIsIHRtcCk7CiAgICAgICAgICBjb25zdCBwb3NpdGlvbkFsb25nRWRnZUIgPSB0bXAuZG90KGVkZ2VWZWN0b3IpOwogICAgICAgICAgbG9jYWxTcGhlcmVQb3MudnN1YihlZGdlVmVydGV4QSwgdG1wKTsKICAgICAgICAgIGxldCBwb3NpdGlvbkFsb25nRWRnZUEgPSB0bXAuZG90KGVkZ2VWZWN0b3IpOwoKICAgICAgICAgIGlmIChwb3NpdGlvbkFsb25nRWRnZUEgPiAwICYmIHBvc2l0aW9uQWxvbmdFZGdlQiA8IDApIHsKICAgICAgICAgICAgLy8gTm93IGNoZWNrIHRoZSBvcnRob2dvbmFsIGRpc3RhbmNlIGZyb20gZWRnZSB0byBzcGhlcmUgY2VudGVyCiAgICAgICAgICAgIGxvY2FsU3BoZXJlUG9zLnZzdWIoZWRnZVZlcnRleEEsIHRtcCk7CiAgICAgICAgICAgIGVkZ2VWZWN0b3JVbml0LmNvcHkoZWRnZVZlY3Rvcik7CiAgICAgICAgICAgIGVkZ2VWZWN0b3JVbml0Lm5vcm1hbGl6ZSgpOwogICAgICAgICAgICBwb3NpdGlvbkFsb25nRWRnZUEgPSB0bXAuZG90KGVkZ2VWZWN0b3JVbml0KTsKICAgICAgICAgICAgZWRnZVZlY3RvclVuaXQuc2NhbGUocG9zaXRpb25BbG9uZ0VkZ2VBLCB0bXApOwogICAgICAgICAgICB0bXAudmFkZChlZGdlVmVydGV4QSwgdG1wKTsgLy8gdG1wIGlzIG5vdyB0aGUgc3BoZXJlIGNlbnRlciBwb3NpdGlvbiBwcm9qZWN0ZWQgdG8gdGhlIGVkZ2UsIGRlZmluZWQgbG9jYWxseSBpbiB0aGUgdHJpbWVzaCBmcmFtZQoKICAgICAgICAgICAgY29uc3QgZGlzdCA9IHRtcC5kaXN0YW5jZVRvKGxvY2FsU3BoZXJlUG9zKTsKCiAgICAgICAgICAgIGlmIChkaXN0IDwgc3BoZXJlU2hhcGUucmFkaXVzKSB7CiAgICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgc3BoZXJlU2hhcGUsIHRyaW1lc2hTaGFwZSwgcnNpLCByc2opOwogICAgICAgICAgICAgIHRtcC52c3ViKGxvY2FsU3BoZXJlUG9zLCByLm5pKTsKICAgICAgICAgICAgICByLm5pLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgIHIubmkuc2NhbGUoc3BoZXJlU2hhcGUucmFkaXVzLCByLnJpKTsKICAgICAgICAgICAgICByLnJpLnZhZGQoc3BoZXJlUG9zLCByLnJpKTsKICAgICAgICAgICAgICByLnJpLnZzdWIoc3BoZXJlQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHRyaW1lc2hQb3MsIHRyaW1lc2hRdWF0LCB0bXAsIHRtcCk7CiAgICAgICAgICAgICAgdG1wLnZzdWIodHJpbWVzaEJvZHkucG9zaXRpb24sIHIucmopOwogICAgICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIubmksIHIubmkpOwogICAgICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIucmksIHIucmkpOwogICAgICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIFRyaWFuZ2xlIGZhY2VzCgoKICAgICAgY29uc3QgdmEgPSBzcGhlcmVUcmltZXNoX3ZhOwogICAgICBjb25zdCB2YiA9IHNwaGVyZVRyaW1lc2hfdmI7CiAgICAgIGNvbnN0IHZjID0gc3BoZXJlVHJpbWVzaF92YzsKICAgICAgY29uc3Qgbm9ybWFsID0gc3BoZXJlVHJpbWVzaF9ub3JtYWw7CgogICAgICBmb3IgKGxldCBpID0gMCwgTiA9IHRyaWFuZ2xlcy5sZW5ndGg7IGkgIT09IE47IGkrKykgewogICAgICAgIHRyaW1lc2hTaGFwZS5nZXRUcmlhbmdsZVZlcnRpY2VzKHRyaWFuZ2xlc1tpXSwgdmEsIHZiLCB2Yyk7CiAgICAgICAgdHJpbWVzaFNoYXBlLmdldE5vcm1hbCh0cmlhbmdsZXNbaV0sIG5vcm1hbCk7CiAgICAgICAgbG9jYWxTcGhlcmVQb3MudnN1Yih2YSwgdG1wKTsKICAgICAgICBsZXQgZGlzdCA9IHRtcC5kb3Qobm9ybWFsKTsKICAgICAgICBub3JtYWwuc2NhbGUoZGlzdCwgdG1wKTsKICAgICAgICBsb2NhbFNwaGVyZVBvcy52c3ViKHRtcCwgdG1wKTsgLy8gdG1wIGlzIG5vdyB0aGUgc3BoZXJlIHBvc2l0aW9uIHByb2plY3RlZCB0byB0aGUgdHJpYW5nbGUgcGxhbmUKCiAgICAgICAgZGlzdCA9IHRtcC5kaXN0YW5jZVRvKGxvY2FsU3BoZXJlUG9zKTsKCiAgICAgICAgaWYgKFJheS5wb2ludEluVHJpYW5nbGUodG1wLCB2YSwgdmIsIHZjKSAmJiBkaXN0IDwgc3BoZXJlU2hhcGUucmFkaXVzKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgbGV0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgc3BoZXJlU2hhcGUsIHRyaW1lc2hTaGFwZSwgcnNpLCByc2opOwogICAgICAgICAgdG1wLnZzdWIobG9jYWxTcGhlcmVQb3MsIHIubmkpOwogICAgICAgICAgci5uaS5ub3JtYWxpemUoKTsKICAgICAgICAgIHIubmkuc2NhbGUoc3BoZXJlU2hhcGUucmFkaXVzLCByLnJpKTsKICAgICAgICAgIHIucmkudmFkZChzcGhlcmVQb3MsIHIucmkpOwogICAgICAgICAgci5yaS52c3ViKHNwaGVyZUJvZHkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHRyaW1lc2hQb3MsIHRyaW1lc2hRdWF0LCB0bXAsIHRtcCk7CiAgICAgICAgICB0bXAudnN1Yih0cmltZXNoQm9keS5wb3NpdGlvbiwgci5yaik7CiAgICAgICAgICBUcmFuc2Zvcm0udmVjdG9yVG9Xb3JsZEZyYW1lKHRyaW1lc2hRdWF0LCByLm5pLCByLm5pKTsKICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIucmksIHIucmkpOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRyaWFuZ2xlcy5sZW5ndGggPSAwOwogICAgfQoKICAgIHBsYW5lVHJpbWVzaChwbGFuZVNoYXBlLCB0cmltZXNoU2hhcGUsIHBsYW5lUG9zLCB0cmltZXNoUG9zLCBwbGFuZVF1YXQsIHRyaW1lc2hRdWF0LCBwbGFuZUJvZHksIHRyaW1lc2hCb2R5LCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgLy8gTWFrZSBjb250YWN0cyEKICAgICAgY29uc3QgdiA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IG5vcm1hbCA9IHBsYW5lVHJpbWVzaF9ub3JtYWw7CiAgICAgIG5vcm1hbC5zZXQoMCwgMCwgMSk7CiAgICAgIHBsYW5lUXVhdC52bXVsdChub3JtYWwsIG5vcm1hbCk7IC8vIFR1cm4gbm9ybWFsIGFjY29yZGluZyB0byBwbGFuZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0cmltZXNoU2hhcGUudmVydGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgLy8gR2V0IHdvcmxkIHZlcnRleCBmcm9tIHRyaW1lc2gKICAgICAgICB0cmltZXNoU2hhcGUuZ2V0VmVydGV4KGksIHYpOyAvLyBTYWZlIHVwCgogICAgICAgIGNvbnN0IHYyID0gbmV3IFZlYzMoKTsKICAgICAgICB2Mi5jb3B5KHYpOwogICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgdjIsIHYpOyAvLyBDaGVjayBwbGFuZSBzaWRlCgogICAgICAgIGNvbnN0IHJlbHBvcyA9IHBsYW5lVHJpbWVzaF9yZWxwb3M7CiAgICAgICAgdi52c3ViKHBsYW5lUG9zLCByZWxwb3MpOwogICAgICAgIGNvbnN0IGRvdCA9IG5vcm1hbC5kb3QocmVscG9zKTsKCiAgICAgICAgaWYgKGRvdCA8PSAwLjApIHsKICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24ocGxhbmVCb2R5LCB0cmltZXNoQm9keSwgcGxhbmVTaGFwZSwgdHJpbWVzaFNoYXBlLCByc2ksIHJzaik7CiAgICAgICAgICByLm5pLmNvcHkobm9ybWFsKTsgLy8gQ29udGFjdCBub3JtYWwgaXMgdGhlIHBsYW5lIG5vcm1hbAogICAgICAgICAgLy8gR2V0IHZlcnRleCBwb3NpdGlvbiBwcm9qZWN0ZWQgb24gcGxhbmUKCiAgICAgICAgICBjb25zdCBwcm9qZWN0ZWQgPSBwbGFuZVRyaW1lc2hfcHJvamVjdGVkOwogICAgICAgICAgbm9ybWFsLnNjYWxlKHJlbHBvcy5kb3Qobm9ybWFsKSwgcHJvamVjdGVkKTsKICAgICAgICAgIHYudnN1Yihwcm9qZWN0ZWQsIHByb2plY3RlZCk7IC8vIHJpIGlzIHRoZSBwcm9qZWN0ZWQgd29ybGQgcG9zaXRpb24gbWludXMgcGxhbmUgcG9zaXRpb24KCiAgICAgICAgICByLnJpLmNvcHkocHJvamVjdGVkKTsKICAgICAgICAgIHIucmkudnN1YihwbGFuZUJvZHkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgci5yai5jb3B5KHYpOwogICAgICAgICAgci5yai52c3ViKHRyaW1lc2hCb2R5LnBvc2l0aW9uLCByLnJqKTsgLy8gU3RvcmUgcmVzdWx0CgogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gLy8gY29udmV4VHJpbWVzaCgKICAgIC8vICAgc2k6IENvbnZleFBvbHloZWRyb24sIHNqOiBUcmltZXNoLCB4aTogVmVjMywgeGo6IFZlYzMsIHFpOiBRdWF0ZXJuaW9uLCBxajogUXVhdGVybmlvbiwKICAgIC8vICAgYmk6IEJvZHksIGJqOiBCb2R5LCByc2k/OiBTaGFwZSB8IG51bGwsIHJzaj86IFNoYXBlIHwgbnVsbCwKICAgIC8vICAgZmFjZUxpc3RBPzogbnVtYmVyW10gfCBudWxsLCBmYWNlTGlzdEI/OiBudW1iZXJbXSB8IG51bGwsCiAgICAvLyApIHsKICAgIC8vICAgY29uc3Qgc2VwQXhpcyA9IGNvbnZleENvbnZleF9zZXBBeGlzOwogICAgLy8gICBpZih4aS5kaXN0YW5jZVRvKHhqKSA+IHNpLmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgc2ouYm91bmRpbmdTcGhlcmVSYWRpdXMpewogICAgLy8gICAgICAgcmV0dXJuOwogICAgLy8gICB9CiAgICAvLyAgIC8vIENvbnN0cnVjdCBhIHRlbXAgaHVsbCBmb3IgZWFjaCB0cmlhbmdsZQogICAgLy8gICBjb25zdCBodWxsQiA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKCk7CiAgICAvLyAgIGh1bGxCLmZhY2VzID0gW1swLDEsMl1dOwogICAgLy8gICBjb25zdCB2YSA9IG5ldyBWZWMzKCk7CiAgICAvLyAgIGNvbnN0IHZiID0gbmV3IFZlYzMoKTsKICAgIC8vICAgY29uc3QgdmMgPSBuZXcgVmVjMygpOwogICAgLy8gICBodWxsQi52ZXJ0aWNlcyA9IFsKICAgIC8vICAgICAgIHZhLAogICAgLy8gICAgICAgdmIsCiAgICAvLyAgICAgICB2YwogICAgLy8gICBdOwogICAgLy8gICBmb3IgKGxldCBpID0gMDsgaSA8IHNqLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAvLyAgICAgICBjb25zdCB0cmlhbmdsZU5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgICAvLyAgICAgICBzai5nZXROb3JtYWwoaSwgdHJpYW5nbGVOb3JtYWwpOwogICAgLy8gICAgICAgaHVsbEIuZmFjZU5vcm1hbHMgPSBbdHJpYW5nbGVOb3JtYWxdOwogICAgLy8gICAgICAgc2ouZ2V0VHJpYW5nbGVWZXJ0aWNlcyhpLCB2YSwgdmIsIHZjKTsKICAgIC8vICAgICAgIGxldCBkID0gc2kudGVzdFNlcEF4aXModHJpYW5nbGVOb3JtYWwsIGh1bGxCLCB4aSwgcWksIHhqLCBxaik7CiAgICAvLyAgICAgICBpZighZCl7CiAgICAvLyAgICAgICAgICAgdHJpYW5nbGVOb3JtYWwuc2NhbGUoLTEsIHRyaWFuZ2xlTm9ybWFsKTsKICAgIC8vICAgICAgICAgICBkID0gc2kudGVzdFNlcEF4aXModHJpYW5nbGVOb3JtYWwsIGh1bGxCLCB4aSwgcWksIHhqLCBxaik7CiAgICAvLyAgICAgICAgICAgaWYoIWQpewogICAgLy8gICAgICAgICAgICAgICBjb250aW51ZTsKICAgIC8vICAgICAgICAgICB9CiAgICAvLyAgICAgICB9CiAgICAvLyAgICAgICBjb25zdCByZXM6IENvbnZleFBvbHloZWRyb25Db250YWN0UG9pbnRbXSA9IFtdOwogICAgLy8gICAgICAgY29uc3QgcSA9IGNvbnZleENvbnZleF9xOwogICAgLy8gICAgICAgc2kuY2xpcEFnYWluc3RIdWxsKHhpLHFpLGh1bGxCLHhqLHFqLHRyaWFuZ2xlTm9ybWFsLC0xMDAsMTAwLHJlcyk7CiAgICAvLyAgICAgICBmb3IobGV0IGogPSAwOyBqICE9PSByZXMubGVuZ3RoOyBqKyspewogICAgLy8gICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSxiaixzaSxzaixyc2kscnNqKSwKICAgIC8vICAgICAgICAgICAgICAgcmkgPSByLnJpLAogICAgLy8gICAgICAgICAgICAgICByaiA9IHIucmo7CiAgICAvLyAgICAgICAgICAgci5uaS5jb3B5KHRyaWFuZ2xlTm9ybWFsKTsKICAgIC8vICAgICAgICAgICByLm5pLm5lZ2F0ZShyLm5pKTsKICAgIC8vICAgICAgICAgICByZXNbal0ubm9ybWFsLm5lZ2F0ZShxKTsKICAgIC8vICAgICAgICAgICBxLm11bHQocmVzW2pdLmRlcHRoLCBxKTsKICAgIC8vICAgICAgICAgICByZXNbal0ucG9pbnQudmFkZChxLCByaSk7CiAgICAvLyAgICAgICAgICAgcmouY29weShyZXNbal0ucG9pbnQpOwogICAgLy8gICAgICAgICAgIC8vIENvbnRhY3QgcG9pbnRzIGFyZSBpbiB3b3JsZCBjb29yZGluYXRlcy4gVHJhbnNmb3JtIGJhY2sgdG8gcmVsYXRpdmUKICAgIC8vICAgICAgICAgICByaS52c3ViKHhpLHJpKTsKICAgIC8vICAgICAgICAgICByai52c3ViKHhqLHJqKTsKICAgIC8vICAgICAgICAgICAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwogICAgLy8gICAgICAgICAgIHJpLnZhZGQoeGksIHJpKTsKICAgIC8vICAgICAgICAgICByaS52c3ViKGJpLnBvc2l0aW9uLCByaSk7CiAgICAvLyAgICAgICAgICAgcmoudmFkZCh4aiwgcmopOwogICAgLy8gICAgICAgICAgIHJqLnZzdWIoYmoucG9zaXRpb24sIHJqKTsKICAgIC8vICAgICAgICAgICByZXN1bHQucHVzaChyKTsKICAgIC8vICAgICAgIH0KICAgIC8vICAgfQogICAgLy8gfQoKCiAgfQogIGNvbnN0IGF2ZXJhZ2VOb3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IGF2ZXJhZ2VDb250YWN0UG9pbnRBID0gbmV3IFZlYzMoKTsKICBjb25zdCBhdmVyYWdlQ29udGFjdFBvaW50QiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjMSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wUXVhdDEgPSBuZXcgUXVhdGVybmlvbigpOwogIGNvbnN0IHRtcFF1YXQyID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgY29uc3QgcGxhbmVUcmltZXNoX25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVUcmltZXNoX3JlbHBvcyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVUcmltZXNoX3Byb2plY3RlZCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9ub3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfcmVscG9zID0gbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfdiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92MiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9lZGdlVmVydGV4QSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9lZGdlVmVydGV4QiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9lZGdlVmVjdG9yID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX2VkZ2VWZWN0b3JVbml0ID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX2xvY2FsU3BoZXJlUG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX3RtcCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92YSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92YiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92YyA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9sb2NhbFNwaGVyZUFBQkIgPSBuZXcgQUFCQigpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfdHJpYW5nbGVzID0gW107CiAgY29uc3QgcG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlID0gbmV3IFZlYzMoKTsKICBjb25zdCBwbGFuZV90b19zcGhlcmVfb3J0aG8gPSBuZXcgVmVjMygpOyAvLyBTZWUgaHR0cDovL2J1bGxldHBoeXNpY3MuY29tL0J1bGxldC9CdWxsZXRGdWxsL1NwaGVyZVRyaWFuZ2xlRGV0ZWN0b3JfOGNwcF9zb3VyY2UuaHRtbAoKICBjb25zdCBwb2ludEluUG9seWdvbl9lZGdlID0gbmV3IFZlYzMoKTsKICBjb25zdCBwb2ludEluUG9seWdvbl9lZGdlX3hfbm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBwb2ludEluUG9seWdvbl92dHAgPSBuZXcgVmVjMygpOwoKICBmdW5jdGlvbiBwb2ludEluUG9seWdvbih2ZXJ0cywgbm9ybWFsLCBwKSB7CiAgICBsZXQgcG9zaXRpdmVSZXN1bHQgPSBudWxsOwogICAgY29uc3QgTiA9IHZlcnRzLmxlbmd0aDsKCiAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgIGNvbnN0IHYgPSB2ZXJ0c1tpXTsgLy8gR2V0IGVkZ2UgdG8gdGhlIG5leHQgdmVydGV4CgogICAgICBjb25zdCBlZGdlID0gcG9pbnRJblBvbHlnb25fZWRnZTsKICAgICAgdmVydHNbKGkgKyAxKSAlIE5dLnZzdWIodiwgZWRnZSk7IC8vIEdldCBjcm9zcyBwcm9kdWN0IGJldHdlZW4gcG9seWdvbiBub3JtYWwgYW5kIHRoZSBlZGdlCgogICAgICBjb25zdCBlZGdlX3hfbm9ybWFsID0gcG9pbnRJblBvbHlnb25fZWRnZV94X25vcm1hbDsgLy9jb25zdCBlZGdlX3hfbm9ybWFsID0gbmV3IFZlYzMoKTsKCiAgICAgIGVkZ2UuY3Jvc3Mobm9ybWFsLCBlZGdlX3hfbm9ybWFsKTsgLy8gR2V0IHZlY3RvciBiZXR3ZWVuIHBvaW50IGFuZCBjdXJyZW50IHZlcnRleAoKICAgICAgY29uc3QgdmVydGV4X3RvX3AgPSBwb2ludEluUG9seWdvbl92dHA7CiAgICAgIHAudnN1Yih2LCB2ZXJ0ZXhfdG9fcCk7IC8vIFRoaXMgZG90IHByb2R1Y3QgZGV0ZXJtaW5lcyB3aGljaCBzaWRlIG9mIHRoZSBlZGdlIHRoZSBwb2ludCBpcwoKICAgICAgY29uc3QgciA9IGVkZ2VfeF9ub3JtYWwuZG90KHZlcnRleF90b19wKTsgLy8gSWYgYWxsIHN1Y2ggZG90IHByb2R1Y3RzIGhhdmUgc2FtZSBzaWduLCB3ZSBhcmUgaW5zaWRlIHRoZSBwb2x5Z29uLgoKICAgICAgaWYgKHBvc2l0aXZlUmVzdWx0ID09PSBudWxsIHx8IHIgPiAwICYmIHBvc2l0aXZlUmVzdWx0ID09PSB0cnVlIHx8IHIgPD0gMCAmJiBwb3NpdGl2ZVJlc3VsdCA9PT0gZmFsc2UpIHsKICAgICAgICBpZiAocG9zaXRpdmVSZXN1bHQgPT09IG51bGwpIHsKICAgICAgICAgIHBvc2l0aXZlUmVzdWx0ID0gciA+IDA7CiAgICAgICAgfQoKICAgICAgICBjb250aW51ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gZmFsc2U7IC8vIEVuY291bnRlcmVkIHNvbWUgb3RoZXIgc2lnbi4gRXhpdC4KICAgICAgfQogICAgfSAvLyBJZiB3ZSBnb3QgaGVyZSwgYWxsIGRvdCBwcm9kdWN0cyB3ZXJlIG9mIHRoZSBzYW1lIHNpZ24uCgoKICAgIHJldHVybiB0cnVlOwogIH0KCiAgY29uc3QgYm94X3RvX3NwaGVyZSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQm94X25zID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfbnMxID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfbnMyID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfc2lkZXMgPSBbbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKV07CiAgY29uc3Qgc3BoZXJlQm94X3NwaGVyZV90b19jb3JuZXIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUJveF9zaWRlX25zID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfc2lkZV9uczEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUJveF9zaWRlX25zMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29udmV4X3RvX3NwaGVyZSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X2VkZ2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF9lZGdlVW5pdCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3NwaGVyZVRvQ29ybmVyID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVDb252ZXhfd29ybGRDb3JuZXIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF93b3JsZE5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3dvcmxkUG9pbnQgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF93b3JsZFNwaGVyZVBvaW50Q2xvc2VzdFRvUGxhbmUgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF9wZW5ldHJhdGlvblZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3NwaGVyZVRvV29ybGRQb2ludCA9IG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHBsYW5lQ29udmV4X3YgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBsYW5lQ29udmV4X25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVDb252ZXhfcmVscG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBwbGFuZUNvbnZleF9wcm9qZWN0ZWQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleENvbnZleF9zZXBBeGlzID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb252ZXhDb252ZXhfcSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGFydGljbGVQbGFuZV9ub3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBhcnRpY2xlUGxhbmVfcmVscG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBwYXJ0aWNsZVBsYW5lX3Byb2plY3RlZCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGFydGljbGVTcGhlcmVfbm9ybWFsID0gbmV3IFZlYzMoKTsgLy8gV0lQCgogIGNvbnN0IGNxaiA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgY29uc3QgY29udmV4UGFydGljbGVfbG9jYWwgPSBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgY29uc3QgY29udmV4UGFydGljbGVfcGVuZXRyYXRlZEZhY2VOb3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleFBhcnRpY2xlX3ZlcnRleFRvUGFydGljbGUgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleFBhcnRpY2xlX3dvcmxkUGVuZXRyYXRpb25WZWMgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleEhlaWdodGZpZWxkX3RtcDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleEhlaWdodGZpZWxkX3RtcDIgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleEhlaWdodGZpZWxkX2ZhY2VMaXN0ID0gWzBdOwogIGNvbnN0IHNwaGVyZUhlaWdodGZpZWxkX3RtcDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUhlaWdodGZpZWxkX3RtcDIgPSBuZXcgVmVjMygpOwoKICBjbGFzcyBPdmVybGFwS2VlcGVyIHsKICAgIC8qKgogICAgICogQHRvZG8gUmVtb3ZlIHVzZWxlc3MgY29uc3RydWN0b3IKICAgICAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMuY3VycmVudCA9IFtdOwogICAgICB0aGlzLnByZXZpb3VzID0gW107CiAgICB9CiAgICAvKioKICAgICAqIGdldEtleQogICAgICovCgoKICAgIGdldEtleShpLCBqKSB7CiAgICAgIGlmIChqIDwgaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICByZXR1cm4gaSA8PCAxNiB8IGo7CiAgICB9CiAgICAvKioKICAgICAqIHNldAogICAgICovCgoKICAgIHNldChpLCBqKSB7CiAgICAgIC8vIEluc2VydGlvbiBzb3J0LiBUaGlzIHdheSB0aGUgZGlmZiB3aWxsIGhhdmUgbGluZWFyIGNvbXBsZXhpdHkuCiAgICAgIGNvbnN0IGtleSA9IHRoaXMuZ2V0S2V5KGksIGopOwogICAgICBjb25zdCBjdXJyZW50ID0gdGhpcy5jdXJyZW50OwogICAgICBsZXQgaW5kZXggPSAwOwoKICAgICAgd2hpbGUgKGtleSA+IGN1cnJlbnRbaW5kZXhdKSB7CiAgICAgICAgaW5kZXgrKzsKICAgICAgfQoKICAgICAgaWYgKGtleSA9PT0gY3VycmVudFtpbmRleF0pIHsKICAgICAgICByZXR1cm47IC8vIFBhaXIgd2FzIGFscmVhZHkgYWRkZWQKICAgICAgfQoKICAgICAgZm9yIChsZXQgaiA9IGN1cnJlbnQubGVuZ3RoIC0gMTsgaiA+PSBpbmRleDsgai0tKSB7CiAgICAgICAgY3VycmVudFtqICsgMV0gPSBjdXJyZW50W2pdOwogICAgICB9CgogICAgICBjdXJyZW50W2luZGV4XSA9IGtleTsKICAgIH0KICAgIC8qKgogICAgICogdGljawogICAgICovCgoKICAgIHRpY2soKSB7CiAgICAgIGNvbnN0IHRtcCA9IHRoaXMuY3VycmVudDsKICAgICAgdGhpcy5jdXJyZW50ID0gdGhpcy5wcmV2aW91czsKICAgICAgdGhpcy5wcmV2aW91cyA9IHRtcDsKICAgICAgdGhpcy5jdXJyZW50Lmxlbmd0aCA9IDA7CiAgICB9CiAgICAvKioKICAgICAqIGdldERpZmYKICAgICAqLwoKCiAgICBnZXREaWZmKGFkZGl0aW9ucywgcmVtb3ZhbHMpIHsKICAgICAgY29uc3QgYSA9IHRoaXMuY3VycmVudDsKICAgICAgY29uc3QgYiA9IHRoaXMucHJldmlvdXM7CiAgICAgIGNvbnN0IGFsID0gYS5sZW5ndGg7CiAgICAgIGNvbnN0IGJsID0gYi5sZW5ndGg7CiAgICAgIGxldCBqID0gMDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYWw7IGkrKykgewogICAgICAgIGxldCBmb3VuZCA9IGZhbHNlOwogICAgICAgIGNvbnN0IGtleUEgPSBhW2ldOwoKICAgICAgICB3aGlsZSAoa2V5QSA+IGJbal0pIHsKICAgICAgICAgIGorKzsKICAgICAgICB9CgogICAgICAgIGZvdW5kID0ga2V5QSA9PT0gYltqXTsKCiAgICAgICAgaWYgKCFmb3VuZCkgewogICAgICAgICAgdW5wYWNrQW5kUHVzaChhZGRpdGlvbnMsIGtleUEpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaiA9IDA7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJsOyBpKyspIHsKICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTsKICAgICAgICBjb25zdCBrZXlCID0gYltpXTsKCiAgICAgICAgd2hpbGUgKGtleUIgPiBhW2pdKSB7CiAgICAgICAgICBqKys7CiAgICAgICAgfQoKICAgICAgICBmb3VuZCA9IGFbal0gPT09IGtleUI7CgogICAgICAgIGlmICghZm91bmQpIHsKICAgICAgICAgIHVucGFja0FuZFB1c2gocmVtb3ZhbHMsIGtleUIpOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICB9CgogIGZ1bmN0aW9uIHVucGFja0FuZFB1c2goYXJyYXksIGtleSkgewogICAgYXJyYXkucHVzaCgoa2V5ICYgMHhmZmZmMDAwMCkgPj4gMTYsIGtleSAmIDB4MDAwMGZmZmYpOwogIH0KCiAgY29uc3QgZ2V0S2V5ID0gKGksIGopID0+IGkgPCBqID8gYCR7aX0tJHtqfWAgOiBgJHtqfS0ke2l9YDsKICAvKioKICAgKiBUdXBsZURpY3Rpb25hcnkKICAgKi8KCgogIGNsYXNzIFR1cGxlRGljdGlvbmFyeSB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5kYXRhID0gewogICAgICAgIGtleXM6IFtdCiAgICAgIH07CiAgICB9CgogICAgLyoqIGdldCAqLwogICAgZ2V0KGksIGopIHsKICAgICAgY29uc3Qga2V5ID0gZ2V0S2V5KGksIGopOwogICAgICByZXR1cm4gdGhpcy5kYXRhW2tleV07CiAgICB9CiAgICAvKiogc2V0ICovCgoKICAgIHNldChpLCBqLCB2YWx1ZSkgewogICAgICBjb25zdCBrZXkgPSBnZXRLZXkoaSwgaik7IC8vIENoZWNrIGlmIGtleSBhbHJlYWR5IGV4aXN0cwoKICAgICAgaWYgKCF0aGlzLmdldChpLCBqKSkgewogICAgICAgIHRoaXMuZGF0YS5rZXlzLnB1c2goa2V5KTsKICAgICAgfQoKICAgICAgdGhpcy5kYXRhW2tleV0gPSB2YWx1ZTsKICAgIH0KICAgIC8qKiBkZWxldGUgKi8KCgogICAgZGVsZXRlKGksIGopIHsKICAgICAgY29uc3Qga2V5ID0gZ2V0S2V5KGksIGopOwogICAgICBjb25zdCBpbmRleCA9IHRoaXMuZGF0YS5rZXlzLmluZGV4T2Yoa2V5KTsKCiAgICAgIGlmIChpbmRleCAhPT0gLTEpIHsKICAgICAgICB0aGlzLmRhdGEua2V5cy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB9CgogICAgICBkZWxldGUgdGhpcy5kYXRhW2tleV07CiAgICB9CiAgICAvKiogcmVzZXQgKi8KCgogICAgcmVzZXQoKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IGtleXMgPSBkYXRhLmtleXM7CgogICAgICB3aGlsZSAoa2V5cy5sZW5ndGggPiAwKSB7CiAgICAgICAgY29uc3Qga2V5ID0ga2V5cy5wb3AoKTsKICAgICAgICBkZWxldGUgZGF0YVtrZXldOwogICAgICB9CiAgICB9CgogIH0KCiAgLyoqCiAgICogVGhlIHBoeXNpY3Mgd29ybGQKICAgKi8KICBjbGFzcyBXb3JsZCBleHRlbmRzIEV2ZW50VGFyZ2V0IHsKICAgIC8qKgogICAgICogQ3VycmVudGx5IC8gbGFzdCB1c2VkIHRpbWVzdGVwLiBJcyBzZXQgdG8gLTEgaWYgbm90IGF2YWlsYWJsZS4gVGhpcyB2YWx1ZSBpcyB1cGRhdGVkIGJlZm9yZSBlYWNoIGludGVybmFsIHN0ZXAsIHdoaWNoIG1lYW5zIHRoYXQgaXQgaXMgImZyZXNoIiBpbnNpZGUgZXZlbnQgY2FsbGJhY2tzLgogICAgICovCgogICAgLyoqCiAgICAgKiBNYWtlcyBib2RpZXMgZ28gdG8gc2xlZXAgd2hlbiB0aGV5J3ZlIGJlZW4gaW5hY3RpdmUuCiAgICAgKiBAZGVmYXVsdCBmYWxzZQogICAgICovCgogICAgLyoqCiAgICAgKiBBbGwgdGhlIGN1cnJlbnQgY29udGFjdHMgKGluc3RhbmNlcyBvZiBDb250YWN0RXF1YXRpb24pIGluIHRoZSB3b3JsZC4KICAgICAqLwoKICAgIC8qKgogICAgICogSG93IG9mdGVuIHRvIG5vcm1hbGl6ZSBxdWF0ZXJuaW9ucy4gU2V0IHRvIDAgZm9yIGV2ZXJ5IHN0ZXAsIDEgZm9yIGV2ZXJ5IHNlY29uZCBldGMuLiBBIGxhcmdlciB2YWx1ZSBpbmNyZWFzZXMgcGVyZm9ybWFuY2UuIElmIGJvZGllcyB0ZW5kIHRvIGV4cGxvZGUsIHNldCB0byBhIHNtYWxsZXIgdmFsdWUgKHplcm8gdG8gYmUgc3VyZSBub3RoaW5nIGNhbiBnbyB3cm9uZykuCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNldCB0byB0cnVlIHRvIHVzZSBmYXN0IHF1YXRlcm5pb24gbm9ybWFsaXphdGlvbi4gSXQgaXMgb2Z0ZW4gZW5vdWdoIGFjY3VyYXRlIHRvIHVzZS4KICAgICAqIElmIGJvZGllcyB0ZW5kIHRvIGV4cGxvZGUsIHNldCB0byBmYWxzZS4KICAgICAqIEBkZWZhdWx0IGZhbHNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSB3YWxsLWNsb2NrIHRpbWUgc2luY2Ugc2ltdWxhdGlvbiBzdGFydC4KICAgICAqLwoKICAgIC8qKgogICAgICogTnVtYmVyIG9mIHRpbWVzdGVwcyB0YWtlbiBzaW5jZSBzdGFydC4KICAgICAqLwoKICAgIC8qKgogICAgICogRGVmYXVsdCBhbmQgbGFzdCB0aW1lc3RlcCBzaXplcy4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGdyYXZpdHkgb2YgdGhlIHdvcmxkLgogICAgICovCgogICAgLyoqCiAgICAgKiBHcmF2aXR5IHRvIHVzZSB3aGVuIGFwcHJveGltYXRpbmcgdGhlIGZyaWN0aW9uIG1heCBmb3JjZSAobXUqbWFzcypncmF2aXR5KS4KICAgICAqIElmIHVuZGVmaW5lZCwgZ2xvYmFsIGdyYXZpdHkgd2lsbCBiZSB1c2VkLgogICAgICogVXNlIHRvIGVuYWJsZSBmcmljdGlvbiBpbiBhIFdvcmxkIHdpdGggYSBudWxsIGdyYXZpdHkgdmVjdG9yIChubyBncmF2aXR5KS4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGJyb2FkcGhhc2UgYWxnb3JpdGhtIHRvIHVzZS4KICAgICAqIEBkZWZhdWx0IE5haXZlQnJvYWRwaGFzZQogICAgICovCgogICAgLyoqCiAgICAgKiBBbGwgYm9kaWVzIGluIHRoaXMgd29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogVHJ1ZSBpZiBhbnkgYm9kaWVzIGFyZSBub3Qgc2xlZXBpbmcsIGZhbHNlIGlmIGV2ZXJ5IGJvZHkgaXMgc2xlZXBpbmcuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBzb2x2ZXIgYWxnb3JpdGhtIHRvIHVzZS4KICAgICAqIEBkZWZhdWx0IEdTU29sdmVyCiAgICAgKi8KCiAgICAvKioKICAgICAqIGNvbGxpc2lvbk1hdHJpeAogICAgICovCgogICAgLyoqCiAgICAgKiBDb2xsaXNpb25NYXRyaXggZnJvbSB0aGUgcHJldmlvdXMgc3RlcC4KICAgICAqLwoKICAgIC8qKgogICAgICogQWxsIGFkZGVkIGNvbnRhY3RtYXRlcmlhbHMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFVzZWQgdG8gbG9vayB1cCBhIENvbnRhY3RNYXRlcmlhbCBnaXZlbiB0d28gaW5zdGFuY2VzIG9mIE1hdGVyaWFsLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgZGVmYXVsdCBtYXRlcmlhbCBvZiB0aGUgYm9kaWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGlzIGNvbnRhY3QgbWF0ZXJpYWwgaXMgdXNlZCBpZiBubyBzdWl0YWJsZSBjb250YWN0bWF0ZXJpYWwgaXMgZm91bmQgZm9yIGEgY29udGFjdC4KICAgICAqLwoKICAgIC8qKgogICAgICogVGltZSBhY2N1bXVsYXRvciBmb3IgaW50ZXJwb2xhdGlvbi4KICAgICAqIEBzZWUgaHR0cHM6Ly9nYWZmZXJvbmdhbWVzLmNvbS9nYW1lLXBoeXNpY3MvZml4LXlvdXItdGltZXN0ZXAvCiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3BhdGNoZWQgYWZ0ZXIgYSBib2R5IGhhcyBiZWVuIGFkZGVkIHRvIHRoZSB3b3JsZC4KICAgICAqLwoKICAgIC8qKgogICAgICogRGlzcGF0Y2hlZCBhZnRlciBhIGJvZHkgaGFzIGJlZW4gcmVtb3ZlZCBmcm9tIHRoZSB3b3JsZC4KICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBzdXBlcigpOwogICAgICB0aGlzLmR0ID0gLTE7CiAgICAgIHRoaXMuYWxsb3dTbGVlcCA9ICEhb3B0aW9ucy5hbGxvd1NsZWVwOwogICAgICB0aGlzLmNvbnRhY3RzID0gW107CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMgPSBbXTsKICAgICAgdGhpcy5xdWF0Tm9ybWFsaXplU2tpcCA9IG9wdGlvbnMucXVhdE5vcm1hbGl6ZVNraXAgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMucXVhdE5vcm1hbGl6ZVNraXAgOiAwOwogICAgICB0aGlzLnF1YXROb3JtYWxpemVGYXN0ID0gb3B0aW9ucy5xdWF0Tm9ybWFsaXplRmFzdCAhPT0gdW5kZWZpbmVkID8gb3B0aW9ucy5xdWF0Tm9ybWFsaXplRmFzdCA6IGZhbHNlOwogICAgICB0aGlzLnRpbWUgPSAwLjA7CiAgICAgIHRoaXMuc3RlcG51bWJlciA9IDA7CiAgICAgIHRoaXMuZGVmYXVsdF9kdCA9IDEgLyA2MDsKICAgICAgdGhpcy5uZXh0SWQgPSAwOwogICAgICB0aGlzLmdyYXZpdHkgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMuZ3Jhdml0eSkgewogICAgICAgIHRoaXMuZ3Jhdml0eS5jb3B5KG9wdGlvbnMuZ3Jhdml0eSk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLmZyaWN0aW9uR3Jhdml0eSkgewogICAgICAgIHRoaXMuZnJpY3Rpb25HcmF2aXR5ID0gbmV3IFZlYzMoKTsKICAgICAgICB0aGlzLmZyaWN0aW9uR3Jhdml0eS5jb3B5KG9wdGlvbnMuZnJpY3Rpb25HcmF2aXR5KTsKICAgICAgfQoKICAgICAgdGhpcy5icm9hZHBoYXNlID0gb3B0aW9ucy5icm9hZHBoYXNlICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmJyb2FkcGhhc2UgOiBuZXcgTmFpdmVCcm9hZHBoYXNlKCk7CiAgICAgIHRoaXMuYm9kaWVzID0gW107CiAgICAgIHRoaXMuaGFzQWN0aXZlQm9kaWVzID0gZmFsc2U7CiAgICAgIHRoaXMuc29sdmVyID0gb3B0aW9ucy5zb2x2ZXIgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuc29sdmVyIDogbmV3IEdTU29sdmVyKCk7CiAgICAgIHRoaXMuY29uc3RyYWludHMgPSBbXTsKICAgICAgdGhpcy5uYXJyb3dwaGFzZSA9IG5ldyBOYXJyb3dwaGFzZSh0aGlzKTsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXggPSBuZXcgQXJyYXlDb2xsaXNpb25NYXRyaXgoKTsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXhQcmV2aW91cyA9IG5ldyBBcnJheUNvbGxpc2lvbk1hdHJpeCgpOwogICAgICB0aGlzLmJvZHlPdmVybGFwS2VlcGVyID0gbmV3IE92ZXJsYXBLZWVwZXIoKTsKICAgICAgdGhpcy5zaGFwZU92ZXJsYXBLZWVwZXIgPSBuZXcgT3ZlcmxhcEtlZXBlcigpOwogICAgICB0aGlzLmNvbnRhY3RtYXRlcmlhbHMgPSBbXTsKICAgICAgdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZSA9IG5ldyBUdXBsZURpY3Rpb25hcnkoKTsKICAgICAgdGhpcy5kZWZhdWx0TWF0ZXJpYWwgPSBuZXcgTWF0ZXJpYWwoJ2RlZmF1bHQnKTsKICAgICAgdGhpcy5kZWZhdWx0Q29udGFjdE1hdGVyaWFsID0gbmV3IENvbnRhY3RNYXRlcmlhbCh0aGlzLmRlZmF1bHRNYXRlcmlhbCwgdGhpcy5kZWZhdWx0TWF0ZXJpYWwsIHsKICAgICAgICBmcmljdGlvbjogMC4zLAogICAgICAgIHJlc3RpdHV0aW9uOiAwLjAKICAgICAgfSk7CiAgICAgIHRoaXMuZG9Qcm9maWxpbmcgPSBmYWxzZTsKICAgICAgdGhpcy5wcm9maWxlID0gewogICAgICAgIHNvbHZlOiAwLAogICAgICAgIG1ha2VDb250YWN0Q29uc3RyYWludHM6IDAsCiAgICAgICAgYnJvYWRwaGFzZTogMCwKICAgICAgICBpbnRlZ3JhdGU6IDAsCiAgICAgICAgbmFycm93cGhhc2U6IDAKICAgICAgfTsKICAgICAgdGhpcy5hY2N1bXVsYXRvciA9IDA7CiAgICAgIHRoaXMuc3Vic3lzdGVtcyA9IFtdOwogICAgICB0aGlzLmFkZEJvZHlFdmVudCA9IHsKICAgICAgICB0eXBlOiAnYWRkQm9keScsCiAgICAgICAgYm9keTogbnVsbAogICAgICB9OwogICAgICB0aGlzLnJlbW92ZUJvZHlFdmVudCA9IHsKICAgICAgICB0eXBlOiAncmVtb3ZlQm9keScsCiAgICAgICAgYm9keTogbnVsbAogICAgICB9OwogICAgICB0aGlzLmlkVG9Cb2R5TWFwID0ge307CiAgICAgIHRoaXMuYnJvYWRwaGFzZS5zZXRXb3JsZCh0aGlzKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBjb250YWN0IG1hdGVyaWFsIGJldHdlZW4gbWF0ZXJpYWxzIG0xIGFuZCBtMgogICAgICogQHJldHVybiBUaGUgY29udGFjdCBtYXRlcmlhbCBpZiBpdCB3YXMgZm91bmQuCiAgICAgKi8KCgogICAgZ2V0Q29udGFjdE1hdGVyaWFsKG0xLCBtMikgewogICAgICByZXR1cm4gdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZS5nZXQobTEuaWQsIG0yLmlkKTsKICAgIH0KICAgIC8qKgogICAgICogU3RvcmUgb2xkIGNvbGxpc2lvbiBzdGF0ZSBpbmZvCiAgICAgKi8KCgogICAgY29sbGlzaW9uTWF0cml4VGljaygpIHsKICAgICAgY29uc3QgdGVtcCA9IHRoaXMuY29sbGlzaW9uTWF0cml4UHJldmlvdXM7CiAgICAgIHRoaXMuY29sbGlzaW9uTWF0cml4UHJldmlvdXMgPSB0aGlzLmNvbGxpc2lvbk1hdHJpeDsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXggPSB0ZW1wOwogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5yZXNldCgpOwogICAgICB0aGlzLmJvZHlPdmVybGFwS2VlcGVyLnRpY2soKTsKICAgICAgdGhpcy5zaGFwZU92ZXJsYXBLZWVwZXIudGljaygpOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSBjb25zdHJhaW50IHRvIHRoZSBzaW11bGF0aW9uLgogICAgICovCgoKICAgIGFkZENvbnN0cmFpbnQoYykgewogICAgICB0aGlzLmNvbnN0cmFpbnRzLnB1c2goYyk7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZXMgYSBjb25zdHJhaW50CiAgICAgKi8KCgogICAgcmVtb3ZlQ29uc3RyYWludChjKSB7CiAgICAgIGNvbnN0IGlkeCA9IHRoaXMuY29uc3RyYWludHMuaW5kZXhPZihjKTsKCiAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgdGhpcy5jb25zdHJhaW50cy5zcGxpY2UoaWR4LCAxKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSYXljYXN0IHRlc3QKICAgICAqIEBkZXByZWNhdGVkIFVzZSAucmF5Y2FzdEFsbCwgLnJheWNhc3RDbG9zZXN0IG9yIC5yYXljYXN0QW55IGluc3RlYWQuCiAgICAgKi8KCgogICAgcmF5VGVzdChmcm9tLCB0bywgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgaW5zdGFuY2VvZiBSYXljYXN0UmVzdWx0KSB7CiAgICAgICAgLy8gRG8gcmF5Y2FzdENsb3Nlc3QKICAgICAgICB0aGlzLnJheWNhc3RDbG9zZXN0KGZyb20sIHRvLCB7CiAgICAgICAgICBza2lwQmFja2ZhY2VzOiB0cnVlCiAgICAgICAgfSwgcmVzdWx0KTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBEbyByYXljYXN0QWxsCiAgICAgICAgdGhpcy5yYXljYXN0QWxsKGZyb20sIHRvLCB7CiAgICAgICAgICBza2lwQmFja2ZhY2VzOiB0cnVlCiAgICAgICAgfSwgcmVzdWx0KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSYXkgY2FzdCBhZ2FpbnN0IGFsbCBib2RpZXMuIFRoZSBwcm92aWRlZCBjYWxsYmFjayB3aWxsIGJlIGV4ZWN1dGVkIGZvciBlYWNoIGhpdCB3aXRoIGEgUmF5Y2FzdFJlc3VsdCBhcyBzaW5nbGUgYXJndW1lbnQuCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgYW55IGJvZHkgd2FzIGhpdC4KICAgICAqLwoKCiAgICByYXljYXN0QWxsKGZyb20sIHRvLCBvcHRpb25zLCBjYWxsYmFjaykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zLm1vZGUgPSBSYXkuQUxMOwogICAgICBvcHRpb25zLmZyb20gPSBmcm9tOwogICAgICBvcHRpb25zLnRvID0gdG87CiAgICAgIG9wdGlvbnMuY2FsbGJhY2sgPSBjYWxsYmFjazsKICAgICAgcmV0dXJuIHRtcFJheS5pbnRlcnNlY3RXb3JsZCh0aGlzLCBvcHRpb25zKTsKICAgIH0KICAgIC8qKgogICAgICogUmF5IGNhc3QsIGFuZCBzdG9wIGF0IHRoZSBmaXJzdCByZXN1bHQuIE5vdGUgdGhhdCB0aGUgb3JkZXIgaXMgcmFuZG9tIC0gYnV0IHRoZSBtZXRob2QgaXMgZmFzdC4KICAgICAqIEByZXR1cm4gVHJ1ZSBpZiBhbnkgYm9keSB3YXMgaGl0LgogICAgICovCgoKICAgIHJheWNhc3RBbnkoZnJvbSwgdG8sIG9wdGlvbnMsIHJlc3VsdCkgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zLm1vZGUgPSBSYXkuQU5ZOwogICAgICBvcHRpb25zLmZyb20gPSBmcm9tOwogICAgICBvcHRpb25zLnRvID0gdG87CiAgICAgIG9wdGlvbnMucmVzdWx0ID0gcmVzdWx0OwogICAgICByZXR1cm4gdG1wUmF5LmludGVyc2VjdFdvcmxkKHRoaXMsIG9wdGlvbnMpOwogICAgfQogICAgLyoqCiAgICAgKiBSYXkgY2FzdCwgYW5kIHJldHVybiBpbmZvcm1hdGlvbiBvZiB0aGUgY2xvc2VzdCBoaXQuCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgYW55IGJvZHkgd2FzIGhpdC4KICAgICAqLwoKCiAgICByYXljYXN0Q2xvc2VzdChmcm9tLCB0bywgb3B0aW9ucywgcmVzdWx0KSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIG9wdGlvbnMubW9kZSA9IFJheS5DTE9TRVNUOwogICAgICBvcHRpb25zLmZyb20gPSBmcm9tOwogICAgICBvcHRpb25zLnRvID0gdG87CiAgICAgIG9wdGlvbnMucmVzdWx0ID0gcmVzdWx0OwogICAgICByZXR1cm4gdG1wUmF5LmludGVyc2VjdFdvcmxkKHRoaXMsIG9wdGlvbnMpOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSByaWdpZCBib2R5IHRvIHRoZSBzaW11bGF0aW9uLgogICAgICogQHRvZG8gSWYgdGhlIHNpbXVsYXRpb24gaGFzIG5vdCB5ZXQgc3RhcnRlZCwgd2h5IHJlY3JldGUgYW5kIGNvcHkgYXJyYXlzIGZvciBlYWNoIGJvZHk/IEFjY3VtdWxhdGUgaW4gZHluYW1pYyBhcnJheXMgaW4gdGhpcyBjYXNlLgogICAgICogQHRvZG8gQWRkaW5nIGFuIGFycmF5IG9mIGJvZGllcyBzaG91bGQgYmUgcG9zc2libGUuIFRoaXMgd291bGQgc2F2ZSBzb21lIGxvb3BzIHRvbwogICAgICovCgoKICAgIGFkZEJvZHkoYm9keSkgewogICAgICBpZiAodGhpcy5ib2RpZXMuaW5jbHVkZXMoYm9keSkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGJvZHkuaW5kZXggPSB0aGlzLmJvZGllcy5sZW5ndGg7CiAgICAgIHRoaXMuYm9kaWVzLnB1c2goYm9keSk7CiAgICAgIGJvZHkud29ybGQgPSB0aGlzOwogICAgICBib2R5LmluaXRQb3NpdGlvbi5jb3B5KGJvZHkucG9zaXRpb24pOwogICAgICBib2R5LmluaXRWZWxvY2l0eS5jb3B5KGJvZHkudmVsb2NpdHkpOwogICAgICBib2R5LnRpbWVMYXN0U2xlZXB5ID0gdGhpcy50aW1lOwoKICAgICAgaWYgKGJvZHkgaW5zdGFuY2VvZiBCb2R5KSB7CiAgICAgICAgYm9keS5pbml0QW5ndWxhclZlbG9jaXR5LmNvcHkoYm9keS5hbmd1bGFyVmVsb2NpdHkpOwogICAgICAgIGJvZHkuaW5pdFF1YXRlcm5pb24uY29weShib2R5LnF1YXRlcm5pb24pOwogICAgICB9CgogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5zZXROdW1PYmplY3RzKHRoaXMuYm9kaWVzLmxlbmd0aCk7CiAgICAgIHRoaXMuYWRkQm9keUV2ZW50LmJvZHkgPSBib2R5OwogICAgICB0aGlzLmlkVG9Cb2R5TWFwW2JvZHkuaWRdID0gYm9keTsKICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KHRoaXMuYWRkQm9keUV2ZW50KTsKICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlIGEgcmlnaWQgYm9keSBmcm9tIHRoZSBzaW11bGF0aW9uLgogICAgICovCgoKICAgIHJlbW92ZUJvZHkoYm9keSkgewogICAgICBib2R5LndvcmxkID0gbnVsbDsKICAgICAgY29uc3QgbiA9IHRoaXMuYm9kaWVzLmxlbmd0aCAtIDE7CiAgICAgIGNvbnN0IGJvZGllcyA9IHRoaXMuYm9kaWVzOwogICAgICBjb25zdCBpZHggPSBib2RpZXMuaW5kZXhPZihib2R5KTsKCiAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgYm9kaWVzLnNwbGljZShpZHgsIDEpOyAvLyBUb2RvOiBzaG91bGQgdXNlIGEgZ2FyYmFnZSBmcmVlIG1ldGhvZAogICAgICAgIC8vIFJlY29tcHV0ZSBpbmRleAoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gYm9kaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBib2RpZXNbaV0uaW5kZXggPSBpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXguc2V0TnVtT2JqZWN0cyhuKTsKICAgICAgICB0aGlzLnJlbW92ZUJvZHlFdmVudC5ib2R5ID0gYm9keTsKICAgICAgICBkZWxldGUgdGhpcy5pZFRvQm9keU1hcFtib2R5LmlkXTsKICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQodGhpcy5yZW1vdmVCb2R5RXZlbnQpOwogICAgICB9CiAgICB9CgogICAgZ2V0Qm9keUJ5SWQoaWQpIHsKICAgICAgcmV0dXJuIHRoaXMuaWRUb0JvZHlNYXBbaWRdOwogICAgfQogICAgLyoqCiAgICAgKiBAdG9kbyBNYWtlIGEgZmFzdGVyIG1hcAogICAgICovCgoKICAgIGdldFNoYXBlQnlJZChpZCkgewogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmJvZGllczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYm9kaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3Qgc2hhcGVzID0gYm9kaWVzW2ldLnNoYXBlczsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBzaGFwZXMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGNvbnN0IHNoYXBlID0gc2hhcGVzW2pdOwoKICAgICAgICAgIGlmIChzaGFwZS5pZCA9PT0gaWQpIHsKICAgICAgICAgICAgcmV0dXJuIHNoYXBlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICAvKioKICAgICAqIEFkZHMgYSBjb250YWN0IG1hdGVyaWFsIHRvIHRoZSBXb3JsZAogICAgICovCgoKICAgIGFkZENvbnRhY3RNYXRlcmlhbChjbWF0KSB7CiAgICAgIC8vIEFkZCBjb250YWN0IG1hdGVyaWFsCiAgICAgIHRoaXMuY29udGFjdG1hdGVyaWFscy5wdXNoKGNtYXQpOyAvLyBBZGQgY3VycmVudCBjb250YWN0IG1hdGVyaWFsIHRvIHRoZSBtYXRlcmlhbCB0YWJsZQoKICAgICAgdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZS5zZXQoY21hdC5tYXRlcmlhbHNbMF0uaWQsIGNtYXQubWF0ZXJpYWxzWzFdLmlkLCBjbWF0KTsKICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlcyBhIGNvbnRhY3QgbWF0ZXJpYWwgZnJvbSB0aGUgV29ybGQuCiAgICAgKi8KCgogICAgcmVtb3ZlQ29udGFjdE1hdGVyaWFsKGNtYXQpIHsKICAgICAgY29uc3QgaWR4ID0gdGhpcy5jb250YWN0bWF0ZXJpYWxzLmluZGV4T2YoY21hdCk7CgogICAgICBpZiAoaWR4ID09PSAtMSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGhpcy5jb250YWN0bWF0ZXJpYWxzLnNwbGljZShpZHgsIDEpOwogICAgICB0aGlzLmNvbnRhY3RNYXRlcmlhbFRhYmxlLmRlbGV0ZShjbWF0Lm1hdGVyaWFsc1swXS5pZCwgY21hdC5tYXRlcmlhbHNbMV0uaWQpOwogICAgfQogICAgLyoqCiAgICAgKiBTdGVwIHRoZSBzaW11bGF0aW9uIGZvcndhcmQga2VlcGluZyB0cmFjayBvZiBsYXN0IGNhbGxlZCB0aW1lCiAgICAgKiB0byBiZSBhYmxlIHRvIHN0ZXAgdGhlIHdvcmxkIGF0IGEgZml4ZWQgcmF0ZSwgaW5kZXBlbmRlbnRseSBvZiBmcmFtZXJhdGUuCiAgICAgKgogICAgICogQHBhcmFtIGR0IFRoZSBmaXhlZCB0aW1lIHN0ZXAgc2l6ZSB0byB1c2UgKGRlZmF1bHQ6IDEgLyA2MCkuCiAgICAgKiBAcGFyYW0gbWF4U3ViU3RlcHMgTWF4aW11bSBudW1iZXIgb2YgZml4ZWQgc3RlcHMgdG8gdGFrZSBwZXIgZnVuY3Rpb24gY2FsbCAoZGVmYXVsdDogMTApLgogICAgICogQHNlZSBodHRwczovL2dhZmZlcm9uZ2FtZXMuY29tL3Bvc3QvZml4X3lvdXJfdGltZXN0ZXAvCiAgICAgKiBAZXhhbXBsZQogICAgICogICAgIC8vIFJ1biB0aGUgc2ltdWxhdGlvbiBpbmRlcGVuZGVudGx5IG9mIGZyYW1lcmF0ZSBldmVyeSAxIC8gNjAgbXMKICAgICAqICAgICB3b3JsZC5maXhlZFN0ZXAoKQogICAgICovCgoKICAgIGZpeGVkU3RlcChkdCwgbWF4U3ViU3RlcHMpIHsKICAgICAgaWYgKGR0ID09PSB2b2lkIDApIHsKICAgICAgICBkdCA9IDEgLyA2MDsKICAgICAgfQoKICAgICAgaWYgKG1heFN1YlN0ZXBzID09PSB2b2lkIDApIHsKICAgICAgICBtYXhTdWJTdGVwcyA9IDEwOwogICAgICB9CgogICAgICBjb25zdCB0aW1lID0gcGVyZm9ybWFuY2Uubm93KCkgLyAxMDAwOyAvLyBzZWNvbmRzCgogICAgICBpZiAoIXRoaXMubGFzdENhbGxUaW1lKSB7CiAgICAgICAgdGhpcy5zdGVwKGR0LCB1bmRlZmluZWQsIG1heFN1YlN0ZXBzKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCB0aW1lU2luY2VMYXN0Q2FsbGVkID0gdGltZSAtIHRoaXMubGFzdENhbGxUaW1lOwogICAgICAgIHRoaXMuc3RlcChkdCwgdGltZVNpbmNlTGFzdENhbGxlZCwgbWF4U3ViU3RlcHMpOwogICAgICB9CgogICAgICB0aGlzLmxhc3RDYWxsVGltZSA9IHRpbWU7CiAgICB9CiAgICAvKioKICAgICAqIFN0ZXAgdGhlIHBoeXNpY3Mgd29ybGQgZm9yd2FyZCBpbiB0aW1lLgogICAgICoKICAgICAqIFRoZXJlIGFyZSB0d28gbW9kZXMuIFRoZSBzaW1wbGUgbW9kZSBpcyBmaXhlZCB0aW1lc3RlcHBpbmcgd2l0aG91dCBpbnRlcnBvbGF0aW9uLiBJbiB0aGlzIGNhc2UgeW91IG9ubHkgdXNlIHRoZSBmaXJzdCBhcmd1bWVudC4gVGhlIHNlY29uZCBjYXNlIHVzZXMgaW50ZXJwb2xhdGlvbi4gSW4gdGhhdCB5b3UgYWxzbyBwcm92aWRlIHRoZSB0aW1lIHNpbmNlIHRoZSBmdW5jdGlvbiB3YXMgbGFzdCB1c2VkLCBhcyB3ZWxsIGFzIHRoZSBtYXhpbXVtIGZpeGVkIHRpbWVzdGVwcyB0byB0YWtlLgogICAgICoKICAgICAqIEBwYXJhbSBkdCBUaGUgZml4ZWQgdGltZSBzdGVwIHNpemUgdG8gdXNlLgogICAgICogQHBhcmFtIHRpbWVTaW5jZUxhc3RDYWxsZWQgVGhlIHRpbWUgZWxhcHNlZCBzaW5jZSB0aGUgZnVuY3Rpb24gd2FzIGxhc3QgY2FsbGVkLgogICAgICogQHBhcmFtIG1heFN1YlN0ZXBzIE1heGltdW0gbnVtYmVyIG9mIGZpeGVkIHN0ZXBzIHRvIHRha2UgcGVyIGZ1bmN0aW9uIGNhbGwgKGRlZmF1bHQ6IDEwKS4KICAgICAqIEBzZWUgaHR0cHM6Ly93ZWIuYXJjaGl2ZS5vcmcvd2ViLzIwMTgwNDI2MTU0NTMxL2h0dHA6Ly9idWxsZXRwaHlzaWNzLm9yZy9tZWRpYXdpa2ktMS41LjgvaW5kZXgucGhwL1N0ZXBwaW5nX1RoZV9Xb3JsZCNXaGF0X2RvX3RoZV9wYXJhbWV0ZXJzX3RvX2J0RHluYW1pY3NXb3JsZDo6c3RlcFNpbXVsYXRpb25fbWVhbi4zRgogICAgICogQGV4YW1wbGUKICAgICAqICAgICAvLyBmaXhlZCB0aW1lc3RlcHBpbmcgd2l0aG91dCBpbnRlcnBvbGF0aW9uCiAgICAgKiAgICAgd29ybGQuc3RlcCgxIC8gNjApCiAgICAgKi8KCgogICAgc3RlcChkdCwgdGltZVNpbmNlTGFzdENhbGxlZCwgbWF4U3ViU3RlcHMpIHsKICAgICAgaWYgKG1heFN1YlN0ZXBzID09PSB2b2lkIDApIHsKICAgICAgICBtYXhTdWJTdGVwcyA9IDEwOwogICAgICB9CgogICAgICBpZiAodGltZVNpbmNlTGFzdENhbGxlZCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgLy8gRml4ZWQsIHNpbXBsZSBzdGVwcGluZwogICAgICAgIHRoaXMuaW50ZXJuYWxTdGVwKGR0KTsgLy8gSW5jcmVtZW50IHRpbWUKCiAgICAgICAgdGhpcy50aW1lICs9IGR0OwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYWNjdW11bGF0b3IgKz0gdGltZVNpbmNlTGFzdENhbGxlZDsKICAgICAgICBjb25zdCB0MCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICAgIGxldCBzdWJzdGVwcyA9IDA7CgogICAgICAgIHdoaWxlICh0aGlzLmFjY3VtdWxhdG9yID49IGR0ICYmIHN1YnN0ZXBzIDwgbWF4U3ViU3RlcHMpIHsKICAgICAgICAgIC8vIERvIGZpeGVkIHN0ZXBzIHRvIGNhdGNoIHVwCiAgICAgICAgICB0aGlzLmludGVybmFsU3RlcChkdCk7CiAgICAgICAgICB0aGlzLmFjY3VtdWxhdG9yIC09IGR0OwogICAgICAgICAgc3Vic3RlcHMrKzsKCiAgICAgICAgICBpZiAocGVyZm9ybWFuY2Uubm93KCkgLSB0MCA+IGR0ICogMTAwMCkgewogICAgICAgICAgICAvLyBUaGUgZnJhbWVyYXRlIGlzIG5vdCBpbnRlcmFjdGl2ZSBhbnltb3JlLgogICAgICAgICAgICAvLyBXZSBhcmUgYmVsb3cgdGhlIHRhcmdldCBmcmFtZXJhdGUuCiAgICAgICAgICAgIC8vIEJldHRlciBiYWlsIG91dC4KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBSZW1vdmUgdGhlIGV4Y2VzcyBhY2N1bXVsYXRvciwgc2luY2Ugd2UgbWF5IG5vdAogICAgICAgIC8vIGhhdmUgaGFkIGVub3VnaCBzdWJzdGVwcyBhdmFpbGFibGUgdG8gY2F0Y2ggdXAKCgogICAgICAgIHRoaXMuYWNjdW11bGF0b3IgPSB0aGlzLmFjY3VtdWxhdG9yICUgZHQ7CiAgICAgICAgY29uc3QgdCA9IHRoaXMuYWNjdW11bGF0b3IgLyBkdDsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IHRoaXMuYm9kaWVzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCBiID0gdGhpcy5ib2RpZXNbal07CiAgICAgICAgICBiLnByZXZpb3VzUG9zaXRpb24ubGVycChiLnBvc2l0aW9uLCB0LCBiLmludGVycG9sYXRlZFBvc2l0aW9uKTsKICAgICAgICAgIGIucHJldmlvdXNRdWF0ZXJuaW9uLnNsZXJwKGIucXVhdGVybmlvbiwgdCwgYi5pbnRlcnBvbGF0ZWRRdWF0ZXJuaW9uKTsKICAgICAgICAgIGIucHJldmlvdXNRdWF0ZXJuaW9uLm5vcm1hbGl6ZSgpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy50aW1lICs9IHRpbWVTaW5jZUxhc3RDYWxsZWQ7CiAgICAgIH0KICAgIH0KCiAgICBpbnRlcm5hbFN0ZXAoZHQpIHsKICAgICAgdGhpcy5kdCA9IGR0OwogICAgICBjb25zdCBjb250YWN0cyA9IHRoaXMuY29udGFjdHM7CiAgICAgIGNvbnN0IHAxID0gV29ybGRfc3RlcF9wMTsKICAgICAgY29uc3QgcDIgPSBXb3JsZF9zdGVwX3AyOwogICAgICBjb25zdCBOID0gdGhpcy5ib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmJvZGllczsKICAgICAgY29uc3Qgc29sdmVyID0gdGhpcy5zb2x2ZXI7CiAgICAgIGNvbnN0IGdyYXZpdHkgPSB0aGlzLmdyYXZpdHk7CiAgICAgIGNvbnN0IGRvUHJvZmlsaW5nID0gdGhpcy5kb1Byb2ZpbGluZzsKICAgICAgY29uc3QgcHJvZmlsZSA9IHRoaXMucHJvZmlsZTsKICAgICAgY29uc3QgRFlOQU1JQyA9IEJvZHkuRFlOQU1JQzsKICAgICAgbGV0IHByb2ZpbGluZ1N0YXJ0ID0gLUluZmluaXR5OwogICAgICBjb25zdCBjb25zdHJhaW50cyA9IHRoaXMuY29uc3RyYWludHM7CiAgICAgIGNvbnN0IGZyaWN0aW9uRXF1YXRpb25Qb29sID0gV29ybGRfc3RlcF9mcmljdGlvbkVxdWF0aW9uUG9vbDsKICAgICAgZ3Jhdml0eS5sZW5ndGgoKTsKICAgICAgY29uc3QgZ3ggPSBncmF2aXR5Lng7CiAgICAgIGNvbnN0IGd5ID0gZ3Jhdml0eS55OwogICAgICBjb25zdCBneiA9IGdyYXZpdHkuejsKICAgICAgbGV0IGkgPSAwOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsaW5nU3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKTsKICAgICAgfSAvLyBBZGQgZ3Jhdml0eSB0byBhbGwgb2JqZWN0cwoKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGJpID0gYm9kaWVzW2ldOwoKICAgICAgICBpZiAoYmkudHlwZSA9PT0gRFlOQU1JQykgewogICAgICAgICAgLy8gT25seSBmb3IgZHluYW1pYyBib2RpZXMKICAgICAgICAgIGNvbnN0IGYgPSBiaS5mb3JjZTsKICAgICAgICAgIGNvbnN0IG0gPSBiaS5tYXNzOwogICAgICAgICAgZi54ICs9IG0gKiBneDsKICAgICAgICAgIGYueSArPSBtICogZ3k7CiAgICAgICAgICBmLnogKz0gbSAqIGd6OwogICAgICAgIH0KICAgICAgfSAvLyBVcGRhdGUgc3Vic3lzdGVtcwoKCiAgICAgIGZvciAobGV0IGkgPSAwLCBOc3Vic3lzdGVtcyA9IHRoaXMuc3Vic3lzdGVtcy5sZW5ndGg7IGkgIT09IE5zdWJzeXN0ZW1zOyBpKyspIHsKICAgICAgICB0aGlzLnN1YnN5c3RlbXNbaV0udXBkYXRlKCk7CiAgICAgIH0gLy8gQ29sbGlzaW9uIGRldGVjdGlvbgoKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGluZ1N0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgIH0KCiAgICAgIHAxLmxlbmd0aCA9IDA7IC8vIENsZWFuIHVwIHBhaXIgYXJyYXlzIGZyb20gbGFzdCBzdGVwCgogICAgICBwMi5sZW5ndGggPSAwOwogICAgICB0aGlzLmJyb2FkcGhhc2UuY29sbGlzaW9uUGFpcnModGhpcywgcDEsIHAyKTsKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGUuYnJvYWRwaGFzZSA9IHBlcmZvcm1hbmNlLm5vdygpIC0gcHJvZmlsaW5nU3RhcnQ7CiAgICAgIH0gLy8gUmVtb3ZlIGNvbnN0cmFpbmVkIHBhaXJzIHdpdGggY29sbGlkZUNvbm5lY3RlZCA9PSBmYWxzZQoKCiAgICAgIGxldCBOY29uc3RyYWludHMgPSBjb25zdHJhaW50cy5sZW5ndGg7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOY29uc3RyYWludHM7IGkrKykgewogICAgICAgIGNvbnN0IGMgPSBjb25zdHJhaW50c1tpXTsKCiAgICAgICAgaWYgKCFjLmNvbGxpZGVDb25uZWN0ZWQpIHsKICAgICAgICAgIGZvciAobGV0IGogPSBwMS5sZW5ndGggLSAxOyBqID49IDA7IGogLT0gMSkgewogICAgICAgICAgICBpZiAoYy5ib2R5QSA9PT0gcDFbal0gJiYgYy5ib2R5QiA9PT0gcDJbal0gfHwgYy5ib2R5QiA9PT0gcDFbal0gJiYgYy5ib2R5QSA9PT0gcDJbal0pIHsKICAgICAgICAgICAgICBwMS5zcGxpY2UoaiwgMSk7CiAgICAgICAgICAgICAgcDIuc3BsaWNlKGosIDEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeFRpY2soKTsgLy8gR2VuZXJhdGUgY29udGFjdHMKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGluZ1N0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IG9sZGNvbnRhY3RzID0gV29ybGRfc3RlcF9vbGRDb250YWN0czsKICAgICAgY29uc3QgTm9sZENvbnRhY3RzID0gY29udGFjdHMubGVuZ3RoOwoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTm9sZENvbnRhY3RzOyBpKyspIHsKICAgICAgICBvbGRjb250YWN0cy5wdXNoKGNvbnRhY3RzW2ldKTsKICAgICAgfQoKICAgICAgY29udGFjdHMubGVuZ3RoID0gMDsgLy8gVHJhbnNmZXIgRnJpY3Rpb25FcXVhdGlvbiBmcm9tIGN1cnJlbnQgbGlzdCB0byB0aGUgcG9vbCBmb3IgcmV1c2UKCiAgICAgIGNvbnN0IE5vbGRGcmljdGlvbkVxdWF0aW9ucyA9IHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMubGVuZ3RoOwoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTm9sZEZyaWN0aW9uRXF1YXRpb25zOyBpKyspIHsKICAgICAgICBmcmljdGlvbkVxdWF0aW9uUG9vbC5wdXNoKHRoaXMuZnJpY3Rpb25FcXVhdGlvbnNbaV0pOwogICAgICB9CgogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25zLmxlbmd0aCA9IDA7CiAgICAgIHRoaXMubmFycm93cGhhc2UuZ2V0Q29udGFjdHMocDEsIHAyLCB0aGlzLCBjb250YWN0cywgb2xkY29udGFjdHMsIC8vIFRvIGJlIHJldXNlZAogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25zLCBmcmljdGlvbkVxdWF0aW9uUG9vbCk7CgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxlLm5hcnJvd3BoYXNlID0gcGVyZm9ybWFuY2Uubm93KCkgLSBwcm9maWxpbmdTdGFydDsKICAgICAgfSAvLyBMb29wIG92ZXIgYWxsIGNvbGxpc2lvbnMKCgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9IC8vIEFkZCBhbGwgZnJpY3Rpb24gZXFzCgoKICAgICAgZm9yIChpID0gMDsgaSA8IHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICBzb2x2ZXIuYWRkRXF1YXRpb24odGhpcy5mcmljdGlvbkVxdWF0aW9uc1tpXSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IG5jb250YWN0cyA9IGNvbnRhY3RzLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGsgPSAwOyBrICE9PSBuY29udGFjdHM7IGsrKykgewogICAgICAgIC8vIEN1cnJlbnQgY29udGFjdAogICAgICAgIGNvbnN0IGMgPSBjb250YWN0c1trXTsgLy8gR2V0IGN1cnJlbnQgY29sbGlzaW9uIGluZGVjZXMKCiAgICAgICAgY29uc3QgYmkgPSBjLmJpOwogICAgICAgIGNvbnN0IGJqID0gYy5iajsKICAgICAgICBjb25zdCBzaSA9IGMuc2k7CiAgICAgICAgY29uc3Qgc2ogPSBjLnNqOyAvLyBHZXQgY29sbGlzaW9uIHByb3BlcnRpZXMKCiAgICAgICAgbGV0IGNtOwoKICAgICAgICBpZiAoYmkubWF0ZXJpYWwgJiYgYmoubWF0ZXJpYWwpIHsKICAgICAgICAgIGNtID0gdGhpcy5nZXRDb250YWN0TWF0ZXJpYWwoYmkubWF0ZXJpYWwsIGJqLm1hdGVyaWFsKSB8fCB0aGlzLmRlZmF1bHRDb250YWN0TWF0ZXJpYWw7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNtID0gdGhpcy5kZWZhdWx0Q29udGFjdE1hdGVyaWFsOwogICAgICAgIH0gLy8gYy5lbmFibGVkID0gYmkuY29sbGlzaW9uUmVzcG9uc2UgJiYgYmouY29sbGlzaW9uUmVzcG9uc2UgJiYgc2kuY29sbGlzaW9uUmVzcG9uc2UgJiYgc2ouY29sbGlzaW9uUmVzcG9uc2U7CgoKICAgICAgICBjbS5mcmljdGlvbjsgLy8gYy5yZXN0aXR1dGlvbiA9IGNtLnJlc3RpdHV0aW9uOwogICAgICAgIC8vIElmIGZyaWN0aW9uIG9yIHJlc3RpdHV0aW9uIHdlcmUgc3BlY2lmaWVkIGluIHRoZSBtYXRlcmlhbCwgdXNlIHRoZW0KCiAgICAgICAgaWYgKGJpLm1hdGVyaWFsICYmIGJqLm1hdGVyaWFsKSB7CiAgICAgICAgICBpZiAoYmkubWF0ZXJpYWwuZnJpY3Rpb24gPj0gMCAmJiBiai5tYXRlcmlhbC5mcmljdGlvbiA+PSAwKSB7CiAgICAgICAgICAgIGJpLm1hdGVyaWFsLmZyaWN0aW9uICogYmoubWF0ZXJpYWwuZnJpY3Rpb247CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGJpLm1hdGVyaWFsLnJlc3RpdHV0aW9uID49IDAgJiYgYmoubWF0ZXJpYWwucmVzdGl0dXRpb24gPj0gMCkgewogICAgICAgICAgICBjLnJlc3RpdHV0aW9uID0gYmkubWF0ZXJpYWwucmVzdGl0dXRpb24gKiBiai5tYXRlcmlhbC5yZXN0aXR1dGlvbjsKICAgICAgICAgIH0KICAgICAgICB9IC8vIGMuc2V0U3Bvb2tQYXJhbXMoCiAgICAgICAgLy8gICAgICAgICAgIGNtLmNvbnRhY3RFcXVhdGlvblN0aWZmbmVzcywKICAgICAgICAvLyAgICAgICAgICAgY20uY29udGFjdEVxdWF0aW9uUmVsYXhhdGlvbiwKICAgICAgICAvLyAgICAgICAgICAgZHQKICAgICAgICAvLyAgICAgICApOwoKCiAgICAgICAgc29sdmVyLmFkZEVxdWF0aW9uKGMpOyAvLyAvLyBBZGQgZnJpY3Rpb24gY29uc3RyYWludCBlcXVhdGlvbgogICAgICAgIC8vIGlmKG11ID4gMCl7CiAgICAgICAgLy8gCS8vIENyZWF0ZSAyIHRhbmdlbnQgZXF1YXRpb25zCiAgICAgICAgLy8gCWNvbnN0IG11ZyA9IG11ICogZ25vcm07CiAgICAgICAgLy8gCWNvbnN0IHJlZHVjZWRNYXNzID0gKGJpLmludk1hc3MgKyBiai5pbnZNYXNzKTsKICAgICAgICAvLyAJaWYocmVkdWNlZE1hc3MgPiAwKXsKICAgICAgICAvLyAJCXJlZHVjZWRNYXNzID0gMS9yZWR1Y2VkTWFzczsKICAgICAgICAvLyAJfQogICAgICAgIC8vIAljb25zdCBwb29sID0gZnJpY3Rpb25FcXVhdGlvblBvb2w7CiAgICAgICAgLy8gCWNvbnN0IGMxID0gcG9vbC5sZW5ndGggPyBwb29sLnBvcCgpIDogbmV3IEZyaWN0aW9uRXF1YXRpb24oYmksYmosbXVnKnJlZHVjZWRNYXNzKTsKICAgICAgICAvLyAJY29uc3QgYzIgPSBwb29sLmxlbmd0aCA/IHBvb2wucG9wKCkgOiBuZXcgRnJpY3Rpb25FcXVhdGlvbihiaSxiaixtdWcqcmVkdWNlZE1hc3MpOwogICAgICAgIC8vIAl0aGlzLmZyaWN0aW9uRXF1YXRpb25zLnB1c2goYzEsIGMyKTsKICAgICAgICAvLyAJYzEuYmkgPSBjMi5iaSA9IGJpOwogICAgICAgIC8vIAljMS5iaiA9IGMyLmJqID0gYmo7CiAgICAgICAgLy8gCWMxLm1pbkZvcmNlID0gYzIubWluRm9yY2UgPSAtbXVnKnJlZHVjZWRNYXNzOwogICAgICAgIC8vIAljMS5tYXhGb3JjZSA9IGMyLm1heEZvcmNlID0gbXVnKnJlZHVjZWRNYXNzOwogICAgICAgIC8vIAkvLyBDb3B5IG92ZXIgdGhlIHJlbGF0aXZlIHZlY3RvcnMKICAgICAgICAvLyAJYzEucmkuY29weShjLnJpKTsKICAgICAgICAvLyAJYzEucmouY29weShjLnJqKTsKICAgICAgICAvLyAJYzIucmkuY29weShjLnJpKTsKICAgICAgICAvLyAJYzIucmouY29weShjLnJqKTsKICAgICAgICAvLyAJLy8gQ29uc3RydWN0IHRhbmdlbnRzCiAgICAgICAgLy8gCWMubmkudGFuZ2VudHMoYzEudCwgYzIudCk7CiAgICAgICAgLy8gICAgICAgICAgIC8vIFNldCBzcG9vayBwYXJhbXMKICAgICAgICAvLyAgICAgICAgICAgYzEuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIGR0KTsKICAgICAgICAvLyAgICAgICAgICAgYzIuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIGR0KTsKICAgICAgICAvLyAgICAgICAgICAgYzEuZW5hYmxlZCA9IGMyLmVuYWJsZWQgPSBjLmVuYWJsZWQ7CiAgICAgICAgLy8gCS8vIEFkZCBlcXVhdGlvbnMgdG8gc29sdmVyCiAgICAgICAgLy8gCXNvbHZlci5hZGRFcXVhdGlvbihjMSk7CiAgICAgICAgLy8gCXNvbHZlci5hZGRFcXVhdGlvbihjMik7CiAgICAgICAgLy8gfQoKICAgICAgICBpZiAoYmkuYWxsb3dTbGVlcCAmJiBiaS50eXBlID09PSBCb2R5LkRZTkFNSUMgJiYgYmkuc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORyAmJiBiai5zbGVlcFN0YXRlID09PSBCb2R5LkFXQUtFICYmIGJqLnR5cGUgIT09IEJvZHkuU1RBVElDKSB7CiAgICAgICAgICBjb25zdCBzcGVlZFNxdWFyZWRCID0gYmoudmVsb2NpdHkubGVuZ3RoU3F1YXJlZCgpICsgYmouYW5ndWxhclZlbG9jaXR5Lmxlbmd0aFNxdWFyZWQoKTsKICAgICAgICAgIGNvbnN0IHNwZWVkTGltaXRTcXVhcmVkQiA9IGJqLnNsZWVwU3BlZWRMaW1pdCAqKiAyOwoKICAgICAgICAgIGlmIChzcGVlZFNxdWFyZWRCID49IHNwZWVkTGltaXRTcXVhcmVkQiAqIDIpIHsKICAgICAgICAgICAgYmkud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoYmouYWxsb3dTbGVlcCAmJiBiai50eXBlID09PSBCb2R5LkRZTkFNSUMgJiYgYmouc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORyAmJiBiaS5zbGVlcFN0YXRlID09PSBCb2R5LkFXQUtFICYmIGJpLnR5cGUgIT09IEJvZHkuU1RBVElDKSB7CiAgICAgICAgICBjb25zdCBzcGVlZFNxdWFyZWRBID0gYmkudmVsb2NpdHkubGVuZ3RoU3F1YXJlZCgpICsgYmkuYW5ndWxhclZlbG9jaXR5Lmxlbmd0aFNxdWFyZWQoKTsKICAgICAgICAgIGNvbnN0IHNwZWVkTGltaXRTcXVhcmVkQSA9IGJpLnNsZWVwU3BlZWRMaW1pdCAqKiAyOwoKICAgICAgICAgIGlmIChzcGVlZFNxdWFyZWRBID49IHNwZWVkTGltaXRTcXVhcmVkQSAqIDIpIHsKICAgICAgICAgICAgYmoud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBOb3cgd2Uga25vdyB0aGF0IGkgYW5kIGogYXJlIGluIGNvbnRhY3QuIFNldCBjb2xsaXNpb24gbWF0cml4IHN0YXRlCgoKICAgICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5zZXQoYmksIGJqLCB0cnVlKTsKCiAgICAgICAgaWYgKCF0aGlzLmNvbGxpc2lvbk1hdHJpeFByZXZpb3VzLmdldChiaSwgYmopKSB7CiAgICAgICAgICAvLyBGaXJzdCBjb250YWN0IQogICAgICAgICAgLy8gV2UgcmV1c2UgdGhlIGNvbGxpZGVFdmVudCBvYmplY3QsIG90aGVyd2lzZSB3ZSB3aWxsIGVuZCB1cCBjcmVhdGluZyBuZXcgb2JqZWN0cyBmb3IgZWFjaCBuZXcgY29udGFjdCwgZXZlbiBpZiB0aGVyZSdzIG5vIGV2ZW50IGxpc3RlbmVyIGF0dGFjaGVkLgogICAgICAgICAgV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQuYm9keSA9IGJqOwogICAgICAgICAgV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQuY29udGFjdCA9IGM7CiAgICAgICAgICBiaS5kaXNwYXRjaEV2ZW50KFdvcmxkX3N0ZXBfY29sbGlkZUV2ZW50KTsKICAgICAgICAgIFdvcmxkX3N0ZXBfY29sbGlkZUV2ZW50LmJvZHkgPSBiaTsKICAgICAgICAgIGJqLmRpc3BhdGNoRXZlbnQoV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5ib2R5T3ZlcmxhcEtlZXBlci5zZXQoYmkuaWQsIGJqLmlkKTsKICAgICAgICB0aGlzLnNoYXBlT3ZlcmxhcEtlZXBlci5zZXQoc2kuaWQsIHNqLmlkKTsKICAgICAgfQoKICAgICAgdGhpcy5lbWl0Q29udGFjdEV2ZW50cygpOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5tYWtlQ29udGFjdENvbnN0cmFpbnRzID0gcGVyZm9ybWFuY2Uubm93KCkgLSBwcm9maWxpbmdTdGFydDsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9IC8vIFdha2UgdXAgYm9kaWVzCgoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYmkgPSBib2RpZXNbaV07CgogICAgICAgIGlmIChiaS53YWtlVXBBZnRlck5hcnJvd3BoYXNlKSB7CiAgICAgICAgICBiaS53YWtlVXAoKTsKICAgICAgICAgIGJpLndha2VVcEFmdGVyTmFycm93cGhhc2UgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0gLy8gQWRkIHVzZXItYWRkZWQgY29uc3RyYWludHMKCgogICAgICBOY29uc3RyYWludHMgPSBjb25zdHJhaW50cy5sZW5ndGg7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOY29uc3RyYWludHM7IGkrKykgewogICAgICAgIGNvbnN0IGMgPSBjb25zdHJhaW50c1tpXTsKICAgICAgICBjLnVwZGF0ZSgpOwoKICAgICAgICBmb3IgKGxldCBqID0gMCwgTmVxID0gYy5lcXVhdGlvbnMubGVuZ3RoOyBqICE9PSBOZXE7IGorKykgewogICAgICAgICAgY29uc3QgZXEgPSBjLmVxdWF0aW9uc1tqXTsKICAgICAgICAgIHNvbHZlci5hZGRFcXVhdGlvbihlcSk7CiAgICAgICAgfQogICAgICB9IC8vIFNvbHZlIHRoZSBjb25zdHJhaW5lZCBzeXN0ZW0KCgogICAgICBzb2x2ZXIuc29sdmUoZHQsIHRoaXMpOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5zb2x2ZSA9IHBlcmZvcm1hbmNlLm5vdygpIC0gcHJvZmlsaW5nU3RhcnQ7CiAgICAgIH0gLy8gUmVtb3ZlIGFsbCBjb250YWN0cyBmcm9tIHNvbHZlcgoKCiAgICAgIHNvbHZlci5yZW1vdmVBbGxFcXVhdGlvbnMoKTsgLy8gQXBwbHkgZGFtcGluZywgc2VlIGh0dHA6Ly9jb2RlLmdvb2dsZS5jb20vcC9idWxsZXQvaXNzdWVzL2RldGFpbD9pZD03NCBmb3IgZGV0YWlscwoKICAgICAgY29uc3QgcG93ID0gTWF0aC5wb3c7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKCiAgICAgICAgaWYgKGJpLnR5cGUgJiBEWU5BTUlDKSB7CiAgICAgICAgICAvLyBPbmx5IGZvciBkeW5hbWljIGJvZGllcwogICAgICAgICAgY29uc3QgbGQgPSBwb3coMS4wIC0gYmkubGluZWFyRGFtcGluZywgZHQpOwogICAgICAgICAgY29uc3QgdiA9IGJpLnZlbG9jaXR5OwogICAgICAgICAgdi5zY2FsZShsZCwgdik7CiAgICAgICAgICBjb25zdCBhdiA9IGJpLmFuZ3VsYXJWZWxvY2l0eTsKCiAgICAgICAgICBpZiAoYXYpIHsKICAgICAgICAgICAgY29uc3QgYWQgPSBwb3coMS4wIC0gYmkuYW5ndWxhckRhbXBpbmcsIGR0KTsKICAgICAgICAgICAgYXYuc2NhbGUoYWQsIGF2KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChXb3JsZF9zdGVwX3ByZVN0ZXBFdmVudCk7IC8vIExlYXAgZnJvZwogICAgICAvLyB2bmV3ID0gdiArIGgqZi9tCiAgICAgIC8vIHhuZXcgPSB4ICsgaCp2bmV3CgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9CgogICAgICBjb25zdCBzdGVwbnVtYmVyID0gdGhpcy5zdGVwbnVtYmVyOwogICAgICBjb25zdCBxdWF0Tm9ybWFsaXplID0gc3RlcG51bWJlciAlICh0aGlzLnF1YXROb3JtYWxpemVTa2lwICsgMSkgPT09IDA7CiAgICAgIGNvbnN0IHF1YXROb3JtYWxpemVGYXN0ID0gdGhpcy5xdWF0Tm9ybWFsaXplRmFzdDsKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGJvZGllc1tpXS5pbnRlZ3JhdGUoZHQsIHF1YXROb3JtYWxpemUsIHF1YXROb3JtYWxpemVGYXN0KTsKICAgICAgfQoKICAgICAgdGhpcy5jbGVhckZvcmNlcygpOwogICAgICB0aGlzLmJyb2FkcGhhc2UuZGlydHkgPSB0cnVlOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5pbnRlZ3JhdGUgPSBwZXJmb3JtYW5jZS5ub3coKSAtIHByb2ZpbGluZ1N0YXJ0OwogICAgICB9IC8vIFVwZGF0ZSBzdGVwIG51bWJlcgoKCiAgICAgIHRoaXMuc3RlcG51bWJlciArPSAxOwogICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoV29ybGRfc3RlcF9wb3N0U3RlcEV2ZW50KTsgLy8gU2xlZXBpbmcgdXBkYXRlCgogICAgICBsZXQgaGFzQWN0aXZlQm9kaWVzID0gdHJ1ZTsKCiAgICAgIGlmICh0aGlzLmFsbG93U2xlZXApIHsKICAgICAgICBoYXNBY3RpdmVCb2RpZXMgPSBmYWxzZTsKCiAgICAgICAgZm9yIChpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKICAgICAgICAgIGJpLnNsZWVwVGljayh0aGlzLnRpbWUpOwoKICAgICAgICAgIGlmIChiaS5zbGVlcFN0YXRlICE9PSBCb2R5LlNMRUVQSU5HKSB7CiAgICAgICAgICAgIGhhc0FjdGl2ZUJvZGllcyA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmhhc0FjdGl2ZUJvZGllcyA9IGhhc0FjdGl2ZUJvZGllczsKICAgIH0KCiAgICBlbWl0Q29udGFjdEV2ZW50cygpIHsKICAgICAgY29uc3QgaGFzQmVnaW5Db250YWN0ID0gdGhpcy5oYXNBbnlFdmVudExpc3RlbmVyKCdiZWdpbkNvbnRhY3QnKTsKICAgICAgY29uc3QgaGFzRW5kQ29udGFjdCA9IHRoaXMuaGFzQW55RXZlbnRMaXN0ZW5lcignZW5kQ29udGFjdCcpOwoKICAgICAgaWYgKGhhc0JlZ2luQ29udGFjdCB8fCBoYXNFbmRDb250YWN0KSB7CiAgICAgICAgdGhpcy5ib2R5T3ZlcmxhcEtlZXBlci5nZXREaWZmKGFkZGl0aW9ucywgcmVtb3ZhbHMpOwogICAgICB9CgogICAgICBpZiAoaGFzQmVnaW5Db250YWN0KSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBhZGRpdGlvbnMubGVuZ3RoOyBpIDwgbDsgaSArPSAyKSB7CiAgICAgICAgICBiZWdpbkNvbnRhY3RFdmVudC5ib2R5QSA9IHRoaXMuZ2V0Qm9keUJ5SWQoYWRkaXRpb25zW2ldKTsKICAgICAgICAgIGJlZ2luQ29udGFjdEV2ZW50LmJvZHlCID0gdGhpcy5nZXRCb2R5QnlJZChhZGRpdGlvbnNbaSArIDFdKTsKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChiZWdpbkNvbnRhY3RFdmVudCk7CiAgICAgICAgfQoKICAgICAgICBiZWdpbkNvbnRhY3RFdmVudC5ib2R5QSA9IGJlZ2luQ29udGFjdEV2ZW50LmJvZHlCID0gbnVsbDsKICAgICAgfQoKICAgICAgaWYgKGhhc0VuZENvbnRhY3QpIHsKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IHJlbW92YWxzLmxlbmd0aDsgaSA8IGw7IGkgKz0gMikgewogICAgICAgICAgZW5kQ29udGFjdEV2ZW50LmJvZHlBID0gdGhpcy5nZXRCb2R5QnlJZChyZW1vdmFsc1tpXSk7CiAgICAgICAgICBlbmRDb250YWN0RXZlbnQuYm9keUIgPSB0aGlzLmdldEJvZHlCeUlkKHJlbW92YWxzW2kgKyAxXSk7CiAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoZW5kQ29udGFjdEV2ZW50KTsKICAgICAgICB9CgogICAgICAgIGVuZENvbnRhY3RFdmVudC5ib2R5QSA9IGVuZENvbnRhY3RFdmVudC5ib2R5QiA9IG51bGw7CiAgICAgIH0KCiAgICAgIGFkZGl0aW9ucy5sZW5ndGggPSByZW1vdmFscy5sZW5ndGggPSAwOwogICAgICBjb25zdCBoYXNCZWdpblNoYXBlQ29udGFjdCA9IHRoaXMuaGFzQW55RXZlbnRMaXN0ZW5lcignYmVnaW5TaGFwZUNvbnRhY3QnKTsKICAgICAgY29uc3QgaGFzRW5kU2hhcGVDb250YWN0ID0gdGhpcy5oYXNBbnlFdmVudExpc3RlbmVyKCdlbmRTaGFwZUNvbnRhY3QnKTsKCiAgICAgIGlmIChoYXNCZWdpblNoYXBlQ29udGFjdCB8fCBoYXNFbmRTaGFwZUNvbnRhY3QpIHsKICAgICAgICB0aGlzLnNoYXBlT3ZlcmxhcEtlZXBlci5nZXREaWZmKGFkZGl0aW9ucywgcmVtb3ZhbHMpOwogICAgICB9CgogICAgICBpZiAoaGFzQmVnaW5TaGFwZUNvbnRhY3QpIHsKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGFkZGl0aW9ucy5sZW5ndGg7IGkgPCBsOyBpICs9IDIpIHsKICAgICAgICAgIGNvbnN0IHNoYXBlQSA9IHRoaXMuZ2V0U2hhcGVCeUlkKGFkZGl0aW9uc1tpXSk7CiAgICAgICAgICBjb25zdCBzaGFwZUIgPSB0aGlzLmdldFNoYXBlQnlJZChhZGRpdGlvbnNbaSArIDFdKTsKICAgICAgICAgIGJlZ2luU2hhcGVDb250YWN0RXZlbnQuc2hhcGVBID0gc2hhcGVBOwogICAgICAgICAgYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5zaGFwZUIgPSBzaGFwZUI7CiAgICAgICAgICBpZiAoc2hhcGVBKSBiZWdpblNoYXBlQ29udGFjdEV2ZW50LmJvZHlBID0gc2hhcGVBLmJvZHk7CiAgICAgICAgICBpZiAoc2hhcGVCKSBiZWdpblNoYXBlQ29udGFjdEV2ZW50LmJvZHlCID0gc2hhcGVCLmJvZHk7CiAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoYmVnaW5TaGFwZUNvbnRhY3RFdmVudCk7CiAgICAgICAgfQoKICAgICAgICBiZWdpblNoYXBlQ29udGFjdEV2ZW50LmJvZHlBID0gYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5ib2R5QiA9IGJlZ2luU2hhcGVDb250YWN0RXZlbnQuc2hhcGVBID0gYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5zaGFwZUIgPSBudWxsOwogICAgICB9CgogICAgICBpZiAoaGFzRW5kU2hhcGVDb250YWN0KSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSByZW1vdmFscy5sZW5ndGg7IGkgPCBsOyBpICs9IDIpIHsKICAgICAgICAgIGNvbnN0IHNoYXBlQSA9IHRoaXMuZ2V0U2hhcGVCeUlkKHJlbW92YWxzW2ldKTsKICAgICAgICAgIGNvbnN0IHNoYXBlQiA9IHRoaXMuZ2V0U2hhcGVCeUlkKHJlbW92YWxzW2kgKyAxXSk7CiAgICAgICAgICBlbmRTaGFwZUNvbnRhY3RFdmVudC5zaGFwZUEgPSBzaGFwZUE7CiAgICAgICAgICBlbmRTaGFwZUNvbnRhY3RFdmVudC5zaGFwZUIgPSBzaGFwZUI7CiAgICAgICAgICBpZiAoc2hhcGVBKSBlbmRTaGFwZUNvbnRhY3RFdmVudC5ib2R5QSA9IHNoYXBlQS5ib2R5OwogICAgICAgICAgaWYgKHNoYXBlQikgZW5kU2hhcGVDb250YWN0RXZlbnQuYm9keUIgPSBzaGFwZUIuYm9keTsKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChlbmRTaGFwZUNvbnRhY3RFdmVudCk7CiAgICAgICAgfQoKICAgICAgICBlbmRTaGFwZUNvbnRhY3RFdmVudC5ib2R5QSA9IGVuZFNoYXBlQ29udGFjdEV2ZW50LmJvZHlCID0gZW5kU2hhcGVDb250YWN0RXZlbnQuc2hhcGVBID0gZW5kU2hhcGVDb250YWN0RXZlbnQuc2hhcGVCID0gbnVsbDsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIGFsbCBib2R5IGZvcmNlcyBpbiB0aGUgd29ybGQgdG8gemVyby4KICAgICAqLwoKCiAgICBjbGVhckZvcmNlcygpIHsKICAgICAgY29uc3QgYm9kaWVzID0gdGhpcy5ib2RpZXM7CiAgICAgIGNvbnN0IE4gPSBib2RpZXMubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGIgPSBib2RpZXNbaV07CiAgICAgICAgYi5mb3JjZTsKICAgICAgICBiLnRvcnF1ZTsKICAgICAgICBiLmZvcmNlLnNldCgwLCAwLCAwKTsKICAgICAgICBiLnRvcnF1ZS5zZXQoMCwgMCwgMCk7CiAgICAgIH0KICAgIH0KCiAgfSAvLyBUZW1wIHN0dWZmCgogIG5ldyBBQUJCKCk7CiAgY29uc3QgdG1wUmF5ID0gbmV3IFJheSgpOyAvLyBwZXJmb3JtYW5jZS5ub3coKSBmYWxsYmFjayBvbiBEYXRlLm5vdygpCgogIGNvbnN0IHBlcmZvcm1hbmNlID0gZ2xvYmFsVGhpcy5wZXJmb3JtYW5jZSB8fCB7fTsKCiAgaWYgKCFwZXJmb3JtYW5jZS5ub3cpIHsKICAgIGxldCBub3dPZmZzZXQgPSBEYXRlLm5vdygpOwoKICAgIGlmIChwZXJmb3JtYW5jZS50aW1pbmcgJiYgcGVyZm9ybWFuY2UudGltaW5nLm5hdmlnYXRpb25TdGFydCkgewogICAgICBub3dPZmZzZXQgPSBwZXJmb3JtYW5jZS50aW1pbmcubmF2aWdhdGlvblN0YXJ0OwogICAgfQoKICAgIHBlcmZvcm1hbmNlLm5vdyA9ICgpID0+IERhdGUubm93KCkgLSBub3dPZmZzZXQ7CiAgfQoKICBuZXcgVmVjMygpOyAvLyBEaXNwYXRjaGVkIGFmdGVyIHRoZSB3b3JsZCBoYXMgc3RlcHBlZCBmb3J3YXJkIGluIHRpbWUuCiAgLy8gUmV1c2FibGUgZXZlbnQgb2JqZWN0cyB0byBzYXZlIG1lbW9yeS4KCiAgY29uc3QgV29ybGRfc3RlcF9wb3N0U3RlcEV2ZW50ID0gewogICAgdHlwZTogJ3Bvc3RTdGVwJwogIH07IC8vIERpc3BhdGNoZWQgYmVmb3JlIHRoZSB3b3JsZCBzdGVwcyBmb3J3YXJkIGluIHRpbWUuCgogIGNvbnN0IFdvcmxkX3N0ZXBfcHJlU3RlcEV2ZW50ID0gewogICAgdHlwZTogJ3ByZVN0ZXAnCiAgfTsKICBjb25zdCBXb3JsZF9zdGVwX2NvbGxpZGVFdmVudCA9IHsKICAgIHR5cGU6IEJvZHkuQ09MTElERV9FVkVOVF9OQU1FLAogICAgYm9keTogbnVsbCwKICAgIGNvbnRhY3Q6IG51bGwKICB9OyAvLyBQb29scyBmb3IgdW51c2VkIG9iamVjdHMKCiAgY29uc3QgV29ybGRfc3RlcF9vbGRDb250YWN0cyA9IFtdOwogIGNvbnN0IFdvcmxkX3N0ZXBfZnJpY3Rpb25FcXVhdGlvblBvb2wgPSBbXTsgLy8gUmV1c2FibGUgYXJyYXlzIGZvciBjb2xsaXNpb24gcGFpcnMKCiAgY29uc3QgV29ybGRfc3RlcF9wMSA9IFtdOwogIGNvbnN0IFdvcmxkX3N0ZXBfcDIgPSBbXTsgLy8gU3R1ZmYgZm9yIGVtaXRDb250YWN0RXZlbnRzCgogIGNvbnN0IGFkZGl0aW9ucyA9IFtdOwogIGNvbnN0IHJlbW92YWxzID0gW107CiAgY29uc3QgYmVnaW5Db250YWN0RXZlbnQgPSB7CiAgICB0eXBlOiAnYmVnaW5Db250YWN0JywKICAgIGJvZHlBOiBudWxsLAogICAgYm9keUI6IG51bGwKICB9OwogIGNvbnN0IGVuZENvbnRhY3RFdmVudCA9IHsKICAgIHR5cGU6ICdlbmRDb250YWN0JywKICAgIGJvZHlBOiBudWxsLAogICAgYm9keUI6IG51bGwKICB9OwogIGNvbnN0IGJlZ2luU2hhcGVDb250YWN0RXZlbnQgPSB7CiAgICB0eXBlOiAnYmVnaW5TaGFwZUNvbnRhY3QnLAogICAgYm9keUE6IG51bGwsCiAgICBib2R5QjogbnVsbCwKICAgIHNoYXBlQTogbnVsbCwKICAgIHNoYXBlQjogbnVsbAogIH07CiAgY29uc3QgZW5kU2hhcGVDb250YWN0RXZlbnQgPSB7CiAgICB0eXBlOiAnZW5kU2hhcGVDb250YWN0JywKICAgIGJvZHlBOiBudWxsLAogICAgYm9keUI6IG51bGwsCiAgICBzaGFwZUE6IG51bGwsCiAgICBzaGFwZUI6IG51bGwKICB9OwoKICBjb25zdCBhZGRDb250YWN0TWF0ZXJpYWwgPSAod29ybGQsIGNyZWF0ZU1hdGVyaWFsLCBfcmVmLCB1dWlkKSA9PiB7CiAgICBsZXQgW21hdGVyaWFsQSwgbWF0ZXJpYWxCLCBvcHRpb25zXSA9IF9yZWY7CiAgICBjb25zdCBtYXRBID0gY3JlYXRlTWF0ZXJpYWwobWF0ZXJpYWxBKTsKICAgIGNvbnN0IG1hdEIgPSBjcmVhdGVNYXRlcmlhbChtYXRlcmlhbEIpOwogICAgY29uc3QgY29udGFjdE1hdGVyaWFsID0gbmV3IENvbnRhY3RNYXRlcmlhbChtYXRBLCBtYXRCLCBvcHRpb25zKTsKICAgIGNvbnRhY3RNYXRlcmlhbC51dWlkID0gdXVpZDsKICAgIHdvcmxkLmFkZENvbnRhY3RNYXRlcmlhbChjb250YWN0TWF0ZXJpYWwpOwogIH07CiAgY29uc3QgcmVtb3ZlQ29udGFjdE1hdGVyaWFsID0gKHdvcmxkLCBjbVVVSUQpID0+IHsKICAgIGNvbnN0IGluZGV4ID0gd29ybGQuY29udGFjdG1hdGVyaWFscy5maW5kSW5kZXgoX3JlZjIgPT4gewogICAgICBsZXQgewogICAgICAgIHV1aWQKICAgICAgfSA9IF9yZWYyOwogICAgICByZXR1cm4gdXVpZCA9PT0gY21VVUlEOwogICAgfSk7CiAgICBjb25zdCBbewogICAgICBpZDogaQogICAgfSwgewogICAgICBpZDogagogICAgfV0gPSB3b3JsZC5jb250YWN0bWF0ZXJpYWxzW2luZGV4XS5tYXRlcmlhbHM7CiAgICB3b3JsZC5jb250YWN0bWF0ZXJpYWxzLnNwbGljZShpbmRleCwgMSk7CiAgICBkZWxldGUgd29ybGQuY29udGFjdE1hdGVyaWFsVGFibGUuZGF0YVtpIDwgaiA/IGAke2l9LSR7an1gIDogYCR7an0tJHtpfWBdOwogIH07CgogIGxldCBtYXRlcmlhbElkID0gMDsKICBjb25zdCBjcmVhdGVNYXRlcmlhbEZhY3RvcnkgPSBtYXRlcmlhbHMgPT4gZnVuY3Rpb24gKG5hbWVPck9wdGlvbnMpIHsKICAgIGlmIChuYW1lT3JPcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgbmFtZU9yT3B0aW9ucyA9IHt9OwogICAgfQogICAgY29uc3QgbWF0ZXJpYWxPcHRpb25zID0gdHlwZW9mIG5hbWVPck9wdGlvbnMgPT09ICdzdHJpbmcnID8gewogICAgICBuYW1lOiBuYW1lT3JPcHRpb25zCiAgICB9IDogewogICAgICBuYW1lOiBTeW1ib2wuZm9yKGBNYXRlcmlhbCR7bWF0ZXJpYWxJZCsrfWApLAogICAgICAuLi5uYW1lT3JPcHRpb25zCiAgICB9OwogICAgY29uc3QgewogICAgICBuYW1lCiAgICB9ID0gbWF0ZXJpYWxPcHRpb25zOwogICAgbWF0ZXJpYWxzW25hbWVdID0gbWF0ZXJpYWxzW25hbWVdIHx8IG5ldyBNYXRlcmlhbChtYXRlcmlhbE9wdGlvbnMpOwogICAgcmV0dXJuIG1hdGVyaWFsc1tuYW1lXTsKICB9OwoKICAvKioKICAgKiBAdHlwZWRlZiB7IGltcG9ydCgnY2Fubm9uLWVzJykuTWF0ZXJpYWxPcHRpb25zIH0gTWF0ZXJpYWxPcHRpb25zCiAgICovCgogIGNvbnN0IG1ha2VWZWMzID0gX3JlZiA9PiB7CiAgICBsZXQgW3gsIHksIHpdID0gX3JlZjsKICAgIHJldHVybiBuZXcgVmVjMyh4LCB5LCB6KTsKICB9OwogIGNvbnN0IHByZXBhcmVTcGhlcmUgPSBhcmdzID0+IEFycmF5LmlzQXJyYXkoYXJncykgPyBhcmdzIDogW2FyZ3NdOwogIGNvbnN0IHByZXBhcmVDb252ZXhQb2x5aGVkcm9uID0gX3JlZjIgPT4gewogICAgbGV0IFt2LCBmYWNlcywgbiwgYSwgYm91bmRpbmdTcGhlcmVSYWRpdXNdID0gX3JlZjI7CiAgICByZXR1cm4gW3sKICAgICAgYXhlczogYSA/IGEubWFwKG1ha2VWZWMzKSA6IHVuZGVmaW5lZCwKICAgICAgYm91bmRpbmdTcGhlcmVSYWRpdXMsCiAgICAgIGZhY2VzLAogICAgICBub3JtYWxzOiBuID8gbi5tYXAobWFrZVZlYzMpIDogdW5kZWZpbmVkLAogICAgICB2ZXJ0aWNlczogdiA/IHYubWFwKG1ha2VWZWMzKSA6IHVuZGVmaW5lZAogICAgfV07CiAgfTsKICBmdW5jdGlvbiBjcmVhdGVTaGFwZSh0eXBlLCBhcmdzKSB7CiAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgY2FzZSAnQm94JzoKICAgICAgICByZXR1cm4gbmV3IEJveChuZXcgVmVjMyguLi5hcmdzLm1hcCh2ID0+IHYgLyAyKSkpOwogICAgICAvLyBleHRlbnRzID0+IGhhbGZFeHRlbnRzCiAgICAgIGNhc2UgJ0NvbnZleFBvbHloZWRyb24nOgogICAgICAgIHJldHVybiBuZXcgQ29udmV4UG9seWhlZHJvbiguLi5wcmVwYXJlQ29udmV4UG9seWhlZHJvbihhcmdzKSk7CiAgICAgIGNhc2UgJ0N5bGluZGVyJzoKICAgICAgICByZXR1cm4gbmV3IEN5bGluZGVyKC4uLmFyZ3MpOwogICAgICAvLyBbIHJhZGl1c1RvcCwgcmFkaXVzQm90dG9tLCBoZWlnaHQsIG51bVNlZ21lbnRzIF0gPSBhcmdzCiAgICAgIGNhc2UgJ0hlaWdodGZpZWxkJzoKICAgICAgICByZXR1cm4gbmV3IEhlaWdodGZpZWxkKC4uLmFyZ3MpOwogICAgICAvLyBbIEFycmF5IGRhdGEsIG9wdGlvbnM6IHttaW5WYWx1ZSwgbWF4VmFsdWUsIGVsZW1lbnRTaXplfSAgXSA9IGFyZ3MKICAgICAgY2FzZSAnUGFydGljbGUnOgogICAgICAgIHJldHVybiBuZXcgUGFydGljbGUoKTsKICAgICAgLy8gbm8gYXJncwogICAgICBjYXNlICdQbGFuZSc6CiAgICAgICAgcmV0dXJuIG5ldyBQbGFuZSgpOwogICAgICAvLyBubyBhcmdzLCBpbmZpbml0ZSB4IGFuZCB5CiAgICAgIGNhc2UgJ1NwaGVyZSc6CiAgICAgICAgcmV0dXJuIG5ldyBTcGhlcmUoLi4ucHJlcGFyZVNwaGVyZShhcmdzKSk7CiAgICAgIC8vIHJhZGl1cyA9IGFyZ3MKICAgICAgY2FzZSAnVHJpbWVzaCc6CiAgICAgICAgcmV0dXJuIG5ldyBUcmltZXNoKC4uLmFyZ3MpOwogICAgICAvLyBbdmVydGljZXMsIGluZGljZXNdID0gYXJncwogICAgfQogIH0KCiAgLyoqCiAgICogQHBhcmFtIHtUSFJFRS5RdWF0ZXJuaW9ufSB0YXJnZXQKICAgKiBAcGFyYW0ge3sgcm90YXRpb24/OiBUSFJFRS5WZWN0b3IzVHVwbGUgcXVhdGVybmlvbj86IFRIUkVFLlZlY3RvcjRUdXBsZSB9fSBwcm9wcwogICAqIEByZXR1cm5zIHtUSFJFRS5RdWF0ZXJuaW9ufQogICAqLwogIGNvbnN0IHNldFF1YXRlcm5pb24gPSAodGFyZ2V0LCBfcmVmMykgPT4gewogICAgbGV0IHsKICAgICAgcXVhdGVybmlvbiwKICAgICAgcm90YXRpb24KICAgIH0gPSBfcmVmMzsKICAgIGlmIChxdWF0ZXJuaW9uKSB7CiAgICAgIHRhcmdldC5zZXQoLi4ucXVhdGVybmlvbik7CiAgICB9IGVsc2UgaWYgKHJvdGF0aW9uKSB7CiAgICAgIHRhcmdldC5zZXRGcm9tRXVsZXIoLi4ucm90YXRpb24pOwogICAgfQogICAgcmV0dXJuIHRhcmdldDsKICB9OwoKICAvKioKICAgKiBAZnVuY3Rpb24KICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogICAqIEBwYXJhbSB7c3RyaW5nfSBvcHRpb25zLnV1aWQKICAgKiBAcGFyYW0ge0JvZHlQcm9wc30gb3B0aW9ucy5wcm9wcwogICAqIEBwYXJhbSB7Qm9keVNoYXBlVHlwZX0gb3B0aW9ucy50eXBlCiAgICogQHBhcmFtIHsobWF0ZXJpYWxPcHRpb25zOiBNYXRlcmlhbE9wdGlvbnMpID0+IE1hdGVyaWFsID19IG9wdGlvbnMuY3JlYXRlTWF0ZXJpYWwKICAgKiBAcmV0dXJucyB7Qm9keX0KICAgKi8KICBjb25zdCBwcm9wc1RvQm9keSA9IG9wdGlvbnMgPT4gewogICAgY29uc3QgewogICAgICB1dWlkLAogICAgICBwcm9wcywKICAgICAgdHlwZSwKICAgICAgY3JlYXRlTWF0ZXJpYWwgPSBtYXRlcmlhbE9wdGlvbnMgPT4gbmV3IE1hdGVyaWFsKG1hdGVyaWFsT3B0aW9ucykKICAgIH0gPSBvcHRpb25zOwogICAgY29uc3QgewogICAgICBhbmd1bGFyRmFjdG9yID0gWzEsIDEsIDFdLAogICAgICBhbmd1bGFyVmVsb2NpdHkgPSBbMCwgMCwgMF0sCiAgICAgIGFyZ3MgPSBbXSwKICAgICAgY29sbGlzaW9uUmVzcG9uc2UsCiAgICAgIGxpbmVhckZhY3RvciA9IFsxLCAxLCAxXSwKICAgICAgbWFzcywKICAgICAgbWF0ZXJpYWwsCiAgICAgIG9uQ29sbGlkZSwKICAgICAgcG9zaXRpb24gPSBbMCwgMCwgMF0sCiAgICAgIHJvdGF0aW9uLAogICAgICBxdWF0ZXJuaW9uLAogICAgICBzaGFwZXMsCiAgICAgIHR5cGU6IGJvZHlUeXBlLAogICAgICB2ZWxvY2l0eSA9IFswLCAwLCAwXSwKICAgICAgLi4uZXh0cmEKICAgIH0gPSBwcm9wczsKICAgIGNvbnN0IGJvZHkgPSBuZXcgQm9keSh7CiAgICAgIC4uLmV4dHJhLAogICAgICBtYXNzOiBib2R5VHlwZSA9PT0gJ1N0YXRpYycgPyAwIDogbWFzcywKICAgICAgbWF0ZXJpYWw6IG1hdGVyaWFsID8gY3JlYXRlTWF0ZXJpYWwobWF0ZXJpYWwpIDogdW5kZWZpbmVkLAogICAgICB0eXBlOiBib2R5VHlwZSA/IEJvZHlbYm9keVR5cGUudG9VcHBlckNhc2UoKV0gOiB1bmRlZmluZWQKICAgIH0pOwogICAgYm9keS51dWlkID0gdXVpZDsKICAgIGlmIChjb2xsaXNpb25SZXNwb25zZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIGJvZHkuY29sbGlzaW9uUmVzcG9uc2UgPSBjb2xsaXNpb25SZXNwb25zZTsKICAgIH0KICAgIGlmICh0eXBlID09PSAnQ29tcG91bmQnKSB7CiAgICAgIHNoYXBlcy5mb3JFYWNoKF9yZWY0ID0+IHsKICAgICAgICBsZXQgewogICAgICAgICAgdHlwZSwKICAgICAgICAgIGFyZ3MsCiAgICAgICAgICBwb3NpdGlvbiwKICAgICAgICAgIHJvdGF0aW9uLAogICAgICAgICAgcXVhdGVybmlvbiwKICAgICAgICAgIG1hdGVyaWFsLAogICAgICAgICAgLi4uZXh0cmEKICAgICAgICB9ID0gX3JlZjQ7CiAgICAgICAgY29uc3Qgc2hhcGVCb2R5ID0gYm9keS5hZGRTaGFwZShjcmVhdGVTaGFwZSh0eXBlLCBhcmdzKSwgcG9zaXRpb24gPyBuZXcgVmVjMyguLi5wb3NpdGlvbikgOiB1bmRlZmluZWQsIHNldFF1YXRlcm5pb24obmV3IFF1YXRlcm5pb24oMCwgMCwgMCwgMSksIHsKICAgICAgICAgIHF1YXRlcm5pb24sCiAgICAgICAgICByb3RhdGlvbgogICAgICAgIH0pKTsKICAgICAgICBpZiAobWF0ZXJpYWwpIHNoYXBlQm9keS5tYXRlcmlhbCA9IGNyZWF0ZU1hdGVyaWFsKG1hdGVyaWFsKTsKICAgICAgICBPYmplY3QuYXNzaWduKHNoYXBlQm9keSwgZXh0cmEpOwogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIGJvZHkuYWRkU2hhcGUoY3JlYXRlU2hhcGUodHlwZSwgYXJncykpOwogICAgfQogICAgYm9keS5wb3NpdGlvbi5zZXQocG9zaXRpb25bMF0sIHBvc2l0aW9uWzFdLCBwb3NpdGlvblsyXSk7CiAgICBib2R5LnZlbG9jaXR5LnNldCh2ZWxvY2l0eVswXSwgdmVsb2NpdHlbMV0sIHZlbG9jaXR5WzJdKTsKICAgIGJvZHkuYW5ndWxhclZlbG9jaXR5LnNldChhbmd1bGFyVmVsb2NpdHlbMF0sIGFuZ3VsYXJWZWxvY2l0eVsxXSwgYW5ndWxhclZlbG9jaXR5WzJdKTsKICAgIGJvZHkubGluZWFyRmFjdG9yLnNldChsaW5lYXJGYWN0b3JbMF0sIGxpbmVhckZhY3RvclsxXSwgbGluZWFyRmFjdG9yWzJdKTsKICAgIGJvZHkuYW5ndWxhckZhY3Rvci5zZXQoYW5ndWxhckZhY3RvclswXSwgYW5ndWxhckZhY3RvclsxXSwgYW5ndWxhckZhY3RvclsyXSk7CiAgICBzZXRRdWF0ZXJuaW9uKGJvZHkucXVhdGVybmlvbiwgewogICAgICBxdWF0ZXJuaW9uLAogICAgICByb3RhdGlvbgogICAgfSk7CiAgICByZXR1cm4gYm9keTsKICB9OwoKICBjb25zdCBhZGRCb2RpZXMgPSAoc3RhdGUsIGNyZWF0ZU1hdGVyaWFsLCBfcmVmKSA9PiB7CiAgICBsZXQgewogICAgICBwcm9wcywKICAgICAgdHlwZSwKICAgICAgdXVpZAogICAgfSA9IF9yZWY7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHV1aWQubGVuZ3RoOyBpKyspIHsKICAgICAgY29uc3QgYm9keSA9IHByb3BzVG9Cb2R5KHsKICAgICAgICBjcmVhdGVNYXRlcmlhbCwKICAgICAgICBwcm9wczogcHJvcHNbaV0sCiAgICAgICAgdHlwZSwKICAgICAgICB1dWlkOiB1dWlkW2ldCiAgICAgIH0pOwogICAgICBzdGF0ZS53b3JsZC5hZGRCb2R5KGJvZHkpOwogICAgICBpZiAocHJvcHNbaV0ub25Db2xsaWRlKSBib2R5LmFkZEV2ZW50TGlzdGVuZXIoJ2NvbGxpZGUnLCBfcmVmMiA9PiB7CiAgICAgICAgbGV0IHsKICAgICAgICAgIHR5cGUsCiAgICAgICAgICBib2R5LAogICAgICAgICAgdGFyZ2V0LAogICAgICAgICAgY29udGFjdAogICAgICAgIH0gPSBfcmVmMjsKICAgICAgICBpZiAoIWJvZHkudXVpZCB8fCAhdGFyZ2V0LnV1aWQpIHJldHVybjsKICAgICAgICBjb25zdCB7CiAgICAgICAgICBuaSwKICAgICAgICAgIHJpLAogICAgICAgICAgcmosCiAgICAgICAgICBiaSwKICAgICAgICAgIGJqLAogICAgICAgICAgaWQKICAgICAgICB9ID0gY29udGFjdDsKICAgICAgICBjb25zdCBjb250YWN0UG9pbnQgPSBiaS5wb3NpdGlvbi52YWRkKHJpKTsKICAgICAgICBjb25zdCBjb250YWN0Tm9ybWFsID0gYmkgPT09IGJvZHkgPyBuaSA6IG5pLnNjYWxlKC0xKTsKICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICAgIGJvZHk6IGJvZHkudXVpZCwKICAgICAgICAgIGNvbGxpc2lvbkZpbHRlcnM6IHsKICAgICAgICAgICAgYm9keUZpbHRlckdyb3VwOiBib2R5LmNvbGxpc2lvbkZpbHRlckdyb3VwLAogICAgICAgICAgICBib2R5RmlsdGVyTWFzazogYm9keS5jb2xsaXNpb25GaWx0ZXJNYXNrLAogICAgICAgICAgICB0YXJnZXRGaWx0ZXJHcm91cDogdGFyZ2V0LmNvbGxpc2lvbkZpbHRlckdyb3VwLAogICAgICAgICAgICB0YXJnZXRGaWx0ZXJNYXNrOiB0YXJnZXQuY29sbGlzaW9uRmlsdGVyTWFzawogICAgICAgICAgfSwKICAgICAgICAgIGNvbnRhY3Q6IHsKICAgICAgICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiB1c2UgaWQgaW5zdGVhZCBvZiB1dWlkCiAgICAgICAgICAgIGJpOiBiaS51dWlkLAogICAgICAgICAgICAvLyBAdHMtZXhwZWN0LWVycm9yIFRPRE86IHVzZSBpZCBpbnN0ZWFkIG9mIHV1aWQKICAgICAgICAgICAgYmo6IGJqLnV1aWQsCiAgICAgICAgICAgIC8vIE5vcm1hbCBvZiB0aGUgY29udGFjdCwgcmVsYXRpdmUgdG8gdGhlIGNvbGxpZGluZyBib2R5CiAgICAgICAgICAgIGNvbnRhY3ROb3JtYWw6IGNvbnRhY3ROb3JtYWwudG9BcnJheSgpLAogICAgICAgICAgICAvLyBXb3JsZCBwb3NpdGlvbiBvZiB0aGUgY29udGFjdAogICAgICAgICAgICBjb250YWN0UG9pbnQ6IGNvbnRhY3RQb2ludC50b0FycmF5KCksCiAgICAgICAgICAgIGlkLAogICAgICAgICAgICBpbXBhY3RWZWxvY2l0eTogY29udGFjdC5nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsKCksCiAgICAgICAgICAgIG5pOiBuaS50b0FycmF5KCksCiAgICAgICAgICAgIHJpOiByaS50b0FycmF5KCksCiAgICAgICAgICAgIHJqOiByai50b0FycmF5KCkKICAgICAgICAgIH0sCiAgICAgICAgICBvcDogJ2V2ZW50JywKICAgICAgICAgIHRhcmdldDogdGFyZ2V0LnV1aWQsCiAgICAgICAgICB0eXBlCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogIH07CgogIGNvbnN0IHRyaXBsZXRUb1ZlYzMgPSB0ID0+IHQgPyBuZXcgVmVjMyguLi50KSA6IHVuZGVmaW5lZDsKCiAgY29uc3QgYWRkQ29uc3RyYWludCA9IChzdGF0ZSwgX3JlZikgPT4gewogICAgbGV0IHsKICAgICAgcHJvcHM6IFtib2R5QSwgYm9keUIsIHsKICAgICAgICBhbmdsZSwKICAgICAgICBheGlzQSwKICAgICAgICBheGlzQiwKICAgICAgICBjb2xsaWRlQ29ubmVjdGVkLAogICAgICAgIGRpc3RhbmNlLAogICAgICAgIG1heEZvcmNlLAogICAgICAgIG1heE11bHRpcGxpZXIsCiAgICAgICAgcGl2b3RBLAogICAgICAgIHBpdm90QiwKICAgICAgICB0d2lzdEFuZ2xlLAogICAgICAgIHdha2VVcEJvZGllcwogICAgICB9XSwKICAgICAgdHlwZSwKICAgICAgdXVpZAogICAgfSA9IF9yZWY7CiAgICBsZXQgY29uc3RyYWludDsKICAgIHN3aXRjaCAodHlwZSkgewogICAgICBjYXNlICdQb2ludFRvUG9pbnQnOgogICAgICAgIGNvbnN0cmFpbnQgPSBuZXcgUG9pbnRUb1BvaW50Q29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCB0cmlwbGV0VG9WZWMzKHBpdm90QSksIHN0YXRlLmJvZGllc1tib2R5Ql0sIHRyaXBsZXRUb1ZlYzMocGl2b3RCKSwgbWF4Rm9yY2UpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdDb25lVHdpc3QnOgogICAgICAgIGNvbnN0cmFpbnQgPSBuZXcgQ29uZVR3aXN0Q29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCB7CiAgICAgICAgICBhbmdsZSwKICAgICAgICAgIGF4aXNBOiB0cmlwbGV0VG9WZWMzKGF4aXNBKSwKICAgICAgICAgIGF4aXNCOiB0cmlwbGV0VG9WZWMzKGF4aXNCKSwKICAgICAgICAgIGNvbGxpZGVDb25uZWN0ZWQsCiAgICAgICAgICBtYXhGb3JjZSwKICAgICAgICAgIHBpdm90QTogdHJpcGxldFRvVmVjMyhwaXZvdEEpLAogICAgICAgICAgcGl2b3RCOiB0cmlwbGV0VG9WZWMzKHBpdm90QiksCiAgICAgICAgICB0d2lzdEFuZ2xlCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ0hpbmdlJzoKICAgICAgICBjb25zdHJhaW50ID0gbmV3IEhpbmdlQ29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCB7CiAgICAgICAgICBheGlzQTogdHJpcGxldFRvVmVjMyhheGlzQSksCiAgICAgICAgICBheGlzQjogdHJpcGxldFRvVmVjMyhheGlzQiksCiAgICAgICAgICBjb2xsaWRlQ29ubmVjdGVkLAogICAgICAgICAgbWF4Rm9yY2UsCiAgICAgICAgICBwaXZvdEE6IHRyaXBsZXRUb1ZlYzMocGl2b3RBKSwKICAgICAgICAgIHBpdm90QjogdHJpcGxldFRvVmVjMyhwaXZvdEIpCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ0Rpc3RhbmNlJzoKICAgICAgICBjb25zdHJhaW50ID0gbmV3IERpc3RhbmNlQ29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCBkaXN0YW5jZSwgbWF4Rm9yY2UpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdMb2NrJzoKICAgICAgICBjb25zdHJhaW50ID0gbmV3IExvY2tDb25zdHJhaW50KHN0YXRlLmJvZGllc1tib2R5QV0sIHN0YXRlLmJvZGllc1tib2R5Ql0sIHsKICAgICAgICAgIG1heEZvcmNlCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgY29uc3RyYWludCA9IG5ldyBDb25zdHJhaW50KHN0YXRlLmJvZGllc1tib2R5QV0sIHN0YXRlLmJvZGllc1tib2R5Ql0sIHsKICAgICAgICAgIGNvbGxpZGVDb25uZWN0ZWQsCiAgICAgICAgICB3YWtlVXBCb2RpZXMKICAgICAgICB9KTsKICAgICAgICBicmVhazsKICAgIH0KICAgIGNvbnN0cmFpbnQudXVpZCA9IHV1aWQ7CiAgICBzdGF0ZS53b3JsZC5hZGRDb25zdHJhaW50KGNvbnN0cmFpbnQpOwogICAgaWYgKG1heE11bHRpcGxpZXIgIT09IHVuZGVmaW5lZCkgewogICAgICBjb25zdCBwb3N0U3RlcENvbnN0cmFpbnQgPSAoKSA9PiB7CiAgICAgICAgLy8gVGhlIG11bHRpcGxpZXIgaXMgcHJvcG9ydGlvbmFsIHRvIGhvdyBtdWNoIGZvcmNlIGlzIGFkZGVkIHRvIHRoZSBib2RpZXMgYnkgdGhlIGNvbnN0cmFpbnQuCiAgICAgICAgLy8gSWYgdGhpcyBleGNlZWRzIGEgbGltaXQgdGhlIGNvbnN0cmFpbnQgaXMgZGlzYWJsZWQuCiAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IE1hdGguYWJzKGNvbnN0cmFpbnQuZXF1YXRpb25zWzBdLm11bHRpcGxpZXIpOwogICAgICAgIGlmIChtdWx0aXBsaWVyID4gbWF4TXVsdGlwbGllcikgewogICAgICAgICAgY29uc3RyYWludC5kaXNhYmxlKCk7CiAgICAgICAgfQogICAgICB9OwogICAgICBzdGF0ZS5jb25zdHJhaW50c1t1dWlkXSA9IHBvc3RTdGVwQ29uc3RyYWludDsKICAgICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBzdGF0ZS5jb25zdHJhaW50c1t1dWlkXSk7CiAgICB9CiAgfTsKCiAgZnVuY3Rpb24gdG9VcHBlcmNhc2Uoc3RyKSB7CiAgICByZXR1cm4gc3RyLnRvVXBwZXJDYXNlKCk7CiAgfQogIGNvbnN0IGFkZFJheSA9IChzdGF0ZSwgX3JlZikgPT4gewogICAgbGV0IHsKICAgICAgcHJvcHM6IHsKICAgICAgICBmcm9tLAogICAgICAgIG1vZGUsCiAgICAgICAgdG8sCiAgICAgICAgLi4ucmF5T3B0aW9ucwogICAgICB9LAogICAgICB1dWlkCiAgICB9ID0gX3JlZjsKICAgIGNvbnN0IHJheSA9IG5ldyBSYXkodHJpcGxldFRvVmVjMyhmcm9tKSwgdHJpcGxldFRvVmVjMyh0bykpOwogICAgY29uc3Qgb3B0aW9ucyA9IHsKICAgICAgbW9kZTogUkFZX01PREVTW3RvVXBwZXJjYXNlKG1vZGUpXSwKICAgICAgcmVzdWx0OiBuZXcgUmF5Y2FzdFJlc3VsdCgpLAogICAgICAuLi5yYXlPcHRpb25zCiAgICB9OwogICAgc3RhdGUucmF5c1t1dWlkXSA9ICgpID0+IHsKICAgICAgcmF5LmludGVyc2VjdFdvcmxkKHN0YXRlLndvcmxkLCBvcHRpb25zKTsKICAgICAgaWYgKCFvcHRpb25zLnJlc3VsdCB8fCAhb3B0aW9ucy5yZXN1bHQuYm9keSkgcmV0dXJuOwogICAgICBjb25zdCB7CiAgICAgICAgYm9keSwKICAgICAgICBzaGFwZSwKICAgICAgICByYXlGcm9tV29ybGQsCiAgICAgICAgcmF5VG9Xb3JsZCwKICAgICAgICBoaXROb3JtYWxXb3JsZCwKICAgICAgICBoaXRQb2ludFdvcmxkLAogICAgICAgIC4uLnJlc3QKICAgICAgfSA9IG9wdGlvbnMucmVzdWx0OwogICAgICBjb25zdCBib2R5VVVJRCA9IGJvZHkudXVpZDsKICAgICAgaWYgKCFib2R5VVVJRCkgcmV0dXJuOwogICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICBib2R5OiBib2R5VVVJRCwKICAgICAgICBoaXROb3JtYWxXb3JsZDogaGl0Tm9ybWFsV29ybGQudG9BcnJheSgpLAogICAgICAgIGhpdFBvaW50V29ybGQ6IGhpdFBvaW50V29ybGQudG9BcnJheSgpLAogICAgICAgIG9wOiAnZXZlbnQnLAogICAgICAgIHJheTogewogICAgICAgICAgY29sbGlzaW9uRmlsdGVyR3JvdXA6IHJheS5jb2xsaXNpb25GaWx0ZXJHcm91cCwKICAgICAgICAgIGNvbGxpc2lvbkZpbHRlck1hc2s6IHJheS5jb2xsaXNpb25GaWx0ZXJNYXNrLAogICAgICAgICAgZGlyZWN0aW9uOiByYXkuZGlyZWN0aW9uLnRvQXJyYXkoKSwKICAgICAgICAgIGZyb20sCiAgICAgICAgICB0bywKICAgICAgICAgIHV1aWQKICAgICAgICB9LAogICAgICAgIHJheUZyb21Xb3JsZDogcmF5RnJvbVdvcmxkLnRvQXJyYXkoKSwKICAgICAgICByYXlUb1dvcmxkOiByYXlUb1dvcmxkLnRvQXJyYXkoKSwKICAgICAgICBzaGFwZTogc2hhcGUgPyB7CiAgICAgICAgICAuLi5zaGFwZSwKICAgICAgICAgIGJvZHk6IGJvZHlVVUlECiAgICAgICAgfSA6IG51bGwsCiAgICAgICAgdHlwZTogJ3JheWhpdCcsCiAgICAgICAgLi4ucmVzdAogICAgICB9KTsKICAgIH07CiAgICBzdGF0ZS53b3JsZC5hZGRFdmVudExpc3RlbmVyKCdwcmVTdGVwJywgc3RhdGUucmF5c1t1dWlkXSk7CiAgfTsKCiAgY29uc3QgYWRkUmF5Y2FzdFZlaGljbGUgPSAoc3RhdGUsIGRhdGEpID0+IHsKICAgIGNvbnN0IFtjaGFzc2lzQm9keSwgd2hlZWxzLCB3aGVlbEluZm9zLCBpbmRleEZvcndhcmRBeGlzLCBpbmRleFJpZ2h0QXhpcywgaW5kZXhVcEF4aXNdID0gZGF0YS5wcm9wczsKICAgIGNvbnN0IHZlaGljbGUgPSBuZXcgUmF5Y2FzdFZlaGljbGUoewogICAgICBjaGFzc2lzQm9keTogc3RhdGUuYm9kaWVzW2NoYXNzaXNCb2R5XSwKICAgICAgaW5kZXhGb3J3YXJkQXhpcywKICAgICAgaW5kZXhSaWdodEF4aXMsCiAgICAgIGluZGV4VXBBeGlzCiAgICB9KTsKICAgIHZlaGljbGUud29ybGQgPSBzdGF0ZS53b3JsZDsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgd2hlZWxJbmZvcy5sZW5ndGg7IGkrKykgewogICAgICBjb25zdCB7CiAgICAgICAgYXhsZUxvY2FsLAogICAgICAgIGNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbCwKICAgICAgICBkaXJlY3Rpb25Mb2NhbCwKICAgICAgICAuLi5yZXN0CiAgICAgIH0gPSB3aGVlbEluZm9zW2ldOwogICAgICB2ZWhpY2xlLmFkZFdoZWVsKHsKICAgICAgICBheGxlTG9jYWw6IHRyaXBsZXRUb1ZlYzMoYXhsZUxvY2FsKSwKICAgICAgICBjaGFzc2lzQ29ubmVjdGlvblBvaW50TG9jYWw6IHRyaXBsZXRUb1ZlYzMoY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludExvY2FsKSwKICAgICAgICBkaXJlY3Rpb25Mb2NhbDogdHJpcGxldFRvVmVjMyhkaXJlY3Rpb25Mb2NhbCksCiAgICAgICAgLi4ucmVzdAogICAgICB9KTsKICAgIH0KICAgIGNvbnN0IHByZVN0ZXAgPSAoKSA9PiB7CiAgICAgIHZlaGljbGUudXBkYXRlVmVoaWNsZShzdGF0ZS53b3JsZC5kdCk7CiAgICB9OwogICAgY29uc3QgcG9zdFN0ZXAgPSAoKSA9PiB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVoaWNsZS53aGVlbEluZm9zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmVoaWNsZS51cGRhdGVXaGVlbFRyYW5zZm9ybShpKTsKICAgICAgICBjb25zdCB0ID0gdmVoaWNsZS53aGVlbEluZm9zW2ldLndvcmxkVHJhbnNmb3JtOwogICAgICAgIGNvbnN0IHdoZWVsQm9keSA9IHN0YXRlLmJvZGllc1t3aGVlbHNbaV1dOwogICAgICAgIHdoZWVsQm9keS5wb3NpdGlvbi5jb3B5KHQucG9zaXRpb24pOwogICAgICAgIHdoZWVsQm9keS5xdWF0ZXJuaW9uLmNvcHkodC5xdWF0ZXJuaW9uKTsKICAgICAgfQogICAgfTsKICAgIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0gPSB7CiAgICAgIHBvc3RTdGVwLAogICAgICBwcmVTdGVwLAogICAgICB2ZWhpY2xlCiAgICB9OwogICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHByZVN0ZXApOwogICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBwb3N0U3RlcCk7CiAgfTsKCiAgY29uc3QgYWRkU3ByaW5nID0gKHN0YXRlLCBfcmVmKSA9PiB7CiAgICBsZXQgewogICAgICBwcm9wczogW2JvZHlBLCBib2R5QiwgewogICAgICAgIGRhbXBpbmcsCiAgICAgICAgbG9jYWxBbmNob3JBLAogICAgICAgIGxvY2FsQW5jaG9yQiwKICAgICAgICByZXN0TGVuZ3RoLAogICAgICAgIHN0aWZmbmVzcywKICAgICAgICB3b3JsZEFuY2hvckEsCiAgICAgICAgd29ybGRBbmNob3JCCiAgICAgIH1dLAogICAgICB1dWlkCiAgICB9ID0gX3JlZjsKICAgIGNvbnN0IHNwcmluZyA9IG5ldyBTcHJpbmcoc3RhdGUuYm9kaWVzW2JvZHlBXSwgc3RhdGUuYm9kaWVzW2JvZHlCXSwgewogICAgICBkYW1waW5nLAogICAgICBsb2NhbEFuY2hvckE6IHRyaXBsZXRUb1ZlYzMobG9jYWxBbmNob3JBKSwKICAgICAgbG9jYWxBbmNob3JCOiB0cmlwbGV0VG9WZWMzKGxvY2FsQW5jaG9yQiksCiAgICAgIHJlc3RMZW5ndGgsCiAgICAgIHN0aWZmbmVzcywKICAgICAgd29ybGRBbmNob3JBOiB0cmlwbGV0VG9WZWMzKHdvcmxkQW5jaG9yQSksCiAgICAgIHdvcmxkQW5jaG9yQjogdHJpcGxldFRvVmVjMyh3b3JsZEFuY2hvckIpCiAgICB9KTsKICAgIHNwcmluZy51dWlkID0gdXVpZDsKICAgIGNvbnN0IHBvc3RTdGVwU3ByaW5nID0gKCkgPT4gc3ByaW5nLmFwcGx5Rm9yY2UoKTsKICAgIHN0YXRlLnNwcmluZ3NbdXVpZF0gPSBwb3N0U3RlcFNwcmluZzsKICAgIHN0YXRlLnNwcmluZ0luc3RhbmNlc1t1dWlkXSA9IHNwcmluZzsKCiAgICAvLyBDb21wdXRlIHRoZSBmb3JjZSBhZnRlciBlYWNoIHN0ZXAKICAgIHN0YXRlLndvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgc3RhdGUuc3ByaW5nc1t1dWlkXSk7CiAgfTsKCiAgZnVuY3Rpb24gZW1pdEJlZ2luQ29udGFjdChfcmVmKSB7CiAgICBsZXQgewogICAgICBib2R5QSwKICAgICAgYm9keUIKICAgIH0gPSBfcmVmOwogICAgaWYgKCEoYm9keUEgIT0gbnVsbCAmJiBib2R5QS51dWlkKSB8fCAhKGJvZHlCICE9IG51bGwgJiYgYm9keUIudXVpZCkpIHJldHVybjsKICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICBib2R5QTogYm9keUEudXVpZCwKICAgICAgYm9keUI6IGJvZHlCLnV1aWQsCiAgICAgIG9wOiAnZXZlbnQnLAogICAgICB0eXBlOiAnY29sbGlkZUJlZ2luJwogICAgfSk7CiAgfQogIGZ1bmN0aW9uIGVtaXRFbmRDb250YWN0KF9yZWYyKSB7CiAgICBsZXQgewogICAgICBib2R5QSwKICAgICAgYm9keUIKICAgIH0gPSBfcmVmMjsKICAgIGlmICghKGJvZHlBICE9IG51bGwgJiYgYm9keUEudXVpZCkgfHwgIShib2R5QiAhPSBudWxsICYmIGJvZHlCLnV1aWQpKSByZXR1cm47CiAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgYm9keUE6IGJvZHlBLnV1aWQsCiAgICAgIGJvZHlCOiBib2R5Qi51dWlkLAogICAgICBvcDogJ2V2ZW50JywKICAgICAgdHlwZTogJ2NvbGxpZGVFbmQnCiAgICB9KTsKICB9CiAgY29uc3QgaW5pdCA9ICh3b3JsZCwgX3JlZjMpID0+IHsKICAgIGxldCB7CiAgICAgIGFsbG93U2xlZXAsCiAgICAgIGF4aXNJbmRleCA9IDAsCiAgICAgIGJyb2FkcGhhc2UsCiAgICAgIGRlZmF1bHRDb250YWN0TWF0ZXJpYWwsCiAgICAgIGZyaWN0aW9uR3Jhdml0eSwKICAgICAgZ3Jhdml0eSwKICAgICAgaXRlcmF0aW9ucywKICAgICAgcXVhdE5vcm1hbGl6ZUZhc3QsCiAgICAgIHF1YXROb3JtYWxpemVTa2lwLAogICAgICBzb2x2ZXIsCiAgICAgIHRvbGVyYW5jZQogICAgfSA9IF9yZWYzOwogICAgd29ybGQuYWxsb3dTbGVlcCA9IGFsbG93U2xlZXA7CiAgICB3b3JsZC5ncmF2aXR5LnNldCguLi5ncmF2aXR5KTsKICAgIHdvcmxkLmZyaWN0aW9uR3Jhdml0eSA9IGZyaWN0aW9uR3Jhdml0eSA/IG5ldyBWZWMzKC4uLmZyaWN0aW9uR3Jhdml0eSkgOiB1bmRlZmluZWQ7CiAgICB3b3JsZC5xdWF0Tm9ybWFsaXplRmFzdCA9IHF1YXROb3JtYWxpemVGYXN0OwogICAgd29ybGQucXVhdE5vcm1hbGl6ZVNraXAgPSBxdWF0Tm9ybWFsaXplU2tpcDsKICAgIGlmIChzb2x2ZXIgPT09ICdTcGxpdCcpIHsKICAgICAgd29ybGQuc29sdmVyID0gbmV3IFNwbGl0U29sdmVyKG5ldyBHU1NvbHZlcigpKTsKICAgIH0KICAgIGlmICh3b3JsZC5zb2x2ZXIgaW5zdGFuY2VvZiBHU1NvbHZlcikgewogICAgICB3b3JsZC5zb2x2ZXIudG9sZXJhbmNlID0gdG9sZXJhbmNlOwogICAgICB3b3JsZC5zb2x2ZXIuaXRlcmF0aW9ucyA9IGl0ZXJhdGlvbnM7CiAgICB9CiAgICB3b3JsZC5icm9hZHBoYXNlID0gYnJvYWRwaGFzZSA9PT0gJ1NBUCcgPyBuZXcgU0FQQnJvYWRwaGFzZSh3b3JsZCkgOiBuZXcgTmFpdmVCcm9hZHBoYXNlKCk7CiAgICBpZiAod29ybGQuYnJvYWRwaGFzZSBpbnN0YW5jZW9mIFNBUEJyb2FkcGhhc2UpIHsKICAgICAgd29ybGQuYnJvYWRwaGFzZS5heGlzSW5kZXggPSBheGlzSW5kZXg7CiAgICB9CiAgICB3b3JsZC5hZGRFdmVudExpc3RlbmVyKCdiZWdpbkNvbnRhY3QnLCBlbWl0QmVnaW5Db250YWN0KTsKICAgIHdvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ2VuZENvbnRhY3QnLCBlbWl0RW5kQ29udGFjdCk7CiAgICBPYmplY3QuYXNzaWduKHdvcmxkLmRlZmF1bHRDb250YWN0TWF0ZXJpYWwsIGRlZmF1bHRDb250YWN0TWF0ZXJpYWwpOwogIH07CgogIGNvbnN0IGlzUW9yViA9IHYgPT4gdiBpbnN0YW5jZW9mIFF1YXRlcm5pb24gfHwgdiBpbnN0YW5jZW9mIFZlYzM7CiAgY29uc3Qgc3RlcCA9IChzdGF0ZSwgX3JlZikgPT4gewogICAgbGV0IHsKICAgICAgcG9zaXRpb25zLAogICAgICBwcm9wczogewogICAgICAgIG1heFN1YlN0ZXBzLAogICAgICAgIHN0ZXBTaXplLAogICAgICAgIHRpbWVTaW5jZUxhc3RDYWxsZWQKICAgICAgfSwKICAgICAgcXVhdGVybmlvbnMKICAgIH0gPSBfcmVmOwogICAgc3RhdGUud29ybGQuc3RlcChzdGVwU2l6ZSwgdGltZVNpbmNlTGFzdENhbGxlZCwgbWF4U3ViU3RlcHMpOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdGF0ZS53b3JsZC5ib2RpZXMubGVuZ3RoOyBpICs9IDEpIHsKICAgICAgY29uc3QgcCA9IHN0YXRlLndvcmxkLmJvZGllc1tpXS5wb3NpdGlvbjsKICAgICAgY29uc3QgcSA9IHN0YXRlLndvcmxkLmJvZGllc1tpXS5xdWF0ZXJuaW9uOwogICAgICBwb3NpdGlvbnNbMyAqIGkgKyAwXSA9IHAueDsKICAgICAgcG9zaXRpb25zWzMgKiBpICsgMV0gPSBwLnk7CiAgICAgIHBvc2l0aW9uc1szICogaSArIDJdID0gcC56OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDBdID0gcS54OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDFdID0gcS55OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDJdID0gcS56OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDNdID0gcS53OwogICAgfQogICAgY29uc3Qgb2JzZXJ2YXRpb25zID0gW107CiAgICBmb3IgKGNvbnN0IGlkIG9mIE9iamVjdC5rZXlzKHN0YXRlLnN1YnNjcmlwdGlvbnMpKSB7CiAgICAgIGNvbnN0IFt1dWlkLCB0eXBlLCB0YXJnZXQgPSAnYm9kaWVzJ10gPSBzdGF0ZS5zdWJzY3JpcHRpb25zW2lkXTsKICAgICAgY29uc3QgewogICAgICAgIGJvZGllcywKICAgICAgICB2ZWhpY2xlcwogICAgICB9ID0gc3RhdGU7CiAgICAgIGNvbnN0IHZhbHVlID0gdGFyZ2V0ID09PSAndmVoaWNsZXMnID8KICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiBEaWZmZXJlbnRpYXRlIHRoZXNlICJ0eXBlcyIKICAgICAgdmVoaWNsZXNbdXVpZF0udmVoaWNsZVt0eXBlXSA6CiAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgVE9ETzogRGlmZmVyZW50aWF0ZSB0aGVzZSAidHlwZXMiCiAgICAgIGJvZGllc1t1dWlkXVt0eXBlXTsKICAgICAgY29uc3Qgc2VyaWFsaXphYmxlVmFsdWUgPSBpc1FvclYodmFsdWUpID8gdmFsdWUudG9BcnJheSgpIDogdmFsdWU7CiAgICAgIG9ic2VydmF0aW9ucy5wdXNoKFtOdW1iZXIoaWQpLCBzZXJpYWxpemFibGVWYWx1ZSwKICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiBEaWZmZXJlbnRpYXRlIHRoZXNlICJ0eXBlcyIKICAgICAgdHlwZV0pOwogICAgfQogICAgY29uc3QgbWVzc2FnZSA9IHsKICAgICAgYWN0aXZlOiBzdGF0ZS53b3JsZC5oYXNBY3RpdmVCb2RpZXMsCiAgICAgIG9ic2VydmF0aW9ucywKICAgICAgb3A6ICdmcmFtZScsCiAgICAgIHBvc2l0aW9ucywKICAgICAgcXVhdGVybmlvbnMKICAgIH07CiAgICBpZiAoc3RhdGUuYm9kaWVzTmVlZFN5bmNpbmcpIHsKICAgICAgbWVzc2FnZS5ib2RpZXMgPSBzdGF0ZS53b3JsZC5ib2RpZXMucmVkdWNlKChib2RpZXMsIGJvZHkpID0+IHsKICAgICAgICBpZiAoYm9keS51dWlkKSBib2RpZXMucHVzaChib2R5LnV1aWQpOwogICAgICAgIHJldHVybiBib2RpZXM7CiAgICAgIH0sIFtdKTsKICAgICAgc3RhdGUuYm9kaWVzTmVlZFN5bmNpbmcgPSBmYWxzZTsKICAgIH0KICAgIHNlbGYucG9zdE1lc3NhZ2UobWVzc2FnZSwgW3Bvc2l0aW9ucy5idWZmZXIsIHF1YXRlcm5pb25zLmJ1ZmZlcl0pOwogIH07CgogIGNvbnN0IHN0YXRlID0gewogICAgYm9kaWVzOiB7fSwKICAgIGJvZGllc05lZWRTeW5jaW5nOiBmYWxzZSwKICAgIGNvbnN0cmFpbnRzOiB7fSwKICAgIG1hdGVyaWFsczoge30sCiAgICByYXlzOiB7fSwKICAgIHNwcmluZ0luc3RhbmNlczoge30sCiAgICBzcHJpbmdzOiB7fSwKICAgIHN1YnNjcmlwdGlvbnM6IHt9LAogICAgdmVoaWNsZXM6IHt9LAogICAgd29ybGQ6IG5ldyBXb3JsZCgpCiAgfTsKCiAgLy8vIDxyZWZlcmVuY2Ugbm8tZGVmYXVsdC1saWI9InRydWUiLz4KICBjb25zdCBpc0hpbmdlQ29uc3RyYWludCA9IGMgPT4gYyBpbnN0YW5jZW9mIEhpbmdlQ29uc3RyYWludDsKICBmdW5jdGlvbiBzeW5jQm9kaWVzKCkgewogICAgc3RhdGUuYm9kaWVzTmVlZFN5bmNpbmcgPSB0cnVlOwogICAgc3RhdGUuYm9kaWVzID0gc3RhdGUud29ybGQuYm9kaWVzLnJlZHVjZSgoYm9kaWVzLCBib2R5KSA9PiBib2R5LnV1aWQgPyB7CiAgICAgIC4uLmJvZGllcywKICAgICAgW2JvZHkudXVpZF06IGJvZHkKICAgIH0gOiBib2RpZXMsIHt9KTsKICB9CiAgY29uc3QgYnJvYWRwaGFzZXMgPSB7CiAgICBOYWl2ZUJyb2FkcGhhc2UsCiAgICBTQVBCcm9hZHBoYXNlCiAgfTsKICBjb25zdCBjcmVhdGVNYXRlcmlhbCA9IGNyZWF0ZU1hdGVyaWFsRmFjdG9yeShzdGF0ZS5tYXRlcmlhbHMpOwogIHNlbGYub25tZXNzYWdlID0gX3JlZiA9PiB7CiAgICBsZXQgewogICAgICBkYXRhCiAgICB9ID0gX3JlZjsKICAgIHN3aXRjaCAoZGF0YS5vcCkgewogICAgICBjYXNlICdpbml0JzoKICAgICAgICB7CiAgICAgICAgICBpbml0KHN0YXRlLndvcmxkLCBkYXRhLnByb3BzKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnc3RlcCc6CiAgICAgICAgewogICAgICAgICAgc3RlcChzdGF0ZSwgZGF0YSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ2FkZEJvZGllcyc6CiAgICAgICAgewogICAgICAgICAgYWRkQm9kaWVzKHN0YXRlLCBjcmVhdGVNYXRlcmlhbCwgZGF0YSk7CiAgICAgICAgICBzeW5jQm9kaWVzKCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3JlbW92ZUJvZGllcyc6CiAgICAgICAgewogICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkYXRhLnV1aWQubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlQm9keShzdGF0ZS5ib2RpZXNbZGF0YS51dWlkW2ldXSk7CiAgICAgICAgICAgIGNvbnN0IGtleSA9IE9iamVjdC5rZXlzKHN0YXRlLnN1YnNjcmlwdGlvbnMpLmZpbmQoayA9PiBzdGF0ZS5zdWJzY3JpcHRpb25zW2tdWzBdID09PSBkYXRhLnV1aWRbaV0pOwogICAgICAgICAgICBpZiAoa2V5KSB7CiAgICAgICAgICAgICAgZGVsZXRlIHN0YXRlLnN1YnNjcmlwdGlvbnNba2V5XTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgc3luY0JvZGllcygpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdzdWJzY3JpYmUnOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IHsKICAgICAgICAgICAgaWQsCiAgICAgICAgICAgIHRhcmdldCwKICAgICAgICAgICAgdHlwZQogICAgICAgICAgfSA9IGRhdGEucHJvcHM7CiAgICAgICAgICBzdGF0ZS5zdWJzY3JpcHRpb25zW2lkXSA9IFtkYXRhLnV1aWQsIHR5cGUsIHRhcmdldF07CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3Vuc3Vic2NyaWJlJzoKICAgICAgICB7CiAgICAgICAgICBkZWxldGUgc3RhdGUuc3Vic2NyaXB0aW9uc1tkYXRhLnByb3BzXTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnc2V0UG9zaXRpb24nOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnBvc2l0aW9uLnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0UXVhdGVybmlvbic6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ucXVhdGVybmlvbi5zZXQoZGF0YS5wcm9wc1swXSwgZGF0YS5wcm9wc1sxXSwgZGF0YS5wcm9wc1syXSwgZGF0YS5wcm9wc1szXSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldFJvdGF0aW9uJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5xdWF0ZXJuaW9uLnNldEZyb21FdWxlcihkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0VmVsb2NpdHknOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnZlbG9jaXR5LnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QW5ndWxhclZlbG9jaXR5JzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hbmd1bGFyVmVsb2NpdHkuc2V0KGRhdGEucHJvcHNbMF0sIGRhdGEucHJvcHNbMV0sIGRhdGEucHJvcHNbMl0pOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRMaW5lYXJGYWN0b3InOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmxpbmVhckZhY3Rvci5zZXQoZGF0YS5wcm9wc1swXSwgZGF0YS5wcm9wc1sxXSwgZGF0YS5wcm9wc1syXSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldEFuZ3VsYXJGYWN0b3InOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFuZ3VsYXJGYWN0b3Iuc2V0KGRhdGEucHJvcHNbMF0sIGRhdGEucHJvcHNbMV0sIGRhdGEucHJvcHNbMl0pOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRNYXNzJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5tYXNzID0gZGF0YS5wcm9wczsKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS51cGRhdGVNYXNzUHJvcGVydGllcygpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRNYXRlcmlhbCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ubWF0ZXJpYWwgPSBkYXRhLnByb3BzID8gY3JlYXRlTWF0ZXJpYWwoZGF0YS5wcm9wcykgOiBudWxsOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRMaW5lYXJEYW1waW5nJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5saW5lYXJEYW1waW5nID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QW5ndWxhckRhbXBpbmcnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFuZ3VsYXJEYW1waW5nID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QWxsb3dTbGVlcCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uYWxsb3dTbGVlcCA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldFNsZWVwU3BlZWRMaW1pdCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uc2xlZXBTcGVlZExpbWl0ID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0U2xlZXBUaW1lTGltaXQnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnNsZWVwVGltZUxpbWl0ID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0Q29sbGlzaW9uRmlsdGVyR3JvdXAnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmNvbGxpc2lvbkZpbHRlckdyb3VwID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0Q29sbGlzaW9uRmlsdGVyTWFzayc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uY29sbGlzaW9uRmlsdGVyTWFzayA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldENvbGxpc2lvblJlc3BvbnNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5jb2xsaXNpb25SZXNwb25zZSA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldEZpeGVkUm90YXRpb24nOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmZpeGVkUm90YXRpb24gPSBkYXRhLnByb3BzOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRGcmljdGlvbkdyYXZpdHknOgogICAgICAgIHN0YXRlLndvcmxkLmZyaWN0aW9uR3Jhdml0eSA9IGRhdGEucHJvcHMgPyBuZXcgVmVjMyguLi5kYXRhLnByb3BzKSA6IHVuZGVmaW5lZDsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0SXNUcmlnZ2VyJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5pc1RyaWdnZXIgPSBkYXRhLnByb3BzOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRHcmF2aXR5JzoKICAgICAgICBzdGF0ZS53b3JsZC5ncmF2aXR5LnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0VG9sZXJhbmNlJzoKICAgICAgICBpZiAoc3RhdGUud29ybGQuc29sdmVyIGluc3RhbmNlb2YgR1NTb2x2ZXIpIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnNvbHZlci50b2xlcmFuY2UgPSBkYXRhLnByb3BzOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0SXRlcmF0aW9ucyc6CiAgICAgICAgaWYgKHN0YXRlLndvcmxkLnNvbHZlciBpbnN0YW5jZW9mIEdTU29sdmVyKSB7CiAgICAgICAgICBzdGF0ZS53b3JsZC5zb2x2ZXIuaXRlcmF0aW9ucyA9IGRhdGEucHJvcHM7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRCcm9hZHBoYXNlJzoKICAgICAgICBzdGF0ZS53b3JsZC5icm9hZHBoYXNlID0gbmV3IChicm9hZHBoYXNlc1tgJHtkYXRhLnByb3BzfUJyb2FkcGhhc2VgXSB8fCBOYWl2ZUJyb2FkcGhhc2UpKHN0YXRlLndvcmxkKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QXhpc0luZGV4JzoKICAgICAgICBpZiAoc3RhdGUud29ybGQuYnJvYWRwaGFzZSBpbnN0YW5jZW9mIFNBUEJyb2FkcGhhc2UpIHsKICAgICAgICAgIHN0YXRlLndvcmxkLmJyb2FkcGhhc2UuYXhpc0luZGV4ID0gZGF0YS5wcm9wcyA9PT0gdW5kZWZpbmVkIHx8IGRhdGEucHJvcHMgPT09IG51bGwgPyAwIDogZGF0YS5wcm9wczsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2FwcGx5Rm9yY2UnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFwcGx5Rm9yY2UobmV3IFZlYzMoLi4uZGF0YS5wcm9wc1swXSksIG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMV0pKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnYXBwbHlJbXB1bHNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hcHBseUltcHVsc2UobmV3IFZlYzMoLi4uZGF0YS5wcm9wc1swXSksIG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMV0pKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnYXBwbHlMb2NhbEZvcmNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hcHBseUxvY2FsRm9yY2UobmV3IFZlYzMoLi4uZGF0YS5wcm9wc1swXSksIG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMV0pKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnYXBwbHlMb2NhbEltcHVsc2UnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFwcGx5TG9jYWxJbXB1bHNlKG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMF0pLCBuZXcgVmVjMyguLi5kYXRhLnByb3BzWzFdKSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2FwcGx5VG9ycXVlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hcHBseVRvcnF1ZShuZXcgVmVjMyguLi5kYXRhLnByb3BzWzBdKSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2FkZENvbnN0cmFpbnQnOgogICAgICAgIHsKICAgICAgICAgIGFkZENvbnN0cmFpbnQoc3RhdGUsIGRhdGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdyZW1vdmVDb25zdHJhaW50JzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoX3JlZjIgPT4gewogICAgICAgICAgbGV0IHsKICAgICAgICAgICAgdXVpZAogICAgICAgICAgfSA9IF9yZWYyOwogICAgICAgICAgcmV0dXJuIHV1aWQgPT09IGRhdGEudXVpZDsKICAgICAgICB9KS5tYXAoYyA9PiBzdGF0ZS53b3JsZC5yZW1vdmVDb25zdHJhaW50KGMpKTsKICAgICAgICBpZiAoc3RhdGUuY29uc3RyYWludHNbZGF0YS51dWlkXSkgewogICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBzdGF0ZS5jb25zdHJhaW50c1tkYXRhLnV1aWRdKTsKICAgICAgICAgIGRlbGV0ZSBzdGF0ZS5jb25zdHJhaW50c1tkYXRhLnV1aWRdOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgY2FzZSAnZW5hYmxlQ29uc3RyYWludCc6CiAgICAgICAgc3RhdGUud29ybGQuY29uc3RyYWludHMuZmlsdGVyKGMgPT4gYy51dWlkID09PSBkYXRhLnV1aWQpLm1hcChjID0+IGMuZW5hYmxlKCkpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdkaXNhYmxlQ29uc3RyYWludCc6CiAgICAgICAgc3RhdGUud29ybGQuY29uc3RyYWludHMuZmlsdGVyKGMgPT4gYy51dWlkID09PSBkYXRhLnV1aWQpLm1hcChjID0+IGMuZGlzYWJsZSgpKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnZW5hYmxlQ29uc3RyYWludE1vdG9yJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLmVuYWJsZU1vdG9yKCkpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdkaXNhYmxlQ29uc3RyYWludE1vdG9yJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLmRpc2FibGVNb3RvcigpKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0Q29uc3RyYWludE1vdG9yU3BlZWQnOgogICAgICAgIHN0YXRlLndvcmxkLmNvbnN0cmFpbnRzLmZpbHRlcihjID0+IGMudXVpZCA9PT0gZGF0YS51dWlkKS5maWx0ZXIoaXNIaW5nZUNvbnN0cmFpbnQpLm1hcChjID0+IGMuc2V0TW90b3JTcGVlZChkYXRhLnByb3BzKSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldENvbnN0cmFpbnRNb3Rvck1heEZvcmNlJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLnNldE1vdG9yTWF4Rm9yY2UoZGF0YS5wcm9wcykpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdhZGRTcHJpbmcnOgogICAgICAgIHsKICAgICAgICAgIGFkZFNwcmluZyhzdGF0ZSwgZGF0YSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3NldFNwcmluZ1N0aWZmbmVzcyc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuc3ByaW5nSW5zdGFuY2VzW2RhdGEudXVpZF0uc3RpZmZuZXNzID0gZGF0YS5wcm9wczsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnc2V0U3ByaW5nUmVzdExlbmd0aCc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuc3ByaW5nSW5zdGFuY2VzW2RhdGEudXVpZF0ucmVzdExlbmd0aCA9IGRhdGEucHJvcHM7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3NldFNwcmluZ0RhbXBpbmcnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLnNwcmluZ0luc3RhbmNlc1tkYXRhLnV1aWRdLmRhbXBpbmcgPSBkYXRhLnByb3BzOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdyZW1vdmVTcHJpbmcnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgc3RhdGUuc3ByaW5nc1tkYXRhLnV1aWRdKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnYWRkUmF5JzoKICAgICAgICB7CiAgICAgICAgICBhZGRSYXkoc3RhdGUsIGRhdGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdyZW1vdmVSYXknOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3ByZVN0ZXAnLCBzdGF0ZS5yYXlzW2RhdGEudXVpZF0pOwogICAgICAgICAgZGVsZXRlIHN0YXRlLnJheXNbZGF0YS51dWlkXTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnYWRkUmF5Y2FzdFZlaGljbGUnOgogICAgICAgIHsKICAgICAgICAgIGFkZFJheWNhc3RWZWhpY2xlKHN0YXRlLCBkYXRhKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAncmVtb3ZlUmF5Y2FzdFZlaGljbGUnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3ByZVN0ZXAnLCBzdGF0ZS52ZWhpY2xlc1tkYXRhLnV1aWRdLnByZVN0ZXApOwogICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBzdGF0ZS52ZWhpY2xlc1tkYXRhLnV1aWRdLnBvc3RTdGVwKTsKICAgICAgICAgIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0udmVoaWNsZS53b3JsZCA9IG51bGw7CiAgICAgICAgICBkZWxldGUgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXTsKICAgICAgICAgIGNvbnN0IGtleSA9IE9iamVjdC5rZXlzKHN0YXRlLnN1YnNjcmlwdGlvbnMpLmZpbmQoayA9PiBzdGF0ZS5zdWJzY3JpcHRpb25zW2tdWzBdID09PSBkYXRhLnV1aWQpOwogICAgICAgICAgaWYgKGtleSkgewogICAgICAgICAgICBkZWxldGUgc3RhdGUuc3Vic2NyaXB0aW9uc1trZXldOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdzZXRSYXljYXN0VmVoaWNsZVN0ZWVyaW5nVmFsdWUnOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IFt2YWx1ZSwgd2hlZWxJbmRleF0gPSBkYXRhLnByb3BzOwogICAgICAgICAgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXS52ZWhpY2xlLnNldFN0ZWVyaW5nVmFsdWUodmFsdWUsIHdoZWVsSW5kZXgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdhcHBseVJheWNhc3RWZWhpY2xlRW5naW5lRm9yY2UnOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IFt2YWx1ZSwgd2hlZWxJbmRleF0gPSBkYXRhLnByb3BzOwogICAgICAgICAgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXS52ZWhpY2xlLmFwcGx5RW5naW5lRm9yY2UodmFsdWUsIHdoZWVsSW5kZXgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdzZXRSYXljYXN0VmVoaWNsZUJyYWtlJzoKICAgICAgICB7CiAgICAgICAgICBjb25zdCBbYnJha2UsIHdoZWVsSW5kZXhdID0gZGF0YS5wcm9wczsKICAgICAgICAgIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0udmVoaWNsZS5zZXRCcmFrZShicmFrZSwgd2hlZWxJbmRleCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ2FkZENvbnRhY3RNYXRlcmlhbCc6CiAgICAgICAgewogICAgICAgICAgYWRkQ29udGFjdE1hdGVyaWFsKHN0YXRlLndvcmxkLCBjcmVhdGVNYXRlcmlhbCwgZGF0YS5wcm9wcywgZGF0YS51dWlkKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAncmVtb3ZlQ29udGFjdE1hdGVyaWFsJzoKICAgICAgICB7CiAgICAgICAgICByZW1vdmVDb250YWN0TWF0ZXJpYWwoc3RhdGUud29ybGQsIGRhdGEudXVpZCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3dha2VVcCc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ud2FrZVVwKCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3NsZWVwJzoKICAgICAgICB7CiAgICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5zbGVlcCgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgfQogIH07Cgp9KSgpOwoK",
        zg = null,
        fg = !1,
        function(g) {
            return kg = kg || Ng(Sg, zg, fg),
            new Worker(kg,g)
        }
        ), Lg = function(g) {
            function I(g) {
                var C;
                ig(this, I);
                var A = g.allowSleep
                  , e = void 0 !== A && A
                  , o = g.axisIndex
                  , i = void 0 === o ? 0 : o
                  , t = g.broadphase
                  , n = void 0 === t ? "Naive" : t
                  , l = g.defaultContactMaterial
                  , c = void 0 === l ? {
                    contactEquationStiffness: 1e6
                } : l
                  , a = g.frictionGravity
                  , s = void 0 === a ? null : a
                  , d = g.gravity
                  , b = void 0 === d ? [0, -9.81, 0] : d
                  , G = g.iterations
                  , r = void 0 === G ? 5 : G
                  , u = g.quatNormalizeFast
                  , B = void 0 !== u && u
                  , Z = g.quatNormalizeSkip
                  , m = void 0 === Z ? 0 : Z
                  , h = g.size
                  , p = void 0 === h ? 1e3 : h
                  , y = g.solver
                  , W = void 0 === y ? "GS" : y
                  , v = g.tolerance
                  , V = void 0 === v ? .001 : v;
                return bg(C = lg(this, I), "messageQueue", []),
                bg(C, "worker", null),
                C.config = {
                    allowSleep: e,
                    axisIndex: i,
                    broadphase: n,
                    defaultContactMaterial: c,
                    frictionGravity: s,
                    gravity: b,
                    iterations: r,
                    quatNormalizeFast: B,
                    quatNormalizeSkip: m,
                    size: p,
                    solver: W,
                    tolerance: V
                },
                C.buffers = {
                    positions: new Float32Array(3 * p),
                    quaternions: new Float32Array(4 * p)
                },
                C
            }
            return sg(I, g),
            ng(I, [{
                key: "axisIndex",
                get: function() {
                    return this.config.axisIndex
                },
                set: function(g) {
                    this.config.axisIndex = g,
                    this.postMessage({
                        op: "setAxisIndex",
                        props: g
                    })
                }
            }, {
                key: "broadphase",
                get: function() {
                    return this.config.broadphase
                },
                set: function(g) {
                    this.config.broadphase = g,
                    this.postMessage({
                        op: "setBroadphase",
                        props: g
                    })
                }
            }, {
                key: "frictionGravity",
                get: function() {
                    return this.config.frictionGravity
                },
                set: function(g) {
                    this.config.frictionGravity = g,
                    this.postMessage({
                        op: "setFrictionGravity",
                        props: g
                    })
                }
            }, {
                key: "gravity",
                get: function() {
                    return this.config.gravity
                },
                set: function(g) {
                    this.config.gravity = g,
                    this.postMessage({
                        op: "setGravity",
                        props: g
                    })
                }
            }, {
                key: "iterations",
                get: function() {
                    return this.config.iterations
                },
                set: function(g) {
                    this.config.iterations = g,
                    this.postMessage({
                        op: "setIterations",
                        props: g
                    })
                }
            }, {
                key: "tolerance",
                get: function() {
                    return this.config.tolerance
                },
                set: function(g) {
                    this.config.tolerance = g,
                    this.postMessage({
                        op: "setTolerance",
                        props: g
                    })
                }
            }, {
                key: "addBodies",
                value: function(g) {
                    var I = g.props
                      , C = g.type
                      , A = g.uuid;
                    this.postMessage({
                        op: "addBodies",
                        props: I,
                        type: C,
                        uuid: A
                    })
                }
            }, {
                key: "addConstraint",
                value: function(g) {
                    var I = Ag(g.props, 3)
                      , C = I[0]
                      , A = I[1]
                      , e = I[2]
                      , o = g.type
                      , i = g.uuid;
                    this.postMessage({
                        op: "addConstraint",
                        props: [C, A, e],
                        type: o,
                        uuid: i
                    })
                }
            }, {
                key: "addContactMaterial",
                value: function(g) {
                    var I = g.props
                      , C = g.uuid;
                    this.postMessage({
                        op: "addContactMaterial",
                        props: I,
                        uuid: C
                    })
                }
            }, {
                key: "addRay",
                value: function(g) {
                    var I = g.props
                      , C = g.uuid;
                    this.postMessage({
                        op: "addRay",
                        props: I,
                        uuid: C
                    })
                }
            }, {
                key: "addRaycastVehicle",
                value: function(g) {
                    var I = Ag(g.props, 6)
                      , C = I[0]
                      , A = I[1]
                      , e = I[2]
                      , o = I[3]
                      , i = I[4]
                      , t = I[5]
                      , n = g.uuid;
                    this.postMessage({
                        op: "addRaycastVehicle",
                        props: [C, A, e, o, i, t],
                        uuid: n
                    })
                }
            }, {
                key: "addSpring",
                value: function(g) {
                    var I = Ag(g.props, 3)
                      , C = I[0]
                      , A = I[1]
                      , e = I[2]
                      , o = g.uuid;
                    this.postMessage({
                        op: "addSpring",
                        props: [C, A, e],
                        uuid: o
                    })
                }
            }, {
                key: "applyForce",
                value: function(g) {
                    var I = g.props
                      , C = g.uuid;
                    this.postMessage({
                        op: "applyForce",
                        props: I,
                        uuid: C
                    })
                }
            }, {
                key: "applyImpulse",
                value: function(g) {
                    var I = g.props
                      , C = g.uuid;
                    this.postMessage({
                        op: "applyImpulse",
                        props: I,
                        uuid: C
                    })
                }
            }, {
                key: "applyLocalForce",
                value: function(g) {
                    var I = g.props
                      , C = g.uuid;
                    this.postMessage({
                        op: "applyLocalForce",
                        props: I,
                        uuid: C
                    })
                }
            }, {
                key: "applyLocalImpulse",
                value: function(g) {
                    var I = g.props
                      , C = g.uuid;
                    this.postMessage({
                        op: "applyLocalImpulse",
                        props: I,
                        uuid: C
                    })
                }
            }, {
                key: "applyRaycastVehicleEngineForce",
                value: function(g) {
                    var I = g.props
                      , C = g.uuid;
                    this.postMessage({
                        op: "applyRaycastVehicleEngineForce",
                        props: I,
                        uuid: C
                    })
                }
            }, {
                key: "applyTorque",
                value: function(g) {
                    var I = g.props
                      , C = g.uuid;
                    this.postMessage({
                        op: "applyTorque",
                        props: I,
                        uuid: C
                    })
                }
            }, {
                key: "connect",
                value: function() {
                    var g = this;
                    this.worker = new Jg,
                    this.worker.onmessage = function(I) {
                        if ("frame" === I.data.op)
                            return g.buffers.positions = I.data.positions,
                            g.buffers.quaternions = I.data.quaternions,
                            void g.emit(I.data.op, I.data);
                        g.emit(I.data.type, I.data)
                    }
                    ;
                    var I, C = Cg(this.messageQueue);
                    try {
                        for (C.s(); !(I = C.n()).done; ) {
                            var A = I.value;
                            this.worker.postMessage(A)
                        }
                    } catch (g) {
                        C.e(g)
                    } finally {
                        C.f()
                    }
                    this.messageQueue.length = 0
                }
            }, {
                key: "disableConstraint",
                value: function(g) {
                    var I = g.uuid;
                    this.postMessage({
                        op: "disableConstraint",
                        uuid: I
                    })
                }
            }, {
                key: "disableConstraintMotor",
                value: function(g) {
                    var I = g.uuid;
                    this.postMessage({
                        op: "disableConstraintMotor",
                        uuid: I
                    })
                }
            }, {
                key: "disconnect",
                value: function() {
                    this.worker && (this.worker.onmessage = null)
                }
            }, {
                key: "enableConstraint",
                value: function(g) {
                    var I = g.uuid;
                    this.postMessage({
                        op: "enableConstraint",
                        uuid: I
                    })
                }
            }, {
                key: "enableConstraintMotor",
                value: function(g) {
                    var I = g.uuid;
                    this.postMessage({
                        op: "enableConstraintMotor",
                        uuid: I
                    })
                }
            }, {
                key: "init",
                value: function() {
                    var g = this.config
                      , I = g.allowSleep
                      , C = g.axisIndex
                      , A = g.broadphase
                      , e = g.defaultContactMaterial
                      , o = g.frictionGravity
                      , i = g.gravity
                      , t = g.iterations
                      , n = g.quatNormalizeFast
                      , l = g.quatNormalizeSkip
                      , c = g.solver
                      , a = g.tolerance;
                    this.postMessage({
                        op: "init",
                        props: {
                            allowSleep: I,
                            axisIndex: C,
                            broadphase: A,
                            defaultContactMaterial: e,
                            frictionGravity: o,
                            gravity: i,
                            iterations: t,
                            quatNormalizeFast: n,
                            quatNormalizeSkip: l,
                            solver: c,
                            tolerance: a
                        }
                    })
                }
            }, {
                key: "removeBodies",
                value: function(g) {
                    var I = g.uuid;
                    this.postMessage({
                        op: "removeBodies",
                        uuid: I
                    })
                }
            }, {
                key: "removeConstraint",
                value: function(g) {
                    var I = g.uuid;
                    this.postMessage({
                        op: "removeConstraint",
                        uuid: I
                    })
                }
            }, {
                key: "removeContactMaterial",
                value: function(g) {
                    var I = g.uuid;
                    this.postMessage({
                        op: "removeContactMaterial",
                        uuid: I
                    })
                }
            }, {
                key: "removeRay",
                value: function(g) {
                    var I = g.uuid;
                    this.postMessage({
                        op: "removeRay",
                        uuid: I
                    })
                }
            }, {
                key: "removeRaycastVehicle",
                value: function(g) {
                    var I = g.uuid;
                    this.postMessage({
                        op: "removeRaycastVehicle",
                        uuid: I
                    })
                }
            }, {
                key: "removeSpring",
                value: function(g) {
                    var I = g.uuid;
                    this.postMessage({
                        op: "removeSpring",
                        uuid: I
                    })
                }
            }, {
                key: "setAllowSleep",
                value: function(g) {
                    var I = g.props
                      , C = g.uuid;
                    this.postMessage({
                        op: "setAllowSleep",
                        props: I,
                        uuid: C
                    })
                }
            }, {
                key: "setAngularDamping",
                value: function(g) {
                    var I = g.props
                      , C = g.uuid;
                    this.postMessage({
                        op: "setAngularDamping",
                        props: I,
                        uuid: C
                    })
                }
            }, {
                key: "setAngularFactor",
                value: function(g) {
                    var I = g.props
                      , C = g.uuid;
                    this.postMessage({
                        op: "setAngularFactor",
                        props: I,
                        uuid: C
                    })
                }
            }, {
                key: "setAngularVelocity",
                value: function(g) {
                    var I = g.props
                      , C = g.uuid;
                    this.postMessage({
                        op: "setAngularVelocity",
                        props: I,
                        uuid: C
                    })
                }
            }, {
                key: "setCollisionFilterGroup",
                value: function(g) {
                    var I = g.props
                      , C = g.uuid;
                    this.postMessage({
                        op: "setCollisionFilterGroup",
                        props: I,
                        uuid: C
                    })
                }
            }, {
                key: "setCollisionFilterMask",
                value: function(g) {
                    var I = g.props
                      , C = g.uuid;
                    this.postMessage({
                        op: "setCollisionFilterMask",
                        props: I,
                        uuid: C
                    })
                }
            }, {
                key: "setCollisionResponse",
                value: function(g) {
                    var I = g.props
                      , C = g.uuid;
                    this.postMessage({
                        op: "setCollisionResponse",
                        props: I,
                        uuid: C
                    })
                }
            }, {
                key: "setConstraintMotorMaxForce",
                value: function(g) {
                    var I = g.props
                      , C = g.uuid;
                    this.postMessage({
                        op: "setConstraintMotorMaxForce",
                        props: I,
                        uuid: C
                    })
                }
            }, {
                key: "setConstraintMotorSpeed",
                value: function(g) {
                    var I = g.props
                      , C = g.uuid;
                    this.postMessage({
                        op: "setConstraintMotorSpeed",
                        props: I,
                        uuid: C
                    })
                }
            }, {
                key: "setFixedRotation",
                value: function(g) {
                    var I = g.props
                      , C = g.uuid;
                    this.postMessage({
                        op: "setFixedRotation",
                        props: I,
                        uuid: C
                    })
                }
            }, {
                key: "setIsTrigger",
                value: function(g) {
                    var I = g.props
                      , C = g.uuid;
                    this.postMessage({
                        op: "setIsTrigger",
                        props: I,
                        uuid: C
                    })
                }
            }, {
                key: "setLinearDamping",
                value: function(g) {
                    var I = g.props
                      , C = g.uuid;
                    this.postMessage({
                        op: "setLinearDamping",
                        props: I,
                        uuid: C
                    })
                }
            }, {
                key: "setLinearFactor",
                value: function(g) {
                    var I = g.props
                      , C = g.uuid;
                    this.postMessage({
                        op: "setLinearFactor",
                        props: I,
                        uuid: C
                    })
                }
            }, {
                key: "setMass",
                value: function(g) {
                    var I = g.props
                      , C = g.uuid;
                    this.postMessage({
                        op: "setMass",
                        props: I,
                        uuid: C
                    })
                }
            }, {
                key: "setMaterial",
                value: function(g) {
                    var I = g.props
                      , C = g.uuid;
                    this.postMessage({
                        op: "setMaterial",
                        props: I,
                        uuid: C
                    })
                }
            }, {
                key: "setPosition",
                value: function(g) {
                    var I = g.props
                      , C = g.uuid;
                    this.postMessage({
                        op: "setPosition",
                        props: I,
                        uuid: C
                    })
                }
            }, {
                key: "setQuaternion",
                value: function(g) {
                    var I = Ag(g.props, 4)
                      , C = I[0]
                      , A = I[1]
                      , e = I[2]
                      , o = I[3]
                      , i = g.uuid;
                    this.postMessage({
                        op: "setQuaternion",
                        props: [C, A, e, o],
                        uuid: i
                    })
                }
            }, {
                key: "setRaycastVehicleBrake",
                value: function(g) {
                    var I = g.props
                      , C = g.uuid;
                    this.postMessage({
                        op: "setRaycastVehicleBrake",
                        props: I,
                        uuid: C
                    })
                }
            }, {
                key: "setRaycastVehicleSteeringValue",
                value: function(g) {
                    var I = g.props
                      , C = g.uuid;
                    this.postMessage({
                        op: "setRaycastVehicleSteeringValue",
                        props: I,
                        uuid: C
                    })
                }
            }, {
                key: "setRotation",
                value: function(g) {
                    var I = g.props
                      , C = g.uuid;
                    this.postMessage({
                        op: "setRotation",
                        props: I,
                        uuid: C
                    })
                }
            }, {
                key: "setSleepSpeedLimit",
                value: function(g) {
                    var I = g.props
                      , C = g.uuid;
                    this.postMessage({
                        op: "setSleepSpeedLimit",
                        props: I,
                        uuid: C
                    })
                }
            }, {
                key: "setSleepTimeLimit",
                value: function(g) {
                    var I = g.props
                      , C = g.uuid;
                    this.postMessage({
                        op: "setSleepTimeLimit",
                        props: I,
                        uuid: C
                    })
                }
            }, {
                key: "setSpringDamping",
                value: function(g) {
                    var I = g.props
                      , C = g.uuid;
                    this.postMessage({
                        op: "setSpringDamping",
                        props: I,
                        uuid: C
                    })
                }
            }, {
                key: "setSpringRestLength",
                value: function(g) {
                    var I = g.props
                      , C = g.uuid;
                    this.postMessage({
                        op: "setSpringRestLength",
                        props: I,
                        uuid: C
                    })
                }
            }, {
                key: "setSpringStiffness",
                value: function(g) {
                    var I = g.props
                      , C = g.uuid;
                    this.postMessage({
                        op: "setSpringStiffness",
                        props: I,
                        uuid: C
                    })
                }
            }, {
                key: "setUserData",
                value: function(g) {
                    var I = g.props
                      , C = g.uuid;
                    this.postMessage({
                        op: "setUserData",
                        props: I,
                        uuid: C
                    })
                }
            }, {
                key: "setVelocity",
                value: function(g) {
                    var I = g.props
                      , C = g.uuid;
                    this.postMessage({
                        op: "setVelocity",
                        props: I,
                        uuid: C
                    })
                }
            }, {
                key: "sleep",
                value: function(g) {
                    var I = g.uuid;
                    this.postMessage({
                        op: "sleep",
                        uuid: I
                    })
                }
            }, {
                key: "step",
                value: function(g) {
                    var I, C = this.buffers, A = C.positions, e = C.quaternions;
                    (A.byteLength || e.byteLength) && (null == (I = this.worker) || I.postMessage({
                        op: "step",
                        positions: A,
                        props: g,
                        quaternions: e
                    }, [A.buffer, e.buffer]))
                }
            }, {
                key: "subscribe",
                value: function(g) {
                    var I = g.props
                      , C = I.id
                      , A = I.target
                      , e = I.type
                      , o = g.uuid;
                    this.postMessage({
                        op: "subscribe",
                        props: {
                            id: C,
                            target: A,
                            type: e
                        },
                        uuid: o
                    })
                }
            }, {
                key: "terminate",
                value: function() {
                    var g;
                    null == (g = this.worker) || g.terminate(),
                    this.worker = null
                }
            }, {
                key: "unsubscribe",
                value: function(g) {
                    var I = g.props;
                    this.postMessage({
                        op: "unsubscribe",
                        props: I
                    })
                }
            }, {
                key: "wakeUp",
                value: function(g) {
                    var I = g.uuid;
                    this.postMessage({
                        op: "wakeUp",
                        uuid: I
                    })
                }
            }, {
                key: "postMessage",
                value: function(g) {
                    if (this.worker)
                        return this.worker.postMessage(g);
                    this.messageQueue.push(g)
                }
            }])
        }(Fg), xg = function() {
            function g(I) {
                ig(this, g),
                void 0 === I && (I = [0, 0, 0, 0, 0, 0, 0, 0, 0]),
                this.elements = I
            }
            return ng(g, [{
                key: "identity",
                value: function() {
                    var g = this.elements;
                    g[0] = 1,
                    g[1] = 0,
                    g[2] = 0,
                    g[3] = 0,
                    g[4] = 1,
                    g[5] = 0,
                    g[6] = 0,
                    g[7] = 0,
                    g[8] = 1
                }
            }, {
                key: "setZero",
                value: function() {
                    var g = this.elements;
                    g[0] = 0,
                    g[1] = 0,
                    g[2] = 0,
                    g[3] = 0,
                    g[4] = 0,
                    g[5] = 0,
                    g[6] = 0,
                    g[7] = 0,
                    g[8] = 0
                }
            }, {
                key: "setTrace",
                value: function(g) {
                    var I = this.elements;
                    I[0] = g.x,
                    I[4] = g.y,
                    I[8] = g.z
                }
            }, {
                key: "getTrace",
                value: function(g) {
                    void 0 === g && (g = new Qg);
                    var I = this.elements;
                    return g.x = I[0],
                    g.y = I[4],
                    g.z = I[8],
                    g
                }
            }, {
                key: "vmult",
                value: function(g, I) {
                    void 0 === I && (I = new Qg);
                    var C = this.elements
                      , A = g.x
                      , e = g.y
                      , o = g.z;
                    return I.x = C[0] * A + C[1] * e + C[2] * o,
                    I.y = C[3] * A + C[4] * e + C[5] * o,
                    I.z = C[6] * A + C[7] * e + C[8] * o,
                    I
                }
            }, {
                key: "smult",
                value: function(g) {
                    for (var I = 0; I < this.elements.length; I++)
                        this.elements[I] *= g
                }
            }, {
                key: "mmult",
                value: function(I, C) {
                    void 0 === C && (C = new g);
                    var A = this.elements
                      , e = I.elements
                      , o = C.elements
                      , i = A[0]
                      , t = A[1]
                      , n = A[2]
                      , l = A[3]
                      , c = A[4]
                      , a = A[5]
                      , s = A[6]
                      , d = A[7]
                      , b = A[8]
                      , G = e[0]
                      , r = e[1]
                      , u = e[2]
                      , B = e[3]
                      , Z = e[4]
                      , m = e[5]
                      , h = e[6]
                      , p = e[7]
                      , y = e[8];
                    return o[0] = i * G + t * B + n * h,
                    o[1] = i * r + t * Z + n * p,
                    o[2] = i * u + t * m + n * y,
                    o[3] = l * G + c * B + a * h,
                    o[4] = l * r + c * Z + a * p,
                    o[5] = l * u + c * m + a * y,
                    o[6] = s * G + d * B + b * h,
                    o[7] = s * r + d * Z + b * p,
                    o[8] = s * u + d * m + b * y,
                    C
                }
            }, {
                key: "scale",
                value: function(I, C) {
                    void 0 === C && (C = new g);
                    for (var A = this.elements, e = C.elements, o = 0; 3 !== o; o++)
                        e[3 * o + 0] = I.x * A[3 * o + 0],
                        e[3 * o + 1] = I.y * A[3 * o + 1],
                        e[3 * o + 2] = I.z * A[3 * o + 2];
                    return C
                }
            }, {
                key: "solve",
                value: function(g, I) {
                    void 0 === I && (I = new Qg);
                    var C, A, e = [];
                    for (C = 0; C < 12; C++)
                        e.push(0);
                    for (C = 0; C < 3; C++)
                        for (A = 0; A < 3; A++)
                            e[C + 4 * A] = this.elements[C + 3 * A];
                    e[3] = g.x,
                    e[7] = g.y,
                    e[11] = g.z;
                    var o, i, t = 3, n = t;
                    do {
                        if (0 === e[(C = n - t) + 4 * C])
                            for (A = C + 1; A < n; A++)
                                if (0 !== e[C + 4 * A]) {
                                    o = 4;
                                    do {
                                        e[(i = 4 - o) + 4 * C] += e[i + 4 * A]
                                    } while (--o);
                                    break
                                }
                        if (0 !== e[C + 4 * C])
                            for (A = C + 1; A < n; A++) {
                                var l = e[C + 4 * A] / e[C + 4 * C];
                                o = 4;
                                do {
                                    e[(i = 4 - o) + 4 * A] = i <= C ? 0 : e[i + 4 * A] - e[i + 4 * C] * l
                                } while (--o)
                            }
                    } while (--t);
                    if (I.z = e[11] / e[10],
                    I.y = (e[7] - e[6] * I.z) / e[5],
                    I.x = (e[3] - e[2] * I.z - e[1] * I.y) / e[0],
                    isNaN(I.x) || isNaN(I.y) || isNaN(I.z) || I.x === 1 / 0 || I.y === 1 / 0 || I.z === 1 / 0)
                        throw "Could not solve equation! Got x=[".concat(I.toString(), "], b=[").concat(g.toString(), "], A=[").concat(this.toString(), "]");
                    return I
                }
            }, {
                key: "e",
                value: function(g, I, C) {
                    if (void 0 === C)
                        return this.elements[I + 3 * g];
                    this.elements[I + 3 * g] = C
                }
            }, {
                key: "copy",
                value: function(g) {
                    for (var I = 0; I < g.elements.length; I++)
                        this.elements[I] = g.elements[I];
                    return this
                }
            }, {
                key: "toString",
                value: function() {
                    for (var g = "", I = 0; I < 9; I++)
                        g += this.elements[I] + ",";
                    return g
                }
            }, {
                key: "reverse",
                value: function(I) {
                    void 0 === I && (I = new g);
                    var C, A, e = Mg;
                    for (C = 0; C < 3; C++)
                        for (A = 0; A < 3; A++)
                            e[C + 6 * A] = this.elements[C + 3 * A];
                    e[3] = 1,
                    e[9] = 0,
                    e[15] = 0,
                    e[4] = 0,
                    e[10] = 1,
                    e[16] = 0,
                    e[5] = 0,
                    e[11] = 0,
                    e[17] = 1;
                    var o, i, t = 3, n = t;
                    do {
                        if (0 === e[(C = n - t) + 6 * C])
                            for (A = C + 1; A < n; A++)
                                if (0 !== e[C + 6 * A]) {
                                    o = 6;
                                    do {
                                        e[(i = 6 - o) + 6 * C] += e[i + 6 * A]
                                    } while (--o);
                                    break
                                }
                        if (0 !== e[C + 6 * C])
                            for (A = C + 1; A < n; A++) {
                                var l = e[C + 6 * A] / e[C + 6 * C];
                                o = 6;
                                do {
                                    e[(i = 6 - o) + 6 * A] = i <= C ? 0 : e[i + 6 * A] - e[i + 6 * C] * l
                                } while (--o)
                            }
                    } while (--t);
                    C = 2;
                    do {
                        A = C - 1;
                        do {
                            var c = e[C + 6 * A] / e[C + 6 * C];
                            o = 6;
                            do {
                                e[(i = 6 - o) + 6 * A] = e[i + 6 * A] - e[i + 6 * C] * c
                            } while (--o)
                        } while (A--)
                    } while (--C);
                    C = 2;
                    do {
                        var a = 1 / e[C + 6 * C];
                        o = 6;
                        do {
                            e[(i = 6 - o) + 6 * C] = e[i + 6 * C] * a
                        } while (--o)
                    } while (C--);
                    C = 2;
                    do {
                        A = 2;
                        do {
                            if (i = e[3 + A + 6 * C],
                            isNaN(i) || i === 1 / 0)
                                throw "Could not reverse! A=[".concat(this.toString(), "]");
                            I.e(C, A, i)
                        } while (A--)
                    } while (C--);
                    return I
                }
            }, {
                key: "setRotationFromQuaternion",
                value: function(g) {
                    var I = g.x
                      , C = g.y
                      , A = g.z
                      , e = g.w
                      , o = I + I
                      , i = C + C
                      , t = A + A
                      , n = I * o
                      , l = I * i
                      , c = I * t
                      , a = C * i
                      , s = C * t
                      , d = A * t
                      , b = e * o
                      , G = e * i
                      , r = e * t
                      , u = this.elements;
                    return u[0] = 1 - (a + d),
                    u[1] = l - r,
                    u[2] = c + G,
                    u[3] = l + r,
                    u[4] = 1 - (n + d),
                    u[5] = s - b,
                    u[6] = c - G,
                    u[7] = s + b,
                    u[8] = 1 - (n + a),
                    this
                }
            }, {
                key: "transpose",
                value: function(I) {
                    void 0 === I && (I = new g);
                    var C, A = this.elements, e = I.elements;
                    return e[0] = A[0],
                    e[4] = A[4],
                    e[8] = A[8],
                    C = A[1],
                    e[1] = A[3],
                    e[3] = C,
                    C = A[2],
                    e[2] = A[6],
                    e[6] = C,
                    C = A[5],
                    e[5] = A[7],
                    e[7] = C,
                    I
                }
            }])
        }(), Mg = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], Qg = function() {
            function g(I, C, A) {
                ig(this, g),
                void 0 === I && (I = 0),
                void 0 === C && (C = 0),
                void 0 === A && (A = 0),
                this.x = I,
                this.y = C,
                this.z = A
            }
            return ng(g, [{
                key: "cross",
                value: function(I, C) {
                    void 0 === C && (C = new g);
                    var A = I.x
                      , e = I.y
                      , o = I.z
                      , i = this.x
                      , t = this.y
                      , n = this.z;
                    return C.x = t * o - n * e,
                    C.y = n * A - i * o,
                    C.z = i * e - t * A,
                    C
                }
            }, {
                key: "set",
                value: function(g, I, C) {
                    return this.x = g,
                    this.y = I,
                    this.z = C,
                    this
                }
            }, {
                key: "setZero",
                value: function() {
                    this.x = this.y = this.z = 0
                }
            }, {
                key: "vadd",
                value: function(I, C) {
                    if (!C)
                        return new g(this.x + I.x,this.y + I.y,this.z + I.z);
                    C.x = I.x + this.x,
                    C.y = I.y + this.y,
                    C.z = I.z + this.z
                }
            }, {
                key: "vsub",
                value: function(I, C) {
                    if (!C)
                        return new g(this.x - I.x,this.y - I.y,this.z - I.z);
                    C.x = this.x - I.x,
                    C.y = this.y - I.y,
                    C.z = this.z - I.z
                }
            }, {
                key: "crossmat",
                value: function() {
                    return new xg([0, -this.z, this.y, this.z, 0, -this.x, -this.y, this.x, 0])
                }
            }, {
                key: "normalize",
                value: function() {
                    var g = this.x
                      , I = this.y
                      , C = this.z
                      , A = Math.sqrt(g * g + I * I + C * C);
                    if (A > 0) {
                        var e = 1 / A;
                        this.x *= e,
                        this.y *= e,
                        this.z *= e
                    } else
                        this.x = 0,
                        this.y = 0,
                        this.z = 0;
                    return A
                }
            }, {
                key: "unit",
                value: function(I) {
                    void 0 === I && (I = new g);
                    var C = this.x
                      , A = this.y
                      , e = this.z
                      , o = Math.sqrt(C * C + A * A + e * e);
                    return o > 0 ? (o = 1 / o,
                    I.x = C * o,
                    I.y = A * o,
                    I.z = e * o) : (I.x = 1,
                    I.y = 0,
                    I.z = 0),
                    I
                }
            }, {
                key: "length",
                value: function() {
                    var g = this.x
                      , I = this.y
                      , C = this.z;
                    return Math.sqrt(g * g + I * I + C * C)
                }
            }, {
                key: "lengthSquared",
                value: function() {
                    return this.dot(this)
                }
            }, {
                key: "distanceTo",
                value: function(g) {
                    var I = this.x
                      , C = this.y
                      , A = this.z
                      , e = g.x
                      , o = g.y
                      , i = g.z;
                    return Math.sqrt((e - I) * (e - I) + (o - C) * (o - C) + (i - A) * (i - A))
                }
            }, {
                key: "distanceSquared",
                value: function(g) {
                    var I = this.x
                      , C = this.y
                      , A = this.z
                      , e = g.x
                      , o = g.y
                      , i = g.z;
                    return (e - I) * (e - I) + (o - C) * (o - C) + (i - A) * (i - A)
                }
            }, {
                key: "scale",
                value: function(I, C) {
                    void 0 === C && (C = new g);
                    var A = this.x
                      , e = this.y
                      , o = this.z;
                    return C.x = I * A,
                    C.y = I * e,
                    C.z = I * o,
                    C
                }
            }, {
                key: "vmul",
                value: function(I, C) {
                    return void 0 === C && (C = new g),
                    C.x = I.x * this.x,
                    C.y = I.y * this.y,
                    C.z = I.z * this.z,
                    C
                }
            }, {
                key: "addScaledVector",
                value: function(I, C, A) {
                    return void 0 === A && (A = new g),
                    A.x = this.x + I * C.x,
                    A.y = this.y + I * C.y,
                    A.z = this.z + I * C.z,
                    A
                }
            }, {
                key: "dot",
                value: function(g) {
                    return this.x * g.x + this.y * g.y + this.z * g.z
                }
            }, {
                key: "isZero",
                value: function() {
                    return 0 === this.x && 0 === this.y && 0 === this.z
                }
            }, {
                key: "negate",
                value: function(I) {
                    return void 0 === I && (I = new g),
                    I.x = -this.x,
                    I.y = -this.y,
                    I.z = -this.z,
                    I
                }
            }, {
                key: "tangents",
                value: function(g, I) {
                    var C = this.length();
                    if (C > 0) {
                        var A = jg
                          , e = 1 / C;
                        A.set(this.x * e, this.y * e, this.z * e);
                        var o = Ug;
                        Math.abs(A.x) < .9 ? (o.set(1, 0, 0),
                        A.cross(o, g)) : (o.set(0, 1, 0),
                        A.cross(o, g)),
                        A.cross(g, I)
                    } else
                        g.set(1, 0, 0),
                        I.set(0, 1, 0)
                }
            }, {
                key: "toString",
                value: function() {
                    return "".concat(this.x, ",").concat(this.y, ",").concat(this.z)
                }
            }, {
                key: "toArray",
                value: function() {
                    return [this.x, this.y, this.z]
                }
            }, {
                key: "copy",
                value: function(g) {
                    return this.x = g.x,
                    this.y = g.y,
                    this.z = g.z,
                    this
                }
            }, {
                key: "lerp",
                value: function(g, I, C) {
                    var A = this.x
                      , e = this.y
                      , o = this.z;
                    C.x = A + (g.x - A) * I,
                    C.y = e + (g.y - e) * I,
                    C.z = o + (g.z - o) * I
                }
            }, {
                key: "almostEquals",
                value: function(g, I) {
                    return void 0 === I && (I = 1e-6),
                    !(Math.abs(this.x - g.x) > I || Math.abs(this.y - g.y) > I || Math.abs(this.z - g.z) > I)
                }
            }, {
                key: "almostZero",
                value: function(g) {
                    return void 0 === g && (g = 1e-6),
                    !(Math.abs(this.x) > g || Math.abs(this.y) > g || Math.abs(this.z) > g)
                }
            }, {
                key: "isAntiparallelTo",
                value: function(g, I) {
                    return this.negate(Dg),
                    Dg.almostEquals(g, I)
                }
            }, {
                key: "clone",
                value: function() {
                    return new g(this.x,this.y,this.z)
                }
            }])
        }();
        Qg.ZERO = new Qg(0,0,0),
        Qg.UNIT_X = new Qg(1,0,0),
        Qg.UNIT_Y = new Qg(0,1,0),
        Qg.UNIT_Z = new Qg(0,0,1);
        var jg = new Qg
          , Ug = new Qg
          , Dg = new Qg
          , Tg = function() {
            function g(I) {
                ig(this, g),
                void 0 === I && (I = {}),
                this.lowerBound = new Qg,
                this.upperBound = new Qg,
                I.lowerBound && this.lowerBound.copy(I.lowerBound),
                I.upperBound && this.upperBound.copy(I.upperBound)
            }
            return ng(g, [{
                key: "setFromPoints",
                value: function(g, I, C, A) {
                    var e = this.lowerBound
                      , o = this.upperBound
                      , i = C;
                    e.copy(g[0]),
                    i && i.vmult(e, e),
                    o.copy(e);
                    for (var t = 1; t < g.length; t++) {
                        var n = g[t];
                        i && (i.vmult(n, Og),
                        n = Og),
                        n.x > o.x && (o.x = n.x),
                        n.x < e.x && (e.x = n.x),
                        n.y > o.y && (o.y = n.y),
                        n.y < e.y && (e.y = n.y),
                        n.z > o.z && (o.z = n.z),
                        n.z < e.z && (e.z = n.z)
                    }
                    return I && (I.vadd(e, e),
                    I.vadd(o, o)),
                    A && (e.x -= A,
                    e.y -= A,
                    e.z -= A,
                    o.x += A,
                    o.y += A,
                    o.z += A),
                    this
                }
            }, {
                key: "copy",
                value: function(g) {
                    return this.lowerBound.copy(g.lowerBound),
                    this.upperBound.copy(g.upperBound),
                    this
                }
            }, {
                key: "clone",
                value: function() {
                    return (new g).copy(this)
                }
            }, {
                key: "extend",
                value: function(g) {
                    this.lowerBound.x = Math.min(this.lowerBound.x, g.lowerBound.x),
                    this.upperBound.x = Math.max(this.upperBound.x, g.upperBound.x),
                    this.lowerBound.y = Math.min(this.lowerBound.y, g.lowerBound.y),
                    this.upperBound.y = Math.max(this.upperBound.y, g.upperBound.y),
                    this.lowerBound.z = Math.min(this.lowerBound.z, g.lowerBound.z),
                    this.upperBound.z = Math.max(this.upperBound.z, g.upperBound.z)
                }
            }, {
                key: "overlaps",
                value: function(g) {
                    var I = this.lowerBound
                      , C = this.upperBound
                      , A = g.lowerBound
                      , e = g.upperBound
                      , o = A.x <= C.x && C.x <= e.x || I.x <= e.x && e.x <= C.x
                      , i = A.y <= C.y && C.y <= e.y || I.y <= e.y && e.y <= C.y
                      , t = A.z <= C.z && C.z <= e.z || I.z <= e.z && e.z <= C.z;
                    return o && i && t
                }
            }, {
                key: "volume",
                value: function() {
                    var g = this.lowerBound
                      , I = this.upperBound;
                    return (I.x - g.x) * (I.y - g.y) * (I.z - g.z)
                }
            }, {
                key: "contains",
                value: function(g) {
                    var I = this.lowerBound
                      , C = this.upperBound
                      , A = g.lowerBound
                      , e = g.upperBound;
                    return I.x <= A.x && C.x >= e.x && I.y <= A.y && C.y >= e.y && I.z <= A.z && C.z >= e.z
                }
            }, {
                key: "getCorners",
                value: function(g, I, C, A, e, o, i, t) {
                    var n = this.lowerBound
                      , l = this.upperBound;
                    g.copy(n),
                    I.set(l.x, n.y, n.z),
                    C.set(l.x, l.y, n.z),
                    A.set(n.x, l.y, l.z),
                    e.set(l.x, n.y, l.z),
                    o.set(n.x, l.y, n.z),
                    i.set(n.x, n.y, l.z),
                    t.copy(l)
                }
            }, {
                key: "toLocalFrame",
                value: function(g, I) {
                    var C = Eg
                      , A = C[0]
                      , e = C[1]
                      , o = C[2]
                      , i = C[3]
                      , t = C[4]
                      , n = C[5]
                      , l = C[6]
                      , c = C[7];
                    this.getCorners(A, e, o, i, t, n, l, c);
                    for (var a = 0; 8 !== a; a++) {
                        var s = C[a];
                        g.pointToLocal(s, s)
                    }
                    return I.setFromPoints(C)
                }
            }, {
                key: "toWorldFrame",
                value: function(g, I) {
                    var C = Eg
                      , A = C[0]
                      , e = C[1]
                      , o = C[2]
                      , i = C[3]
                      , t = C[4]
                      , n = C[5]
                      , l = C[6]
                      , c = C[7];
                    this.getCorners(A, e, o, i, t, n, l, c);
                    for (var a = 0; 8 !== a; a++) {
                        var s = C[a];
                        g.pointToWorld(s, s)
                    }
                    return I.setFromPoints(C)
                }
            }, {
                key: "overlapsRay",
                value: function(g) {
                    var I = g.direction
                      , C = g.from
                      , A = 1 / I.x
                      , e = 1 / I.y
                      , o = 1 / I.z
                      , i = (this.lowerBound.x - C.x) * A
                      , t = (this.upperBound.x - C.x) * A
                      , n = (this.lowerBound.y - C.y) * e
                      , l = (this.upperBound.y - C.y) * e
                      , c = (this.lowerBound.z - C.z) * o
                      , a = (this.upperBound.z - C.z) * o
                      , s = Math.max(Math.max(Math.min(i, t), Math.min(n, l)), Math.min(c, a))
                      , d = Math.min(Math.min(Math.max(i, t), Math.max(n, l)), Math.max(c, a));
                    return !(d < 0) && !(s > d)
                }
            }])
        }()
          , Og = new Qg
          , Eg = [new Qg, new Qg, new Qg, new Qg, new Qg, new Qg, new Qg, new Qg]
          , Pg = function() {
            return ng((function g() {
                ig(this, g)
            }
            ), [{
                key: "addEventListener",
                value: function(g, I) {
                    void 0 === this._listeners && (this._listeners = {});
                    var C = this._listeners;
                    return void 0 === C[g] && (C[g] = []),
                    C[g].includes(I) || C[g].push(I),
                    this
                }
            }, {
                key: "hasEventListener",
                value: function(g, I) {
                    if (void 0 === this._listeners)
                        return !1;
                    var C = this._listeners;
                    return !(void 0 === C[g] || !C[g].includes(I))
                }
            }, {
                key: "hasAnyEventListener",
                value: function(g) {
                    return void 0 !== this._listeners && void 0 !== this._listeners[g]
                }
            }, {
                key: "removeEventListener",
                value: function(g, I) {
                    if (void 0 === this._listeners)
                        return this;
                    var C = this._listeners;
                    if (void 0 === C[g])
                        return this;
                    var A = C[g].indexOf(I);
                    return -1 !== A && C[g].splice(A, 1),
                    this
                }
            }, {
                key: "dispatchEvent",
                value: function(g) {
                    if (void 0 === this._listeners)
                        return this;
                    var I = this._listeners[g.type];
                    if (void 0 !== I) {
                        g.target = this;
                        for (var C = 0, A = I.length; C < A; C++)
                            I[C].call(this, g)
                    }
                    return this
                }
            }])
        }()
          , qg = function() {
            function g(I, C, A, e) {
                ig(this, g),
                void 0 === I && (I = 0),
                void 0 === C && (C = 0),
                void 0 === A && (A = 0),
                void 0 === e && (e = 1),
                this.x = I,
                this.y = C,
                this.z = A,
                this.w = e
            }
            return ng(g, [{
                key: "set",
                value: function(g, I, C, A) {
                    return this.x = g,
                    this.y = I,
                    this.z = C,
                    this.w = A,
                    this
                }
            }, {
                key: "toString",
                value: function() {
                    return "".concat(this.x, ",").concat(this.y, ",").concat(this.z, ",").concat(this.w)
                }
            }, {
                key: "toArray",
                value: function() {
                    return [this.x, this.y, this.z, this.w]
                }
            }, {
                key: "setFromAxisAngle",
                value: function(g, I) {
                    var C = Math.sin(.5 * I);
                    return this.x = g.x * C,
                    this.y = g.y * C,
                    this.z = g.z * C,
                    this.w = Math.cos(.5 * I),
                    this
                }
            }, {
                key: "toAxisAngle",
                value: function(g) {
                    void 0 === g && (g = new Qg),
                    this.normalize();
                    var I = 2 * Math.acos(this.w)
                      , C = Math.sqrt(1 - this.w * this.w);
                    return C < .001 ? (g.x = this.x,
                    g.y = this.y,
                    g.z = this.z) : (g.x = this.x / C,
                    g.y = this.y / C,
                    g.z = this.z / C),
                    [g, I]
                }
            }, {
                key: "setFromVectors",
                value: function(g, I) {
                    if (g.isAntiparallelTo(I)) {
                        var C = _g
                          , A = $g;
                        g.tangents(C, A),
                        this.setFromAxisAngle(C, Math.PI)
                    } else {
                        var e = g.cross(I);
                        this.x = e.x,
                        this.y = e.y,
                        this.z = e.z,
                        this.w = Math.sqrt(Math.pow(g.length(), 2) * Math.pow(I.length(), 2)) + g.dot(I),
                        this.normalize()
                    }
                    return this
                }
            }, {
                key: "mult",
                value: function(I, C) {
                    void 0 === C && (C = new g);
                    var A = this.x
                      , e = this.y
                      , o = this.z
                      , i = this.w
                      , t = I.x
                      , n = I.y
                      , l = I.z
                      , c = I.w;
                    return C.x = A * c + i * t + e * l - o * n,
                    C.y = e * c + i * n + o * t - A * l,
                    C.z = o * c + i * l + A * n - e * t,
                    C.w = i * c - A * t - e * n - o * l,
                    C
                }
            }, {
                key: "inverse",
                value: function(I) {
                    void 0 === I && (I = new g);
                    var C = this.x
                      , A = this.y
                      , e = this.z
                      , o = this.w;
                    this.conjugate(I);
                    var i = 1 / (C * C + A * A + e * e + o * o);
                    return I.x *= i,
                    I.y *= i,
                    I.z *= i,
                    I.w *= i,
                    I
                }
            }, {
                key: "conjugate",
                value: function(I) {
                    return void 0 === I && (I = new g),
                    I.x = -this.x,
                    I.y = -this.y,
                    I.z = -this.z,
                    I.w = this.w,
                    I
                }
            }, {
                key: "normalize",
                value: function() {
                    var g = Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w);
                    return 0 === g ? (this.x = 0,
                    this.y = 0,
                    this.z = 0,
                    this.w = 0) : (g = 1 / g,
                    this.x *= g,
                    this.y *= g,
                    this.z *= g,
                    this.w *= g),
                    this
                }
            }, {
                key: "normalizeFast",
                value: function() {
                    var g = (3 - (this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w)) / 2;
                    return 0 === g ? (this.x = 0,
                    this.y = 0,
                    this.z = 0,
                    this.w = 0) : (this.x *= g,
                    this.y *= g,
                    this.z *= g,
                    this.w *= g),
                    this
                }
            }, {
                key: "vmult",
                value: function(g, I) {
                    void 0 === I && (I = new Qg);
                    var C = g.x
                      , A = g.y
                      , e = g.z
                      , o = this.x
                      , i = this.y
                      , t = this.z
                      , n = this.w
                      , l = n * C + i * e - t * A
                      , c = n * A + t * C - o * e
                      , a = n * e + o * A - i * C
                      , s = -o * C - i * A - t * e;
                    return I.x = l * n + s * -o + c * -t - a * -i,
                    I.y = c * n + s * -i + a * -o - l * -t,
                    I.z = a * n + s * -t + l * -i - c * -o,
                    I
                }
            }, {
                key: "copy",
                value: function(g) {
                    return this.x = g.x,
                    this.y = g.y,
                    this.z = g.z,
                    this.w = g.w,
                    this
                }
            }, {
                key: "toEuler",
                value: function(g, I) {
                    var C, A, e;
                    void 0 === I && (I = "YZX");
                    var o = this.x
                      , i = this.y
                      , t = this.z
                      , n = this.w;
                    switch (I) {
                    case "YZX":
                        var l = o * i + t * n;
                        if (l > .499 && (C = 2 * Math.atan2(o, n),
                        A = Math.PI / 2,
                        e = 0),
                        l < -.499 && (C = -2 * Math.atan2(o, n),
                        A = -Math.PI / 2,
                        e = 0),
                        void 0 === C) {
                            var c = o * o
                              , a = i * i
                              , s = t * t;
                            C = Math.atan2(2 * i * n - 2 * o * t, 1 - 2 * a - 2 * s),
                            A = Math.asin(2 * l),
                            e = Math.atan2(2 * o * n - 2 * i * t, 1 - 2 * c - 2 * s)
                        }
                        break;
                    default:
                        throw new Error("Euler order ".concat(I, " not supported yet."))
                    }
                    g.y = C,
                    g.z = A,
                    g.x = e
                }
            }, {
                key: "setFromEuler",
                value: function(g, I, C, A) {
                    void 0 === A && (A = "XYZ");
                    var e = Math.cos(g / 2)
                      , o = Math.cos(I / 2)
                      , i = Math.cos(C / 2)
                      , t = Math.sin(g / 2)
                      , n = Math.sin(I / 2)
                      , l = Math.sin(C / 2);
                    return "XYZ" === A ? (this.x = t * o * i + e * n * l,
                    this.y = e * n * i - t * o * l,
                    this.z = e * o * l + t * n * i,
                    this.w = e * o * i - t * n * l) : "YXZ" === A ? (this.x = t * o * i + e * n * l,
                    this.y = e * n * i - t * o * l,
                    this.z = e * o * l - t * n * i,
                    this.w = e * o * i + t * n * l) : "ZXY" === A ? (this.x = t * o * i - e * n * l,
                    this.y = e * n * i + t * o * l,
                    this.z = e * o * l + t * n * i,
                    this.w = e * o * i - t * n * l) : "ZYX" === A ? (this.x = t * o * i - e * n * l,
                    this.y = e * n * i + t * o * l,
                    this.z = e * o * l - t * n * i,
                    this.w = e * o * i + t * n * l) : "YZX" === A ? (this.x = t * o * i + e * n * l,
                    this.y = e * n * i + t * o * l,
                    this.z = e * o * l - t * n * i,
                    this.w = e * o * i - t * n * l) : "XZY" === A && (this.x = t * o * i - e * n * l,
                    this.y = e * n * i - t * o * l,
                    this.z = e * o * l + t * n * i,
                    this.w = e * o * i + t * n * l),
                    this
                }
            }, {
                key: "clone",
                value: function() {
                    return new g(this.x,this.y,this.z,this.w)
                }
            }, {
                key: "slerp",
                value: function(I, C, A) {
                    void 0 === A && (A = new g);
                    var e, o, i, t, n, l = this.x, c = this.y, a = this.z, s = this.w, d = I.x, b = I.y, G = I.z, r = I.w;
                    return (o = l * d + c * b + a * G + s * r) < 0 && (o = -o,
                    d = -d,
                    b = -b,
                    G = -G,
                    r = -r),
                    1 - o > 1e-6 ? (e = Math.acos(o),
                    i = Math.sin(e),
                    t = Math.sin((1 - C) * e) / i,
                    n = Math.sin(C * e) / i) : (t = 1 - C,
                    n = C),
                    A.x = t * l + n * d,
                    A.y = t * c + n * b,
                    A.z = t * a + n * G,
                    A.w = t * s + n * r,
                    A
                }
            }, {
                key: "integrate",
                value: function(I, C, A, e) {
                    void 0 === e && (e = new g);
                    var o = I.x * A.x
                      , i = I.y * A.y
                      , t = I.z * A.z
                      , n = this.x
                      , l = this.y
                      , c = this.z
                      , a = this.w
                      , s = .5 * C;
                    return e.x += s * (o * a + i * c - t * l),
                    e.y += s * (i * a + t * n - o * c),
                    e.z += s * (t * a + o * l - i * n),
                    e.w += s * (-o * n - i * l - t * c),
                    e
                }
            }])
        }()
          , _g = new Qg
          , $g = new Qg
          , gI = function() {
            return ng((function g(I) {
                ig(this, g),
                void 0 === I && (I = {}),
                this.id = g.idCounter++,
                this.type = I.type || 0,
                this.boundingSphereRadius = 0,
                this.collisionResponse = !I.collisionResponse || I.collisionResponse,
                this.collisionFilterGroup = void 0 !== I.collisionFilterGroup ? I.collisionFilterGroup : 1,
                this.collisionFilterMask = void 0 !== I.collisionFilterMask ? I.collisionFilterMask : -1,
                this.material = I.material ? I.material : null,
                this.body = null
            }
            ), [{
                key: "updateBoundingSphereRadius",
                value: function() {
                    throw "computeBoundingSphereRadius() not implemented for shape type ".concat(this.type)
                }
            }, {
                key: "volume",
                value: function() {
                    throw "volume() not implemented for shape type ".concat(this.type)
                }
            }, {
                key: "calculateLocalInertia",
                value: function(g, I) {
                    throw "calculateLocalInertia() not implemented for shape type ".concat(this.type)
                }
            }, {
                key: "calculateWorldAABB",
                value: function(g, I, C, A) {
                    throw "calculateWorldAABB() not implemented for shape type ".concat(this.type)
                }
            }])
        }();
        gI.idCounter = 0,
        gI.types = {
            SPHERE: 1,
            PLANE: 2,
            BOX: 4,
            COMPOUND: 8,
            CONVEXPOLYHEDRON: 16,
            HEIGHTFIELD: 32,
            PARTICLE: 64,
            CYLINDER: 128,
            TRIMESH: 256
        };
        var II = function() {
            function g(I) {
                ig(this, g),
                void 0 === I && (I = {}),
                this.position = new Qg,
                this.quaternion = new qg,
                I.position && this.position.copy(I.position),
                I.quaternion && this.quaternion.copy(I.quaternion)
            }
            return ng(g, [{
                key: "pointToLocal",
                value: function(I, C) {
                    return g.pointToLocalFrame(this.position, this.quaternion, I, C)
                }
            }, {
                key: "pointToWorld",
                value: function(I, C) {
                    return g.pointToWorldFrame(this.position, this.quaternion, I, C)
                }
            }, {
                key: "vectorToWorldFrame",
                value: function(g, I) {
                    return void 0 === I && (I = new Qg),
                    this.quaternion.vmult(g, I),
                    I
                }
            }], [{
                key: "pointToLocalFrame",
                value: function(g, I, C, A) {
                    return void 0 === A && (A = new Qg),
                    C.vsub(g, A),
                    I.conjugate(CI),
                    CI.vmult(A, A),
                    A
                }
            }, {
                key: "pointToWorldFrame",
                value: function(g, I, C, A) {
                    return void 0 === A && (A = new Qg),
                    I.vmult(C, A),
                    A.vadd(g, A),
                    A
                }
            }, {
                key: "vectorToWorldFrame",
                value: function(g, I, C) {
                    return void 0 === C && (C = new Qg),
                    g.vmult(I, C),
                    C
                }
            }, {
                key: "vectorToLocalFrame",
                value: function(g, I, C, A) {
                    return void 0 === A && (A = new Qg),
                    I.w *= -1,
                    I.vmult(C, A),
                    I.w *= -1,
                    A
                }
            }])
        }()
          , CI = new qg
          , AI = function(g) {
            function I(g) {
                var C;
                ig(this, I),
                void 0 === g && (g = {});
                var A = g
                  , e = A.vertices
                  , o = void 0 === e ? [] : e
                  , i = A.faces
                  , t = void 0 === i ? [] : i
                  , n = A.normals
                  , l = void 0 === n ? [] : n
                  , c = A.axes
                  , a = A.boundingSphereRadius;
                return (C = lg(this, I, [{
                    type: gI.types.CONVEXPOLYHEDRON
                }])).vertices = o,
                C.faces = t,
                C.faceNormals = l,
                0 === C.faceNormals.length && C.computeNormals(),
                a ? C.boundingSphereRadius = a : C.updateBoundingSphereRadius(),
                C.worldVertices = [],
                C.worldVerticesNeedsUpdate = !0,
                C.worldFaceNormals = [],
                C.worldFaceNormalsNeedsUpdate = !0,
                C.uniqueAxes = c ? c.slice() : null,
                C.uniqueEdges = [],
                C.computeEdges(),
                C
            }
            return sg(I, g),
            ng(I, [{
                key: "computeEdges",
                value: function() {
                    var g = this.faces
                      , I = this.vertices
                      , C = this.uniqueEdges;
                    C.length = 0;
                    for (var A = new Qg, e = 0; e !== g.length; e++)
                        for (var o = g[e], i = o.length, t = 0; t !== i; t++) {
                            var n = (t + 1) % i;
                            I[o[t]].vsub(I[o[n]], A),
                            A.normalize();
                            for (var l = !1, c = 0; c !== C.length; c++)
                                if (C[c].almostEquals(A) || C[c].almostEquals(A)) {
                                    l = !0;
                                    break
                                }
                            l || C.push(A.clone())
                        }
                }
            }, {
                key: "computeNormals",
                value: function() {
                    this.faceNormals.length = this.faces.length;
                    for (var g = 0; g < this.faces.length; g++) {
                        for (var I = 0; I < this.faces[g].length; I++)
                            if (!this.vertices[this.faces[g][I]])
                                throw new Error("Vertex ".concat(this.faces[g][I], " not found!"));
                        var C = this.faceNormals[g] || new Qg;
                        this.getFaceNormal(g, C),
                        C.negate(C),
                        this.faceNormals[g] = C;
                        var A = this.vertices[this.faces[g][0]];
                        if (C.dot(A) < 0) {
                            console.error(".faceNormals[".concat(g, "] = Vec3(").concat(C.toString(), ") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule."));
                            for (var e = 0; e < this.faces[g].length; e++)
                                console.warn(".vertices[".concat(this.faces[g][e], "] = Vec3(").concat(this.vertices[this.faces[g][e]].toString(), ")"))
                        }
                    }
                }
            }, {
                key: "getFaceNormal",
                value: function(g, C) {
                    var A = this.faces[g]
                      , e = this.vertices[A[0]]
                      , o = this.vertices[A[1]]
                      , i = this.vertices[A[2]];
                    I.computeNormal(e, o, i, C)
                }
            }, {
                key: "clipAgainstHull",
                value: function(g, I, C, A, e, o, i, t, n) {
                    for (var l = new Qg, c = -1, a = -Number.MAX_VALUE, s = 0; s < C.faces.length; s++) {
                        l.copy(C.faceNormals[s]),
                        e.vmult(l, l);
                        var d = l.dot(o);
                        d > a && (a = d,
                        c = s)
                    }
                    for (var b = [], G = 0; G < C.faces[c].length; G++) {
                        var r = C.vertices[C.faces[c][G]]
                          , u = new Qg;
                        u.copy(r),
                        e.vmult(u, u),
                        A.vadd(u, u),
                        b.push(u)
                    }
                    c >= 0 && this.clipFaceAgainstHull(o, g, I, b, i, t, n)
                }
            }, {
                key: "findSeparatingAxis",
                value: function(g, I, C, A, e, o, i, t) {
                    var n = new Qg
                      , l = new Qg
                      , c = new Qg
                      , a = new Qg
                      , s = new Qg
                      , d = new Qg
                      , b = Number.MAX_VALUE;
                    if (this.uniqueAxes)
                        for (var G = 0; G !== this.uniqueAxes.length; G++) {
                            C.vmult(this.uniqueAxes[G], n);
                            var r = this.testSepAxis(n, g, I, C, A, e);
                            if (!1 === r)
                                return !1;
                            r < b && (b = r,
                            o.copy(n))
                        }
                    else
                        for (var u = i ? i.length : this.faces.length, B = 0; B < u; B++) {
                            var Z = i ? i[B] : B;
                            n.copy(this.faceNormals[Z]),
                            C.vmult(n, n);
                            var m = this.testSepAxis(n, g, I, C, A, e);
                            if (!1 === m)
                                return !1;
                            m < b && (b = m,
                            o.copy(n))
                        }
                    if (g.uniqueAxes)
                        for (var h = 0; h !== g.uniqueAxes.length; h++) {
                            e.vmult(g.uniqueAxes[h], l);
                            var p = this.testSepAxis(l, g, I, C, A, e);
                            if (!1 === p)
                                return !1;
                            p < b && (b = p,
                            o.copy(l))
                        }
                    else
                        for (var y = t ? t.length : g.faces.length, W = 0; W < y; W++) {
                            var v = t ? t[W] : W;
                            l.copy(g.faceNormals[v]),
                            e.vmult(l, l);
                            var V = this.testSepAxis(l, g, I, C, A, e);
                            if (!1 === V)
                                return !1;
                            V < b && (b = V,
                            o.copy(l))
                        }
                    for (var X = 0; X !== this.uniqueEdges.length; X++) {
                        C.vmult(this.uniqueEdges[X], a);
                        for (var Y = 0; Y !== g.uniqueEdges.length; Y++)
                            if (e.vmult(g.uniqueEdges[Y], s),
                            a.cross(s, d),
                            !d.almostZero()) {
                                d.normalize();
                                var K = this.testSepAxis(d, g, I, C, A, e);
                                if (!1 === K)
                                    return !1;
                                K < b && (b = K,
                                o.copy(d))
                            }
                    }
                    return A.vsub(I, c),
                    c.dot(o) > 0 && o.negate(o),
                    !0
                }
            }, {
                key: "testSepAxis",
                value: function(g, C, A, e, o, i) {
                    I.project(this, g, A, e, eI),
                    I.project(C, g, o, i, oI);
                    var t = eI[0]
                      , n = eI[1]
                      , l = oI[0]
                      , c = oI[1];
                    if (t < c || l < n)
                        return !1;
                    var a = t - c
                      , s = l - n;
                    return a < s ? a : s
                }
            }, {
                key: "calculateLocalInertia",
                value: function(g, I) {
                    var C = new Qg
                      , A = new Qg;
                    this.computeLocalAABB(A, C);
                    var e = C.x - A.x
                      , o = C.y - A.y
                      , i = C.z - A.z;
                    I.x = 1 / 12 * g * (2 * o * 2 * o + 2 * i * 2 * i),
                    I.y = 1 / 12 * g * (2 * e * 2 * e + 2 * i * 2 * i),
                    I.z = 1 / 12 * g * (2 * o * 2 * o + 2 * e * 2 * e)
                }
            }, {
                key: "getPlaneConstantOfFace",
                value: function(g) {
                    var I = this.faces[g]
                      , C = this.faceNormals[g]
                      , A = this.vertices[I[0]];
                    return -C.dot(A)
                }
            }, {
                key: "clipFaceAgainstHull",
                value: function(g, I, C, A, e, o, i) {
                    for (var t = new Qg, n = new Qg, l = new Qg, c = new Qg, a = new Qg, s = new Qg, d = new Qg, b = new Qg, G = A, r = [], u = -1, B = Number.MAX_VALUE, Z = 0; Z < this.faces.length; Z++) {
                        t.copy(this.faceNormals[Z]),
                        C.vmult(t, t);
                        var m = t.dot(g);
                        m < B && (B = m,
                        u = Z)
                    }
                    if (!(u < 0)) {
                        var h = this.faces[u];
                        h.connectedFaces = [];
                        for (var p = 0; p < this.faces.length; p++)
                            for (var y = 0; y < this.faces[p].length; y++)
                                -1 !== h.indexOf(this.faces[p][y]) && p !== u && -1 === h.connectedFaces.indexOf(p) && h.connectedFaces.push(p);
                        for (var W = h.length, v = 0; v < W; v++) {
                            var V = this.vertices[h[v]]
                              , X = this.vertices[h[(v + 1) % W]];
                            V.vsub(X, n),
                            l.copy(n),
                            C.vmult(l, l),
                            I.vadd(l, l),
                            c.copy(this.faceNormals[u]),
                            C.vmult(c, c),
                            I.vadd(c, c),
                            l.cross(c, a),
                            a.negate(a),
                            s.copy(V),
                            C.vmult(s, s),
                            I.vadd(s, s);
                            var Y = h.connectedFaces[v];
                            d.copy(this.faceNormals[Y]);
                            var K = this.getPlaneConstantOfFace(Y);
                            b.copy(d),
                            C.vmult(b, b);
                            var R = K - b.dot(I);
                            for (this.clipFaceAgainstPlane(G, r, b, R); G.length; )
                                G.shift();
                            for (; r.length; )
                                G.push(r.shift())
                        }
                        d.copy(this.faceNormals[u]);
                        var w = this.getPlaneConstantOfFace(u);
                        b.copy(d),
                        C.vmult(b, b);
                        for (var H = w - b.dot(I), F = 0; F < G.length; F++) {
                            var N = b.dot(G[F]) + H;
                            if (N <= e && (console.log("clamped: depth=".concat(N, " to minDist=").concat(e)),
                            N = e),
                            N <= o) {
                                var S = G[F];
                                if (N <= 1e-6) {
                                    var z = {
                                        point: S,
                                        normal: b,
                                        depth: N
                                    };
                                    i.push(z)
                                }
                            }
                        }
                    }
                }
            }, {
                key: "clipFaceAgainstPlane",
                value: function(g, I, C, A) {
                    var e, o, i = g.length;
                    if (i < 2)
                        return I;
                    var t = g[g.length - 1]
                      , n = g[0];
                    e = C.dot(t) + A;
                    for (var l = 0; l < i; l++) {
                        if (n = g[l],
                        o = C.dot(n) + A,
                        e < 0)
                            if (o < 0) {
                                var c = new Qg;
                                c.copy(n),
                                I.push(c)
                            } else {
                                var a = new Qg;
                                t.lerp(n, e / (e - o), a),
                                I.push(a)
                            }
                        else if (o < 0) {
                            var s = new Qg;
                            t.lerp(n, e / (e - o), s),
                            I.push(s),
                            I.push(n)
                        }
                        t = n,
                        e = o
                    }
                    return I
                }
            }, {
                key: "computeWorldVertices",
                value: function(g, I) {
                    for (; this.worldVertices.length < this.vertices.length; )
                        this.worldVertices.push(new Qg);
                    for (var C = this.vertices, A = this.worldVertices, e = 0; e !== this.vertices.length; e++)
                        I.vmult(C[e], A[e]),
                        g.vadd(A[e], A[e]);
                    this.worldVerticesNeedsUpdate = !1
                }
            }, {
                key: "computeLocalAABB",
                value: function(g, I) {
                    var C = this.vertices;
                    g.set(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE),
                    I.set(-Number.MAX_VALUE, -Number.MAX_VALUE, -Number.MAX_VALUE);
                    for (var A = 0; A < this.vertices.length; A++) {
                        var e = C[A];
                        e.x < g.x ? g.x = e.x : e.x > I.x && (I.x = e.x),
                        e.y < g.y ? g.y = e.y : e.y > I.y && (I.y = e.y),
                        e.z < g.z ? g.z = e.z : e.z > I.z && (I.z = e.z)
                    }
                }
            }, {
                key: "computeWorldFaceNormals",
                value: function(g) {
                    for (var I = this.faceNormals.length; this.worldFaceNormals.length < I; )
                        this.worldFaceNormals.push(new Qg);
                    for (var C = this.faceNormals, A = this.worldFaceNormals, e = 0; e !== I; e++)
                        g.vmult(C[e], A[e]);
                    this.worldFaceNormalsNeedsUpdate = !1
                }
            }, {
                key: "updateBoundingSphereRadius",
                value: function() {
                    for (var g = 0, I = this.vertices, C = 0; C !== I.length; C++) {
                        var A = I[C].lengthSquared();
                        A > g && (g = A)
                    }
                    this.boundingSphereRadius = Math.sqrt(g)
                }
            }, {
                key: "calculateWorldAABB",
                value: function(g, I, C, A) {
                    for (var e, o, i, t, n, l, c = this.vertices, a = new Qg, s = 0; s < c.length; s++) {
                        a.copy(c[s]),
                        I.vmult(a, a),
                        g.vadd(a, a);
                        var d = a;
                        (void 0 === e || d.x < e) && (e = d.x),
                        (void 0 === t || d.x > t) && (t = d.x),
                        (void 0 === o || d.y < o) && (o = d.y),
                        (void 0 === n || d.y > n) && (n = d.y),
                        (void 0 === i || d.z < i) && (i = d.z),
                        (void 0 === l || d.z > l) && (l = d.z)
                    }
                    C.set(e, o, i),
                    A.set(t, n, l)
                }
            }, {
                key: "volume",
                value: function() {
                    return 4 * Math.PI * this.boundingSphereRadius / 3
                }
            }, {
                key: "getAveragePointLocal",
                value: function(g) {
                    void 0 === g && (g = new Qg);
                    for (var I = this.vertices, C = 0; C < I.length; C++)
                        g.vadd(I[C], g);
                    return g.scale(1 / I.length, g),
                    g
                }
            }, {
                key: "transformAllPoints",
                value: function(g, I) {
                    var C = this.vertices.length
                      , A = this.vertices;
                    if (I) {
                        for (var e = 0; e < C; e++) {
                            var o = A[e];
                            I.vmult(o, o)
                        }
                        for (var i = 0; i < this.faceNormals.length; i++) {
                            var t = this.faceNormals[i];
                            I.vmult(t, t)
                        }
                    }
                    if (g)
                        for (var n = 0; n < C; n++) {
                            var l = A[n];
                            l.vadd(g, l)
                        }
                }
            }, {
                key: "pointIsInside",
                value: function(g) {
                    var I = this.vertices
                      , C = this.faces
                      , A = this.faceNormals
                      , e = new Qg;
                    this.getAveragePointLocal(e);
                    for (var o = 0; o < this.faces.length; o++) {
                        var i = A[o]
                          , t = I[C[o][0]]
                          , n = new Qg;
                        g.vsub(t, n);
                        var l = i.dot(n)
                          , c = new Qg;
                        e.vsub(t, c);
                        var a = i.dot(c);
                        if (l < 0 && a > 0 || l > 0 && a < 0)
                            return !1
                    }
                    return -1
                }
            }], [{
                key: "computeNormal",
                value: function(g, I, C, A) {
                    var e = new Qg
                      , o = new Qg;
                    I.vsub(g, o),
                    C.vsub(I, e),
                    e.cross(o, A),
                    A.isZero() || A.normalize()
                }
            }, {
                key: "project",
                value: function(g, I, C, A, e) {
                    var o = g.vertices.length
                      , i = iI
                      , t = 0
                      , n = 0
                      , l = tI
                      , c = g.vertices;
                    l.setZero(),
                    II.vectorToLocalFrame(C, A, I, i),
                    II.pointToLocalFrame(C, A, l, l);
                    var a = l.dot(i);
                    n = t = c[0].dot(i);
                    for (var s = 1; s < o; s++) {
                        var d = c[s].dot(i);
                        d > t && (t = d),
                        d < n && (n = d)
                    }
                    if ((n -= a) > (t -= a)) {
                        var b = n;
                        n = t,
                        t = b
                    }
                    e[0] = t,
                    e[1] = n
                }
            }])
        }(gI)
          , eI = []
          , oI = [];
        new Qg;
        var iI = new Qg
          , tI = new Qg
          , nI = function(g) {
            function I(g) {
                var C;
                return ig(this, I),
                (C = lg(this, I, [{
                    type: gI.types.BOX
                }])).halfExtents = g,
                C.convexPolyhedronRepresentation = null,
                C.updateConvexPolyhedronRepresentation(),
                C.updateBoundingSphereRadius(),
                C
            }
            return sg(I, g),
            ng(I, [{
                key: "updateConvexPolyhedronRepresentation",
                value: function() {
                    var g = this.halfExtents.x
                      , I = this.halfExtents.y
                      , C = this.halfExtents.z
                      , A = Qg
                      , e = [new A(-g,-I,-C), new A(g,-I,-C), new A(g,I,-C), new A(-g,I,-C), new A(-g,-I,C), new A(g,-I,C), new A(g,I,C), new A(-g,I,C)]
                      , o = [new A(0,0,1), new A(0,1,0), new A(1,0,0)]
                      , i = new AI({
                        vertices: e,
                        faces: [[3, 2, 1, 0], [4, 5, 6, 7], [5, 4, 0, 1], [2, 3, 7, 6], [0, 4, 7, 3], [1, 2, 6, 5]],
                        axes: o
                    });
                    this.convexPolyhedronRepresentation = i,
                    i.material = this.material
                }
            }, {
                key: "calculateLocalInertia",
                value: function(g, C) {
                    return void 0 === C && (C = new Qg),
                    I.calculateInertia(this.halfExtents, g, C),
                    C
                }
            }, {
                key: "getSideNormals",
                value: function(g, I) {
                    var C = g
                      , A = this.halfExtents;
                    if (C[0].set(A.x, 0, 0),
                    C[1].set(0, A.y, 0),
                    C[2].set(0, 0, A.z),
                    C[3].set(-A.x, 0, 0),
                    C[4].set(0, -A.y, 0),
                    C[5].set(0, 0, -A.z),
                    void 0 !== I)
                        for (var e = 0; e !== C.length; e++)
                            I.vmult(C[e], C[e]);
                    return C
                }
            }, {
                key: "volume",
                value: function() {
                    return 8 * this.halfExtents.x * this.halfExtents.y * this.halfExtents.z
                }
            }, {
                key: "updateBoundingSphereRadius",
                value: function() {
                    this.boundingSphereRadius = this.halfExtents.length()
                }
            }, {
                key: "forEachWorldCorner",
                value: function(g, I, C) {
                    for (var A = this.halfExtents, e = [[A.x, A.y, A.z], [-A.x, A.y, A.z], [-A.x, -A.y, A.z], [-A.x, -A.y, -A.z], [A.x, -A.y, -A.z], [A.x, A.y, -A.z], [-A.x, A.y, -A.z], [A.x, -A.y, A.z]], o = 0; o < e.length; o++)
                        lI.set(e[o][0], e[o][1], e[o][2]),
                        I.vmult(lI, lI),
                        g.vadd(lI, lI),
                        C(lI.x, lI.y, lI.z)
                }
            }, {
                key: "calculateWorldAABB",
                value: function(g, I, C, A) {
                    var e = this.halfExtents;
                    cI[0].set(e.x, e.y, e.z),
                    cI[1].set(-e.x, e.y, e.z),
                    cI[2].set(-e.x, -e.y, e.z),
                    cI[3].set(-e.x, -e.y, -e.z),
                    cI[4].set(e.x, -e.y, -e.z),
                    cI[5].set(e.x, e.y, -e.z),
                    cI[6].set(-e.x, e.y, -e.z),
                    cI[7].set(e.x, -e.y, e.z);
                    var o = cI[0];
                    I.vmult(o, o),
                    g.vadd(o, o),
                    A.copy(o),
                    C.copy(o);
                    for (var i = 1; i < 8; i++) {
                        var t = cI[i];
                        I.vmult(t, t),
                        g.vadd(t, t);
                        var n = t.x
                          , l = t.y
                          , c = t.z;
                        n > A.x && (A.x = n),
                        l > A.y && (A.y = l),
                        c > A.z && (A.z = c),
                        n < C.x && (C.x = n),
                        l < C.y && (C.y = l),
                        c < C.z && (C.z = c)
                    }
                }
            }], [{
                key: "calculateInertia",
                value: function(g, I, C) {
                    var A = g;
                    C.x = 1 / 12 * I * (2 * A.y * 2 * A.y + 2 * A.z * 2 * A.z),
                    C.y = 1 / 12 * I * (2 * A.x * 2 * A.x + 2 * A.z * 2 * A.z),
                    C.z = 1 / 12 * I * (2 * A.y * 2 * A.y + 2 * A.x * 2 * A.x)
                }
            }])
        }(gI)
          , lI = new Qg
          , cI = [new Qg, new Qg, new Qg, new Qg, new Qg, new Qg, new Qg, new Qg]
          , aI = 1
          , sI = 2
          , dI = 4
          , bI = 0
          , GI = 1
          , rI = 2
          , uI = function(g) {
            function I(g) {
                var C;
                ig(this, I),
                void 0 === g && (g = {}),
                (C = lg(this, I)).id = I.idCounter++,
                C.index = -1,
                C.world = null,
                C.vlambda = new Qg,
                C.collisionFilterGroup = "number" == typeof g.collisionFilterGroup ? g.collisionFilterGroup : 1,
                C.collisionFilterMask = "number" == typeof g.collisionFilterMask ? g.collisionFilterMask : -1,
                C.collisionResponse = "boolean" != typeof g.collisionResponse || g.collisionResponse,
                C.position = new Qg,
                C.previousPosition = new Qg,
                C.interpolatedPosition = new Qg,
                C.initPosition = new Qg,
                g.position && (C.position.copy(g.position),
                C.previousPosition.copy(g.position),
                C.interpolatedPosition.copy(g.position),
                C.initPosition.copy(g.position)),
                C.velocity = new Qg,
                g.velocity && C.velocity.copy(g.velocity),
                C.initVelocity = new Qg,
                C.force = new Qg;
                var A = "number" == typeof g.mass ? g.mass : 0;
                return C.mass = A,
                C.invMass = A > 0 ? 1 / A : 0,
                C.material = g.material || null,
                C.linearDamping = "number" == typeof g.linearDamping ? g.linearDamping : .01,
                C.type = A <= 0 ? I.STATIC : I.DYNAMIC,
                rg(g.type) === rg(I.STATIC) && (C.type = g.type),
                C.allowSleep = void 0 === g.allowSleep || g.allowSleep,
                C.sleepState = I.AWAKE,
                C.sleepSpeedLimit = void 0 !== g.sleepSpeedLimit ? g.sleepSpeedLimit : .1,
                C.sleepTimeLimit = void 0 !== g.sleepTimeLimit ? g.sleepTimeLimit : 1,
                C.timeLastSleepy = 0,
                C.wakeUpAfterNarrowphase = !1,
                C.torque = new Qg,
                C.quaternion = new qg,
                C.initQuaternion = new qg,
                C.previousQuaternion = new qg,
                C.interpolatedQuaternion = new qg,
                g.quaternion && (C.quaternion.copy(g.quaternion),
                C.initQuaternion.copy(g.quaternion),
                C.previousQuaternion.copy(g.quaternion),
                C.interpolatedQuaternion.copy(g.quaternion)),
                C.angularVelocity = new Qg,
                g.angularVelocity && C.angularVelocity.copy(g.angularVelocity),
                C.initAngularVelocity = new Qg,
                C.shapes = [],
                C.shapeOffsets = [],
                C.shapeOrientations = [],
                C.inertia = new Qg,
                C.invInertia = new Qg,
                C.invInertiaWorld = new xg,
                C.invMassSolve = 0,
                C.invInertiaSolve = new Qg,
                C.invInertiaWorldSolve = new xg,
                C.fixedRotation = void 0 !== g.fixedRotation && g.fixedRotation,
                C.angularDamping = void 0 !== g.angularDamping ? g.angularDamping : .01,
                C.linearFactor = new Qg(1,1,1),
                g.linearFactor && C.linearFactor.copy(g.linearFactor),
                C.angularFactor = new Qg(1,1,1),
                g.angularFactor && C.angularFactor.copy(g.angularFactor),
                C.aabb = new Tg,
                C.aabbNeedsUpdate = !0,
                C.boundingRadius = 0,
                C.wlambda = new Qg,
                C.isTrigger = Boolean(g.isTrigger),
                g.shape && C.addShape(g.shape),
                C.updateMassProperties(),
                C
            }
            return sg(I, g),
            ng(I, [{
                key: "wakeUp",
                value: function() {
                    var g = this.sleepState;
                    this.sleepState = I.AWAKE,
                    this.wakeUpAfterNarrowphase = !1,
                    g === I.SLEEPING && this.dispatchEvent(I.wakeupEvent)
                }
            }, {
                key: "sleep",
                value: function() {
                    this.sleepState = I.SLEEPING,
                    this.velocity.set(0, 0, 0),
                    this.angularVelocity.set(0, 0, 0),
                    this.wakeUpAfterNarrowphase = !1
                }
            }, {
                key: "sleepTick",
                value: function(g) {
                    if (this.allowSleep) {
                        var C = this.sleepState
                          , A = this.velocity.lengthSquared() + this.angularVelocity.lengthSquared()
                          , e = Math.pow(this.sleepSpeedLimit, 2);
                        C === I.AWAKE && A < e ? (this.sleepState = I.SLEEPY,
                        this.timeLastSleepy = g,
                        this.dispatchEvent(I.sleepyEvent)) : C === I.SLEEPY && A > e ? this.wakeUp() : C === I.SLEEPY && g - this.timeLastSleepy > this.sleepTimeLimit && (this.sleep(),
                        this.dispatchEvent(I.sleepEvent))
                    }
                }
            }, {
                key: "updateSolveMassProperties",
                value: function() {
                    this.sleepState === I.SLEEPING || this.type === I.KINEMATIC ? (this.invMassSolve = 0,
                    this.invInertiaSolve.setZero(),
                    this.invInertiaWorldSolve.setZero()) : (this.invMassSolve = this.invMass,
                    this.invInertiaSolve.copy(this.invInertia),
                    this.invInertiaWorldSolve.copy(this.invInertiaWorld))
                }
            }, {
                key: "pointToLocalFrame",
                value: function(g, I) {
                    return void 0 === I && (I = new Qg),
                    g.vsub(this.position, I),
                    this.quaternion.conjugate().vmult(I, I),
                    I
                }
            }, {
                key: "vectorToLocalFrame",
                value: function(g, I) {
                    return void 0 === I && (I = new Qg),
                    this.quaternion.conjugate().vmult(g, I),
                    I
                }
            }, {
                key: "pointToWorldFrame",
                value: function(g, I) {
                    return void 0 === I && (I = new Qg),
                    this.quaternion.vmult(g, I),
                    I.vadd(this.position, I),
                    I
                }
            }, {
                key: "vectorToWorldFrame",
                value: function(g, I) {
                    return void 0 === I && (I = new Qg),
                    this.quaternion.vmult(g, I),
                    I
                }
            }, {
                key: "addShape",
                value: function(g, I, C) {
                    var A = new Qg
                      , e = new qg;
                    return I && A.copy(I),
                    C && e.copy(C),
                    this.shapes.push(g),
                    this.shapeOffsets.push(A),
                    this.shapeOrientations.push(e),
                    this.updateMassProperties(),
                    this.updateBoundingRadius(),
                    this.aabbNeedsUpdate = !0,
                    g.body = this,
                    this
                }
            }, {
                key: "removeShape",
                value: function(g) {
                    var I = this.shapes.indexOf(g);
                    return -1 === I ? (console.warn("Shape does not belong to the body"),
                    this) : (this.shapes.splice(I, 1),
                    this.shapeOffsets.splice(I, 1),
                    this.shapeOrientations.splice(I, 1),
                    this.updateMassProperties(),
                    this.updateBoundingRadius(),
                    this.aabbNeedsUpdate = !0,
                    g.body = null,
                    this)
                }
            }, {
                key: "updateBoundingRadius",
                value: function() {
                    for (var g = this.shapes, I = this.shapeOffsets, C = g.length, A = 0, e = 0; e !== C; e++) {
                        var o = g[e];
                        o.updateBoundingSphereRadius();
                        var i = I[e].length()
                          , t = o.boundingSphereRadius;
                        i + t > A && (A = i + t)
                    }
                    this.boundingRadius = A
                }
            }, {
                key: "updateAABB",
                value: function() {
                    for (var g = this.shapes, I = this.shapeOffsets, C = this.shapeOrientations, A = g.length, e = BI, o = ZI, i = this.quaternion, t = this.aabb, n = mI, l = 0; l !== A; l++) {
                        var c = g[l];
                        i.vmult(I[l], e),
                        e.vadd(this.position, e),
                        i.mult(C[l], o),
                        c.calculateWorldAABB(e, o, n.lowerBound, n.upperBound),
                        0 === l ? t.copy(n) : t.extend(n)
                    }
                    this.aabbNeedsUpdate = !1
                }
            }, {
                key: "updateInertiaWorld",
                value: function(g) {
                    var I = this.invInertia;
                    if (I.x !== I.y || I.y !== I.z || g) {
                        var C = hI
                          , A = pI;
                        C.setRotationFromQuaternion(this.quaternion),
                        C.transpose(A),
                        C.scale(I, C),
                        C.mmult(A, this.invInertiaWorld)
                    } else
                        ;
                }
            }, {
                key: "applyForce",
                value: function(g, C) {
                    if (void 0 === C && (C = new Qg),
                    this.type === I.DYNAMIC) {
                        this.sleepState === I.SLEEPING && this.wakeUp();
                        var A = yI;
                        C.cross(g, A),
                        this.force.vadd(g, this.force),
                        this.torque.vadd(A, this.torque)
                    }
                }
            }, {
                key: "applyLocalForce",
                value: function(g, C) {
                    if (void 0 === C && (C = new Qg),
                    this.type === I.DYNAMIC) {
                        var A = WI
                          , e = vI;
                        this.vectorToWorldFrame(g, A),
                        this.vectorToWorldFrame(C, e),
                        this.applyForce(A, e)
                    }
                }
            }, {
                key: "applyTorque",
                value: function(g) {
                    this.type === I.DYNAMIC && (this.sleepState === I.SLEEPING && this.wakeUp(),
                    this.torque.vadd(g, this.torque))
                }
            }, {
                key: "applyImpulse",
                value: function(g, C) {
                    if (void 0 === C && (C = new Qg),
                    this.type === I.DYNAMIC) {
                        this.sleepState === I.SLEEPING && this.wakeUp();
                        var A = C
                          , e = VI;
                        e.copy(g),
                        e.scale(this.invMass, e),
                        this.velocity.vadd(e, this.velocity);
                        var o = XI;
                        A.cross(g, o),
                        this.invInertiaWorld.vmult(o, o),
                        this.angularVelocity.vadd(o, this.angularVelocity)
                    }
                }
            }, {
                key: "applyLocalImpulse",
                value: function(g, C) {
                    if (void 0 === C && (C = new Qg),
                    this.type === I.DYNAMIC) {
                        var A = YI
                          , e = KI;
                        this.vectorToWorldFrame(g, A),
                        this.vectorToWorldFrame(C, e),
                        this.applyImpulse(A, e)
                    }
                }
            }, {
                key: "updateMassProperties",
                value: function() {
                    var g = RI;
                    this.invMass = this.mass > 0 ? 1 / this.mass : 0;
                    var I = this.inertia
                      , C = this.fixedRotation;
                    this.updateAABB(),
                    g.set((this.aabb.upperBound.x - this.aabb.lowerBound.x) / 2, (this.aabb.upperBound.y - this.aabb.lowerBound.y) / 2, (this.aabb.upperBound.z - this.aabb.lowerBound.z) / 2),
                    nI.calculateInertia(g, this.mass, I),
                    this.invInertia.set(I.x > 0 && !C ? 1 / I.x : 0, I.y > 0 && !C ? 1 / I.y : 0, I.z > 0 && !C ? 1 / I.z : 0),
                    this.updateInertiaWorld(!0)
                }
            }, {
                key: "getVelocityAtWorldPoint",
                value: function(g, I) {
                    var C = new Qg;
                    return g.vsub(this.position, C),
                    this.angularVelocity.cross(C, I),
                    this.velocity.vadd(I, I),
                    I
                }
            }, {
                key: "integrate",
                value: function(g, C, A) {
                    if (this.previousPosition.copy(this.position),
                    this.previousQuaternion.copy(this.quaternion),
                    (this.type === I.DYNAMIC || this.type === I.KINEMATIC) && this.sleepState !== I.SLEEPING) {
                        var e = this.velocity
                          , o = this.angularVelocity
                          , i = this.position
                          , t = this.force
                          , n = this.torque
                          , l = this.quaternion
                          , c = this.invMass
                          , a = this.invInertiaWorld
                          , s = this.linearFactor
                          , d = c * g;
                        e.x += t.x * d * s.x,
                        e.y += t.y * d * s.y,
                        e.z += t.z * d * s.z;
                        var b = a.elements
                          , G = this.angularFactor
                          , r = n.x * G.x
                          , u = n.y * G.y
                          , B = n.z * G.z;
                        o.x += g * (b[0] * r + b[1] * u + b[2] * B),
                        o.y += g * (b[3] * r + b[4] * u + b[5] * B),
                        o.z += g * (b[6] * r + b[7] * u + b[8] * B),
                        i.x += e.x * g,
                        i.y += e.y * g,
                        i.z += e.z * g,
                        l.integrate(this.angularVelocity, g, this.angularFactor, l),
                        C && (A ? l.normalizeFast() : l.normalize()),
                        this.aabbNeedsUpdate = !0,
                        this.updateInertiaWorld()
                    }
                }
            }])
        }(Pg);
        uI.idCounter = 0,
        uI.COLLIDE_EVENT_NAME = "collide",
        uI.DYNAMIC = aI,
        uI.STATIC = sI,
        uI.KINEMATIC = dI,
        uI.AWAKE = bI,
        uI.SLEEPY = GI,
        uI.SLEEPING = rI,
        uI.wakeupEvent = {
            type: "wakeup"
        },
        uI.sleepyEvent = {
            type: "sleepy"
        },
        uI.sleepEvent = {
            type: "sleep"
        };
        var BI = new Qg
          , ZI = new qg
          , mI = new Tg
          , hI = new xg
          , pI = new xg;
        new xg;
        var yI = new Qg
          , WI = new Qg
          , vI = new Qg
          , VI = new Qg
          , XI = new Qg
          , YI = new Qg
          , KI = new Qg
          , RI = new Qg;
        new Qg,
        new Qg,
        new qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg;
        var wI = function() {
            return ng((function g() {
                ig(this, g),
                this.rayFromWorld = new Qg,
                this.rayToWorld = new Qg,
                this.hitNormalWorld = new Qg,
                this.hitPointWorld = new Qg,
                this.hasHit = !1,
                this.shape = null,
                this.body = null,
                this.hitFaceIndex = -1,
                this.distance = -1,
                this.shouldStop = !1
            }
            ), [{
                key: "reset",
                value: function() {
                    this.rayFromWorld.setZero(),
                    this.rayToWorld.setZero(),
                    this.hitNormalWorld.setZero(),
                    this.hitPointWorld.setZero(),
                    this.hasHit = !1,
                    this.shape = null,
                    this.body = null,
                    this.hitFaceIndex = -1,
                    this.distance = -1,
                    this.shouldStop = !1
                }
            }, {
                key: "abort",
                value: function() {
                    this.shouldStop = !0
                }
            }, {
                key: "set",
                value: function(g, I, C, A, e, o, i) {
                    this.rayFromWorld.copy(g),
                    this.rayToWorld.copy(I),
                    this.hitNormalWorld.copy(C),
                    this.hitPointWorld.copy(A),
                    this.shape = e,
                    this.body = o,
                    this.distance = i
                }
            }])
        }()
          , HI = 1
          , FI = 2
          , NI = 4
          , SI = function(g, I, C, A, e, o, i) {
            function t(g, I) {
                ig(this, t),
                void 0 === g && (g = new Qg),
                void 0 === I && (I = new Qg),
                this.from = g.clone(),
                this.to = I.clone(),
                this.direction = new Qg,
                this.precision = 1e-4,
                this.checkCollisionResponse = !0,
                this.skipBackfaces = !1,
                this.collisionFilterMask = -1,
                this.collisionFilterGroup = -1,
                this.mode = t.ANY,
                this.result = new wI,
                this.hasHit = !1,
                this.callback = function(g) {}
            }
            return ng(t, [{
                key: g,
                get: function() {
                    return this._intersectSphere
                }
            }, {
                key: I,
                get: function() {
                    return this._intersectPlane
                }
            }, {
                key: C,
                get: function() {
                    return this._intersectBox
                }
            }, {
                key: A,
                get: function() {
                    return this._intersectConvex
                }
            }, {
                key: e,
                get: function() {
                    return this._intersectConvex
                }
            }, {
                key: o,
                get: function() {
                    return this._intersectHeightfield
                }
            }, {
                key: i,
                get: function() {
                    return this._intersectTrimesh
                }
            }, {
                key: "intersectWorld",
                value: function(g, I) {
                    return this.mode = I.mode || t.ANY,
                    this.result = I.result || new wI,
                    this.skipBackfaces = !!I.skipBackfaces,
                    this.collisionFilterMask = void 0 !== I.collisionFilterMask ? I.collisionFilterMask : -1,
                    this.collisionFilterGroup = void 0 !== I.collisionFilterGroup ? I.collisionFilterGroup : -1,
                    this.checkCollisionResponse = void 0 === I.checkCollisionResponse || I.checkCollisionResponse,
                    I.from && this.from.copy(I.from),
                    I.to && this.to.copy(I.to),
                    this.callback = I.callback || function() {}
                    ,
                    this.hasHit = !1,
                    this.result.reset(),
                    this.updateDirection(),
                    this.getAABB(zI),
                    fI.length = 0,
                    g.broadphase.aabbQuery(g, zI, fI),
                    this.intersectBodies(fI),
                    this.hasHit
                }
            }, {
                key: "intersectBody",
                value: function(g, I) {
                    I && (this.result = I,
                    this.updateDirection());
                    var C = this.checkCollisionResponse;
                    if ((!C || g.collisionResponse) && 0 != (this.collisionFilterGroup & g.collisionFilterMask) && 0 != (g.collisionFilterGroup & this.collisionFilterMask))
                        for (var A = LI, e = xI, o = 0, i = g.shapes.length; o < i; o++) {
                            var t = g.shapes[o];
                            if ((!C || t.collisionResponse) && (g.quaternion.mult(g.shapeOrientations[o], e),
                            g.quaternion.vmult(g.shapeOffsets[o], A),
                            A.vadd(g.position, A),
                            this.intersectShape(t, e, A, g),
                            this.result.shouldStop))
                                break
                        }
                }
            }, {
                key: "intersectBodies",
                value: function(g, I) {
                    I && (this.result = I,
                    this.updateDirection());
                    for (var C = 0, A = g.length; !this.result.shouldStop && C < A; C++)
                        this.intersectBody(g[C])
                }
            }, {
                key: "updateDirection",
                value: function() {
                    this.to.vsub(this.from, this.direction),
                    this.direction.normalize()
                }
            }, {
                key: "intersectShape",
                value: function(g, I, C, A) {
                    if (!(function(g, I, C) {
                        C.vsub(g, nC);
                        var A = nC.dot(I);
                        return I.scale(A, lC),
                        lC.vadd(g, lC),
                        C.distanceTo(lC)
                    }(this.from, this.direction, C) > g.boundingSphereRadius)) {
                        var e = this[g.type];
                        e && e.call(this, g, I, C, A, g)
                    }
                }
            }, {
                key: "_intersectBox",
                value: function(g, I, C, A, e) {
                    return this._intersectConvex(g.convexPolyhedronRepresentation, I, C, A, e)
                }
            }, {
                key: "_intersectPlane",
                value: function(g, I, C, A, e) {
                    var o = this.from
                      , i = this.to
                      , t = this.direction
                      , n = new Qg(0,0,1);
                    I.vmult(n, n);
                    var l = new Qg;
                    o.vsub(C, l);
                    var c = l.dot(n);
                    if (i.vsub(C, l),
                    !(c * l.dot(n) > 0 || o.distanceTo(i) < c)) {
                        var a = n.dot(t);
                        if (!(Math.abs(a) < this.precision)) {
                            var s = new Qg
                              , d = new Qg
                              , b = new Qg;
                            o.vsub(C, s);
                            var G = -n.dot(s) / a;
                            t.scale(G, d),
                            o.vadd(d, b),
                            this.reportIntersection(n, b, e, A, -1)
                        }
                    }
                }
            }, {
                key: "getAABB",
                value: function(g) {
                    var I = g.lowerBound
                      , C = g.upperBound
                      , A = this.to
                      , e = this.from;
                    I.x = Math.min(A.x, e.x),
                    I.y = Math.min(A.y, e.y),
                    I.z = Math.min(A.z, e.z),
                    C.x = Math.max(A.x, e.x),
                    C.y = Math.max(A.y, e.y),
                    C.z = Math.max(A.z, e.z)
                }
            }, {
                key: "_intersectHeightfield",
                value: function(g, I, C, A, e) {
                    g.data,
                    g.elementSize;
                    var o = OI;
                    o.from.copy(this.from),
                    o.to.copy(this.to),
                    II.pointToLocalFrame(C, I, o.from, o.from),
                    II.pointToLocalFrame(C, I, o.to, o.to),
                    o.updateDirection();
                    var i, t, n, l, c = EI;
                    i = t = 0,
                    n = l = g.data.length - 1;
                    var a = new Tg;
                    o.getAABB(a),
                    g.getIndexOfPosition(a.lowerBound.x, a.lowerBound.y, c, !0),
                    i = Math.max(i, c[0]),
                    t = Math.max(t, c[1]),
                    g.getIndexOfPosition(a.upperBound.x, a.upperBound.y, c, !0),
                    n = Math.min(n, c[0] + 1),
                    l = Math.min(l, c[1] + 1);
                    for (var s = i; s < n; s++)
                        for (var d = t; d < l; d++) {
                            if (this.result.shouldStop)
                                return;
                            if (g.getAabbAtIndex(s, d, a),
                            a.overlapsRay(o)) {
                                if (g.getConvexTrianglePillar(s, d, !1),
                                II.pointToWorldFrame(C, I, g.pillarOffset, TI),
                                this._intersectConvex(g.pillarConvex, I, TI, A, e, DI),
                                this.result.shouldStop)
                                    return;
                                g.getConvexTrianglePillar(s, d, !0),
                                II.pointToWorldFrame(C, I, g.pillarOffset, TI),
                                this._intersectConvex(g.pillarConvex, I, TI, A, e, DI)
                            }
                        }
                }
            }, {
                key: "_intersectSphere",
                value: function(g, I, C, A, e) {
                    var o = this.from
                      , i = this.to
                      , t = g.radius
                      , n = Math.pow(i.x - o.x, 2) + Math.pow(i.y - o.y, 2) + Math.pow(i.z - o.z, 2)
                      , l = 2 * ((i.x - o.x) * (o.x - C.x) + (i.y - o.y) * (o.y - C.y) + (i.z - o.z) * (o.z - C.z))
                      , c = Math.pow(o.x - C.x, 2) + Math.pow(o.y - C.y, 2) + Math.pow(o.z - C.z, 2) - Math.pow(t, 2)
                      , a = Math.pow(l, 2) - 4 * n * c
                      , s = PI
                      , d = qI;
                    if (!(a < 0))
                        if (0 === a)
                            o.lerp(i, a, s),
                            s.vsub(C, d),
                            d.normalize(),
                            this.reportIntersection(d, s, e, A, -1);
                        else {
                            var b = (-l - Math.sqrt(a)) / (2 * n)
                              , G = (-l + Math.sqrt(a)) / (2 * n);
                            if (b >= 0 && b <= 1 && (o.lerp(i, b, s),
                            s.vsub(C, d),
                            d.normalize(),
                            this.reportIntersection(d, s, e, A, -1)),
                            this.result.shouldStop)
                                return;
                            G >= 0 && G <= 1 && (o.lerp(i, G, s),
                            s.vsub(C, d),
                            d.normalize(),
                            this.reportIntersection(d, s, e, A, -1))
                        }
                }
            }, {
                key: "_intersectConvex",
                value: function(g, I, C, A, e, o) {
                    for (var i = _I, n = $I, l = o && o.faceList || null, c = g.faces, a = g.vertices, s = g.faceNormals, d = this.direction, b = this.from, G = this.to, r = b.distanceTo(G), u = l ? l.length : c.length, B = this.result, Z = 0; !B.shouldStop && Z < u; Z++) {
                        var m = l ? l[Z] : Z
                          , h = c[m]
                          , p = s[m]
                          , y = I
                          , W = C;
                        n.copy(a[h[0]]),
                        y.vmult(n, n),
                        n.vadd(W, n),
                        n.vsub(b, n),
                        y.vmult(p, i);
                        var v = d.dot(i);
                        if (!(Math.abs(v) < this.precision)) {
                            var V = i.dot(n) / v;
                            if (!(V < 0)) {
                                d.scale(V, MI),
                                MI.vadd(b, MI),
                                QI.copy(a[h[0]]),
                                y.vmult(QI, QI),
                                W.vadd(QI, QI);
                                for (var X = 1; !B.shouldStop && X < h.length - 1; X++) {
                                    jI.copy(a[h[X]]),
                                    UI.copy(a[h[X + 1]]),
                                    y.vmult(jI, jI),
                                    y.vmult(UI, UI),
                                    W.vadd(jI, jI),
                                    W.vadd(UI, UI);
                                    var Y = MI.distanceTo(b);
                                    !t.pointInTriangle(MI, QI, jI, UI) && !t.pointInTriangle(MI, jI, QI, UI) || Y > r || this.reportIntersection(i, MI, e, A, m)
                                }
                            }
                        }
                    }
                }
            }, {
                key: "_intersectTrimesh",
                value: function(g, I, C, A, e, o) {
                    var i = gC
                      , n = iC
                      , l = tC
                      , c = $I
                      , a = IC
                      , s = CC
                      , d = AC
                      , b = oC
                      , G = eC
                      , r = g.indices;
                    g.vertices;
                    var u = this.from
                      , B = this.to
                      , Z = this.direction;
                    l.position.copy(C),
                    l.quaternion.copy(I),
                    II.vectorToLocalFrame(C, I, Z, a),
                    II.pointToLocalFrame(C, I, u, s),
                    II.pointToLocalFrame(C, I, B, d),
                    d.x *= g.scale.x,
                    d.y *= g.scale.y,
                    d.z *= g.scale.z,
                    s.x *= g.scale.x,
                    s.y *= g.scale.y,
                    s.z *= g.scale.z,
                    d.vsub(s, a),
                    a.normalize();
                    var m = s.distanceSquared(d);
                    g.tree.rayQuery(this, l, n);
                    for (var h = 0, p = n.length; !this.result.shouldStop && h !== p; h++) {
                        var y = n[h];
                        g.getNormal(y, i),
                        g.getVertex(r[3 * y], QI),
                        QI.vsub(s, c);
                        var W = a.dot(i)
                          , v = i.dot(c) / W;
                        if (!(v < 0)) {
                            a.scale(v, MI),
                            MI.vadd(s, MI),
                            g.getVertex(r[3 * y + 1], jI),
                            g.getVertex(r[3 * y + 2], UI);
                            var V = MI.distanceSquared(s);
                            !t.pointInTriangle(MI, jI, QI, UI) && !t.pointInTriangle(MI, QI, jI, UI) || V > m || (II.vectorToWorldFrame(I, i, G),
                            II.pointToWorldFrame(C, I, MI, b),
                            this.reportIntersection(G, b, e, A, y))
                        }
                    }
                    n.length = 0
                }
            }, {
                key: "reportIntersection",
                value: function(g, I, C, A, e) {
                    var o = this.from
                      , i = this.to
                      , n = o.distanceTo(I)
                      , l = this.result;
                    if (!(this.skipBackfaces && g.dot(this.direction) > 0))
                        switch (l.hitFaceIndex = void 0 !== e ? e : -1,
                        this.mode) {
                        case t.ALL:
                            this.hasHit = !0,
                            l.set(o, i, g, I, C, A, n),
                            l.hasHit = !0,
                            this.callback(l);
                            break;
                        case t.CLOSEST:
                            (n < l.distance || !l.hasHit) && (this.hasHit = !0,
                            l.hasHit = !0,
                            l.set(o, i, g, I, C, A, n));
                            break;
                        case t.ANY:
                            this.hasHit = !0,
                            l.hasHit = !0,
                            l.set(o, i, g, I, C, A, n),
                            l.shouldStop = !0
                        }
                }
            }], [{
                key: "pointInTriangle",
                value: function(g, I, C, A) {
                    A.vsub(I, nC),
                    C.vsub(I, kI),
                    g.vsub(I, JI);
                    var e, o, i = nC.dot(nC), t = nC.dot(kI), n = nC.dot(JI), l = kI.dot(kI), c = kI.dot(JI);
                    return (e = l * n - t * c) >= 0 && (o = i * c - t * n) >= 0 && e + o < i * l - t * t
                }
            }])
        }(gI.types.SPHERE, gI.types.PLANE, gI.types.BOX, gI.types.CYLINDER, gI.types.CONVEXPOLYHEDRON, gI.types.HEIGHTFIELD, gI.types.TRIMESH);
        SI.CLOSEST = HI,
        SI.ANY = FI,
        SI.ALL = NI;
        var zI = new Tg
          , fI = []
          , kI = new Qg
          , JI = new Qg
          , LI = new Qg
          , xI = new qg
          , MI = new Qg
          , QI = new Qg
          , jI = new Qg
          , UI = new Qg;
        new Qg,
        new wI;
        var DI = {
            faceList: [0]
        }
          , TI = new Qg
          , OI = new SI
          , EI = []
          , PI = new Qg
          , qI = new Qg
          , _I = new Qg;
        new Qg,
        new Qg;
        var $I = new Qg
          , gC = new Qg
          , IC = new Qg
          , CC = new Qg
          , AC = new Qg
          , eC = new Qg
          , oC = new Qg;
        new Tg;
        var iC = []
          , tC = new II
          , nC = new Qg
          , lC = new Qg;
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg;
        var cC = ng((function g(I) {
            ig(this, g),
            void 0 === I && (I = {});
            var C = "";
            "string" == typeof I && (C = I,
            I = {}),
            this.name = C,
            this.id = g.idCounter++,
            this.friction = void 0 !== I.friction ? I.friction : -1,
            this.restitution = void 0 !== I.restitution ? I.restitution : -1
        }
        ));
        cC.idCounter = 0,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new SI,
        new Qg,
        new Qg,
        new Qg,
        new Qg(1,0,0),
        new Qg(0,1,0),
        new Qg(0,0,1),
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg;
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg;
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg;
        new Qg,
        new Tg,
        new Qg,
        new Tg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Tg,
        new Qg,
        new II,
        new Tg;
        gI.types.SPHERE,
        gI.types.SPHERE,
        gI.types.PLANE,
        gI.types.BOX,
        gI.types.BOX,
        gI.types.SPHERE,
        gI.types.BOX,
        gI.types.PLANE,
        gI.types.BOX,
        gI.types.CONVEXPOLYHEDRON,
        gI.types.SPHERE,
        gI.types.CONVEXPOLYHEDRON,
        gI.types.PLANE,
        gI.types.CONVEXPOLYHEDRON,
        gI.types.BOX,
        gI.types.CONVEXPOLYHEDRON,
        gI.types.SPHERE,
        gI.types.HEIGHTFIELD,
        gI.types.BOX,
        gI.types.HEIGHTFIELD,
        gI.types.CONVEXPOLYHEDRON,
        gI.types.HEIGHTFIELD,
        gI.types.PARTICLE,
        gI.types.SPHERE,
        gI.types.PLANE,
        gI.types.PARTICLE,
        gI.types.BOX,
        gI.types.PARTICLE,
        gI.types.PARTICLE,
        gI.types.CONVEXPOLYHEDRON,
        gI.types.CYLINDER,
        gI.types.SPHERE,
        gI.types.CYLINDER,
        gI.types.PLANE,
        gI.types.CYLINDER,
        gI.types.BOX,
        gI.types.CYLINDER,
        gI.types.CONVEXPOLYHEDRON,
        gI.types.CYLINDER,
        gI.types.HEIGHTFIELD,
        gI.types.CYLINDER,
        gI.types.PARTICLE,
        gI.types.CYLINDER,
        gI.types.SPHERE,
        gI.types.TRIMESH,
        gI.types.PLANE,
        gI.types.TRIMESH,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new qg,
        new qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Tg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Qg,
        new Tg,
        new SI;
        var aC = globalThis.performance || {};
        if (!aC.now) {
            var sC = Date.now();
            aC.timing && aC.timing.navigationStart && (sC = aC.timing.navigationStart),
            aC.now = function() {
                return Date.now() - sC
            }
        }
        new Qg;
        var dC = function() {
            function g(I) {
                ig(this, g),
                void 0 === I && (I = [0, 0, 0, 0, 0, 0, 0, 0, 0]),
                this.elements = I
            }
            return ng(g, [{
                key: "identity",
                value: function() {
                    var g = this.elements;
                    g[0] = 1,
                    g[1] = 0,
                    g[2] = 0,
                    g[3] = 0,
                    g[4] = 1,
                    g[5] = 0,
                    g[6] = 0,
                    g[7] = 0,
                    g[8] = 1
                }
            }, {
                key: "setZero",
                value: function() {
                    var g = this.elements;
                    g[0] = 0,
                    g[1] = 0,
                    g[2] = 0,
                    g[3] = 0,
                    g[4] = 0,
                    g[5] = 0,
                    g[6] = 0,
                    g[7] = 0,
                    g[8] = 0
                }
            }, {
                key: "setTrace",
                value: function(g) {
                    var I = this.elements;
                    I[0] = g.x,
                    I[4] = g.y,
                    I[8] = g.z
                }
            }, {
                key: "getTrace",
                value: function(g) {
                    void 0 === g && (g = new GC);
                    var I = this.elements;
                    return g.x = I[0],
                    g.y = I[4],
                    g.z = I[8],
                    g
                }
            }, {
                key: "vmult",
                value: function(g, I) {
                    void 0 === I && (I = new GC);
                    var C = this.elements
                      , A = g.x
                      , e = g.y
                      , o = g.z;
                    return I.x = C[0] * A + C[1] * e + C[2] * o,
                    I.y = C[3] * A + C[4] * e + C[5] * o,
                    I.z = C[6] * A + C[7] * e + C[8] * o,
                    I
                }
            }, {
                key: "smult",
                value: function(g) {
                    for (var I = 0; I < this.elements.length; I++)
                        this.elements[I] *= g
                }
            }, {
                key: "mmult",
                value: function(I, C) {
                    void 0 === C && (C = new g);
                    var A = this.elements
                      , e = I.elements
                      , o = C.elements
                      , i = A[0]
                      , t = A[1]
                      , n = A[2]
                      , l = A[3]
                      , c = A[4]
                      , a = A[5]
                      , s = A[6]
                      , d = A[7]
                      , b = A[8]
                      , G = e[0]
                      , r = e[1]
                      , u = e[2]
                      , B = e[3]
                      , Z = e[4]
                      , m = e[5]
                      , h = e[6]
                      , p = e[7]
                      , y = e[8];
                    return o[0] = i * G + t * B + n * h,
                    o[1] = i * r + t * Z + n * p,
                    o[2] = i * u + t * m + n * y,
                    o[3] = l * G + c * B + a * h,
                    o[4] = l * r + c * Z + a * p,
                    o[5] = l * u + c * m + a * y,
                    o[6] = s * G + d * B + b * h,
                    o[7] = s * r + d * Z + b * p,
                    o[8] = s * u + d * m + b * y,
                    C
                }
            }, {
                key: "scale",
                value: function(I, C) {
                    void 0 === C && (C = new g);
                    for (var A = this.elements, e = C.elements, o = 0; 3 !== o; o++)
                        e[3 * o + 0] = I.x * A[3 * o + 0],
                        e[3 * o + 1] = I.y * A[3 * o + 1],
                        e[3 * o + 2] = I.z * A[3 * o + 2];
                    return C
                }
            }, {
                key: "solve",
                value: function(g, I) {
                    void 0 === I && (I = new GC);
                    var C, A, e = [];
                    for (C = 0; C < 12; C++)
                        e.push(0);
                    for (C = 0; C < 3; C++)
                        for (A = 0; A < 3; A++)
                            e[C + 4 * A] = this.elements[C + 3 * A];
                    e[3] = g.x,
                    e[7] = g.y,
                    e[11] = g.z;
                    var o, i, t = 3, n = t;
                    do {
                        if (0 === e[(C = n - t) + 4 * C])
                            for (A = C + 1; A < n; A++)
                                if (0 !== e[C + 4 * A]) {
                                    o = 4;
                                    do {
                                        e[(i = 4 - o) + 4 * C] += e[i + 4 * A]
                                    } while (--o);
                                    break
                                }
                        if (0 !== e[C + 4 * C])
                            for (A = C + 1; A < n; A++) {
                                var l = e[C + 4 * A] / e[C + 4 * C];
                                o = 4;
                                do {
                                    e[(i = 4 - o) + 4 * A] = i <= C ? 0 : e[i + 4 * A] - e[i + 4 * C] * l
                                } while (--o)
                            }
                    } while (--t);
                    if (I.z = e[11] / e[10],
                    I.y = (e[7] - e[6] * I.z) / e[5],
                    I.x = (e[3] - e[2] * I.z - e[1] * I.y) / e[0],
                    isNaN(I.x) || isNaN(I.y) || isNaN(I.z) || I.x === 1 / 0 || I.y === 1 / 0 || I.z === 1 / 0)
                        throw "Could not solve equation! Got x=[".concat(I.toString(), "], b=[").concat(g.toString(), "], A=[").concat(this.toString(), "]");
                    return I
                }
            }, {
                key: "e",
                value: function(g, I, C) {
                    if (void 0 === C)
                        return this.elements[I + 3 * g];
                    this.elements[I + 3 * g] = C
                }
            }, {
                key: "copy",
                value: function(g) {
                    for (var I = 0; I < g.elements.length; I++)
                        this.elements[I] = g.elements[I];
                    return this
                }
            }, {
                key: "toString",
                value: function() {
                    for (var g = "", I = 0; I < 9; I++)
                        g += this.elements[I] + ",";
                    return g
                }
            }, {
                key: "reverse",
                value: function(I) {
                    void 0 === I && (I = new g);
                    var C, A, e = bC;
                    for (C = 0; C < 3; C++)
                        for (A = 0; A < 3; A++)
                            e[C + 6 * A] = this.elements[C + 3 * A];
                    e[3] = 1,
                    e[9] = 0,
                    e[15] = 0,
                    e[4] = 0,
                    e[10] = 1,
                    e[16] = 0,
                    e[5] = 0,
                    e[11] = 0,
                    e[17] = 1;
                    var o, i, t = 3, n = t;
                    do {
                        if (0 === e[(C = n - t) + 6 * C])
                            for (A = C + 1; A < n; A++)
                                if (0 !== e[C + 6 * A]) {
                                    o = 6;
                                    do {
                                        e[(i = 6 - o) + 6 * C] += e[i + 6 * A]
                                    } while (--o);
                                    break
                                }
                        if (0 !== e[C + 6 * C])
                            for (A = C + 1; A < n; A++) {
                                var l = e[C + 6 * A] / e[C + 6 * C];
                                o = 6;
                                do {
                                    e[(i = 6 - o) + 6 * A] = i <= C ? 0 : e[i + 6 * A] - e[i + 6 * C] * l
                                } while (--o)
                            }
                    } while (--t);
                    C = 2;
                    do {
                        A = C - 1;
                        do {
                            var c = e[C + 6 * A] / e[C + 6 * C];
                            o = 6;
                            do {
                                e[(i = 6 - o) + 6 * A] = e[i + 6 * A] - e[i + 6 * C] * c
                            } while (--o)
                        } while (A--)
                    } while (--C);
                    C = 2;
                    do {
                        var a = 1 / e[C + 6 * C];
                        o = 6;
                        do {
                            e[(i = 6 - o) + 6 * C] = e[i + 6 * C] * a
                        } while (--o)
                    } while (C--);
                    C = 2;
                    do {
                        A = 2;
                        do {
                            if (i = e[3 + A + 6 * C],
                            isNaN(i) || i === 1 / 0)
                                throw "Could not reverse! A=[".concat(this.toString(), "]");
                            I.e(C, A, i)
                        } while (A--)
                    } while (C--);
                    return I
                }
            }, {
                key: "setRotationFromQuaternion",
                value: function(g) {
                    var I = g.x
                      , C = g.y
                      , A = g.z
                      , e = g.w
                      , o = I + I
                      , i = C + C
                      , t = A + A
                      , n = I * o
                      , l = I * i
                      , c = I * t
                      , a = C * i
                      , s = C * t
                      , d = A * t
                      , b = e * o
                      , G = e * i
                      , r = e * t
                      , u = this.elements;
                    return u[0] = 1 - (a + d),
                    u[1] = l - r,
                    u[2] = c + G,
                    u[3] = l + r,
                    u[4] = 1 - (n + d),
                    u[5] = s - b,
                    u[6] = c - G,
                    u[7] = s + b,
                    u[8] = 1 - (n + a),
                    this
                }
            }, {
                key: "transpose",
                value: function(I) {
                    void 0 === I && (I = new g);
                    var C, A = this.elements, e = I.elements;
                    return e[0] = A[0],
                    e[4] = A[4],
                    e[8] = A[8],
                    C = A[1],
                    e[1] = A[3],
                    e[3] = C,
                    C = A[2],
                    e[2] = A[6],
                    e[6] = C,
                    C = A[5],
                    e[5] = A[7],
                    e[7] = C,
                    I
                }
            }])
        }()
          , bC = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
          , GC = function() {
            function g(I, C, A) {
                ig(this, g),
                void 0 === I && (I = 0),
                void 0 === C && (C = 0),
                void 0 === A && (A = 0),
                this.x = I,
                this.y = C,
                this.z = A
            }
            return ng(g, [{
                key: "cross",
                value: function(I, C) {
                    void 0 === C && (C = new g);
                    var A = I.x
                      , e = I.y
                      , o = I.z
                      , i = this.x
                      , t = this.y
                      , n = this.z;
                    return C.x = t * o - n * e,
                    C.y = n * A - i * o,
                    C.z = i * e - t * A,
                    C
                }
            }, {
                key: "set",
                value: function(g, I, C) {
                    return this.x = g,
                    this.y = I,
                    this.z = C,
                    this
                }
            }, {
                key: "setZero",
                value: function() {
                    this.x = this.y = this.z = 0
                }
            }, {
                key: "vadd",
                value: function(I, C) {
                    if (!C)
                        return new g(this.x + I.x,this.y + I.y,this.z + I.z);
                    C.x = I.x + this.x,
                    C.y = I.y + this.y,
                    C.z = I.z + this.z
                }
            }, {
                key: "vsub",
                value: function(I, C) {
                    if (!C)
                        return new g(this.x - I.x,this.y - I.y,this.z - I.z);
                    C.x = this.x - I.x,
                    C.y = this.y - I.y,
                    C.z = this.z - I.z
                }
            }, {
                key: "crossmat",
                value: function() {
                    return new dC([0, -this.z, this.y, this.z, 0, -this.x, -this.y, this.x, 0])
                }
            }, {
                key: "normalize",
                value: function() {
                    var g = this.x
                      , I = this.y
                      , C = this.z
                      , A = Math.sqrt(g * g + I * I + C * C);
                    if (A > 0) {
                        var e = 1 / A;
                        this.x *= e,
                        this.y *= e,
                        this.z *= e
                    } else
                        this.x = 0,
                        this.y = 0,
                        this.z = 0;
                    return A
                }
            }, {
                key: "unit",
                value: function(I) {
                    void 0 === I && (I = new g);
                    var C = this.x
                      , A = this.y
                      , e = this.z
                      , o = Math.sqrt(C * C + A * A + e * e);
                    return o > 0 ? (o = 1 / o,
                    I.x = C * o,
                    I.y = A * o,
                    I.z = e * o) : (I.x = 1,
                    I.y = 0,
                    I.z = 0),
                    I
                }
            }, {
                key: "length",
                value: function() {
                    var g = this.x
                      , I = this.y
                      , C = this.z;
                    return Math.sqrt(g * g + I * I + C * C)
                }
            }, {
                key: "lengthSquared",
                value: function() {
                    return this.dot(this)
                }
            }, {
                key: "distanceTo",
                value: function(g) {
                    var I = this.x
                      , C = this.y
                      , A = this.z
                      , e = g.x
                      , o = g.y
                      , i = g.z;
                    return Math.sqrt((e - I) * (e - I) + (o - C) * (o - C) + (i - A) * (i - A))
                }
            }, {
                key: "distanceSquared",
                value: function(g) {
                    var I = this.x
                      , C = this.y
                      , A = this.z
                      , e = g.x
                      , o = g.y
                      , i = g.z;
                    return (e - I) * (e - I) + (o - C) * (o - C) + (i - A) * (i - A)
                }
            }, {
                key: "scale",
                value: function(I, C) {
                    void 0 === C && (C = new g);
                    var A = this.x
                      , e = this.y
                      , o = this.z;
                    return C.x = I * A,
                    C.y = I * e,
                    C.z = I * o,
                    C
                }
            }, {
                key: "vmul",
                value: function(I, C) {
                    return void 0 === C && (C = new g),
                    C.x = I.x * this.x,
                    C.y = I.y * this.y,
                    C.z = I.z * this.z,
                    C
                }
            }, {
                key: "addScaledVector",
                value: function(I, C, A) {
                    return void 0 === A && (A = new g),
                    A.x = this.x + I * C.x,
                    A.y = this.y + I * C.y,
                    A.z = this.z + I * C.z,
                    A
                }
            }, {
                key: "dot",
                value: function(g) {
                    return this.x * g.x + this.y * g.y + this.z * g.z
                }
            }, {
                key: "isZero",
                value: function() {
                    return 0 === this.x && 0 === this.y && 0 === this.z
                }
            }, {
                key: "negate",
                value: function(I) {
                    return void 0 === I && (I = new g),
                    I.x = -this.x,
                    I.y = -this.y,
                    I.z = -this.z,
                    I
                }
            }, {
                key: "tangents",
                value: function(g, I) {
                    var C = this.length();
                    if (C > 0) {
                        var A = rC
                          , e = 1 / C;
                        A.set(this.x * e, this.y * e, this.z * e);
                        var o = uC;
                        Math.abs(A.x) < .9 ? (o.set(1, 0, 0),
                        A.cross(o, g)) : (o.set(0, 1, 0),
                        A.cross(o, g)),
                        A.cross(g, I)
                    } else
                        g.set(1, 0, 0),
                        I.set(0, 1, 0)
                }
            }, {
                key: "toString",
                value: function() {
                    return "".concat(this.x, ",").concat(this.y, ",").concat(this.z)
                }
            }, {
                key: "toArray",
                value: function() {
                    return [this.x, this.y, this.z]
                }
            }, {
                key: "copy",
                value: function(g) {
                    return this.x = g.x,
                    this.y = g.y,
                    this.z = g.z,
                    this
                }
            }, {
                key: "lerp",
                value: function(g, I, C) {
                    var A = this.x
                      , e = this.y
                      , o = this.z;
                    C.x = A + (g.x - A) * I,
                    C.y = e + (g.y - e) * I,
                    C.z = o + (g.z - o) * I
                }
            }, {
                key: "almostEquals",
                value: function(g, I) {
                    return void 0 === I && (I = 1e-6),
                    !(Math.abs(this.x - g.x) > I || Math.abs(this.y - g.y) > I || Math.abs(this.z - g.z) > I)
                }
            }, {
                key: "almostZero",
                value: function(g) {
                    return void 0 === g && (g = 1e-6),
                    !(Math.abs(this.x) > g || Math.abs(this.y) > g || Math.abs(this.z) > g)
                }
            }, {
                key: "isAntiparallelTo",
                value: function(g, I) {
                    return this.negate(BC),
                    BC.almostEquals(g, I)
                }
            }, {
                key: "clone",
                value: function() {
                    return new g(this.x,this.y,this.z)
                }
            }])
        }();
        GC.ZERO = new GC(0,0,0),
        GC.UNIT_X = new GC(1,0,0),
        GC.UNIT_Y = new GC(0,1,0),
        GC.UNIT_Z = new GC(0,0,1);
        var rC = new GC
          , uC = new GC
          , BC = new GC
          , ZC = function() {
            function g(I) {
                ig(this, g),
                void 0 === I && (I = {}),
                this.lowerBound = new GC,
                this.upperBound = new GC,
                I.lowerBound && this.lowerBound.copy(I.lowerBound),
                I.upperBound && this.upperBound.copy(I.upperBound)
            }
            return ng(g, [{
                key: "setFromPoints",
                value: function(g, I, C, A) {
                    var e = this.lowerBound
                      , o = this.upperBound
                      , i = C;
                    e.copy(g[0]),
                    i && i.vmult(e, e),
                    o.copy(e);
                    for (var t = 1; t < g.length; t++) {
                        var n = g[t];
                        i && (i.vmult(n, mC),
                        n = mC),
                        n.x > o.x && (o.x = n.x),
                        n.x < e.x && (e.x = n.x),
                        n.y > o.y && (o.y = n.y),
                        n.y < e.y && (e.y = n.y),
                        n.z > o.z && (o.z = n.z),
                        n.z < e.z && (e.z = n.z)
                    }
                    return I && (I.vadd(e, e),
                    I.vadd(o, o)),
                    A && (e.x -= A,
                    e.y -= A,
                    e.z -= A,
                    o.x += A,
                    o.y += A,
                    o.z += A),
                    this
                }
            }, {
                key: "copy",
                value: function(g) {
                    return this.lowerBound.copy(g.lowerBound),
                    this.upperBound.copy(g.upperBound),
                    this
                }
            }, {
                key: "clone",
                value: function() {
                    return (new g).copy(this)
                }
            }, {
                key: "extend",
                value: function(g) {
                    this.lowerBound.x = Math.min(this.lowerBound.x, g.lowerBound.x),
                    this.upperBound.x = Math.max(this.upperBound.x, g.upperBound.x),
                    this.lowerBound.y = Math.min(this.lowerBound.y, g.lowerBound.y),
                    this.upperBound.y = Math.max(this.upperBound.y, g.upperBound.y),
                    this.lowerBound.z = Math.min(this.lowerBound.z, g.lowerBound.z),
                    this.upperBound.z = Math.max(this.upperBound.z, g.upperBound.z)
                }
            }, {
                key: "overlaps",
                value: function(g) {
                    var I = this.lowerBound
                      , C = this.upperBound
                      , A = g.lowerBound
                      , e = g.upperBound
                      , o = A.x <= C.x && C.x <= e.x || I.x <= e.x && e.x <= C.x
                      , i = A.y <= C.y && C.y <= e.y || I.y <= e.y && e.y <= C.y
                      , t = A.z <= C.z && C.z <= e.z || I.z <= e.z && e.z <= C.z;
                    return o && i && t
                }
            }, {
                key: "volume",
                value: function() {
                    var g = this.lowerBound
                      , I = this.upperBound;
                    return (I.x - g.x) * (I.y - g.y) * (I.z - g.z)
                }
            }, {
                key: "contains",
                value: function(g) {
                    var I = this.lowerBound
                      , C = this.upperBound
                      , A = g.lowerBound
                      , e = g.upperBound;
                    return I.x <= A.x && C.x >= e.x && I.y <= A.y && C.y >= e.y && I.z <= A.z && C.z >= e.z
                }
            }, {
                key: "getCorners",
                value: function(g, I, C, A, e, o, i, t) {
                    var n = this.lowerBound
                      , l = this.upperBound;
                    g.copy(n),
                    I.set(l.x, n.y, n.z),
                    C.set(l.x, l.y, n.z),
                    A.set(n.x, l.y, l.z),
                    e.set(l.x, n.y, l.z),
                    o.set(n.x, l.y, n.z),
                    i.set(n.x, n.y, l.z),
                    t.copy(l)
                }
            }, {
                key: "toLocalFrame",
                value: function(g, I) {
                    var C = hC
                      , A = C[0]
                      , e = C[1]
                      , o = C[2]
                      , i = C[3]
                      , t = C[4]
                      , n = C[5]
                      , l = C[6]
                      , c = C[7];
                    this.getCorners(A, e, o, i, t, n, l, c);
                    for (var a = 0; 8 !== a; a++) {
                        var s = C[a];
                        g.pointToLocal(s, s)
                    }
                    return I.setFromPoints(C)
                }
            }, {
                key: "toWorldFrame",
                value: function(g, I) {
                    var C = hC
                      , A = C[0]
                      , e = C[1]
                      , o = C[2]
                      , i = C[3]
                      , t = C[4]
                      , n = C[5]
                      , l = C[6]
                      , c = C[7];
                    this.getCorners(A, e, o, i, t, n, l, c);
                    for (var a = 0; 8 !== a; a++) {
                        var s = C[a];
                        g.pointToWorld(s, s)
                    }
                    return I.setFromPoints(C)
                }
            }, {
                key: "overlapsRay",
                value: function(g) {
                    var I = g.direction
                      , C = g.from
                      , A = 1 / I.x
                      , e = 1 / I.y
                      , o = 1 / I.z
                      , i = (this.lowerBound.x - C.x) * A
                      , t = (this.upperBound.x - C.x) * A
                      , n = (this.lowerBound.y - C.y) * e
                      , l = (this.upperBound.y - C.y) * e
                      , c = (this.lowerBound.z - C.z) * o
                      , a = (this.upperBound.z - C.z) * o
                      , s = Math.max(Math.max(Math.min(i, t), Math.min(n, l)), Math.min(c, a))
                      , d = Math.min(Math.min(Math.max(i, t), Math.max(n, l)), Math.max(c, a));
                    return !(d < 0) && !(s > d)
                }
            }])
        }()
          , mC = new GC
          , hC = [new GC, new GC, new GC, new GC, new GC, new GC, new GC, new GC]
          , pC = function() {
            function g(I, C, A, e) {
                ig(this, g),
                void 0 === I && (I = 0),
                void 0 === C && (C = 0),
                void 0 === A && (A = 0),
                void 0 === e && (e = 1),
                this.x = I,
                this.y = C,
                this.z = A,
                this.w = e
            }
            return ng(g, [{
                key: "set",
                value: function(g, I, C, A) {
                    return this.x = g,
                    this.y = I,
                    this.z = C,
                    this.w = A,
                    this
                }
            }, {
                key: "toString",
                value: function() {
                    return "".concat(this.x, ",").concat(this.y, ",").concat(this.z, ",").concat(this.w)
                }
            }, {
                key: "toArray",
                value: function() {
                    return [this.x, this.y, this.z, this.w]
                }
            }, {
                key: "setFromAxisAngle",
                value: function(g, I) {
                    var C = Math.sin(.5 * I);
                    return this.x = g.x * C,
                    this.y = g.y * C,
                    this.z = g.z * C,
                    this.w = Math.cos(.5 * I),
                    this
                }
            }, {
                key: "toAxisAngle",
                value: function(g) {
                    void 0 === g && (g = new GC),
                    this.normalize();
                    var I = 2 * Math.acos(this.w)
                      , C = Math.sqrt(1 - this.w * this.w);
                    return C < .001 ? (g.x = this.x,
                    g.y = this.y,
                    g.z = this.z) : (g.x = this.x / C,
                    g.y = this.y / C,
                    g.z = this.z / C),
                    [g, I]
                }
            }, {
                key: "setFromVectors",
                value: function(g, I) {
                    if (g.isAntiparallelTo(I)) {
                        var C = yC
                          , A = WC;
                        g.tangents(C, A),
                        this.setFromAxisAngle(C, Math.PI)
                    } else {
                        var e = g.cross(I);
                        this.x = e.x,
                        this.y = e.y,
                        this.z = e.z,
                        this.w = Math.sqrt(Math.pow(g.length(), 2) * Math.pow(I.length(), 2)) + g.dot(I),
                        this.normalize()
                    }
                    return this
                }
            }, {
                key: "mult",
                value: function(I, C) {
                    void 0 === C && (C = new g);
                    var A = this.x
                      , e = this.y
                      , o = this.z
                      , i = this.w
                      , t = I.x
                      , n = I.y
                      , l = I.z
                      , c = I.w;
                    return C.x = A * c + i * t + e * l - o * n,
                    C.y = e * c + i * n + o * t - A * l,
                    C.z = o * c + i * l + A * n - e * t,
                    C.w = i * c - A * t - e * n - o * l,
                    C
                }
            }, {
                key: "inverse",
                value: function(I) {
                    void 0 === I && (I = new g);
                    var C = this.x
                      , A = this.y
                      , e = this.z
                      , o = this.w;
                    this.conjugate(I);
                    var i = 1 / (C * C + A * A + e * e + o * o);
                    return I.x *= i,
                    I.y *= i,
                    I.z *= i,
                    I.w *= i,
                    I
                }
            }, {
                key: "conjugate",
                value: function(I) {
                    return void 0 === I && (I = new g),
                    I.x = -this.x,
                    I.y = -this.y,
                    I.z = -this.z,
                    I.w = this.w,
                    I
                }
            }, {
                key: "normalize",
                value: function() {
                    var g = Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w);
                    return 0 === g ? (this.x = 0,
                    this.y = 0,
                    this.z = 0,
                    this.w = 0) : (g = 1 / g,
                    this.x *= g,
                    this.y *= g,
                    this.z *= g,
                    this.w *= g),
                    this
                }
            }, {
                key: "normalizeFast",
                value: function() {
                    var g = (3 - (this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w)) / 2;
                    return 0 === g ? (this.x = 0,
                    this.y = 0,
                    this.z = 0,
                    this.w = 0) : (this.x *= g,
                    this.y *= g,
                    this.z *= g,
                    this.w *= g),
                    this
                }
            }, {
                key: "vmult",
                value: function(g, I) {
                    void 0 === I && (I = new GC);
                    var C = g.x
                      , A = g.y
                      , e = g.z
                      , o = this.x
                      , i = this.y
                      , t = this.z
                      , n = this.w
                      , l = n * C + i * e - t * A
                      , c = n * A + t * C - o * e
                      , a = n * e + o * A - i * C
                      , s = -o * C - i * A - t * e;
                    return I.x = l * n + s * -o + c * -t - a * -i,
                    I.y = c * n + s * -i + a * -o - l * -t,
                    I.z = a * n + s * -t + l * -i - c * -o,
                    I
                }
            }, {
                key: "copy",
                value: function(g) {
                    return this.x = g.x,
                    this.y = g.y,
                    this.z = g.z,
                    this.w = g.w,
                    this
                }
            }, {
                key: "toEuler",
                value: function(g, I) {
                    var C, A, e;
                    void 0 === I && (I = "YZX");
                    var o = this.x
                      , i = this.y
                      , t = this.z
                      , n = this.w;
                    switch (I) {
                    case "YZX":
                        var l = o * i + t * n;
                        if (l > .499 && (C = 2 * Math.atan2(o, n),
                        A = Math.PI / 2,
                        e = 0),
                        l < -.499 && (C = -2 * Math.atan2(o, n),
                        A = -Math.PI / 2,
                        e = 0),
                        void 0 === C) {
                            var c = o * o
                              , a = i * i
                              , s = t * t;
                            C = Math.atan2(2 * i * n - 2 * o * t, 1 - 2 * a - 2 * s),
                            A = Math.asin(2 * l),
                            e = Math.atan2(2 * o * n - 2 * i * t, 1 - 2 * c - 2 * s)
                        }
                        break;
                    default:
                        throw new Error("Euler order ".concat(I, " not supported yet."))
                    }
                    g.y = C,
                    g.z = A,
                    g.x = e
                }
            }, {
                key: "setFromEuler",
                value: function(g, I, C, A) {
                    void 0 === A && (A = "XYZ");
                    var e = Math.cos(g / 2)
                      , o = Math.cos(I / 2)
                      , i = Math.cos(C / 2)
                      , t = Math.sin(g / 2)
                      , n = Math.sin(I / 2)
                      , l = Math.sin(C / 2);
                    return "XYZ" === A ? (this.x = t * o * i + e * n * l,
                    this.y = e * n * i - t * o * l,
                    this.z = e * o * l + t * n * i,
                    this.w = e * o * i - t * n * l) : "YXZ" === A ? (this.x = t * o * i + e * n * l,
                    this.y = e * n * i - t * o * l,
                    this.z = e * o * l - t * n * i,
                    this.w = e * o * i + t * n * l) : "ZXY" === A ? (this.x = t * o * i - e * n * l,
                    this.y = e * n * i + t * o * l,
                    this.z = e * o * l + t * n * i,
                    this.w = e * o * i - t * n * l) : "ZYX" === A ? (this.x = t * o * i - e * n * l,
                    this.y = e * n * i + t * o * l,
                    this.z = e * o * l - t * n * i,
                    this.w = e * o * i + t * n * l) : "YZX" === A ? (this.x = t * o * i + e * n * l,
                    this.y = e * n * i + t * o * l,
                    this.z = e * o * l - t * n * i,
                    this.w = e * o * i - t * n * l) : "XZY" === A && (this.x = t * o * i - e * n * l,
                    this.y = e * n * i - t * o * l,
                    this.z = e * o * l + t * n * i,
                    this.w = e * o * i + t * n * l),
                    this
                }
            }, {
                key: "clone",
                value: function() {
                    return new g(this.x,this.y,this.z,this.w)
                }
            }, {
                key: "slerp",
                value: function(I, C, A) {
                    void 0 === A && (A = new g);
                    var e, o, i, t, n, l = this.x, c = this.y, a = this.z, s = this.w, d = I.x, b = I.y, G = I.z, r = I.w;
                    return (o = l * d + c * b + a * G + s * r) < 0 && (o = -o,
                    d = -d,
                    b = -b,
                    G = -G,
                    r = -r),
                    1 - o > 1e-6 ? (e = Math.acos(o),
                    i = Math.sin(e),
                    t = Math.sin((1 - C) * e) / i,
                    n = Math.sin(C * e) / i) : (t = 1 - C,
                    n = C),
                    A.x = t * l + n * d,
                    A.y = t * c + n * b,
                    A.z = t * a + n * G,
                    A.w = t * s + n * r,
                    A
                }
            }, {
                key: "integrate",
                value: function(I, C, A, e) {
                    void 0 === e && (e = new g);
                    var o = I.x * A.x
                      , i = I.y * A.y
                      , t = I.z * A.z
                      , n = this.x
                      , l = this.y
                      , c = this.z
                      , a = this.w
                      , s = .5 * C;
                    return e.x += s * (o * a + i * c - t * l),
                    e.y += s * (i * a + t * n - o * c),
                    e.z += s * (t * a + o * l - i * n),
                    e.w += s * (-o * n - i * l - t * c),
                    e
                }
            }])
        }()
          , yC = new GC
          , WC = new GC
          , vC = function() {
            return ng((function g(I) {
                ig(this, g),
                void 0 === I && (I = {}),
                this.id = g.idCounter++,
                this.type = I.type || 0,
                this.boundingSphereRadius = 0,
                this.collisionResponse = !I.collisionResponse || I.collisionResponse,
                this.collisionFilterGroup = void 0 !== I.collisionFilterGroup ? I.collisionFilterGroup : 1,
                this.collisionFilterMask = void 0 !== I.collisionFilterMask ? I.collisionFilterMask : -1,
                this.material = I.material ? I.material : null,
                this.body = null
            }
            ), [{
                key: "updateBoundingSphereRadius",
                value: function() {
                    throw "computeBoundingSphereRadius() not implemented for shape type ".concat(this.type)
                }
            }, {
                key: "volume",
                value: function() {
                    throw "volume() not implemented for shape type ".concat(this.type)
                }
            }, {
                key: "calculateLocalInertia",
                value: function(g, I) {
                    throw "calculateLocalInertia() not implemented for shape type ".concat(this.type)
                }
            }, {
                key: "calculateWorldAABB",
                value: function(g, I, C, A) {
                    throw "calculateWorldAABB() not implemented for shape type ".concat(this.type)
                }
            }])
        }();
        vC.idCounter = 0,
        vC.types = {
            SPHERE: 1,
            PLANE: 2,
            BOX: 4,
            COMPOUND: 8,
            CONVEXPOLYHEDRON: 16,
            HEIGHTFIELD: 32,
            PARTICLE: 64,
            CYLINDER: 128,
            TRIMESH: 256
        };
        var VC = function() {
            function g(I) {
                ig(this, g),
                void 0 === I && (I = {}),
                this.position = new GC,
                this.quaternion = new pC,
                I.position && this.position.copy(I.position),
                I.quaternion && this.quaternion.copy(I.quaternion)
            }
            return ng(g, [{
                key: "pointToLocal",
                value: function(I, C) {
                    return g.pointToLocalFrame(this.position, this.quaternion, I, C)
                }
            }, {
                key: "pointToWorld",
                value: function(I, C) {
                    return g.pointToWorldFrame(this.position, this.quaternion, I, C)
                }
            }, {
                key: "vectorToWorldFrame",
                value: function(g, I) {
                    return void 0 === I && (I = new GC),
                    this.quaternion.vmult(g, I),
                    I
                }
            }], [{
                key: "pointToLocalFrame",
                value: function(g, I, C, A) {
                    return void 0 === A && (A = new GC),
                    C.vsub(g, A),
                    I.conjugate(XC),
                    XC.vmult(A, A),
                    A
                }
            }, {
                key: "pointToWorldFrame",
                value: function(g, I, C, A) {
                    return void 0 === A && (A = new GC),
                    I.vmult(C, A),
                    A.vadd(g, A),
                    A
                }
            }, {
                key: "vectorToWorldFrame",
                value: function(g, I, C) {
                    return void 0 === C && (C = new GC),
                    g.vmult(I, C),
                    C
                }
            }, {
                key: "vectorToLocalFrame",
                value: function(g, I, C, A) {
                    return void 0 === A && (A = new GC),
                    I.w *= -1,
                    I.vmult(C, A),
                    I.w *= -1,
                    A
                }
            }])
        }()
          , XC = new pC;
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new pC,
        new ZC,
        new dC,
        new dC,
        new dC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new pC,
        new GC,
        new GC,
        new GC,
        new GC;
        var YC = function() {
            return ng((function g() {
                ig(this, g),
                this.rayFromWorld = new GC,
                this.rayToWorld = new GC,
                this.hitNormalWorld = new GC,
                this.hitPointWorld = new GC,
                this.hasHit = !1,
                this.shape = null,
                this.body = null,
                this.hitFaceIndex = -1,
                this.distance = -1,
                this.shouldStop = !1
            }
            ), [{
                key: "reset",
                value: function() {
                    this.rayFromWorld.setZero(),
                    this.rayToWorld.setZero(),
                    this.hitNormalWorld.setZero(),
                    this.hitPointWorld.setZero(),
                    this.hasHit = !1,
                    this.shape = null,
                    this.body = null,
                    this.hitFaceIndex = -1,
                    this.distance = -1,
                    this.shouldStop = !1
                }
            }, {
                key: "abort",
                value: function() {
                    this.shouldStop = !0
                }
            }, {
                key: "set",
                value: function(g, I, C, A, e, o, i) {
                    this.rayFromWorld.copy(g),
                    this.rayToWorld.copy(I),
                    this.hitNormalWorld.copy(C),
                    this.hitPointWorld.copy(A),
                    this.shape = e,
                    this.body = o,
                    this.distance = i
                }
            }])
        }()
          , KC = 1
          , RC = 2
          , wC = 4
          , HC = function(g, I, C, A, e, o, i) {
            function t(g, I) {
                ig(this, t),
                void 0 === g && (g = new GC),
                void 0 === I && (I = new GC),
                this.from = g.clone(),
                this.to = I.clone(),
                this.direction = new GC,
                this.precision = 1e-4,
                this.checkCollisionResponse = !0,
                this.skipBackfaces = !1,
                this.collisionFilterMask = -1,
                this.collisionFilterGroup = -1,
                this.mode = t.ANY,
                this.result = new YC,
                this.hasHit = !1,
                this.callback = function(g) {}
            }
            return ng(t, [{
                key: g,
                get: function() {
                    return this._intersectSphere
                }
            }, {
                key: I,
                get: function() {
                    return this._intersectPlane
                }
            }, {
                key: C,
                get: function() {
                    return this._intersectBox
                }
            }, {
                key: A,
                get: function() {
                    return this._intersectConvex
                }
            }, {
                key: e,
                get: function() {
                    return this._intersectConvex
                }
            }, {
                key: o,
                get: function() {
                    return this._intersectHeightfield
                }
            }, {
                key: i,
                get: function() {
                    return this._intersectTrimesh
                }
            }, {
                key: "intersectWorld",
                value: function(g, I) {
                    return this.mode = I.mode || t.ANY,
                    this.result = I.result || new YC,
                    this.skipBackfaces = !!I.skipBackfaces,
                    this.collisionFilterMask = void 0 !== I.collisionFilterMask ? I.collisionFilterMask : -1,
                    this.collisionFilterGroup = void 0 !== I.collisionFilterGroup ? I.collisionFilterGroup : -1,
                    this.checkCollisionResponse = void 0 === I.checkCollisionResponse || I.checkCollisionResponse,
                    I.from && this.from.copy(I.from),
                    I.to && this.to.copy(I.to),
                    this.callback = I.callback || function() {}
                    ,
                    this.hasHit = !1,
                    this.result.reset(),
                    this.updateDirection(),
                    this.getAABB(FC),
                    NC.length = 0,
                    g.broadphase.aabbQuery(g, FC, NC),
                    this.intersectBodies(NC),
                    this.hasHit
                }
            }, {
                key: "intersectBody",
                value: function(g, I) {
                    I && (this.result = I,
                    this.updateDirection());
                    var C = this.checkCollisionResponse;
                    if ((!C || g.collisionResponse) && 0 != (this.collisionFilterGroup & g.collisionFilterMask) && 0 != (g.collisionFilterGroup & this.collisionFilterMask))
                        for (var A = fC, e = kC, o = 0, i = g.shapes.length; o < i; o++) {
                            var t = g.shapes[o];
                            if ((!C || t.collisionResponse) && (g.quaternion.mult(g.shapeOrientations[o], e),
                            g.quaternion.vmult(g.shapeOffsets[o], A),
                            A.vadd(g.position, A),
                            this.intersectShape(t, e, A, g),
                            this.result.shouldStop))
                                break
                        }
                }
            }, {
                key: "intersectBodies",
                value: function(g, I) {
                    I && (this.result = I,
                    this.updateDirection());
                    for (var C = 0, A = g.length; !this.result.shouldStop && C < A; C++)
                        this.intersectBody(g[C])
                }
            }, {
                key: "updateDirection",
                value: function() {
                    this.to.vsub(this.from, this.direction),
                    this.direction.normalize()
                }
            }, {
                key: "intersectShape",
                value: function(g, I, C, A) {
                    if (!(function(g, I, C) {
                        C.vsub(g, oA);
                        var A = oA.dot(I);
                        return I.scale(A, iA),
                        iA.vadd(g, iA),
                        C.distanceTo(iA)
                    }(this.from, this.direction, C) > g.boundingSphereRadius)) {
                        var e = this[g.type];
                        e && e.call(this, g, I, C, A, g)
                    }
                }
            }, {
                key: "_intersectBox",
                value: function(g, I, C, A, e) {
                    return this._intersectConvex(g.convexPolyhedronRepresentation, I, C, A, e)
                }
            }, {
                key: "_intersectPlane",
                value: function(g, I, C, A, e) {
                    var o = this.from
                      , i = this.to
                      , t = this.direction
                      , n = new GC(0,0,1);
                    I.vmult(n, n);
                    var l = new GC;
                    o.vsub(C, l);
                    var c = l.dot(n);
                    if (i.vsub(C, l),
                    !(c * l.dot(n) > 0 || o.distanceTo(i) < c)) {
                        var a = n.dot(t);
                        if (!(Math.abs(a) < this.precision)) {
                            var s = new GC
                              , d = new GC
                              , b = new GC;
                            o.vsub(C, s);
                            var G = -n.dot(s) / a;
                            t.scale(G, d),
                            o.vadd(d, b),
                            this.reportIntersection(n, b, e, A, -1)
                        }
                    }
                }
            }, {
                key: "getAABB",
                value: function(g) {
                    var I = g.lowerBound
                      , C = g.upperBound
                      , A = this.to
                      , e = this.from;
                    I.x = Math.min(A.x, e.x),
                    I.y = Math.min(A.y, e.y),
                    I.z = Math.min(A.z, e.z),
                    C.x = Math.max(A.x, e.x),
                    C.y = Math.max(A.y, e.y),
                    C.z = Math.max(A.z, e.z)
                }
            }, {
                key: "_intersectHeightfield",
                value: function(g, I, C, A, e) {
                    g.data,
                    g.elementSize;
                    var o = UC;
                    o.from.copy(this.from),
                    o.to.copy(this.to),
                    VC.pointToLocalFrame(C, I, o.from, o.from),
                    VC.pointToLocalFrame(C, I, o.to, o.to),
                    o.updateDirection();
                    var i, t, n, l, c = DC;
                    i = t = 0,
                    n = l = g.data.length - 1;
                    var a = new ZC;
                    o.getAABB(a),
                    g.getIndexOfPosition(a.lowerBound.x, a.lowerBound.y, c, !0),
                    i = Math.max(i, c[0]),
                    t = Math.max(t, c[1]),
                    g.getIndexOfPosition(a.upperBound.x, a.upperBound.y, c, !0),
                    n = Math.min(n, c[0] + 1),
                    l = Math.min(l, c[1] + 1);
                    for (var s = i; s < n; s++)
                        for (var d = t; d < l; d++) {
                            if (this.result.shouldStop)
                                return;
                            if (g.getAabbAtIndex(s, d, a),
                            a.overlapsRay(o)) {
                                if (g.getConvexTrianglePillar(s, d, !1),
                                VC.pointToWorldFrame(C, I, g.pillarOffset, jC),
                                this._intersectConvex(g.pillarConvex, I, jC, A, e, QC),
                                this.result.shouldStop)
                                    return;
                                g.getConvexTrianglePillar(s, d, !0),
                                VC.pointToWorldFrame(C, I, g.pillarOffset, jC),
                                this._intersectConvex(g.pillarConvex, I, jC, A, e, QC)
                            }
                        }
                }
            }, {
                key: "_intersectSphere",
                value: function(g, I, C, A, e) {
                    var o = this.from
                      , i = this.to
                      , t = g.radius
                      , n = Math.pow(i.x - o.x, 2) + Math.pow(i.y - o.y, 2) + Math.pow(i.z - o.z, 2)
                      , l = 2 * ((i.x - o.x) * (o.x - C.x) + (i.y - o.y) * (o.y - C.y) + (i.z - o.z) * (o.z - C.z))
                      , c = Math.pow(o.x - C.x, 2) + Math.pow(o.y - C.y, 2) + Math.pow(o.z - C.z, 2) - Math.pow(t, 2)
                      , a = Math.pow(l, 2) - 4 * n * c
                      , s = TC
                      , d = OC;
                    if (!(a < 0))
                        if (0 === a)
                            o.lerp(i, a, s),
                            s.vsub(C, d),
                            d.normalize(),
                            this.reportIntersection(d, s, e, A, -1);
                        else {
                            var b = (-l - Math.sqrt(a)) / (2 * n)
                              , G = (-l + Math.sqrt(a)) / (2 * n);
                            if (b >= 0 && b <= 1 && (o.lerp(i, b, s),
                            s.vsub(C, d),
                            d.normalize(),
                            this.reportIntersection(d, s, e, A, -1)),
                            this.result.shouldStop)
                                return;
                            G >= 0 && G <= 1 && (o.lerp(i, G, s),
                            s.vsub(C, d),
                            d.normalize(),
                            this.reportIntersection(d, s, e, A, -1))
                        }
                }
            }, {
                key: "_intersectConvex",
                value: function(g, I, C, A, e, o) {
                    for (var i = EC, n = PC, l = o && o.faceList || null, c = g.faces, a = g.vertices, s = g.faceNormals, d = this.direction, b = this.from, G = this.to, r = b.distanceTo(G), u = l ? l.length : c.length, B = this.result, Z = 0; !B.shouldStop && Z < u; Z++) {
                        var m = l ? l[Z] : Z
                          , h = c[m]
                          , p = s[m]
                          , y = I
                          , W = C;
                        n.copy(a[h[0]]),
                        y.vmult(n, n),
                        n.vadd(W, n),
                        n.vsub(b, n),
                        y.vmult(p, i);
                        var v = d.dot(i);
                        if (!(Math.abs(v) < this.precision)) {
                            var V = i.dot(n) / v;
                            if (!(V < 0)) {
                                d.scale(V, JC),
                                JC.vadd(b, JC),
                                LC.copy(a[h[0]]),
                                y.vmult(LC, LC),
                                W.vadd(LC, LC);
                                for (var X = 1; !B.shouldStop && X < h.length - 1; X++) {
                                    xC.copy(a[h[X]]),
                                    MC.copy(a[h[X + 1]]),
                                    y.vmult(xC, xC),
                                    y.vmult(MC, MC),
                                    W.vadd(xC, xC),
                                    W.vadd(MC, MC);
                                    var Y = JC.distanceTo(b);
                                    !t.pointInTriangle(JC, LC, xC, MC) && !t.pointInTriangle(JC, xC, LC, MC) || Y > r || this.reportIntersection(i, JC, e, A, m)
                                }
                            }
                        }
                    }
                }
            }, {
                key: "_intersectTrimesh",
                value: function(g, I, C, A, e, o) {
                    var i = qC
                      , n = AA
                      , l = eA
                      , c = PC
                      , a = _C
                      , s = $C
                      , d = gA
                      , b = CA
                      , G = IA
                      , r = g.indices;
                    g.vertices;
                    var u = this.from
                      , B = this.to
                      , Z = this.direction;
                    l.position.copy(C),
                    l.quaternion.copy(I),
                    VC.vectorToLocalFrame(C, I, Z, a),
                    VC.pointToLocalFrame(C, I, u, s),
                    VC.pointToLocalFrame(C, I, B, d),
                    d.x *= g.scale.x,
                    d.y *= g.scale.y,
                    d.z *= g.scale.z,
                    s.x *= g.scale.x,
                    s.y *= g.scale.y,
                    s.z *= g.scale.z,
                    d.vsub(s, a),
                    a.normalize();
                    var m = s.distanceSquared(d);
                    g.tree.rayQuery(this, l, n);
                    for (var h = 0, p = n.length; !this.result.shouldStop && h !== p; h++) {
                        var y = n[h];
                        g.getNormal(y, i),
                        g.getVertex(r[3 * y], LC),
                        LC.vsub(s, c);
                        var W = a.dot(i)
                          , v = i.dot(c) / W;
                        if (!(v < 0)) {
                            a.scale(v, JC),
                            JC.vadd(s, JC),
                            g.getVertex(r[3 * y + 1], xC),
                            g.getVertex(r[3 * y + 2], MC);
                            var V = JC.distanceSquared(s);
                            !t.pointInTriangle(JC, xC, LC, MC) && !t.pointInTriangle(JC, LC, xC, MC) || V > m || (VC.vectorToWorldFrame(I, i, G),
                            VC.pointToWorldFrame(C, I, JC, b),
                            this.reportIntersection(G, b, e, A, y))
                        }
                    }
                    n.length = 0
                }
            }, {
                key: "reportIntersection",
                value: function(g, I, C, A, e) {
                    var o = this.from
                      , i = this.to
                      , n = o.distanceTo(I)
                      , l = this.result;
                    if (!(this.skipBackfaces && g.dot(this.direction) > 0))
                        switch (l.hitFaceIndex = void 0 !== e ? e : -1,
                        this.mode) {
                        case t.ALL:
                            this.hasHit = !0,
                            l.set(o, i, g, I, C, A, n),
                            l.hasHit = !0,
                            this.callback(l);
                            break;
                        case t.CLOSEST:
                            (n < l.distance || !l.hasHit) && (this.hasHit = !0,
                            l.hasHit = !0,
                            l.set(o, i, g, I, C, A, n));
                            break;
                        case t.ANY:
                            this.hasHit = !0,
                            l.hasHit = !0,
                            l.set(o, i, g, I, C, A, n),
                            l.shouldStop = !0
                        }
                }
            }], [{
                key: "pointInTriangle",
                value: function(g, I, C, A) {
                    A.vsub(I, oA),
                    C.vsub(I, SC),
                    g.vsub(I, zC);
                    var e, o, i = oA.dot(oA), t = oA.dot(SC), n = oA.dot(zC), l = SC.dot(SC), c = SC.dot(zC);
                    return (e = l * n - t * c) >= 0 && (o = i * c - t * n) >= 0 && e + o < i * l - t * t
                }
            }])
        }(vC.types.SPHERE, vC.types.PLANE, vC.types.BOX, vC.types.CYLINDER, vC.types.CONVEXPOLYHEDRON, vC.types.HEIGHTFIELD, vC.types.TRIMESH);
        HC.CLOSEST = KC,
        HC.ANY = RC,
        HC.ALL = wC;
        var FC = new ZC
          , NC = []
          , SC = new GC
          , zC = new GC
          , fC = new GC
          , kC = new pC
          , JC = new GC
          , LC = new GC
          , xC = new GC
          , MC = new GC;
        new GC,
        new YC;
        var QC = {
            faceList: [0]
        }
          , jC = new GC
          , UC = new HC
          , DC = []
          , TC = new GC
          , OC = new GC
          , EC = new GC;
        new GC,
        new GC;
        var PC = new GC
          , qC = new GC
          , _C = new GC
          , $C = new GC
          , gA = new GC
          , IA = new GC
          , CA = new GC;
        new ZC;
        var AA = []
          , eA = new VC
          , oA = new GC
          , iA = new GC;
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new HC,
        new GC,
        new GC,
        new GC,
        new GC(1,0,0),
        new GC(0,1,0),
        new GC(0,0,1),
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new ZC,
        new GC,
        new ZC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new ZC,
        new GC,
        new VC,
        new ZC,
        vC.types.SPHERE,
        vC.types.SPHERE,
        vC.types.PLANE,
        vC.types.BOX,
        vC.types.BOX,
        vC.types.SPHERE,
        vC.types.BOX,
        vC.types.PLANE,
        vC.types.BOX,
        vC.types.CONVEXPOLYHEDRON,
        vC.types.SPHERE,
        vC.types.CONVEXPOLYHEDRON,
        vC.types.PLANE,
        vC.types.CONVEXPOLYHEDRON,
        vC.types.BOX,
        vC.types.CONVEXPOLYHEDRON,
        vC.types.SPHERE,
        vC.types.HEIGHTFIELD,
        vC.types.BOX,
        vC.types.HEIGHTFIELD,
        vC.types.CONVEXPOLYHEDRON,
        vC.types.HEIGHTFIELD,
        vC.types.PARTICLE,
        vC.types.SPHERE,
        vC.types.PLANE,
        vC.types.PARTICLE,
        vC.types.BOX,
        vC.types.PARTICLE,
        vC.types.PARTICLE,
        vC.types.CONVEXPOLYHEDRON,
        vC.types.CYLINDER,
        vC.types.SPHERE,
        vC.types.CYLINDER,
        vC.types.PLANE,
        vC.types.CYLINDER,
        vC.types.BOX,
        vC.types.CYLINDER,
        vC.types.CONVEXPOLYHEDRON,
        vC.types.CYLINDER,
        vC.types.HEIGHTFIELD,
        vC.types.CYLINDER,
        vC.types.PARTICLE,
        vC.types.CYLINDER,
        vC.types.SPHERE,
        vC.types.TRIMESH,
        vC.types.PLANE,
        vC.types.TRIMESH,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new pC,
        new pC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new ZC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new pC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new GC,
        new ZC,
        new HC;
        var tA = globalThis.performance || {};
        if (!tA.now) {
            var nA = Date.now();
            tA.timing && tA.timing.navigationStart && (nA = tA.timing.navigationStart),
            tA.now = function() {
                return Date.now() - nA
            }
        }
        new GC;
        var lA = Object(o.createContext)(null)
          , cA = Object(o.createContext)(null)
          , aA = function() {
            var g = Object(o.useContext)(cA);
            if (!g)
                throw new Error("Physics context not found. @react-three/cannon & components can only be used within a Physics provider");
            return g
        };
        new L.Quaternion,
        new L.Vector3(1,1,1),
        new L.Vector3,
        new L.Matrix4;
        var sA = new L.Object3D;
        function dA(g) {
            var I = Object(o.useRef)(null);
            return g && "function" != typeof g ? g : I
        }
        function bA(g) {
            return g.charAt(0).toUpperCase() + g.slice(1)
        }
        function GA(g, I) {
            var C = void 0 === I ? "" : "/".concat(I);
            return "function" == typeof g ? null : g && g.current && "".concat(g.current.uuid).concat(C)
        }
        var rA = new L.Euler
          , uA = new L.Quaternion
          , BA = 0;
        function ZA(g, I, C, A, e, o) {
            return void 0 === o && (o = "bodies"),
            function(i) {
                var t = BA++;
                C[t] = bg({}, A, i);
                var n = GA(g, e);
                return n && I.subscribe({
                    props: {
                        id: t,
                        target: o,
                        type: A
                    },
                    uuid: n
                }),
                function() {
                    delete C[t],
                    I.unsubscribe({
                        props: t
                    })
                }
            }
        }
        function mA(g, I) {
            var C, A, e = I.position, o = void 0 === e ? [0, 0, 0] : e, i = I.rotation, t = void 0 === i ? [0, 0, 0] : i, n = I.userData, l = void 0 === n ? {} : n;
            g.userData = l,
            (C = g.position).set.apply(C, Ig(o)),
            (A = g.rotation).set.apply(A, Ig(t)),
            g.updateMatrix()
        }
        function hA(g, I, C) {
            var A = I.onCollide
              , e = I.onCollideBegin
              , o = I.onCollideEnd;
            g[C] = {
                collide: A,
                collideBegin: e,
                collideEnd: o
            }
        }
        function pA(g, I, C, A, e) {
            void 0 === A && (A = null),
            void 0 === e && (e = []);
            var i = dA(A)
              , t = aA()
              , n = t.events
              , l = t.refs
              , c = t.scaleOverrides
              , a = t.subscriptions
              , s = t.worker
              , d = Object(o.useContext)(lA);
            Object(o.useLayoutEffect)((function() {
                i.current || (i.current = new L.Object3D);
                var A = i.current
                  , e = s
                  , o = A instanceof L.InstancedMesh ? (A.instanceMatrix.setUsage(L.DynamicDrawUsage),
                A.count) : 1
                  , t = A instanceof L.InstancedMesh ? new Array(o).fill(0).map((function(g, I) {
                    return "".concat(A.uuid, "/").concat(I)
                }
                )) : [A.uuid]
                  , c = A instanceof L.InstancedMesh ? t.map((function(e, o) {
                    var i = I(o);
                    return mA(sA, i),
                    A.setMatrixAt(o, sA.matrix),
                    A.instanceMatrix.needsUpdate = !0,
                    l[e] = A,
                    null == d || d.add(e, i, g),
                    hA(n, i, e),
                    _(_({}, i), {}, {
                        args: C(i.args)
                    })
                }
                )) : t.map((function(e, o) {
                    var i = I(o);
                    return mA(A, i),
                    l[e] = A,
                    null == d || d.add(e, i, g),
                    hA(n, i, e),
                    _(_({}, i), {}, {
                        args: C(i.args)
                    })
                }
                ));
                return e.addBodies({
                    props: c.map((function(g) {
                        var I = g.onCollide
                          , C = (g.onCollideBegin,
                        g.onCollideEnd,
                        $(g, D));
                        return _({
                            onCollide: Boolean(I)
                        }, C)
                    }
                    )),
                    type: g,
                    uuid: t
                }),
                function() {
                    t.forEach((function(g) {
                        delete l[g],
                        null == d || d.remove(g),
                        delete n[g]
                    }
                    )),
                    e.removeBodies({
                        uuid: t
                    })
                }
            }
            ), e);
            var b = Object(o.useMemo)((function() {
                var g = function(g, I) {
                    var C = "set".concat(bA(g));
                    return {
                        set: function(g) {
                            var A = GA(i, I);
                            A && s[C]({
                                props: g,
                                uuid: A
                            })
                        },
                        subscribe: ZA(i, s, a, g, I)
                    }
                }
                  , I = function(g) {
                    return {
                        copy: function(I) {
                            var C = I.w
                              , A = I.x
                              , e = I.y
                              , o = I.z
                              , t = GA(i, g);
                            t && s.setQuaternion({
                                props: [A, e, o, C],
                                uuid: t
                            })
                        },
                        set: function(I, C, A, e) {
                            var o = GA(i, g);
                            o && s.setQuaternion({
                                props: [I, C, A, e],
                                uuid: o
                            })
                        },
                        subscribe: ZA(i, s, a, "quaternion", g)
                    }
                }
                  , C = function(g) {
                    return {
                        copy: function(I) {
                            var C = I.x
                              , A = I.y
                              , e = I.z
                              , o = GA(i, g);
                            o && s.setRotation({
                                props: [C, A, e],
                                uuid: o
                            })
                        },
                        set: function(I, C, A) {
                            var e = GA(i, g);
                            e && s.setRotation({
                                props: [I, C, A],
                                uuid: e
                            })
                        },
                        subscribe: function(I) {
                            var C = BA++
                              , A = GA(i, g);
                            return a[C] = bg({}, "quaternion", function(g) {
                                return function(I) {
                                    return g(rA.setFromQuaternion(uA.fromArray(I)).toArray())
                                }
                            }(I)),
                            A && s.subscribe({
                                props: {
                                    id: C,
                                    target: "bodies",
                                    type: "quaternion"
                                },
                                uuid: A
                            }),
                            function() {
                                delete a[C],
                                s.unsubscribe({
                                    props: C
                                })
                            }
                        }
                    }
                }
                  , A = function(g, I) {
                    var C = "set".concat(bA(g));
                    return {
                        copy: function(g) {
                            var A = g.x
                              , e = g.y
                              , o = g.z
                              , t = GA(i, I);
                            t && s[C]({
                                props: [A, e, o],
                                uuid: t
                            })
                        },
                        set: function(g, A, e) {
                            var o = GA(i, I);
                            o && s[C]({
                                props: [g, A, e],
                                uuid: o
                            })
                        },
                        subscribe: ZA(i, s, a, g, I)
                    }
                };
                function e(e) {
                    return {
                        allowSleep: g("allowSleep", e),
                        angularDamping: g("angularDamping", e),
                        angularFactor: A("angularFactor", e),
                        angularVelocity: A("angularVelocity", e),
                        applyForce: function(g, I) {
                            var C = GA(i, e);
                            C && s.applyForce({
                                props: [g, I],
                                uuid: C
                            })
                        },
                        applyImpulse: function(g, I) {
                            var C = GA(i, e);
                            C && s.applyImpulse({
                                props: [g, I],
                                uuid: C
                            })
                        },
                        applyLocalForce: function(g, I) {
                            var C = GA(i, e);
                            C && s.applyLocalForce({
                                props: [g, I],
                                uuid: C
                            })
                        },
                        applyLocalImpulse: function(g, I) {
                            var C = GA(i, e);
                            C && s.applyLocalImpulse({
                                props: [g, I],
                                uuid: C
                            })
                        },
                        applyTorque: function(g) {
                            var I = GA(i, e);
                            I && s.applyTorque({
                                props: [g],
                                uuid: I
                            })
                        },
                        collisionFilterGroup: g("collisionFilterGroup", e),
                        collisionFilterMask: g("collisionFilterMask", e),
                        collisionResponse: g("collisionResponse", e),
                        fixedRotation: g("fixedRotation", e),
                        isTrigger: g("isTrigger", e),
                        linearDamping: g("linearDamping", e),
                        linearFactor: A("linearFactor", e),
                        mass: g("mass", e),
                        material: g("material", e),
                        position: A("position", e),
                        quaternion: I(e),
                        rotation: C(e),
                        scaleOverride: function(g) {
                            var I = GA(i, e);
                            I && (c[I] = gg(L.Vector3, Ig(g)))
                        },
                        sleep: function() {
                            var g = GA(i, e);
                            g && s.sleep({
                                uuid: g
                            })
                        },
                        sleepSpeedLimit: g("sleepSpeedLimit", e),
                        sleepTimeLimit: g("sleepTimeLimit", e),
                        userData: g("userData", e),
                        velocity: A("velocity", e),
                        wakeUp: function() {
                            var g = GA(i, e);
                            g && s.wakeUp({
                                uuid: g
                            })
                        }
                    }
                }
                var o = {};
                return _(_({}, e(void 0)), {}, {
                    at: function(g) {
                        return o[g] || (o[g] = e(g))
                    }
                })
            }
            ), []);
            return [i, b]
        }
        function yA(g, I, C) {
            return pA("Plane", g, (function() {
                return []
            }
            ), I, C)
        }
        function WA(g, I, C) {
            return pA("Sphere", g, (function(g) {
                if (void 0 === g && (g = [1]),
                !Array.isArray(g))
                    throw new Error("useSphere args must be an array");
                return [g[0]]
            }
            ), I, C)
        }
        var vA = new L.Vector3
          , VA = new L.Vector3(1,1,1)
          , XA = new L.Quaternion
          , YA = new L.Matrix4;
        function KA(g, I, C, A, e) {
            return void 0 === A && (A = VA),
            void 0 !== g ? (YA.compose(vA.fromArray(I, 3 * g), XA.fromArray(C, 4 * g), A),
            e && (e.matrixAutoUpdate = !1,
            e.matrix.copy(YA)),
            YA) : YA.identity()
        }
        function RA(g) {
            var I = g.allowSleep
              , C = void 0 !== I && I
              , A = g.axisIndex
              , e = void 0 === A ? 0 : A
              , i = g.broadphase
              , t = void 0 === i ? "Naive" : i
              , n = g.children
              , l = g.defaultContactMaterial
              , c = void 0 === l ? {
                contactEquationStiffness: 1e6
            } : l
              , a = g.frictionGravity
              , s = void 0 === a ? null : a
              , d = g.gravity
              , b = void 0 === d ? [0, -9.81, 0] : d
              , G = g.isPaused
              , u = void 0 !== G && G
              , B = g.iterations
              , Z = void 0 === B ? 5 : B
              , m = g.maxSubSteps
              , h = void 0 === m ? 10 : m
              , p = g.quatNormalizeFast
              , y = void 0 !== p && p
              , W = g.quatNormalizeSkip
              , v = void 0 === W ? 0 : W
              , V = g.shouldInvalidate
              , X = void 0 === V || V
              , Y = g.size
              , K = void 0 === Y ? 1e3 : Y
              , R = g.solver
              , w = void 0 === R ? "GS" : R
              , H = g.stepSize
              , F = void 0 === H ? 1 / 60 : H
              , N = g.tolerance
              , S = void 0 === N ? .001 : N
              , z = Object(r.e)().invalidate
              , f = Ag(Object(o.useState)((function() {
                return {
                    bodies: {},
                    events: {},
                    refs: {},
                    scaleOverrides: {},
                    subscriptions: {},
                    worker: new Lg({
                        allowSleep: C,
                        axisIndex: e,
                        broadphase: t,
                        defaultContactMaterial: c,
                        frictionGravity: s,
                        gravity: b,
                        iterations: Z,
                        quatNormalizeFast: y,
                        quatNormalizeSkip: v,
                        size: K,
                        solver: w,
                        tolerance: S
                    })
                }
            }
            )), 1)[0]
              , k = f.bodies
              , J = f.events
              , x = f.refs
              , M = f.scaleOverrides
              , Q = f.subscriptions
              , j = f.worker
              , D = 0
              , q = Object(o.useCallback)((function(g, I) {
                u || (D += I,
                j.step({
                    maxSubSteps: h,
                    stepSize: F,
                    timeSinceLastCalled: D
                }),
                D = 0)
            }
            ), [u, h, F])
              , gg = function(g) {
                var I, C = g.body, A = g.contact, e = A.bi, o = A.bj, i = $(A, T), t = g.target, n = $(g, O), l = null == (I = J[t]) ? void 0 : I.collide;
                l && l(_({
                    body: x[C],
                    contact: _({
                        bi: x[e],
                        bj: x[o]
                    }, i),
                    target: x[t]
                }, n))
            }
              , Ig = function(g) {
                var I, C, A = g.bodyA, e = g.bodyB, o = null == (I = J[A]) ? void 0 : I.collideBegin;
                o && o({
                    body: x[e],
                    op: "event",
                    target: x[A],
                    type: "collideBegin"
                });
                var i = null == (C = J[e]) ? void 0 : C.collideBegin;
                i && i({
                    body: x[A],
                    op: "event",
                    target: x[e],
                    type: "collideBegin"
                })
            }
              , eg = function(g) {
                var I, C, A = g.bodyA, e = g.bodyB, o = null == (I = J[A]) ? void 0 : I.collideEnd;
                o && o({
                    body: x[e],
                    op: "event",
                    target: x[A],
                    type: "collideEnd"
                });
                var i = null == (C = J[e]) ? void 0 : C.collideEnd;
                i && i({
                    body: x[A],
                    op: "event",
                    target: x[e],
                    type: "collideEnd"
                })
            }
              , og = function(g) {
                for (var I = g.active, C = g.bodies, A = void 0 === C ? [] : C, e = g.observations, o = g.positions, i = g.quaternions, t = 0; t < A.length; t++)
                    k[A[t]] = t;
                if (e.forEach((function(g) {
                    var I = Ag(g, 3)
                      , C = I[0]
                      , A = I[1]
                      , e = I[2]
                      , o = (Q[C] || {})[e];
                    o && o(A)
                }
                )),
                I) {
                    var n, l, c = Cg(Object.values(x).filter((l = [],
                    function(g) {
                        return !l.includes(g) && !!l.push(g)
                    }
                    )));
                    try {
                        for (c.s(); !(n = c.n()).done; ) {
                            var a = n.value;
                            if (a instanceof L.InstancedMesh)
                                for (var s = 0; s < a.count; s++) {
                                    var d = "".concat(a.uuid, "/").concat(s)
                                      , b = k[d];
                                    void 0 !== b && (a.setMatrixAt(s, KA(b, o, i, M[d])),
                                    a.instanceMatrix.needsUpdate = !0)
                                }
                            else {
                                var G = M[a.uuid] || a.scale;
                                KA(k[a.uuid], o, i, G, a)
                            }
                        }
                    } catch (g) {
                        c.e(g)
                    } finally {
                        c.f()
                    }
                    X && z()
                }
            }
              , ig = function(g) {
                var I, C = g.body, A = g.ray, e = A.uuid, o = $(A, E), i = $(g, P), t = null == (I = J[e]) ? void 0 : I.rayhit;
                t && t(_({
                    body: C ? x[C] : null,
                    ray: _({
                        uuid: e
                    }, o)
                }, i))
            };
            Object(r.c)(q),
            Object(o.useEffect)((function() {
                return j.connect(),
                j.init(),
                j.on("collide", gg),
                j.on("collideBegin", Ig),
                j.on("collideEnd", eg),
                j.on("frame", og),
                j.on("rayhit", ig),
                function() {
                    j.terminate(),
                    j.removeAllListeners()
                }
            }
            ), []),
            Object(o.useEffect)((function() {
                j.axisIndex = e
            }
            ), [e]),
            Object(o.useEffect)((function() {
                j.broadphase = t
            }
            ), [t]),
            Object(o.useEffect)((function() {
                j.gravity = b
            }
            ), [b]),
            Object(o.useEffect)((function() {
                j.iterations = Z
            }
            ), [Z]),
            Object(o.useEffect)((function() {
                j.tolerance = S
            }
            ), [S]);
            var tg = Object(o.useMemo)((function() {
                return {
                    bodies: k,
                    events: J,
                    refs: x,
                    scaleOverrides: M,
                    subscriptions: Q,
                    worker: j
                }
            }
            ), [k, J, x, Q, j]);
            return Object(U.jsx)(cA.Provider, {
                value: tg,
                children: n
            })
        }
        var wA = function() {
            var g, I, C, A = [.4, .4, 2], o = Object(r.e)().viewport, i = Object(J.a)().stage, t = (C = [1, 1, 1],
            pA("Box", (function() {
                return {
                    type: "Kinematic",
                    mass: 1e3,
                    args: A
                }
            }
            ), (function(g) {
                return void 0 === g && (g = C),
                g
            }
            ), g, I)), n = e()(t, 2), l = (n[0],
            n[1]);
            return Object(r.c)((function(g) {
                var I = g.mouse;
                i < 1 && l.position.set(I.x * o.width / 2 - 1, I.y * o.height / 2, 0)
            }
            )),
            null
        }
          , HA = C(737)
          , FA = C.n(HA);
        function NA(g, I) {
            var C = Object.keys(g);
            if (Object.getOwnPropertySymbols) {
                var A = Object.getOwnPropertySymbols(g);
                I && (A = A.filter((function(I) {
                    return Object.getOwnPropertyDescriptor(g, I).enumerable
                }
                ))),
                C.push.apply(C, A)
            }
            return C
        }
        function SA(g) {
            for (var I = 1; I < arguments.length; I++) {
                var C = null != arguments[I] ? arguments[I] : {};
                I % 2 ? NA(Object(C), !0).forEach((function(I) {
                    n()(g, I, C[I])
                }
                )) : Object.getOwnPropertyDescriptors ? Object.defineProperties(g, Object.getOwnPropertyDescriptors(C)) : NA(Object(C)).forEach((function(I) {
                    Object.defineProperty(g, I, Object.getOwnPropertyDescriptor(C, I))
                }
                ))
            }
            return g
        }
        var zA = L.MathUtils.lerp
          , fA = function(g) {
            var I = Object.assign({}, (FA()(g),
            g))
              , C = Object(r.e)().viewport
              , A = Object(J.a)().stage
              , i = Math.PI
              , t = (Math.sin,
            Math.cos,
            Object(o.useRef)(.5))
              , n = .5 * i
              , l = yA((function() {
                return SA({
                    rotation: [n, 0, 0],
                    position: [0, 2, 0]
                }, I)
            }
            ))
              , c = e()(l, 2)
              , a = (c[0],
            c[1])
              , s = yA((function() {
                return SA({
                    rotation: [-n, 0, 0],
                    position: [0, -2, 0]
                }, I)
            }
            ))
              , d = e()(s, 2)
              , b = (d[0],
            d[1])
              , G = yA((function() {
                return SA({
                    rotation: [0, n, 0],
                    position: [-.5, 0, 0]
                }, I)
            }
            ))
              , u = e()(G, 2)
              , B = (u[0],
            u[1])
              , Z = yA((function() {
                return SA({
                    rotation: [0, -n, 0],
                    position: [.5, 0, 0]
                }, I)
            }
            ))
              , m = e()(Z, 2)
              , h = (m[0],
            m[1])
              , p = yA((function() {
                return SA({
                    rotation: [i, 0, 0],
                    position: [0, 0, .5]
                }, I)
            }
            ))
              , y = e()(p, 2)
              , W = (y[0],
            y[1])
              , v = yA((function() {
                return SA({
                    rotation: [0, 0, 0],
                    position: [0, 0, -.5]
                }, I)
            }
            ))
              , V = e()(v, 2)
              , X = (V[0],
            V[1]);
            return Object(o.useEffect)((function() {
                switch (A) {
                case 0:
                    a.position.set(0, 2, 0),
                    b.position.set(0, -2, 0);
                    break;
                default:
                    a.position.set(0, C.height / 2, 0),
                    b.position.set(0, -C.height / 2, 0)
                }
            }
            ), [A]),
            Object(r.c)((function(g) {
                var I = g.clock;
                switch (A) {
                case 0:
                    t.current = zA(t.current, .4, .08),
                    I.getElapsedTime();
                    break;
                default:
                    t.current = zA(t.current, 5, .02),
                    0
                }
                B.position.set(-t.current, 0, 0),
                h.position.set(t.current, 0, 0),
                W.position.set(0, 0, t.current),
                X.position.set(0, 0, -t.current)
            }
            )),
            null
        };
        function kA(g) {
            var I = g.number
              , C = void 0 === I ? 30 : I
              , A = g.mass
              , i = g.args
              , t = g.visible
              , n = g.materialColor
              , l = g.s
              , c = WA((function() {
                return {
                    mass: A,
                    type: "Dynamic",
                    position: [L.MathUtils.randFloatSpread(1), L.MathUtils.randFloatSpread(4), L.MathUtils.randFloatSpread(1)],
                    fixedRotation: !0,
                    allowSleep: !1,
                    collisionFilterGroup: 2,
                    material: {
                        friction: 0
                    },
                    args: i
                }
            }
            ))
              , a = e()(c, 1)[0]
              , s = Object(o.useMemo)((function() {
                for (var g = new Float32Array(3 * C), I = new L.Color, A = 0; A < C; A += 1)
                    I.set(n).convertSRGBToLinear().toArray(g, 3 * A);
                return g
            }
            ), [C, l]);
            return Object(Y.jsxs)("instancedMesh", {
                receiveShadow: !0,
                castShadow: !0,
                ref: a,
                args: [null, null, C],
                visible: t,
                children: [Object(Y.jsx)("sphereBufferGeometry", {
                    args: i,
                    children: Object(Y.jsx)("instancedBufferAttribute", {
                        attachObject: ["attributes", "color"],
                        args: [s, 3]
                    })
                }), Object(Y.jsx)("meshStandardMaterial", {
                    vertexColors: !0,
                    roughness: l.roughness,
                    metalness: l.metalness,
                    emissive: l.materialEmissive
                })]
            })
        }
        var JA = function(g) {
            var I = g.s
              , C = Object(o.useRef)()
              , A = Object(J.a)().stage;
            return Object(r.c)((function() {
                0 === A && (C.current.rotation.y += .01)
            }
            )),
            Object(Y.jsx)(RA, {
                gravity: [0, 0, 0],
                children: Object(Y.jsxs)("group", {
                    rotation: [0, 0, -.26],
                    children: [Object(Y.jsx)(wA, {}), Object(Y.jsxs)("group", {
                        position: [1, .25, 0],
                        ref: C,
                        children: [Object(Y.jsx)(fA, {}), Object(Y.jsx)(kA, {
                            s: I,
                            args: [.04, 20, 20],
                            negative: 0,
                            number: 2,
                            mass: 1e3,
                            materialColor: I.materialColor2
                        }), Object(Y.jsx)(kA, {
                            s: I,
                            args: [.08, 20, 20],
                            negative: 0,
                            number: 2,
                            mass: 1e3,
                            materialColor: I.materialColor2
                        }), Object(Y.jsx)(kA, {
                            s: I,
                            args: [.12, 20, 20],
                            negative: 0,
                            number: 5,
                            mass: 1e3,
                            materialColor: I.materialColor1
                        }), Object(Y.jsx)(kA, {
                            s: I,
                            args: [.2, 20, 20],
                            negative: 0,
                            number: 1,
                            mass: 1e3,
                            materialColor: I.materialColor2
                        }), Object(Y.jsx)(kA, {
                            s: I,
                            args: [.25, 20, 20],
                            negative: 0,
                            number: 6,
                            mass: 1e3,
                            materialColor: I.materialColor1
                        }), Object(Y.jsx)(kA, {
                            s: I,
                            args: [.36, 20, 20],
                            negative: 0,
                            number: 5,
                            mass: 1e3,
                            materialColor: I.materialColor1
                        }), Object(Y.jsx)(kA, {
                            s: I,
                            args: [.14, 20, 20],
                            negative: 0,
                            number: 10,
                            mass: 1e3,
                            visible: !1
                        })]
                    })]
                })
            })
        }
          , LA = C(665)
          , xA = C.n(LA);
        const MA = new WeakMap;
        class QA extends L.Loader {
            constructor(g) {
                super(g),
                this.decoderPath = "",
                this.decoderConfig = {},
                this.decoderBinary = null,
                this.decoderPending = null,
                this.workerLimit = 4,
                this.workerPool = [],
                this.workerNextTaskID = 1,
                this.workerSourceURL = "",
                this.defaultAttributeIDs = {
                    position: "POSITION",
                    normal: "NORMAL",
                    color: "COLOR",
                    uv: "TEX_COORD"
                },
                this.defaultAttributeTypes = {
                    position: "Float32Array",
                    normal: "Float32Array",
                    color: "Float32Array",
                    uv: "Float32Array"
                }
            }
            setDecoderPath(g) {
                return this.decoderPath = g,
                this
            }
            setDecoderConfig(g) {
                return this.decoderConfig = g,
                this
            }
            setWorkerLimit(g) {
                return this.workerLimit = g,
                this
            }
            load(g, I, C, A) {
                const e = new L.FileLoader(this.manager);
                e.setPath(this.path),
                e.setResponseType("arraybuffer"),
                e.setRequestHeader(this.requestHeader),
                e.setWithCredentials(this.withCredentials),
                e.load(g, g => {
                    const C = {
                        attributeIDs: this.defaultAttributeIDs,
                        attributeTypes: this.defaultAttributeTypes,
                        useUniqueIDs: !1
                    };
                    this.decodeGeometry(g, C).then(I).catch(A)
                }
                , C, A)
            }
            decodeDracoFile(g, I, C, A) {
                const e = {
                    attributeIDs: C || this.defaultAttributeIDs,
                    attributeTypes: A || this.defaultAttributeTypes,
                    useUniqueIDs: !!C
                };
                this.decodeGeometry(g, e).then(I)
            }
            decodeGeometry(g, I) {
                for (const g in I.attributeTypes) {
                    const C = I.attributeTypes[g];
                    void 0 !== C.BYTES_PER_ELEMENT && (I.attributeTypes[g] = C.name)
                }
                const C = JSON.stringify(I);
                if (MA.has(g)) {
                    const I = MA.get(g);
                    if (I.key === C)
                        return I.promise;
                    if (0 === g.byteLength)
                        throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")
                }
                let A;
                const e = this.workerNextTaskID++
                  , o = g.byteLength
                  , i = this._getWorker(e, o).then(C => (A = C,
                new Promise( (C, o) => {
                    A._callbacks[e] = {
                        resolve: C,
                        reject: o
                    },
                    A.postMessage({
                        type: "decode",
                        id: e,
                        taskConfig: I,
                        buffer: g
                    }, [g])
                }
                ))).then(g => this._createGeometry(g.geometry));
                return i.catch( () => !0).then( () => {
                    A && e && this._releaseTask(A, e)
                }
                ),
                MA.set(g, {
                    key: C,
                    promise: i
                }),
                i
            }
            _createGeometry(g) {
                const I = new L.BufferGeometry;
                g.index && I.setIndex(new L.BufferAttribute(g.index.array,1));
                for (let C = 0; C < g.attributes.length; C++) {
                    const A = g.attributes[C]
                      , e = A.name
                      , o = A.array
                      , i = A.itemSize;
                    I.setAttribute(e, new L.BufferAttribute(o,i))
                }
                return I
            }
            _loadLibrary(g, I) {
                const C = new L.FileLoader(this.manager);
                return C.setPath(this.decoderPath),
                C.setResponseType(I),
                C.setWithCredentials(this.withCredentials),
                new Promise( (I, A) => {
                    C.load(g, I, void 0, A)
                }
                )
            }
            preload() {
                return this._initDecoder(),
                this
            }
            _initDecoder() {
                if (this.decoderPending)
                    return this.decoderPending;
                const g = "object" != typeof WebAssembly || "js" === this.decoderConfig.type
                  , I = [];
                return g ? I.push(this._loadLibrary("draco-decoder.js", "text")) : (I.push(this._loadLibrary("draco_wasm_wrapper.js", "text")),
                I.push(this._loadLibrary("draco_decoder.wasm", "arraybuffer"))),
                this.decoderPending = Promise.all(I).then(I => {
                    const C = I[0];
                    g || (this.decoderConfig.wasmBinary = I[1]);
                    const A = jA.toString()
                      , e = ["/* draco decoder */", C, "", "/* worker */", A.substring(A.indexOf("{") + 1, A.lastIndexOf("}"))].join("\n");
                    this.workerSourceURL = URL.createObjectURL(new Blob([e]))
                }
                ),
                this.decoderPending
            }
            _getWorker(g, I) {
                return this._initDecoder().then( () => {
                    if (this.workerPool.length < this.workerLimit) {
                        const g = new Worker(this.workerSourceURL);
                        g._callbacks = {},
                        g._taskCosts = {},
                        g._taskLoad = 0,
                        g.postMessage({
                            type: "init",
                            decoderConfig: this.decoderConfig
                        }),
                        g.onmessage = function(I) {
                            const C = I.data;
                            switch (C.type) {
                            case "decode":
                                g._callbacks[C.id].resolve(C);
                                break;
                            case "error":
                                g._callbacks[C.id].reject(C);
                                break;
                            default:
                                console.error('THREE.DRACOLoader: Unexpected message, "' + C.type + '"')
                            }
                        }
                        ,
                        this.workerPool.push(g)
                    } else
                        this.workerPool.sort((function(g, I) {
                            return g._taskLoad > I._taskLoad ? -1 : 1
                        }
                        ));
                    const C = this.workerPool[this.workerPool.length - 1];
                    return C._taskCosts[g] = I,
                    C._taskLoad += I,
                    C
                }
                )
            }
            _releaseTask(g, I) {
                g._taskLoad -= g._taskCosts[I],
                delete g._callbacks[I],
                delete g._taskCosts[I]
            }
            debug() {
                console.log("Task load: ", this.workerPool.map(g => g._taskLoad))
            }
            dispose() {
                for (let g = 0; g < this.workerPool.length; ++g)
                    this.workerPool[g].terminate();
                return this.workerPool.length = 0,
                this
            }
        }
        function jA() {
            let g, I;
            function C(g, I, C, A, e, o) {
                const i = o.num_components()
                  , t = C.num_points() * i
                  , n = t * e.BYTES_PER_ELEMENT
                  , l = function(g, I) {
                    switch (I) {
                    case Float32Array:
                        return g.DT_FLOAT32;
                    case Int8Array:
                        return g.DT_INT8;
                    case Int16Array:
                        return g.DT_INT16;
                    case Int32Array:
                        return g.DT_INT32;
                    case Uint8Array:
                        return g.DT_UINT8;
                    case Uint16Array:
                        return g.DT_UINT16;
                    case Uint32Array:
                        return g.DT_UINT32
                    }
                }(g, e)
                  , c = g._malloc(n);
                I.GetAttributeDataArrayForAllPoints(C, o, l, n, c);
                const a = new e(g.HEAPF32.buffer,c,t).slice();
                return g._free(c),
                {
                    name: A,
                    array: a,
                    itemSize: i
                }
            }
            onmessage = function(A) {
                const e = A.data;
                switch (e.type) {
                case "init":
                    g = e.decoderConfig,
                    I = new Promise((function(I) {
                        g.onModuleLoaded = function(g) {
                            I({
                                draco: g
                            })
                        }
                        ,
                        DracoDecoderModule(g)
                    }
                    ));
                    break;
                case "decode":
                    const A = e.buffer
                      , o = e.taskConfig;
                    I.then(g => {
                        const I = g.draco
                          , i = new I.Decoder
                          , t = new I.DecoderBuffer;
                        t.Init(new Int8Array(A), A.byteLength);
                        try {
                            const g = function(g, I, A, e) {
                                const o = e.attributeIDs
                                  , i = e.attributeTypes;
                                let t, n;
                                const l = I.GetEncodedGeometryType(A);
                                if (l === g.TRIANGULAR_MESH)
                                    t = new g.Mesh,
                                    n = I.DecodeBufferToMesh(A, t);
                                else {
                                    if (l !== g.POINT_CLOUD)
                                        throw new Error("THREE.DRACOLoader: Unexpected geometry type.");
                                    t = new g.PointCloud,
                                    n = I.DecodeBufferToPointCloud(A, t)
                                }
                                if (!n.ok() || 0 === t.ptr)
                                    throw new Error("THREE.DRACOLoader: Decoding failed: " + n.error_msg());
                                const c = {
                                    index: null,
                                    attributes: []
                                };
                                for (const A in o) {
                                    const n = self[i[A]];
                                    let l, a;
                                    if (e.useUniqueIDs)
                                        a = o[A],
                                        l = I.GetAttributeByUniqueId(t, a);
                                    else {
                                        if (a = I.GetAttributeId(t, g[o[A]]),
                                        -1 === a)
                                            continue;
                                        l = I.GetAttribute(t, a)
                                    }
                                    c.attributes.push(C(g, I, t, A, n, l))
                                }
                                l === g.TRIANGULAR_MESH && (c.index = function(g, I, C) {
                                    const A = 3 * C.num_faces()
                                      , e = 4 * A
                                      , o = g._malloc(e);
                                    I.GetTrianglesUInt32Array(C, e, o);
                                    const i = new Uint32Array(g.HEAPF32.buffer,o,A).slice();
                                    return g._free(o),
                                    {
                                        array: i,
                                        itemSize: 1
                                    }
                                }(g, I, t));
                                return g.destroy(t),
                                c
                            }(I, i, t, o)
                              , A = g.attributes.map(g => g.array.buffer);
                            g.index && A.push(g.index.array.buffer),
                            self.postMessage({
                                type: "decode",
                                id: e.id,
                                geometry: g
                            }, A)
                        } catch (g) {
                            console.error(g),
                            self.postMessage({
                                type: "error",
                                id: e.id,
                                error: g.message
                            })
                        } finally {
                            I.destroy(t),
                            I.destroy(i)
                        }
                    }
                    )
                }
            }
        }
        let UA;
        const DA = () => {
            if (UA)
                return UA;
            const g = new Uint8Array([0, 97, 115, 109, 1, 0, 0, 0, 1, 4, 1, 96, 0, 0, 3, 3, 2, 0, 0, 5, 3, 1, 0, 1, 12, 1, 0, 10, 22, 2, 12, 0, 65, 0, 65, 0, 65, 0, 252, 10, 0, 0, 11, 7, 0, 65, 0, 253, 15, 26, 11])
              , I = new Uint8Array([32, 0, 65, 253, 3, 1, 2, 34, 4, 106, 6, 5, 11, 8, 7, 20, 13, 33, 12, 16, 128, 9, 116, 64, 19, 113, 127, 15, 10, 21, 22, 14, 255, 66, 24, 54, 136, 107, 18, 23, 192, 26, 114, 118, 132, 17, 77, 101, 130, 144, 27, 87, 131, 44, 45, 74, 156, 154, 70, 167]);
            if ("object" != typeof WebAssembly)
                return {
                    supported: !1
                };
            let C, A = "B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB";
            WebAssembly.validate(g) && (A = "B9h9z9tFBBBFiI9gBB9gLaaaaaFa9gEaaaB9gFaFaEMcBBFBFFGGGEILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBOn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBNI9z9iqlBVc+N9IcIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMk8lLbaE97F9+FaL978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAeDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAeDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBReCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBH8ZCFD9tA8ZAPD9OD9hD9RH8ZDQBTFtGmEYIPLdKeOnHpAIAQJDBIBHyCFD9tAyAPD9OD9hD9RHyAIASJDBIBH8cCFD9tA8cAPD9OD9hD9RH8cDQBTFtGmEYIPLdKeOnH8dDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAeD9uHeDyBjGBAEAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeApA8dDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNiV8ZcpMyS8cQ8df8eb8fHdAyA8cDQNiV8ZcpMyS8cQ8df8eb8fH8ZDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/dLEK97FaF97GXGXAGCI9HQBAF9FQFCBRGEXABABDBBBHECiD+rFCiD+sFD/6FHIAECND+rFCiD+sFD/6FAID/gFAECTD+rFCiD+sFD/6FHLD/gFD/kFD/lFHKCBDtD+2FHOAICUUUU94DtHND9OD9RD/kFHI9DBB/+hDYAIAID/mFAKAKD/mFALAOALAND9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHLD/mF9DBBX9LDYHOD/kFCgFDtD9OAECUUU94DtD9OD9QAIALD/mFAOD/kFCND+rFCU/+EDtD9OD9QAKALD/mFAOD/kFCTD+rFCUU/8ODtD9OD9QDMBBABCTJRBAGCIJHGAF9JQBSGMMAF9FQBCBRGEXABCTJHVAVDBBBHECBDtHOCUU98D8cFCUU98D8cEHND9OABDBBBHKAEDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAKAEDQBFGENVcMTtmYi8ZpyHECTD+sFD/6FHID/gFAECTD+rFCTD+sFD/6FHLD/gFD/kFD/lFHE9DB/+g6DYALAEAOD+2FHOALCUUUU94DtHcD9OD9RD/kFHLALD/mFAEAED/mFAIAOAIAcD9OD9RD/kFHEAED/mFD/kFD/kFD/jFD/nFHID/mF9DBBX9LDYHOD/kFCTD+rFALAID/mFAOD/kFCggEDtD9OD9QHLAEAID/mFAOD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHEDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAKAND9OALAEDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM/hEIGaF97FaL978jUUUUBCTlREGXAF9FQBCBRIEXAEABDBBBHLABCTJHKDBBBHODQILKOSQfbPden8c8d8e8fHNCTD+sFHVCID+rFDMIBAB9DBBU8/DY9D/zI818/DYAVCEDtD9QD/6FD/nFHVALAODQBFGENVcMTtmYi8ZpyHLCTD+rFCTD+sFD/6FD/mFHOAOD/mFAVALCTD+sFD/6FD/mFHcAcD/mFAVANCTD+rFCTD+sFD/6FD/mFHNAND/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHVD/mF9DBBX9LDYHLD/kFCggEDtHMD9OAcAVD/mFALD/kFCTD+rFD9QHcANAVD/mFALD/kFCTD+rFAOAVD/mFALD/kFAMD9OD9QHVDQBFTtGEmYILPdKOenHLD8dBAEDBIBDyB+t+J83EBABCNJALD8dFAEDBIBDyF+t+J83EBAKAcAVDQNVi8ZcMpySQ8c8dfb8e8fHVD8dBAEDBIBDyG+t+J83EBABCiJAVD8dFAEDBIBDyE+t+J83EBABCAJRBAICIJHIAF9JQBMMM9jFF97GXAGCGrAF9sHG9FQBCBRFEXABABDBBBHECND+rFCND+sFD/6FAECiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBABCTJRBAFCIJHFAG9JQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB");
            const e = WebAssembly.instantiate(function(g) {
                const C = new Uint8Array(g.length);
                for (let I = 0; I < g.length; ++I) {
                    const A = g.charCodeAt(I);
                    C[I] = A > 96 ? A - 71 : A > 64 ? A - 65 : A > 47 ? A + 4 : A > 46 ? 63 : 62
                }
                let A = 0;
                for (let e = 0; e < g.length; ++e)
                    C[A++] = C[e] < 60 ? I[C[e]] : 64 * (C[e] - 60) + C[++e];
                return C.buffer.slice(0, A)
            }(A), {}).then(g => {
                C = g.instance,
                C.exports.__wasm_call_ctors()
            }
            );
            function o(g, I, A, e, o, i) {
                const t = C.exports.sbrk
                  , n = A + 3 & -4
                  , l = t(n * e)
                  , c = t(o.length)
                  , a = new Uint8Array(C.exports.memory.buffer);
                a.set(o, c);
                const s = g(l, A, e, c, o.length);
                if (0 === s && i && i(l, n, e),
                I.set(a.subarray(l, l + A * e)),
                t(l - t(0)),
                0 !== s)
                    throw new Error("Malformed buffer data: " + s)
            }
            const i = {
                0: "",
                1: "meshopt_decodeFilterOct",
                2: "meshopt_decodeFilterQuat",
                3: "meshopt_decodeFilterExp",
                NONE: "",
                OCTAHEDRAL: "meshopt_decodeFilterOct",
                QUATERNION: "meshopt_decodeFilterQuat",
                EXPONENTIAL: "meshopt_decodeFilterExp"
            }
              , t = {
                0: "meshopt_decodeVertexBuffer",
                1: "meshopt_decodeIndexBuffer",
                2: "meshopt_decodeIndexSequence",
                ATTRIBUTES: "meshopt_decodeVertexBuffer",
                TRIANGLES: "meshopt_decodeIndexBuffer",
                INDICES: "meshopt_decodeIndexSequence"
            };
            return UA = {
                ready: e,
                supported: !0,
                decodeVertexBuffer(g, I, A, e, t) {
                    o(C.exports.meshopt_decodeVertexBuffer, g, I, A, e, C.exports[i[t]])
                },
                decodeIndexBuffer(g, I, A, e) {
                    o(C.exports.meshopt_decodeIndexBuffer, g, I, A, e)
                },
                decodeIndexSequence(g, I, A, e) {
                    o(C.exports.meshopt_decodeIndexSequence, g, I, A, e)
                },
                decodeGltfBuffer(g, I, A, e, n, l) {
                    o(C.exports[t[n]], g, I, A, e, C.exports[i[l]])
                }
            },
            UA
        }
        ;
        function TA(g, I) {
            if (I === L.TrianglesDrawMode)
                return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),
                g;
            if (I === L.TriangleFanDrawMode || I === L.TriangleStripDrawMode) {
                let C = g.getIndex();
                if (null === C) {
                    const I = []
                      , A = g.getAttribute("position");
                    if (void 0 === A)
                        return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),
                        g;
                    for (let g = 0; g < A.count; g++)
                        I.push(g);
                    g.setIndex(I),
                    C = g.getIndex()
                }
                const A = C.count - 2
                  , e = [];
                if (C)
                    if (I === L.TriangleFanDrawMode)
                        for (let g = 1; g <= A; g++)
                            e.push(C.getX(0)),
                            e.push(C.getX(g)),
                            e.push(C.getX(g + 1));
                    else
                        for (let g = 0; g < A; g++)
                            g % 2 == 0 ? (e.push(C.getX(g)),
                            e.push(C.getX(g + 1)),
                            e.push(C.getX(g + 2))) : (e.push(C.getX(g + 2)),
                            e.push(C.getX(g + 1)),
                            e.push(C.getX(g)));
                e.length / 3 !== A && console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");
                const o = g.clone();
                return o.setIndex(e),
                o.clearGroups(),
                o
            }
            return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:", I),
            g
        }
        const OA = parseInt(L.REVISION.replace(/\D+/g, ""));
        class EA extends L.Loader {
            constructor(g) {
                super(g),
                this.dracoLoader = null,
                this.ktx2Loader = null,
                this.meshoptDecoder = null,
                this.pluginCallbacks = [],
                this.register((function(g) {
                    return new Ie(g)
                }
                )),
                this.register((function(g) {
                    return new Ce(g)
                }
                )),
                this.register((function(g) {
                    return new ae(g)
                }
                )),
                this.register((function(g) {
                    return new se(g)
                }
                )),
                this.register((function(g) {
                    return new de(g)
                }
                )),
                this.register((function(g) {
                    return new ee(g)
                }
                )),
                this.register((function(g) {
                    return new oe(g)
                }
                )),
                this.register((function(g) {
                    return new ie(g)
                }
                )),
                this.register((function(g) {
                    return new te(g)
                }
                )),
                this.register((function(g) {
                    return new ge(g)
                }
                )),
                this.register((function(g) {
                    return new ne(g)
                }
                )),
                this.register((function(g) {
                    return new Ae(g)
                }
                )),
                this.register((function(g) {
                    return new ce(g)
                }
                )),
                this.register((function(g) {
                    return new le(g)
                }
                )),
                this.register((function(g) {
                    return new _A(g)
                }
                )),
                this.register((function(g) {
                    return new be(g)
                }
                )),
                this.register((function(g) {
                    return new Ge(g)
                }
                ))
            }
            load(g, I, C, A) {
                const e = this;
                let o;
                if ("" !== this.resourcePath)
                    o = this.resourcePath;
                else if ("" !== this.path) {
                    const I = L.LoaderUtils.extractUrlBase(g);
                    o = L.LoaderUtils.resolveURL(I, this.path)
                } else
                    o = L.LoaderUtils.extractUrlBase(g);
                this.manager.itemStart(g);
                const i = function(I) {
                    A ? A(I) : console.error(I),
                    e.manager.itemError(g),
                    e.manager.itemEnd(g)
                }
                  , t = new L.FileLoader(this.manager);
                t.setPath(this.path),
                t.setResponseType("arraybuffer"),
                t.setRequestHeader(this.requestHeader),
                t.setWithCredentials(this.withCredentials),
                t.load(g, (function(C) {
                    try {
                        e.parse(C, o, (function(C) {
                            I(C),
                            e.manager.itemEnd(g)
                        }
                        ), i)
                    } catch (g) {
                        i(g)
                    }
                }
                ), C, i)
            }
            setDRACOLoader(g) {
                return this.dracoLoader = g,
                this
            }
            setDDSLoader() {
                throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')
            }
            setKTX2Loader(g) {
                return this.ktx2Loader = g,
                this
            }
            setMeshoptDecoder(g) {
                return this.meshoptDecoder = g,
                this
            }
            register(g) {
                return -1 === this.pluginCallbacks.indexOf(g) && this.pluginCallbacks.push(g),
                this
            }
            unregister(g) {
                return -1 !== this.pluginCallbacks.indexOf(g) && this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(g), 1),
                this
            }
            parse(g, I, C, A) {
                let e;
                const o = {}
                  , i = {};
                if ("string" == typeof g)
                    e = JSON.parse(g);
                else if (g instanceof ArrayBuffer) {
                    if (L.LoaderUtils.decodeText(new Uint8Array(g.slice(0, 4))) === re) {
                        try {
                            o[qA.KHR_BINARY_GLTF] = new Ze(g)
                        } catch (g) {
                            return void (A && A(g))
                        }
                        e = JSON.parse(o[qA.KHR_BINARY_GLTF].content)
                    } else
                        e = JSON.parse(L.LoaderUtils.decodeText(new Uint8Array(g)))
                } else
                    e = g;
                if (void 0 === e.asset || e.asset.version[0] < 2)
                    return void (A && A(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));
                const t = new je(e,{
                    path: I || this.resourcePath || "",
                    crossOrigin: this.crossOrigin,
                    requestHeader: this.requestHeader,
                    manager: this.manager,
                    ktx2Loader: this.ktx2Loader,
                    meshoptDecoder: this.meshoptDecoder
                });
                t.fileLoader.setRequestHeader(this.requestHeader);
                for (let g = 0; g < this.pluginCallbacks.length; g++) {
                    const I = this.pluginCallbacks[g](t);
                    I.name || console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),
                    i[I.name] = I,
                    o[I.name] = !0
                }
                if (e.extensionsUsed)
                    for (let g = 0; g < e.extensionsUsed.length; ++g) {
                        const I = e.extensionsUsed[g]
                          , C = e.extensionsRequired || [];
                        switch (I) {
                        case qA.KHR_MATERIALS_UNLIT:
                            o[I] = new $A;
                            break;
                        case qA.KHR_DRACO_MESH_COMPRESSION:
                            o[I] = new me(e,this.dracoLoader);
                            break;
                        case qA.KHR_TEXTURE_TRANSFORM:
                            o[I] = new he;
                            break;
                        case qA.KHR_MESH_QUANTIZATION:
                            o[I] = new pe;
                            break;
                        default:
                            C.indexOf(I) >= 0 && void 0 === i[I] && console.warn('THREE.GLTFLoader: Unknown extension "' + I + '".')
                        }
                    }
                t.setExtensions(o),
                t.setPlugins(i),
                t.parse(C, A)
            }
            parseAsync(g, I) {
                const C = this;
                return new Promise((function(A, e) {
                    C.parse(g, I, A, e)
                }
                ))
            }
        }
        function PA() {
            let g = {};
            return {
                get: function(I) {
                    return g[I]
                },
                add: function(I, C) {
                    g[I] = C
                },
                remove: function(I) {
                    delete g[I]
                },
                removeAll: function() {
                    g = {}
                }
            }
        }
        const qA = {
            KHR_BINARY_GLTF: "KHR_binary_glTF",
            KHR_DRACO_MESH_COMPRESSION: "KHR_draco_mesh_compression",
            KHR_LIGHTS_PUNCTUAL: "KHR_lights_punctual",
            KHR_MATERIALS_CLEARCOAT: "KHR_materials_clearcoat",
            KHR_MATERIALS_DISPERSION: "KHR_materials_dispersion",
            KHR_MATERIALS_IOR: "KHR_materials_ior",
            KHR_MATERIALS_SHEEN: "KHR_materials_sheen",
            KHR_MATERIALS_SPECULAR: "KHR_materials_specular",
            KHR_MATERIALS_TRANSMISSION: "KHR_materials_transmission",
            KHR_MATERIALS_IRIDESCENCE: "KHR_materials_iridescence",
            KHR_MATERIALS_ANISOTROPY: "KHR_materials_anisotropy",
            KHR_MATERIALS_UNLIT: "KHR_materials_unlit",
            KHR_MATERIALS_VOLUME: "KHR_materials_volume",
            KHR_TEXTURE_BASISU: "KHR_texture_basisu",
            KHR_TEXTURE_TRANSFORM: "KHR_texture_transform",
            KHR_MESH_QUANTIZATION: "KHR_mesh_quantization",
            KHR_MATERIALS_EMISSIVE_STRENGTH: "KHR_materials_emissive_strength",
            EXT_MATERIALS_BUMP: "EXT_materials_bump",
            EXT_TEXTURE_WEBP: "EXT_texture_webp",
            EXT_TEXTURE_AVIF: "EXT_texture_avif",
            EXT_MESHOPT_COMPRESSION: "EXT_meshopt_compression",
            EXT_MESH_GPU_INSTANCING: "EXT_mesh_gpu_instancing"
        };
        class _A {
            constructor(g) {
                this.parser = g,
                this.name = qA.KHR_LIGHTS_PUNCTUAL,
                this.cache = {
                    refs: {},
                    uses: {}
                }
            }
            _markDefs() {
                const g = this.parser
                  , I = this.parser.json.nodes || [];
                for (let C = 0, A = I.length; C < A; C++) {
                    const A = I[C];
                    A.extensions && A.extensions[this.name] && void 0 !== A.extensions[this.name].light && g._addNodeRef(this.cache, A.extensions[this.name].light)
                }
            }
            _loadLight(g) {
                const I = this.parser
                  , C = "light:" + g;
                let A = I.cache.get(C);
                if (A)
                    return A;
                const e = I.json
                  , o = ((e.extensions && e.extensions[this.name] || {}).lights || [])[g];
                let i;
                const t = new L.Color(16777215);
                void 0 !== o.color && t.setRGB(o.color[0], o.color[1], o.color[2], "srgb-linear");
                const n = void 0 !== o.range ? o.range : 0;
                switch (o.type) {
                case "directional":
                    i = new L.DirectionalLight(t),
                    i.target.position.set(0, 0, -1),
                    i.add(i.target);
                    break;
                case "point":
                    i = new L.PointLight(t),
                    i.distance = n;
                    break;
                case "spot":
                    i = new L.SpotLight(t),
                    i.distance = n,
                    o.spot = o.spot || {},
                    o.spot.innerConeAngle = void 0 !== o.spot.innerConeAngle ? o.spot.innerConeAngle : 0,
                    o.spot.outerConeAngle = void 0 !== o.spot.outerConeAngle ? o.spot.outerConeAngle : Math.PI / 4,
                    i.angle = o.spot.outerConeAngle,
                    i.penumbra = 1 - o.spot.innerConeAngle / o.spot.outerConeAngle,
                    i.target.position.set(0, 0, -1),
                    i.add(i.target);
                    break;
                default:
                    throw new Error("THREE.GLTFLoader: Unexpected light type: " + o.type)
                }
                return i.position.set(0, 0, 0),
                i.decay = 2,
                ke(i, o),
                void 0 !== o.intensity && (i.intensity = o.intensity),
                i.name = I.createUniqueName(o.name || "light_" + g),
                A = Promise.resolve(i),
                I.cache.add(C, A),
                A
            }
            getDependency(g, I) {
                if ("light" === g)
                    return this._loadLight(I)
            }
            createNodeAttachment(g) {
                const I = this
                  , C = this.parser
                  , A = C.json.nodes[g]
                  , e = (A.extensions && A.extensions[this.name] || {}).light;
                return void 0 === e ? null : this._loadLight(e).then((function(g) {
                    return C._getNodeRef(I.cache, e, g)
                }
                ))
            }
        }
        class $A {
            constructor() {
                this.name = qA.KHR_MATERIALS_UNLIT
            }
            getMaterialType() {
                return L.MeshBasicMaterial
            }
            extendParams(g, I, C) {
                const A = [];
                g.color = new L.Color(1,1,1),
                g.opacity = 1;
                const e = I.pbrMetallicRoughness;
                if (e) {
                    if (Array.isArray(e.baseColorFactor)) {
                        const I = e.baseColorFactor;
                        g.color.setRGB(I[0], I[1], I[2], "srgb-linear"),
                        g.opacity = I[3]
                    }
                    void 0 !== e.baseColorTexture && A.push(C.assignTexture(g, "map", e.baseColorTexture, "srgb"))
                }
                return Promise.all(A)
            }
        }
        class ge {
            constructor(g) {
                this.parser = g,
                this.name = qA.KHR_MATERIALS_EMISSIVE_STRENGTH
            }
            extendMaterialParams(g, I) {
                const C = this.parser.json.materials[g];
                if (!C.extensions || !C.extensions[this.name])
                    return Promise.resolve();
                const A = C.extensions[this.name].emissiveStrength;
                return void 0 !== A && (I.emissiveIntensity = A),
                Promise.resolve()
            }
        }
        class Ie {
            constructor(g) {
                this.parser = g,
                this.name = qA.KHR_MATERIALS_CLEARCOAT
            }
            getMaterialType(g) {
                const I = this.parser.json.materials[g];
                return I.extensions && I.extensions[this.name] ? L.MeshPhysicalMaterial : null
            }
            extendMaterialParams(g, I) {
                const C = this.parser
                  , A = C.json.materials[g];
                if (!A.extensions || !A.extensions[this.name])
                    return Promise.resolve();
                const e = []
                  , o = A.extensions[this.name];
                if (void 0 !== o.clearcoatFactor && (I.clearcoat = o.clearcoatFactor),
                void 0 !== o.clearcoatTexture && e.push(C.assignTexture(I, "clearcoatMap", o.clearcoatTexture)),
                void 0 !== o.clearcoatRoughnessFactor && (I.clearcoatRoughness = o.clearcoatRoughnessFactor),
                void 0 !== o.clearcoatRoughnessTexture && e.push(C.assignTexture(I, "clearcoatRoughnessMap", o.clearcoatRoughnessTexture)),
                void 0 !== o.clearcoatNormalTexture && (e.push(C.assignTexture(I, "clearcoatNormalMap", o.clearcoatNormalTexture)),
                void 0 !== o.clearcoatNormalTexture.scale)) {
                    const g = o.clearcoatNormalTexture.scale;
                    I.clearcoatNormalScale = new L.Vector2(g,g)
                }
                return Promise.all(e)
            }
        }
        class Ce {
            constructor(g) {
                this.parser = g,
                this.name = qA.KHR_MATERIALS_DISPERSION
            }
            getMaterialType(g) {
                const I = this.parser.json.materials[g];
                return I.extensions && I.extensions[this.name] ? L.MeshPhysicalMaterial : null
            }
            extendMaterialParams(g, I) {
                const C = this.parser.json.materials[g];
                if (!C.extensions || !C.extensions[this.name])
                    return Promise.resolve();
                const A = C.extensions[this.name];
                return I.dispersion = void 0 !== A.dispersion ? A.dispersion : 0,
                Promise.resolve()
            }
        }
        class Ae {
            constructor(g) {
                this.parser = g,
                this.name = qA.KHR_MATERIALS_IRIDESCENCE
            }
            getMaterialType(g) {
                const I = this.parser.json.materials[g];
                return I.extensions && I.extensions[this.name] ? L.MeshPhysicalMaterial : null
            }
            extendMaterialParams(g, I) {
                const C = this.parser
                  , A = C.json.materials[g];
                if (!A.extensions || !A.extensions[this.name])
                    return Promise.resolve();
                const e = []
                  , o = A.extensions[this.name];
                return void 0 !== o.iridescenceFactor && (I.iridescence = o.iridescenceFactor),
                void 0 !== o.iridescenceTexture && e.push(C.assignTexture(I, "iridescenceMap", o.iridescenceTexture)),
                void 0 !== o.iridescenceIor && (I.iridescenceIOR = o.iridescenceIor),
                void 0 === I.iridescenceThicknessRange && (I.iridescenceThicknessRange = [100, 400]),
                void 0 !== o.iridescenceThicknessMinimum && (I.iridescenceThicknessRange[0] = o.iridescenceThicknessMinimum),
                void 0 !== o.iridescenceThicknessMaximum && (I.iridescenceThicknessRange[1] = o.iridescenceThicknessMaximum),
                void 0 !== o.iridescenceThicknessTexture && e.push(C.assignTexture(I, "iridescenceThicknessMap", o.iridescenceThicknessTexture)),
                Promise.all(e)
            }
        }
        class ee {
            constructor(g) {
                this.parser = g,
                this.name = qA.KHR_MATERIALS_SHEEN
            }
            getMaterialType(g) {
                const I = this.parser.json.materials[g];
                return I.extensions && I.extensions[this.name] ? L.MeshPhysicalMaterial : null
            }
            extendMaterialParams(g, I) {
                const C = this.parser
                  , A = C.json.materials[g];
                if (!A.extensions || !A.extensions[this.name])
                    return Promise.resolve();
                const e = [];
                I.sheenColor = new L.Color(0,0,0),
                I.sheenRoughness = 0,
                I.sheen = 1;
                const o = A.extensions[this.name];
                if (void 0 !== o.sheenColorFactor) {
                    const g = o.sheenColorFactor;
                    I.sheenColor.setRGB(g[0], g[1], g[2], "srgb-linear")
                }
                return void 0 !== o.sheenRoughnessFactor && (I.sheenRoughness = o.sheenRoughnessFactor),
                void 0 !== o.sheenColorTexture && e.push(C.assignTexture(I, "sheenColorMap", o.sheenColorTexture, "srgb")),
                void 0 !== o.sheenRoughnessTexture && e.push(C.assignTexture(I, "sheenRoughnessMap", o.sheenRoughnessTexture)),
                Promise.all(e)
            }
        }
        class oe {
            constructor(g) {
                this.parser = g,
                this.name = qA.KHR_MATERIALS_TRANSMISSION
            }
            getMaterialType(g) {
                const I = this.parser.json.materials[g];
                return I.extensions && I.extensions[this.name] ? L.MeshPhysicalMaterial : null
            }
            extendMaterialParams(g, I) {
                const C = this.parser
                  , A = C.json.materials[g];
                if (!A.extensions || !A.extensions[this.name])
                    return Promise.resolve();
                const e = []
                  , o = A.extensions[this.name];
                return void 0 !== o.transmissionFactor && (I.transmission = o.transmissionFactor),
                void 0 !== o.transmissionTexture && e.push(C.assignTexture(I, "transmissionMap", o.transmissionTexture)),
                Promise.all(e)
            }
        }
        class ie {
            constructor(g) {
                this.parser = g,
                this.name = qA.KHR_MATERIALS_VOLUME
            }
            getMaterialType(g) {
                const I = this.parser.json.materials[g];
                return I.extensions && I.extensions[this.name] ? L.MeshPhysicalMaterial : null
            }
            extendMaterialParams(g, I) {
                const C = this.parser
                  , A = C.json.materials[g];
                if (!A.extensions || !A.extensions[this.name])
                    return Promise.resolve();
                const e = []
                  , o = A.extensions[this.name];
                I.thickness = void 0 !== o.thicknessFactor ? o.thicknessFactor : 0,
                void 0 !== o.thicknessTexture && e.push(C.assignTexture(I, "thicknessMap", o.thicknessTexture)),
                I.attenuationDistance = o.attenuationDistance || 1 / 0;
                const i = o.attenuationColor || [1, 1, 1];
                return I.attenuationColor = (new L.Color).setRGB(i[0], i[1], i[2], "srgb-linear"),
                Promise.all(e)
            }
        }
        class te {
            constructor(g) {
                this.parser = g,
                this.name = qA.KHR_MATERIALS_IOR
            }
            getMaterialType(g) {
                const I = this.parser.json.materials[g];
                return I.extensions && I.extensions[this.name] ? L.MeshPhysicalMaterial : null
            }
            extendMaterialParams(g, I) {
                const C = this.parser.json.materials[g];
                if (!C.extensions || !C.extensions[this.name])
                    return Promise.resolve();
                const A = C.extensions[this.name];
                return I.ior = void 0 !== A.ior ? A.ior : 1.5,
                Promise.resolve()
            }
        }
        class ne {
            constructor(g) {
                this.parser = g,
                this.name = qA.KHR_MATERIALS_SPECULAR
            }
            getMaterialType(g) {
                const I = this.parser.json.materials[g];
                return I.extensions && I.extensions[this.name] ? L.MeshPhysicalMaterial : null
            }
            extendMaterialParams(g, I) {
                const C = this.parser
                  , A = C.json.materials[g];
                if (!A.extensions || !A.extensions[this.name])
                    return Promise.resolve();
                const e = []
                  , o = A.extensions[this.name];
                I.specularIntensity = void 0 !== o.specularFactor ? o.specularFactor : 1,
                void 0 !== o.specularTexture && e.push(C.assignTexture(I, "specularIntensityMap", o.specularTexture));
                const i = o.specularColorFactor || [1, 1, 1];
                return I.specularColor = (new L.Color).setRGB(i[0], i[1], i[2], "srgb-linear"),
                void 0 !== o.specularColorTexture && e.push(C.assignTexture(I, "specularColorMap", o.specularColorTexture, "srgb")),
                Promise.all(e)
            }
        }
        class le {
            constructor(g) {
                this.parser = g,
                this.name = qA.EXT_MATERIALS_BUMP
            }
            getMaterialType(g) {
                const I = this.parser.json.materials[g];
                return I.extensions && I.extensions[this.name] ? L.MeshPhysicalMaterial : null
            }
            extendMaterialParams(g, I) {
                const C = this.parser
                  , A = C.json.materials[g];
                if (!A.extensions || !A.extensions[this.name])
                    return Promise.resolve();
                const e = []
                  , o = A.extensions[this.name];
                return I.bumpScale = void 0 !== o.bumpFactor ? o.bumpFactor : 1,
                void 0 !== o.bumpTexture && e.push(C.assignTexture(I, "bumpMap", o.bumpTexture)),
                Promise.all(e)
            }
        }
        class ce {
            constructor(g) {
                this.parser = g,
                this.name = qA.KHR_MATERIALS_ANISOTROPY
            }
            getMaterialType(g) {
                const I = this.parser.json.materials[g];
                return I.extensions && I.extensions[this.name] ? L.MeshPhysicalMaterial : null
            }
            extendMaterialParams(g, I) {
                const C = this.parser
                  , A = C.json.materials[g];
                if (!A.extensions || !A.extensions[this.name])
                    return Promise.resolve();
                const e = []
                  , o = A.extensions[this.name];
                return void 0 !== o.anisotropyStrength && (I.anisotropy = o.anisotropyStrength),
                void 0 !== o.anisotropyRotation && (I.anisotropyRotation = o.anisotropyRotation),
                void 0 !== o.anisotropyTexture && e.push(C.assignTexture(I, "anisotropyMap", o.anisotropyTexture)),
                Promise.all(e)
            }
        }
        class ae {
            constructor(g) {
                this.parser = g,
                this.name = qA.KHR_TEXTURE_BASISU
            }
            loadTexture(g) {
                const I = this.parser
                  , C = I.json
                  , A = C.textures[g];
                if (!A.extensions || !A.extensions[this.name])
                    return null;
                const e = A.extensions[this.name]
                  , o = I.options.ktx2Loader;
                if (!o) {
                    if (C.extensionsRequired && C.extensionsRequired.indexOf(this.name) >= 0)
                        throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");
                    return null
                }
                return I.loadTextureImage(g, e.source, o)
            }
        }
        class se {
            constructor(g) {
                this.parser = g,
                this.name = qA.EXT_TEXTURE_WEBP,
                this.isSupported = null
            }
            loadTexture(g) {
                const I = this.name
                  , C = this.parser
                  , A = C.json
                  , e = A.textures[g];
                if (!e.extensions || !e.extensions[I])
                    return null;
                const o = e.extensions[I]
                  , i = A.images[o.source];
                let t = C.textureLoader;
                if (i.uri) {
                    const g = C.options.manager.getHandler(i.uri);
                    null !== g && (t = g)
                }
                return this.detectSupport().then((function(e) {
                    if (e)
                        return C.loadTextureImage(g, o.source, t);
                    if (A.extensionsRequired && A.extensionsRequired.indexOf(I) >= 0)
                        throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");
                    return C.loadTexture(g)
                }
                ))
            }
            detectSupport() {
                return this.isSupported || (this.isSupported = new Promise((function(g) {
                    const I = new Image;
                    I.src = "data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",
                    I.onload = I.onerror = function() {
                        g(1 === I.height)
                    }
                }
                ))),
                this.isSupported
            }
        }
        class de {
            constructor(g) {
                this.parser = g,
                this.name = qA.EXT_TEXTURE_AVIF,
                this.isSupported = null
            }
            loadTexture(g) {
                const I = this.name
                  , C = this.parser
                  , A = C.json
                  , e = A.textures[g];
                if (!e.extensions || !e.extensions[I])
                    return null;
                const o = e.extensions[I]
                  , i = A.images[o.source];
                let t = C.textureLoader;
                if (i.uri) {
                    const g = C.options.manager.getHandler(i.uri);
                    null !== g && (t = g)
                }
                return this.detectSupport().then((function(e) {
                    if (e)
                        return C.loadTextureImage(g, o.source, t);
                    if (A.extensionsRequired && A.extensionsRequired.indexOf(I) >= 0)
                        throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");
                    return C.loadTexture(g)
                }
                ))
            }
            detectSupport() {
                return this.isSupported || (this.isSupported = new Promise((function(g) {
                    const I = new Image;
                    I.src = "data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",
                    I.onload = I.onerror = function() {
                        g(1 === I.height)
                    }
                }
                ))),
                this.isSupported
            }
        }
        class be {
            constructor(g) {
                this.name = qA.EXT_MESHOPT_COMPRESSION,
                this.parser = g
            }
            loadBufferView(g) {
                const I = this.parser.json
                  , C = I.bufferViews[g];
                if (C.extensions && C.extensions[this.name]) {
                    const g = C.extensions[this.name]
                      , A = this.parser.getDependency("buffer", g.buffer)
                      , e = this.parser.options.meshoptDecoder;
                    if (!e || !e.supported) {
                        if (I.extensionsRequired && I.extensionsRequired.indexOf(this.name) >= 0)
                            throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");
                        return null
                    }
                    return A.then((function(I) {
                        const C = g.byteOffset || 0
                          , A = g.byteLength || 0
                          , o = g.count
                          , i = g.byteStride
                          , t = new Uint8Array(I,C,A);
                        return e.decodeGltfBufferAsync ? e.decodeGltfBufferAsync(o, i, t, g.mode, g.filter).then((function(g) {
                            return g.buffer
                        }
                        )) : e.ready.then((function() {
                            const I = new ArrayBuffer(o * i);
                            return e.decodeGltfBuffer(new Uint8Array(I), o, i, t, g.mode, g.filter),
                            I
                        }
                        ))
                    }
                    ))
                }
                return null
            }
        }
        class Ge {
            constructor(g) {
                this.name = qA.EXT_MESH_GPU_INSTANCING,
                this.parser = g
            }
            createNodeMesh(g) {
                const I = this.parser.json
                  , C = I.nodes[g];
                if (!C.extensions || !C.extensions[this.name] || void 0 === C.mesh)
                    return null;
                const A = I.meshes[C.mesh];
                for (const g of A.primitives)
                    if (g.mode !== Ve.TRIANGLES && g.mode !== Ve.TRIANGLE_STRIP && g.mode !== Ve.TRIANGLE_FAN && void 0 !== g.mode)
                        return null;
                const e = C.extensions[this.name].attributes
                  , o = []
                  , i = {};
                for (const g in e)
                    o.push(this.parser.getDependency("accessor", e[g]).then(I => (i[g] = I,
                    i[g])));
                return o.length < 1 ? null : (o.push(this.parser.createNodeMesh(g)),
                Promise.all(o).then(g => {
                    const I = g.pop()
                      , C = I.isGroup ? I.children : [I]
                      , A = g[0].count
                      , e = [];
                    for (const g of C) {
                        const I = new L.Matrix4
                          , C = new L.Vector3
                          , o = new L.Quaternion
                          , t = new L.Vector3(1,1,1)
                          , n = new L.InstancedMesh(g.geometry,g.material,A);
                        for (let g = 0; g < A; g++)
                            i.TRANSLATION && C.fromBufferAttribute(i.TRANSLATION, g),
                            i.ROTATION && o.fromBufferAttribute(i.ROTATION, g),
                            i.SCALE && t.fromBufferAttribute(i.SCALE, g),
                            n.setMatrixAt(g, I.compose(C, o, t));
                        for (const I in i)
                            if ("_COLOR_0" === I) {
                                const g = i[I];
                                n.instanceColor = new L.InstancedBufferAttribute(g.array,g.itemSize,g.normalized)
                            } else
                                "TRANSLATION" !== I && "ROTATION" !== I && "SCALE" !== I && g.geometry.setAttribute(I, i[I]);
                        L.Object3D.prototype.copy.call(n, g),
                        this.parser.assignFinalMaterial(n),
                        e.push(n)
                    }
                    return I.isGroup ? (I.clear(),
                    I.add(...e),
                    I) : e[0]
                }
                ))
            }
        }
        const re = "glTF"
          , ue = 1313821514
          , Be = 5130562;
        class Ze {
            constructor(g) {
                this.name = qA.KHR_BINARY_GLTF,
                this.content = null,
                this.body = null;
                const I = new DataView(g,0,12);
                if (this.header = {
                    magic: L.LoaderUtils.decodeText(new Uint8Array(g.slice(0, 4))),
                    version: I.getUint32(4, !0),
                    length: I.getUint32(8, !0)
                },
                this.header.magic !== re)
                    throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");
                if (this.header.version < 2)
                    throw new Error("THREE.GLTFLoader: Legacy binary file detected.");
                const C = this.header.length - 12
                  , A = new DataView(g,12);
                let e = 0;
                for (; e < C; ) {
                    const I = A.getUint32(e, !0);
                    e += 4;
                    const C = A.getUint32(e, !0);
                    if (e += 4,
                    C === ue) {
                        const C = new Uint8Array(g,12 + e,I);
                        this.content = L.LoaderUtils.decodeText(C)
                    } else if (C === Be) {
                        const C = 12 + e;
                        this.body = g.slice(C, C + I)
                    }
                    e += I
                }
                if (null === this.content)
                    throw new Error("THREE.GLTFLoader: JSON content not found.")
            }
        }
        class me {
            constructor(g, I) {
                if (!I)
                    throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");
                this.name = qA.KHR_DRACO_MESH_COMPRESSION,
                this.json = g,
                this.dracoLoader = I,
                this.dracoLoader.preload()
            }
            decodePrimitive(g, I) {
                const C = this.json
                  , A = this.dracoLoader
                  , e = g.extensions[this.name].bufferView
                  , o = g.extensions[this.name].attributes
                  , i = {}
                  , t = {}
                  , n = {};
                for (const g in o) {
                    const I = we[g] || g.toLowerCase();
                    i[I] = o[g]
                }
                for (const I in g.attributes) {
                    const A = we[I] || I.toLowerCase();
                    if (void 0 !== o[I]) {
                        const e = C.accessors[g.attributes[I]]
                          , o = Xe[e.componentType];
                        n[A] = o.name,
                        t[A] = !0 === e.normalized
                    }
                }
                return I.getDependency("bufferView", e).then((function(g) {
                    return new Promise((function(I, C) {
                        A.decodeDracoFile(g, (function(g) {
                            for (const I in g.attributes) {
                                const C = g.attributes[I]
                                  , A = t[I];
                                void 0 !== A && (C.normalized = A)
                            }
                            I(g)
                        }
                        ), i, n, "srgb-linear", C)
                    }
                    ))
                }
                ))
            }
        }
        class he {
            constructor() {
                this.name = qA.KHR_TEXTURE_TRANSFORM
            }
            extendTexture(g, I) {
                return void 0 !== I.texCoord && I.texCoord !== g.channel || void 0 !== I.offset || void 0 !== I.rotation || void 0 !== I.scale ? (g = g.clone(),
                void 0 !== I.texCoord && (g.channel = I.texCoord),
                void 0 !== I.offset && g.offset.fromArray(I.offset),
                void 0 !== I.rotation && (g.rotation = I.rotation),
                void 0 !== I.scale && g.repeat.fromArray(I.scale),
                g.needsUpdate = !0,
                g) : g
            }
        }
        class pe {
            constructor() {
                this.name = qA.KHR_MESH_QUANTIZATION
            }
        }
        class ye extends L.Interpolant {
            constructor(g, I, C, A) {
                super(g, I, C, A)
            }
            copySampleValue_(g) {
                const I = this.resultBuffer
                  , C = this.sampleValues
                  , A = this.valueSize
                  , e = g * A * 3 + A;
                for (let g = 0; g !== A; g++)
                    I[g] = C[e + g];
                return I
            }
            interpolate_(g, I, C, A) {
                const e = this.resultBuffer
                  , o = this.sampleValues
                  , i = this.valueSize
                  , t = 2 * i
                  , n = 3 * i
                  , l = A - I
                  , c = (C - I) / l
                  , a = c * c
                  , s = a * c
                  , d = g * n
                  , b = d - n
                  , G = -2 * s + 3 * a
                  , r = s - a
                  , u = 1 - G
                  , B = r - a + c;
                for (let g = 0; g !== i; g++) {
                    const I = o[b + g + i]
                      , C = o[b + g + t] * l
                      , A = o[d + g + i]
                      , n = o[d + g] * l;
                    e[g] = u * I + B * C + G * A + r * n
                }
                return e
            }
        }
        const We = new L.Quaternion;
        class ve extends ye {
            interpolate_(g, I, C, A) {
                const e = super.interpolate_(g, I, C, A);
                return We.fromArray(e).normalize().toArray(e),
                e
            }
        }
        const Ve = {
            FLOAT: 5126,
            FLOAT_MAT3: 35675,
            FLOAT_MAT4: 35676,
            FLOAT_VEC2: 35664,
            FLOAT_VEC3: 35665,
            FLOAT_VEC4: 35666,
            LINEAR: 9729,
            REPEAT: 10497,
            SAMPLER_2D: 35678,
            POINTS: 0,
            LINES: 1,
            LINE_LOOP: 2,
            LINE_STRIP: 3,
            TRIANGLES: 4,
            TRIANGLE_STRIP: 5,
            TRIANGLE_FAN: 6,
            UNSIGNED_BYTE: 5121,
            UNSIGNED_SHORT: 5123
        }
          , Xe = {
            5120: Int8Array,
            5121: Uint8Array,
            5122: Int16Array,
            5123: Uint16Array,
            5125: Uint32Array,
            5126: Float32Array
        }
          , Ye = {
            9728: L.NearestFilter,
            9729: L.LinearFilter,
            9984: L.NearestMipmapNearestFilter,
            9985: L.LinearMipmapNearestFilter,
            9986: L.NearestMipmapLinearFilter,
            9987: L.LinearMipmapLinearFilter
        }
          , Ke = {
            33071: L.ClampToEdgeWrapping,
            33648: L.MirroredRepeatWrapping,
            10497: L.RepeatWrapping
        }
          , Re = {
            SCALAR: 1,
            VEC2: 2,
            VEC3: 3,
            VEC4: 4,
            MAT2: 4,
            MAT3: 9,
            MAT4: 16
        }
          , we = {
            POSITION: "position",
            NORMAL: "normal",
            TANGENT: "tangent",
            ...OA >= 152 ? {
                TEXCOORD_0: "uv",
                TEXCOORD_1: "uv1",
                TEXCOORD_2: "uv2",
                TEXCOORD_3: "uv3"
            } : {
                TEXCOORD_0: "uv",
                TEXCOORD_1: "uv2"
            },
            COLOR_0: "color",
            WEIGHTS_0: "skinWeight",
            JOINTS_0: "skinIndex"
        }
          , He = {
            scale: "scale",
            translation: "position",
            rotation: "quaternion",
            weights: "morphTargetInfluences"
        }
          , Fe = {
            CUBICSPLINE: void 0,
            LINEAR: L.InterpolateLinear,
            STEP: L.InterpolateDiscrete
        }
          , Ne = "OPAQUE"
          , Se = "MASK"
          , ze = "BLEND";
        function fe(g, I, C) {
            for (const A in C.extensions)
                void 0 === g[A] && (I.userData.gltfExtensions = I.userData.gltfExtensions || {},
                I.userData.gltfExtensions[A] = C.extensions[A])
        }
        function ke(g, I) {
            void 0 !== I.extras && ("object" == typeof I.extras ? Object.assign(g.userData, I.extras) : console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, " + I.extras))
        }
        function Je(g, I) {
            if (g.updateMorphTargets(),
            void 0 !== I.weights)
                for (let C = 0, A = I.weights.length; C < A; C++)
                    g.morphTargetInfluences[C] = I.weights[C];
            if (I.extras && Array.isArray(I.extras.targetNames)) {
                const C = I.extras.targetNames;
                if (g.morphTargetInfluences.length === C.length) {
                    g.morphTargetDictionary = {};
                    for (let I = 0, A = C.length; I < A; I++)
                        g.morphTargetDictionary[C[I]] = I
                } else
                    console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")
            }
        }
        function Le(g) {
            let I;
            const C = g.extensions && g.extensions[qA.KHR_DRACO_MESH_COMPRESSION];
            if (I = C ? "draco:" + C.bufferView + ":" + C.indices + ":" + xe(C.attributes) : g.indices + ":" + xe(g.attributes) + ":" + g.mode,
            void 0 !== g.targets)
                for (let C = 0, A = g.targets.length; C < A; C++)
                    I += ":" + xe(g.targets[C]);
            return I
        }
        function xe(g) {
            let I = "";
            const C = Object.keys(g).sort();
            for (let A = 0, e = C.length; A < e; A++)
                I += C[A] + ":" + g[C[A]] + ";";
            return I
        }
        function Me(g) {
            switch (g) {
            case Int8Array:
                return 1 / 127;
            case Uint8Array:
                return 1 / 255;
            case Int16Array:
                return 1 / 32767;
            case Uint16Array:
                return 1 / 65535;
            default:
                throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")
            }
        }
        const Qe = new L.Matrix4;
        class je {
            constructor(g={}, I={}) {
                this.json = g,
                this.extensions = {},
                this.plugins = {},
                this.options = I,
                this.cache = new PA,
                this.associations = new Map,
                this.primitiveCache = {},
                this.nodeCache = {},
                this.meshCache = {
                    refs: {},
                    uses: {}
                },
                this.cameraCache = {
                    refs: {},
                    uses: {}
                },
                this.lightCache = {
                    refs: {},
                    uses: {}
                },
                this.sourceCache = {},
                this.textureCache = {},
                this.nodeNamesUsed = {};
                let C = !1
                  , A = !1
                  , e = -1;
                "undefined" != typeof navigator && void 0 !== navigator.userAgent && (C = !0 === /^((?!chrome|android).)*safari/i.test(navigator.userAgent),
                A = navigator.userAgent.indexOf("Firefox") > -1,
                e = A ? navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1] : -1),
                "undefined" == typeof createImageBitmap || C || A && e < 98 ? this.textureLoader = new L.TextureLoader(this.options.manager) : this.textureLoader = new L.ImageBitmapLoader(this.options.manager),
                this.textureLoader.setCrossOrigin(this.options.crossOrigin),
                this.textureLoader.setRequestHeader(this.options.requestHeader),
                this.fileLoader = new L.FileLoader(this.options.manager),
                this.fileLoader.setResponseType("arraybuffer"),
                "use-credentials" === this.options.crossOrigin && this.fileLoader.setWithCredentials(!0)
            }
            setExtensions(g) {
                this.extensions = g
            }
            setPlugins(g) {
                this.plugins = g
            }
            parse(g, I) {
                const C = this
                  , A = this.json
                  , e = this.extensions;
                this.cache.removeAll(),
                this.nodeCache = {},
                this._invokeAll((function(g) {
                    return g._markDefs && g._markDefs()
                }
                )),
                Promise.all(this._invokeAll((function(g) {
                    return g.beforeRoot && g.beforeRoot()
                }
                ))).then((function() {
                    return Promise.all([C.getDependencies("scene"), C.getDependencies("animation"), C.getDependencies("camera")])
                }
                )).then((function(I) {
                    const o = {
                        scene: I[0][A.scene || 0],
                        scenes: I[0],
                        animations: I[1],
                        cameras: I[2],
                        asset: A.asset,
                        parser: C,
                        userData: {}
                    };
                    return fe(e, o, A),
                    ke(o, A),
                    Promise.all(C._invokeAll((function(g) {
                        return g.afterRoot && g.afterRoot(o)
                    }
                    ))).then((function() {
                        for (const g of o.scenes)
                            g.updateMatrixWorld();
                        g(o)
                    }
                    ))
                }
                )).catch(I)
            }
            _markDefs() {
                const g = this.json.nodes || []
                  , I = this.json.skins || []
                  , C = this.json.meshes || [];
                for (let C = 0, A = I.length; C < A; C++) {
                    const A = I[C].joints;
                    for (let I = 0, C = A.length; I < C; I++)
                        g[A[I]].isBone = !0
                }
                for (let I = 0, A = g.length; I < A; I++) {
                    const A = g[I];
                    void 0 !== A.mesh && (this._addNodeRef(this.meshCache, A.mesh),
                    void 0 !== A.skin && (C[A.mesh].isSkinnedMesh = !0)),
                    void 0 !== A.camera && this._addNodeRef(this.cameraCache, A.camera)
                }
            }
            _addNodeRef(g, I) {
                void 0 !== I && (void 0 === g.refs[I] && (g.refs[I] = g.uses[I] = 0),
                g.refs[I]++)
            }
            _getNodeRef(g, I, C) {
                if (g.refs[I] <= 1)
                    return C;
                const A = C.clone()
                  , e = (g, I) => {
                    const C = this.associations.get(g);
                    null != C && this.associations.set(I, C);
                    for (const [C,A] of g.children.entries())
                        e(A, I.children[C])
                }
                ;
                return e(C, A),
                A.name += "_instance_" + g.uses[I]++,
                A
            }
            _invokeOne(g) {
                const I = Object.values(this.plugins);
                I.push(this);
                for (let C = 0; C < I.length; C++) {
                    const A = g(I[C]);
                    if (A)
                        return A
                }
                return null
            }
            _invokeAll(g) {
                const I = Object.values(this.plugins);
                I.unshift(this);
                const C = [];
                for (let A = 0; A < I.length; A++) {
                    const e = g(I[A]);
                    e && C.push(e)
                }
                return C
            }
            getDependency(g, I) {
                const C = g + ":" + I;
                let A = this.cache.get(C);
                if (!A) {
                    switch (g) {
                    case "scene":
                        A = this.loadScene(I);
                        break;
                    case "node":
                        A = this._invokeOne((function(g) {
                            return g.loadNode && g.loadNode(I)
                        }
                        ));
                        break;
                    case "mesh":
                        A = this._invokeOne((function(g) {
                            return g.loadMesh && g.loadMesh(I)
                        }
                        ));
                        break;
                    case "accessor":
                        A = this.loadAccessor(I);
                        break;
                    case "bufferView":
                        A = this._invokeOne((function(g) {
                            return g.loadBufferView && g.loadBufferView(I)
                        }
                        ));
                        break;
                    case "buffer":
                        A = this.loadBuffer(I);
                        break;
                    case "material":
                        A = this._invokeOne((function(g) {
                            return g.loadMaterial && g.loadMaterial(I)
                        }
                        ));
                        break;
                    case "texture":
                        A = this._invokeOne((function(g) {
                            return g.loadTexture && g.loadTexture(I)
                        }
                        ));
                        break;
                    case "skin":
                        A = this.loadSkin(I);
                        break;
                    case "animation":
                        A = this._invokeOne((function(g) {
                            return g.loadAnimation && g.loadAnimation(I)
                        }
                        ));
                        break;
                    case "camera":
                        A = this.loadCamera(I);
                        break;
                    default:
                        if (A = this._invokeOne((function(C) {
                            return C != this && C.getDependency && C.getDependency(g, I)
                        }
                        )),
                        !A)
                            throw new Error("Unknown type: " + g)
                    }
                    this.cache.add(C, A)
                }
                return A
            }
            getDependencies(g) {
                let I = this.cache.get(g);
                if (!I) {
                    const C = this
                      , A = this.json[g + ("mesh" === g ? "es" : "s")] || [];
                    I = Promise.all(A.map((function(I, A) {
                        return C.getDependency(g, A)
                    }
                    ))),
                    this.cache.add(g, I)
                }
                return I
            }
            loadBuffer(g) {
                const I = this.json.buffers[g]
                  , C = this.fileLoader;
                if (I.type && "arraybuffer" !== I.type)
                    throw new Error("THREE.GLTFLoader: " + I.type + " buffer type is not supported.");
                if (void 0 === I.uri && 0 === g)
                    return Promise.resolve(this.extensions[qA.KHR_BINARY_GLTF].body);
                const A = this.options;
                return new Promise((function(g, e) {
                    C.load(L.LoaderUtils.resolveURL(I.uri, A.path), g, void 0, (function() {
                        e(new Error('THREE.GLTFLoader: Failed to load buffer "' + I.uri + '".'))
                    }
                    ))
                }
                ))
            }
            loadBufferView(g) {
                const I = this.json.bufferViews[g];
                return this.getDependency("buffer", I.buffer).then((function(g) {
                    const C = I.byteLength || 0
                      , A = I.byteOffset || 0;
                    return g.slice(A, A + C)
                }
                ))
            }
            loadAccessor(g) {
                const I = this
                  , C = this.json
                  , A = this.json.accessors[g];
                if (void 0 === A.bufferView && void 0 === A.sparse) {
                    const g = Re[A.type]
                      , I = Xe[A.componentType]
                      , C = !0 === A.normalized
                      , e = new I(A.count * g);
                    return Promise.resolve(new L.BufferAttribute(e,g,C))
                }
                const e = [];
                return void 0 !== A.bufferView ? e.push(this.getDependency("bufferView", A.bufferView)) : e.push(null),
                void 0 !== A.sparse && (e.push(this.getDependency("bufferView", A.sparse.indices.bufferView)),
                e.push(this.getDependency("bufferView", A.sparse.values.bufferView))),
                Promise.all(e).then((function(g) {
                    const e = g[0]
                      , o = Re[A.type]
                      , i = Xe[A.componentType]
                      , t = i.BYTES_PER_ELEMENT
                      , n = t * o
                      , l = A.byteOffset || 0
                      , c = void 0 !== A.bufferView ? C.bufferViews[A.bufferView].byteStride : void 0
                      , a = !0 === A.normalized;
                    let s, d;
                    if (c && c !== n) {
                        const g = Math.floor(l / c)
                          , C = "InterleavedBuffer:" + A.bufferView + ":" + A.componentType + ":" + g + ":" + A.count;
                        let n = I.cache.get(C);
                        n || (s = new i(e,g * c,A.count * c / t),
                        n = new L.InterleavedBuffer(s,c / t),
                        I.cache.add(C, n)),
                        d = new L.InterleavedBufferAttribute(n,o,l % c / t,a)
                    } else
                        s = null === e ? new i(A.count * o) : new i(e,l,A.count * o),
                        d = new L.BufferAttribute(s,o,a);
                    if (void 0 !== A.sparse) {
                        const I = Re.SCALAR
                          , C = Xe[A.sparse.indices.componentType]
                          , t = A.sparse.indices.byteOffset || 0
                          , n = A.sparse.values.byteOffset || 0
                          , l = new C(g[1],t,A.sparse.count * I)
                          , c = new i(g[2],n,A.sparse.count * o);
                        null !== e && (d = new L.BufferAttribute(d.array.slice(),d.itemSize,d.normalized));
                        for (let g = 0, I = l.length; g < I; g++) {
                            const I = l[g];
                            if (d.setX(I, c[g * o]),
                            o >= 2 && d.setY(I, c[g * o + 1]),
                            o >= 3 && d.setZ(I, c[g * o + 2]),
                            o >= 4 && d.setW(I, c[g * o + 3]),
                            o >= 5)
                                throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")
                        }
                    }
                    return d
                }
                ))
            }
            loadTexture(g) {
                const I = this.json
                  , C = this.options
                  , A = I.textures[g].source
                  , e = I.images[A];
                let o = this.textureLoader;
                if (e.uri) {
                    const g = C.manager.getHandler(e.uri);
                    null !== g && (o = g)
                }
                return this.loadTextureImage(g, A, o)
            }
            loadTextureImage(g, I, C) {
                const A = this
                  , e = this.json
                  , o = e.textures[g]
                  , i = e.images[I]
                  , t = (i.uri || i.bufferView) + ":" + o.sampler;
                if (this.textureCache[t])
                    return this.textureCache[t];
                const n = this.loadImageSource(I, C).then((function(I) {
                    I.flipY = !1,
                    I.name = o.name || i.name || "",
                    "" === I.name && "string" == typeof i.uri && !1 === i.uri.startsWith("data:image/") && (I.name = i.uri);
                    const C = (e.samplers || {})[o.sampler] || {};
                    return I.magFilter = Ye[C.magFilter] || L.LinearFilter,
                    I.minFilter = Ye[C.minFilter] || L.LinearMipmapLinearFilter,
                    I.wrapS = Ke[C.wrapS] || L.RepeatWrapping,
                    I.wrapT = Ke[C.wrapT] || L.RepeatWrapping,
                    A.associations.set(I, {
                        textures: g
                    }),
                    I
                }
                )).catch((function() {
                    return null
                }
                ));
                return this.textureCache[t] = n,
                n
            }
            loadImageSource(g, I) {
                const C = this
                  , A = this.json
                  , e = this.options;
                if (void 0 !== this.sourceCache[g])
                    return this.sourceCache[g].then(g => g.clone());
                const o = A.images[g]
                  , i = self.URL || self.webkitURL;
                let t = o.uri || ""
                  , n = !1;
                if (void 0 !== o.bufferView)
                    t = C.getDependency("bufferView", o.bufferView).then((function(g) {
                        n = !0;
                        const I = new Blob([g],{
                            type: o.mimeType
                        });
                        return t = i.createObjectURL(I),
                        t
                    }
                    ));
                else if (void 0 === o.uri)
                    throw new Error("THREE.GLTFLoader: Image " + g + " is missing URI and bufferView");
                const l = Promise.resolve(t).then((function(g) {
                    return new Promise((function(C, A) {
                        let o = C;
                        !0 === I.isImageBitmapLoader && (o = function(g) {
                            const I = new L.Texture(g);
                            I.needsUpdate = !0,
                            C(I)
                        }
                        ),
                        I.load(L.LoaderUtils.resolveURL(g, e.path), o, void 0, A)
                    }
                    ))
                }
                )).then((function(g) {
                    var I;
                    return !0 === n && i.revokeObjectURL(t),
                    ke(g, o),
                    g.userData.mimeType = o.mimeType || ((I = o.uri).search(/\.jpe?g($|\?)/i) > 0 || 0 === I.search(/^data\:image\/jpeg/) ? "image/jpeg" : I.search(/\.webp($|\?)/i) > 0 || 0 === I.search(/^data\:image\/webp/) ? "image/webp" : "image/png"),
                    g
                }
                )).catch((function(g) {
                    throw console.error("THREE.GLTFLoader: Couldn't load texture", t),
                    g
                }
                ));
                return this.sourceCache[g] = l,
                l
            }
            assignTexture(g, I, C, A) {
                const e = this;
                return this.getDependency("texture", C.index).then((function(o) {
                    if (!o)
                        return null;
                    if (void 0 !== C.texCoord && C.texCoord > 0 && ((o = o.clone()).channel = C.texCoord),
                    e.extensions[qA.KHR_TEXTURE_TRANSFORM]) {
                        const g = void 0 !== C.extensions ? C.extensions[qA.KHR_TEXTURE_TRANSFORM] : void 0;
                        if (g) {
                            const I = e.associations.get(o);
                            o = e.extensions[qA.KHR_TEXTURE_TRANSFORM].extendTexture(o, g),
                            e.associations.set(o, I)
                        }
                    }
                    return void 0 !== A && ("number" == typeof A && (A = 3001 === A ? "srgb" : "srgb-linear"),
                    "colorSpace"in o ? o.colorSpace = A : o.encoding = "srgb" === A ? 3001 : 3e3),
                    g[I] = o,
                    o
                }
                ))
            }
            assignFinalMaterial(g) {
                const I = g.geometry;
                let C = g.material;
                const A = void 0 === I.attributes.tangent
                  , e = void 0 !== I.attributes.color
                  , o = void 0 === I.attributes.normal;
                if (g.isPoints) {
                    const g = "PointsMaterial:" + C.uuid;
                    let I = this.cache.get(g);
                    I || (I = new L.PointsMaterial,
                    L.Material.prototype.copy.call(I, C),
                    I.color.copy(C.color),
                    I.map = C.map,
                    I.sizeAttenuation = !1,
                    this.cache.add(g, I)),
                    C = I
                } else if (g.isLine) {
                    const g = "LineBasicMaterial:" + C.uuid;
                    let I = this.cache.get(g);
                    I || (I = new L.LineBasicMaterial,
                    L.Material.prototype.copy.call(I, C),
                    I.color.copy(C.color),
                    I.map = C.map,
                    this.cache.add(g, I)),
                    C = I
                }
                if (A || e || o) {
                    let g = "ClonedMaterial:" + C.uuid + ":";
                    A && (g += "derivative-tangents:"),
                    e && (g += "vertex-colors:"),
                    o && (g += "flat-shading:");
                    let I = this.cache.get(g);
                    I || (I = C.clone(),
                    e && (I.vertexColors = !0),
                    o && (I.flatShading = !0),
                    A && (I.normalScale && (I.normalScale.y *= -1),
                    I.clearcoatNormalScale && (I.clearcoatNormalScale.y *= -1)),
                    this.cache.add(g, I),
                    this.associations.set(I, this.associations.get(C))),
                    C = I
                }
                g.material = C
            }
            getMaterialType() {
                return L.MeshStandardMaterial
            }
            loadMaterial(g) {
                const I = this
                  , C = this.json
                  , A = this.extensions
                  , e = C.materials[g];
                let o;
                const i = {}
                  , t = [];
                if ((e.extensions || {})[qA.KHR_MATERIALS_UNLIT]) {
                    const g = A[qA.KHR_MATERIALS_UNLIT];
                    o = g.getMaterialType(),
                    t.push(g.extendParams(i, e, I))
                } else {
                    const C = e.pbrMetallicRoughness || {};
                    if (i.color = new L.Color(1,1,1),
                    i.opacity = 1,
                    Array.isArray(C.baseColorFactor)) {
                        const g = C.baseColorFactor;
                        i.color.setRGB(g[0], g[1], g[2], "srgb-linear"),
                        i.opacity = g[3]
                    }
                    void 0 !== C.baseColorTexture && t.push(I.assignTexture(i, "map", C.baseColorTexture, "srgb")),
                    i.metalness = void 0 !== C.metallicFactor ? C.metallicFactor : 1,
                    i.roughness = void 0 !== C.roughnessFactor ? C.roughnessFactor : 1,
                    void 0 !== C.metallicRoughnessTexture && (t.push(I.assignTexture(i, "metalnessMap", C.metallicRoughnessTexture)),
                    t.push(I.assignTexture(i, "roughnessMap", C.metallicRoughnessTexture))),
                    o = this._invokeOne((function(I) {
                        return I.getMaterialType && I.getMaterialType(g)
                    }
                    )),
                    t.push(Promise.all(this._invokeAll((function(I) {
                        return I.extendMaterialParams && I.extendMaterialParams(g, i)
                    }
                    ))))
                }
                !0 === e.doubleSided && (i.side = L.DoubleSide);
                const n = e.alphaMode || Ne;
                if (n === ze ? (i.transparent = !0,
                i.depthWrite = !1) : (i.transparent = !1,
                n === Se && (i.alphaTest = void 0 !== e.alphaCutoff ? e.alphaCutoff : .5)),
                void 0 !== e.normalTexture && o !== L.MeshBasicMaterial && (t.push(I.assignTexture(i, "normalMap", e.normalTexture)),
                i.normalScale = new L.Vector2(1,1),
                void 0 !== e.normalTexture.scale)) {
                    const g = e.normalTexture.scale;
                    i.normalScale.set(g, g)
                }
                if (void 0 !== e.occlusionTexture && o !== L.MeshBasicMaterial && (t.push(I.assignTexture(i, "aoMap", e.occlusionTexture)),
                void 0 !== e.occlusionTexture.strength && (i.aoMapIntensity = e.occlusionTexture.strength)),
                void 0 !== e.emissiveFactor && o !== L.MeshBasicMaterial) {
                    const g = e.emissiveFactor;
                    i.emissive = (new L.Color).setRGB(g[0], g[1], g[2], "srgb-linear")
                }
                return void 0 !== e.emissiveTexture && o !== L.MeshBasicMaterial && t.push(I.assignTexture(i, "emissiveMap", e.emissiveTexture, "srgb")),
                Promise.all(t).then((function() {
                    const C = new o(i);
                    return e.name && (C.name = e.name),
                    ke(C, e),
                    I.associations.set(C, {
                        materials: g
                    }),
                    e.extensions && fe(A, C, e),
                    C
                }
                ))
            }
            createUniqueName(g) {
                const I = L.PropertyBinding.sanitizeNodeName(g || "");
                return I in this.nodeNamesUsed ? I + "_" + ++this.nodeNamesUsed[I] : (this.nodeNamesUsed[I] = 0,
                I)
            }
            loadGeometries(g) {
                const I = this
                  , C = this.extensions
                  , A = this.primitiveCache;
                function e(g) {
                    return C[qA.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(g, I).then((function(C) {
                        return Ue(C, g, I)
                    }
                    ))
                }
                const o = [];
                for (let C = 0, i = g.length; C < i; C++) {
                    const i = g[C]
                      , t = Le(i)
                      , n = A[t];
                    if (n)
                        o.push(n.promise);
                    else {
                        let g;
                        g = i.extensions && i.extensions[qA.KHR_DRACO_MESH_COMPRESSION] ? e(i) : Ue(new L.BufferGeometry, i, I),
                        A[t] = {
                            primitive: i,
                            promise: g
                        },
                        o.push(g)
                    }
                }
                return Promise.all(o)
            }
            loadMesh(g) {
                const I = this
                  , C = this.json
                  , A = this.extensions
                  , e = C.meshes[g]
                  , o = e.primitives
                  , i = [];
                for (let g = 0, I = o.length; g < I; g++) {
                    const I = void 0 === o[g].material ? (void 0 === (t = this.cache).DefaultMaterial && (t.DefaultMaterial = new L.MeshStandardMaterial({
                        color: 16777215,
                        emissive: 0,
                        metalness: 1,
                        roughness: 1,
                        transparent: !1,
                        depthTest: !0,
                        side: L.FrontSide
                    })),
                    t.DefaultMaterial) : this.getDependency("material", o[g].material);
                    i.push(I)
                }
                var t;
                return i.push(I.loadGeometries(o)),
                Promise.all(i).then((function(C) {
                    const i = C.slice(0, C.length - 1)
                      , t = C[C.length - 1]
                      , n = [];
                    for (let C = 0, l = t.length; C < l; C++) {
                        const l = t[C]
                          , c = o[C];
                        let a;
                        const s = i[C];
                        if (c.mode === Ve.TRIANGLES || c.mode === Ve.TRIANGLE_STRIP || c.mode === Ve.TRIANGLE_FAN || void 0 === c.mode)
                            a = !0 === e.isSkinnedMesh ? new L.SkinnedMesh(l,s) : new L.Mesh(l,s),
                            !0 === a.isSkinnedMesh && a.normalizeSkinWeights(),
                            c.mode === Ve.TRIANGLE_STRIP ? a.geometry = TA(a.geometry, L.TriangleStripDrawMode) : c.mode === Ve.TRIANGLE_FAN && (a.geometry = TA(a.geometry, L.TriangleFanDrawMode));
                        else if (c.mode === Ve.LINES)
                            a = new L.LineSegments(l,s);
                        else if (c.mode === Ve.LINE_STRIP)
                            a = new L.Line(l,s);
                        else if (c.mode === Ve.LINE_LOOP)
                            a = new L.LineLoop(l,s);
                        else {
                            if (c.mode !== Ve.POINTS)
                                throw new Error("THREE.GLTFLoader: Primitive mode unsupported: " + c.mode);
                            a = new L.Points(l,s)
                        }
                        Object.keys(a.geometry.morphAttributes).length > 0 && Je(a, e),
                        a.name = I.createUniqueName(e.name || "mesh_" + g),
                        ke(a, e),
                        c.extensions && fe(A, a, c),
                        I.assignFinalMaterial(a),
                        n.push(a)
                    }
                    for (let C = 0, A = n.length; C < A; C++)
                        I.associations.set(n[C], {
                            meshes: g,
                            primitives: C
                        });
                    if (1 === n.length)
                        return e.extensions && fe(A, n[0], e),
                        n[0];
                    const l = new L.Group;
                    e.extensions && fe(A, l, e),
                    I.associations.set(l, {
                        meshes: g
                    });
                    for (let g = 0, I = n.length; g < I; g++)
                        l.add(n[g]);
                    return l
                }
                ))
            }
            loadCamera(g) {
                let I;
                const C = this.json.cameras[g]
                  , A = C[C.type];
                if (A)
                    return "perspective" === C.type ? I = new L.PerspectiveCamera(L.MathUtils.radToDeg(A.yfov),A.aspectRatio || 1,A.znear || 1,A.zfar || 2e6) : "orthographic" === C.type && (I = new L.OrthographicCamera(-A.xmag,A.xmag,A.ymag,-A.ymag,A.znear,A.zfar)),
                    C.name && (I.name = this.createUniqueName(C.name)),
                    ke(I, C),
                    Promise.resolve(I);
                console.warn("THREE.GLTFLoader: Missing camera parameters.")
            }
            loadSkin(g) {
                const I = this.json.skins[g]
                  , C = [];
                for (let g = 0, A = I.joints.length; g < A; g++)
                    C.push(this._loadNodeShallow(I.joints[g]));
                return void 0 !== I.inverseBindMatrices ? C.push(this.getDependency("accessor", I.inverseBindMatrices)) : C.push(null),
                Promise.all(C).then((function(g) {
                    const C = g.pop()
                      , A = g
                      , e = []
                      , o = [];
                    for (let g = 0, i = A.length; g < i; g++) {
                        const i = A[g];
                        if (i) {
                            e.push(i);
                            const I = new L.Matrix4;
                            null !== C && I.fromArray(C.array, 16 * g),
                            o.push(I)
                        } else
                            console.warn('THREE.GLTFLoader: Joint "%s" could not be found.', I.joints[g])
                    }
                    return new L.Skeleton(e,o)
                }
                ))
            }
            loadAnimation(g) {
                const I = this.json
                  , C = this
                  , A = I.animations[g]
                  , e = A.name ? A.name : "animation_" + g
                  , o = []
                  , i = []
                  , t = []
                  , n = []
                  , l = [];
                for (let g = 0, I = A.channels.length; g < I; g++) {
                    const I = A.channels[g]
                      , C = A.samplers[I.sampler]
                      , e = I.target
                      , c = e.node
                      , a = void 0 !== A.parameters ? A.parameters[C.input] : C.input
                      , s = void 0 !== A.parameters ? A.parameters[C.output] : C.output;
                    void 0 !== e.node && (o.push(this.getDependency("node", c)),
                    i.push(this.getDependency("accessor", a)),
                    t.push(this.getDependency("accessor", s)),
                    n.push(C),
                    l.push(e))
                }
                return Promise.all([Promise.all(o), Promise.all(i), Promise.all(t), Promise.all(n), Promise.all(l)]).then((function(g) {
                    const I = g[0]
                      , A = g[1]
                      , o = g[2]
                      , i = g[3]
                      , t = g[4]
                      , n = [];
                    for (let g = 0, e = I.length; g < e; g++) {
                        const e = I[g]
                          , l = A[g]
                          , c = o[g]
                          , a = i[g]
                          , s = t[g];
                        if (void 0 === e)
                            continue;
                        e.updateMatrix && e.updateMatrix();
                        const d = C._createAnimationTracks(e, l, c, a, s);
                        if (d)
                            for (let g = 0; g < d.length; g++)
                                n.push(d[g])
                    }
                    return new L.AnimationClip(e,void 0,n)
                }
                ))
            }
            createNodeMesh(g) {
                const I = this.json
                  , C = this
                  , A = I.nodes[g];
                return void 0 === A.mesh ? null : C.getDependency("mesh", A.mesh).then((function(g) {
                    const I = C._getNodeRef(C.meshCache, A.mesh, g);
                    return void 0 !== A.weights && I.traverse((function(g) {
                        if (g.isMesh)
                            for (let I = 0, C = A.weights.length; I < C; I++)
                                g.morphTargetInfluences[I] = A.weights[I]
                    }
                    )),
                    I
                }
                ))
            }
            loadNode(g) {
                const I = this
                  , C = this.json.nodes[g]
                  , A = I._loadNodeShallow(g)
                  , e = []
                  , o = C.children || [];
                for (let g = 0, C = o.length; g < C; g++)
                    e.push(I.getDependency("node", o[g]));
                const i = void 0 === C.skin ? Promise.resolve(null) : I.getDependency("skin", C.skin);
                return Promise.all([A, Promise.all(e), i]).then((function(g) {
                    const I = g[0]
                      , C = g[1]
                      , A = g[2];
                    null !== A && I.traverse((function(g) {
                        g.isSkinnedMesh && g.bind(A, Qe)
                    }
                    ));
                    for (let g = 0, A = C.length; g < A; g++)
                        I.add(C[g]);
                    return I
                }
                ))
            }
            _loadNodeShallow(g) {
                const I = this.json
                  , C = this.extensions
                  , A = this;
                if (void 0 !== this.nodeCache[g])
                    return this.nodeCache[g];
                const e = I.nodes[g]
                  , o = e.name ? A.createUniqueName(e.name) : ""
                  , i = []
                  , t = A._invokeOne((function(I) {
                    return I.createNodeMesh && I.createNodeMesh(g)
                }
                ));
                return t && i.push(t),
                void 0 !== e.camera && i.push(A.getDependency("camera", e.camera).then((function(g) {
                    return A._getNodeRef(A.cameraCache, e.camera, g)
                }
                ))),
                A._invokeAll((function(I) {
                    return I.createNodeAttachment && I.createNodeAttachment(g)
                }
                )).forEach((function(g) {
                    i.push(g)
                }
                )),
                this.nodeCache[g] = Promise.all(i).then((function(I) {
                    let i;
                    if (i = !0 === e.isBone ? new L.Bone : I.length > 1 ? new L.Group : 1 === I.length ? I[0] : new L.Object3D,
                    i !== I[0])
                        for (let g = 0, C = I.length; g < C; g++)
                            i.add(I[g]);
                    if (e.name && (i.userData.name = e.name,
                    i.name = o),
                    ke(i, e),
                    e.extensions && fe(C, i, e),
                    void 0 !== e.matrix) {
                        const g = new L.Matrix4;
                        g.fromArray(e.matrix),
                        i.applyMatrix4(g)
                    } else
                        void 0 !== e.translation && i.position.fromArray(e.translation),
                        void 0 !== e.rotation && i.quaternion.fromArray(e.rotation),
                        void 0 !== e.scale && i.scale.fromArray(e.scale);
                    return A.associations.has(i) || A.associations.set(i, {}),
                    A.associations.get(i).nodes = g,
                    i
                }
                )),
                this.nodeCache[g]
            }
            loadScene(g) {
                const I = this.extensions
                  , C = this.json.scenes[g]
                  , A = this
                  , e = new L.Group;
                C.name && (e.name = A.createUniqueName(C.name)),
                ke(e, C),
                C.extensions && fe(I, e, C);
                const o = C.nodes || []
                  , i = [];
                for (let g = 0, I = o.length; g < I; g++)
                    i.push(A.getDependency("node", o[g]));
                return Promise.all(i).then((function(g) {
                    for (let I = 0, C = g.length; I < C; I++)
                        e.add(g[I]);
                    return A.associations = (g => {
                        const I = new Map;
                        for (const [g,C] of A.associations)
                            (g instanceof L.Material || g instanceof L.Texture) && I.set(g, C);
                        return g.traverse(g => {
                            const C = A.associations.get(g);
                            null != C && I.set(g, C)
                        }
                        ),
                        I
                    }
                    )(e),
                    e
                }
                ))
            }
            _createAnimationTracks(g, I, C, A, e) {
                const o = []
                  , i = g.name ? g.name : g.uuid
                  , t = [];
                let n;
                switch (He[e.path] === He.weights ? g.traverse((function(g) {
                    g.morphTargetInfluences && t.push(g.name ? g.name : g.uuid)
                }
                )) : t.push(i),
                He[e.path]) {
                case He.weights:
                    n = L.NumberKeyframeTrack;
                    break;
                case He.rotation:
                    n = L.QuaternionKeyframeTrack;
                    break;
                case He.position:
                case He.scale:
                    n = L.VectorKeyframeTrack;
                    break;
                default:
                    switch (C.itemSize) {
                    case 1:
                        n = L.NumberKeyframeTrack;
                        break;
                    case 2:
                    case 3:
                    default:
                        n = L.VectorKeyframeTrack
                    }
                }
                const l = void 0 !== A.interpolation ? Fe[A.interpolation] : L.InterpolateLinear
                  , c = this._getArrayFromAccessor(C);
                for (let g = 0, C = t.length; g < C; g++) {
                    const C = new n(t[g] + "." + He[e.path],I.array,c,l);
                    "CUBICSPLINE" === A.interpolation && this._createCubicSplineTrackInterpolant(C),
                    o.push(C)
                }
                return o
            }
            _getArrayFromAccessor(g) {
                let I = g.array;
                if (g.normalized) {
                    const g = Me(I.constructor)
                      , C = new Float32Array(I.length);
                    for (let A = 0, e = I.length; A < e; A++)
                        C[A] = I[A] * g;
                    I = C
                }
                return I
            }
            _createCubicSplineTrackInterpolant(g) {
                g.createInterpolant = function(g) {
                    return new (this instanceof L.QuaternionKeyframeTrack ? ve : ye)(this.times,this.values,this.getValueSize() / 3,g)
                }
                ,
                g.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline = !0
            }
        }
        function Ue(g, I, C) {
            const A = I.attributes
              , e = [];
            function o(I, A) {
                return C.getDependency("accessor", I).then((function(I) {
                    g.setAttribute(A, I)
                }
                ))
            }
            for (const I in A) {
                const C = we[I] || I.toLowerCase();
                C in g.attributes || e.push(o(A[I], C))
            }
            if (void 0 !== I.indices && !g.index) {
                const A = C.getDependency("accessor", I.indices).then((function(I) {
                    g.setIndex(I)
                }
                ));
                e.push(A)
            }
            return ke(g, I),
            function(g, I, C) {
                const A = I.attributes
                  , e = new L.Box3;
                if (void 0 === A.POSITION)
                    return;
                {
                    const g = C.json.accessors[A.POSITION]
                      , I = g.min
                      , o = g.max;
                    if (void 0 === I || void 0 === o)
                        return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");
                    if (e.set(new L.Vector3(I[0],I[1],I[2]), new L.Vector3(o[0],o[1],o[2])),
                    g.normalized) {
                        const I = Me(Xe[g.componentType]);
                        e.min.multiplyScalar(I),
                        e.max.multiplyScalar(I)
                    }
                }
                const o = I.targets;
                if (void 0 !== o) {
                    const g = new L.Vector3
                      , I = new L.Vector3;
                    for (let A = 0, e = o.length; A < e; A++) {
                        const e = o[A];
                        if (void 0 !== e.POSITION) {
                            const A = C.json.accessors[e.POSITION]
                              , o = A.min
                              , i = A.max;
                            if (void 0 !== o && void 0 !== i) {
                                if (I.setX(Math.max(Math.abs(o[0]), Math.abs(i[0]))),
                                I.setY(Math.max(Math.abs(o[1]), Math.abs(i[1]))),
                                I.setZ(Math.max(Math.abs(o[2]), Math.abs(i[2]))),
                                A.normalized) {
                                    const g = Me(Xe[A.componentType]);
                                    I.multiplyScalar(g)
                                }
                                g.max(I)
                            } else
                                console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")
                        }
                    }
                    e.expandByVector(g)
                }
                g.boundingBox = e;
                const i = new L.Sphere;
                e.getCenter(i.center),
                i.radius = e.min.distanceTo(e.max) / 2,
                g.boundingSphere = i
            }(g, I, C),
            Promise.all(e).then((function() {
                return void 0 !== I.targets ? function(g, I, C) {
                    let A = !1
                      , e = !1
                      , o = !1;
                    for (let g = 0, C = I.length; g < C; g++) {
                        const C = I[g];
                        if (void 0 !== C.POSITION && (A = !0),
                        void 0 !== C.NORMAL && (e = !0),
                        void 0 !== C.COLOR_0 && (o = !0),
                        A && e && o)
                            break
                    }
                    if (!A && !e && !o)
                        return Promise.resolve(g);
                    const i = []
                      , t = []
                      , n = [];
                    for (let l = 0, c = I.length; l < c; l++) {
                        const c = I[l];
                        if (A) {
                            const I = void 0 !== c.POSITION ? C.getDependency("accessor", c.POSITION) : g.attributes.position;
                            i.push(I)
                        }
                        if (e) {
                            const I = void 0 !== c.NORMAL ? C.getDependency("accessor", c.NORMAL) : g.attributes.normal;
                            t.push(I)
                        }
                        if (o) {
                            const I = void 0 !== c.COLOR_0 ? C.getDependency("accessor", c.COLOR_0) : g.attributes.color;
                            n.push(I)
                        }
                    }
                    return Promise.all([Promise.all(i), Promise.all(t), Promise.all(n)]).then((function(I) {
                        const C = I[0]
                          , i = I[1]
                          , t = I[2];
                        return A && (g.morphAttributes.position = C),
                        e && (g.morphAttributes.normal = i),
                        o && (g.morphAttributes.color = t),
                        g.morphTargetsRelative = !0,
                        g
                    }
                    ))
                }(g, I.targets, C) : g
            }
            ))
        }
        let De = null;
        function Te(g, I, C) {
            return A => {
                C && C(A),
                g && (De || (De = new QA),
                De.setDecoderPath("string" == typeof g ? g : "https://www.gstatic.com/draco/versioned/decoders/1.4.3/"),
                A.setDRACOLoader(De)),
                I && A.setMeshoptDecoder(DA())
            }
        }
        function Oe(g, I=!0, C=!0, A) {
            return Object(r.d)(EA, g, Te(I, C, A))
        }
        Oe.preload = (g, I=!0, C=!0, A) => r.d.preload(EA, g, Te(I, C, A)),
        Oe.clear = g => r.d.clear(EA, g);
        var Ee = C(5)
          , Pe = C(736)
          , qe = C(22)
          , _e = C.n(qe);
        function $e(g) {
            return function g(I, C, A) {
                if (A = A || [],
                !C[0])
                    return I(A);
                function e(e) {
                    return g(I, C.slice(1), A.concat([e]))
                }
                return "function" == typeof C[0] ? C[0]({
                    results: A,
                    render: e
                }) : Object(o.cloneElement)(C[0], {
                    children: e
                })
            }(g.children, g.components)
        }
        $e.propTypes = {
            children: _e.a.func.isRequired,
            components: _e.a.arrayOf(_e.a.oneOfType([_e.a.element, _e.a.func])).isRequired
        };
        const go = new L.Matrix4
          , Io = new L.Matrix4
          , Co = []
          , Ao = new L.Mesh;
        class eo extends L.Group {
            constructor() {
                super(),
                this.color = new L.Color("white"),
                this.instance = {
                    current: void 0
                },
                this.instanceKey = {
                    current: void 0
                }
            }
            get geometry() {
                var g;
                return null == (g = this.instance.current) ? void 0 : g.geometry
            }
            raycast(g, I) {
                const C = this.instance.current;
                if (!C)
                    return;
                if (!C.geometry || !C.material)
                    return;
                Ao.geometry = C.geometry;
                const A = C.matrixWorld;
                let e = C.userData.instances.indexOf(this.instanceKey);
                if (!(-1 === e || e > C.count)) {
                    C.getMatrixAt(e, go),
                    Io.multiplyMatrices(A, go),
                    Ao.matrixWorld = Io,
                    Ao.raycast(g, Co);
                    for (let g = 0, C = Co.length; g < C; g++) {
                        const C = Co[g];
                        C.instanceId = e,
                        C.object = this,
                        I.push(C)
                    }
                    Co.length = 0
                }
            }
        }
        let oo, io;
        const to = o.createContext(null)
          , no = new L.Matrix4
          , lo = new L.Matrix4
          , co = new L.Matrix4;
        new L.Color;
        const ao = new L.Vector3
          , so = new L.Quaternion
          , bo = new L.Vector3
          , Go = o.forwardRef( ({context: g, children: I, ...C}, A) => {
            o.useMemo( () => Object(r.b)({
                Position: eo
            }), []);
            const e = o.useRef()
              , {subscribe: i, getParent: t} = o.useContext(g || to);
            return o.useLayoutEffect( () => i(e), []),
            o.createElement("position", Object(Ee.a)({
                instance: t(),
                instanceKey: e,
                ref: Object(Pe.a)([A, e])
            }, C), I)
        }
        )
          , ro = o.forwardRef( ({children: g, range: I, limit: C=1e3, frames: A=1 / 0, ...e}, i) => {
            const [{context: t, instance: n}] = o.useState( () => {
                const g = o.createContext(null);
                return {
                    context: g,
                    instance: o.forwardRef( (I, C) => o.createElement(Go, Object(Ee.a)({
                        context: g
                    }, I, {
                        ref: C
                    })))
                }
            }
            )
              , l = o.useRef(null)
              , [c,a] = o.useState([])
              , [[s,d]] = o.useState( () => {
                const g = new Float32Array(16 * C);
                for (oo = 0; oo < C; oo++)
                    co.identity().toArray(g, 16 * oo);
                return [g, new Float32Array([...new Array(3 * C)].map( () => 1))]
            }
            );
            o.useLayoutEffect( () => {
                l.current.count = l.current.instanceMatrix.updateRange.count = l.current.instanceColor.updateRange.count = Math.min(C, void 0 !== I ? I : C, c.length)
            }
            , [c, I]),
            o.useEffect( () => {
                l.current.instanceMatrix.needsUpdate = !0
            }
            );
            let b = 0;
            Object(r.c)( () => {
                if (A === 1 / 0 || b < A) {
                    for (l.current.updateMatrix(),
                    l.current.updateMatrixWorld(),
                    no.copy(l.current.matrixWorld).invert(),
                    oo = 0; oo < c.length; oo++)
                        io = c[oo].current,
                        io.matrixWorld.decompose(ao, so, bo),
                        lo.compose(ao, so, bo).premultiply(no),
                        lo.toArray(s, 16 * oo),
                        l.current.instanceMatrix.needsUpdate = !0,
                        io.color.toArray(d, 3 * oo),
                        l.current.instanceColor.needsUpdate = !0;
                    b++
                }
            }
            );
            const G = o.useMemo( () => ({
                getParent: () => l,
                subscribe: g => (a(I => [...I, g]),
                () => a(I => I.filter(I => I.current !== g.current)))
            }), []);
            return o.createElement("instancedMesh", Object(Ee.a)({
                userData: {
                    instances: c
                },
                matrixAutoUpdate: !1,
                ref: Object(Pe.a)([i, l]),
                args: [null, null, 0],
                raycast: () => null
            }, e), o.createElement("instancedBufferAttribute", {
                attach: "instanceMatrix",
                count: s.length / 16,
                array: s,
                itemSize: 16,
                usage: L.DynamicDrawUsage
            }), o.createElement("instancedBufferAttribute", {
                attach: "instanceColor",
                count: d.length / 3,
                array: d,
                itemSize: 3,
                usage: L.DynamicDrawUsage
            }), "function" == typeof g ? o.createElement(t.Provider, {
                value: G
            }, g(n)) : o.createElement(to.Provider, {
                value: G
            }, g))
        }
        );
        var uo = C(771);
        function Bo(g, I) {
            var C = Object.keys(g);
            if (Object.getOwnPropertySymbols) {
                var A = Object.getOwnPropertySymbols(g);
                I && (A = A.filter((function(I) {
                    return Object.getOwnPropertyDescriptor(g, I).enumerable
                }
                ))),
                C.push.apply(C, A)
            }
            return C
        }
        function Zo(g) {
            for (var I = 1; I < arguments.length; I++) {
                var C = null != arguments[I] ? arguments[I] : {};
                I % 2 ? Bo(Object(C), !0).forEach((function(I) {
                    n()(g, I, C[I])
                }
                )) : Object.getOwnPropertyDescriptors ? Object.defineProperties(g, Object.getOwnPropertyDescriptors(C)) : Bo(Object(C)).forEach((function(I) {
                    Object.defineProperty(g, I, Object.getOwnPropertyDescriptor(C, I))
                }
                ))
            }
            return g
        }
        var mo = function(g) {
            var I = Oe(g.file).nodes
              , C = [{
                position: [.12883674393974798, -.05229188725017786, .06980955774029562],
                rotation: [1.709291282077396, -2.9592980763368026, -1.0697556661372716]
            }, {
                position: [.06664734731827215, -.09856040869219174, -.07305403308580294],
                rotation: [-1.944864620966146, 2.0562961097436037, 2.874002952491832]
            }, {
                position: [-.20609031975230097, -.054070143215317, .11734937463069806],
                rotation: [-.3233638493964772, -2.3373710705761686, 1.1107339149610427]
            }, {
                position: [.037948496385698194, -.1967100413999726, -.14796657951153536],
                rotation: [-.702122558018324, -2.402026445345858, -2.746417760460714]
            }, {
                position: [-.13768200768970817, -.11845961707765218, -.08835261126323357],
                rotation: [2.444401340615984, .02443822688504161, -2.7155104301848088]
            }, {
                position: [.20930221549788763, -.19252157791183, -.20342678539197612],
                rotation: [.6599394802461582, -1.843788936206725, 2.4737577082874433]
            }, {
                position: [-.12040784525458703, .16841473818383512, .03825336880088048],
                rotation: [2.1884884538359497, -2.1809997816546645, 2.0966942031661255]
            }, {
                position: [-.1478668586307983, .14498812963941954, .15874965098096794],
                rotation: [.537029264569037, -2.057850650479706, .4785804094139266]
            }]
              , A = function(g) {
                return Object(Y.jsxs)(ro, {
                    geometry: g.geometry,
                    children: [Object(Y.jsx)("meshStandardMaterial", {
                        color: "#efcb7d",
                        metalness: .5,
                        roughness: .35
                    }), C.map((function(g, I) {
                        return Object(uo.createElement)(Go, Zo(Zo({}, g), {}, {
                            key: I.toString()
                        }))
                    }
                    ))]
                })
            };
            return Object(Y.jsxs)("group", {
                scale: .7,
                children: [A(I.sweep), A(I.sweep001), A(I.sweep002), A(I.sweep003), A(I.sweep004), Object(Y.jsx)("mesh", {
                    geometry: I.sweep003.geometry,
                    "position-z": .5,
                    children: Object(Y.jsx)("meshStandardMaterial", {
                        color: "#ff4d00",
                        metalness: .2,
                        roughness: .35
                    })
                })]
            })
        }
          , ho = function() {
            var g = Object(J.a)()
              , I = g.stage
              , C = g.model
              , A = g.model0
              , i = g.model1
              , t = g.model2
              , n = Object(o.useState)(!0)
              , l = e()(n, 2)
              , c = l[0]
              , s = l[1]
              , d = Object(o.useRef)()
              , b = Object(o.useRef)()
              , G = Object(o.useRef)()
              , u = Object(o.useRef)({
                color1: A.circleColor1,
                color2: A.circleColor2
            })
              , B = function(g, I) {
                a.a.killTweensOf(u.current),
                a.a.to(u.current, {
                    color1: g,
                    color2: I,
                    duration: 2
                })
            };
            Object(o.useEffect)((function() {
                switch (2 === I ? (a.a.killTweensOf([d.current.scale, b.current.scale, G.current.scale]),
                a.a.to([d.current.scale, b.current.scale, G.current.scale], {
                    x: 1.1,
                    y: 1.1,
                    z: 1.1,
                    duration: c ? 3 : .4,
                    stagger: .05,
                    delay: c ? 1.5 : 0,
                    ease: "power3.out",
                    onComplete: function() {
                        d.current && (a.a.to([d.current.scale, b.current.scale, G.current.scale], {
                            x: 1,
                            y: 1,
                            z: 1,
                            duration: 1,
                            stagger: .05,
                            ease: "power3.out"
                        }),
                        s(!1))
                    }
                })) : (a.a.to(d.current.scale, {
                    x: 0,
                    y: 0,
                    z: 0,
                    duration: 1,
                    delay: 2,
                    ease: "power3.out"
                }),
                a.a.to(b.current.scale, {
                    x: 0,
                    y: 0,
                    z: 0,
                    duration: 1,
                    delay: 2,
                    ease: "power3.out"
                }),
                a.a.to(G.current.scale, {
                    x: 0,
                    y: 0,
                    z: 0,
                    duration: 1,
                    delay: 2,
                    ease: "power3.out"
                }),
                s(!0)),
                C) {
                case 0:
                    B(A.circleColor1, A.circleColor2);
                    break;
                case 1:
                    B(i.circleColor1, i.circleColor2);
                    break;
                case 2:
                    B(t.circleColor1, t.circleColor2);
                    break;
                default:
                    B(A.circleColor1, A.circleColor2)
                }
                d.current.material.uniforms.uAlpha.value = 1,
                b.current.material.uniforms.uAlpha.value = .4,
                G.current.material.uniforms.uAlpha.value = .2
            }
            ), [I, C, c]);
            var Z = Object(o.useMemo)((function() {
                return {
                    transparent: !0,
                    uniforms: {
                        uTime: {
                            value: 0
                        },
                        uAlpha: {
                            value: 0
                        },
                        uColor1: {
                            value: new L.Color(u.color1)
                        },
                        uColor2: {
                            value: new L.Color(u.color2)
                        }
                    },
                    vertexShader: "\n      varying vec2 vUv;\n      void main() {\n        vUv = uv;\n        vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n        gl_Position = projectionMatrix * mvPosition;\n      }\n      ",
                    fragmentShader: "\n      varying vec2 vUv;\n      uniform vec3 uColor1;\n      uniform vec3 uColor2;\n      uniform float uAlpha;\n\n      void main() {\n        vec3 color = mix(uColor1, uColor2, vUv.y);\n        gl_FragColor = vec4(color, uAlpha);\n      }\n      "
                }
            }
            ), []);
            return Object(r.c)((function() {
                d.current.material.uniforms.uColor1.value = new L.Color(u.current.color1),
                b.current.material.uniforms.uColor1.value = new L.Color(u.current.color1),
                G.current.material.uniforms.uColor1.value = new L.Color(u.current.color1),
                d.current.material.uniforms.uColor2.value = new L.Color(u.current.color2),
                b.current.material.uniforms.uColor2.value = new L.Color(u.current.color2),
                G.current.material.uniforms.uColor2.value = new L.Color(u.current.color2)
            }
            )),
            Object(Y.jsxs)("group", {
                position: [1.6, .2, 0],
                children: [Object(Y.jsxs)("mesh", {
                    position: [0, 0, -2],
                    ref: d,
                    scale: [0, 0, 0],
                    children: [Object(Y.jsx)("circleGeometry", {
                        args: [1, 100]
                    }), Object(Y.jsx)("shaderMaterial", {
                        attach: "material",
                        args: [Z]
                    })]
                }), Object(Y.jsxs)("mesh", {
                    position: [0, 0, -3],
                    ref: b,
                    scale: [0, 0, 0],
                    children: [Object(Y.jsx)("circleGeometry", {
                        args: [2.3, 100]
                    }), Object(Y.jsx)("shaderMaterial", {
                        attach: "material",
                        args: [Z]
                    })]
                }), Object(Y.jsxs)("mesh", {
                    position: [0, 0, -4],
                    ref: G,
                    scale: [0, 0, 0],
                    children: [Object(Y.jsx)("circleGeometry", {
                        args: [4, 100]
                    }), Object(Y.jsx)("shaderMaterial", {
                        attach: "material",
                        args: [Z]
                    })]
                })]
            })
        }
          , po = ["file"]
          , yo = ["file"]
          , Wo = ["file"];
        function vo(g, I) {
            var C = Object.keys(g);
            if (Object.getOwnPropertySymbols) {
                var A = Object.getOwnPropertySymbols(g);
                I && (A = A.filter((function(I) {
                    return Object.getOwnPropertyDescriptor(g, I).enumerable
                }
                ))),
                C.push.apply(C, A)
            }
            return C
        }
        function Vo(g) {
            for (var I = 1; I < arguments.length; I++) {
                var C = null != arguments[I] ? arguments[I] : {};
                I % 2 ? vo(Object(C), !0).forEach((function(I) {
                    n()(g, I, C[I])
                }
                )) : Object.getOwnPropertyDescriptors ? Object.defineProperties(g, Object.getOwnPropertyDescriptors(C)) : vo(Object(C)).forEach((function(I) {
                    Object.defineProperty(g, I, Object.getOwnPropertyDescriptor(C, I))
                }
                ))
            }
            return g
        }
        var Xo = L.MathUtils.lerp
          , Yo = Object(o.forwardRef)((function(g, I) {
            var C = g.file
              , A = xA()(g, po)
              , e = Oe(C)
              , o = (e.nodes,
            e.materials,
            e.scene);
            return Object(Y.jsx)("group", Vo(Vo({}, A), {}, {
                ref: I,
                scale: .01,
                children: Object(Y.jsx)("group", {
                    rotation: [0, Math.PI / 2, 0],
                    scale: .7,
                    children: Object(Y.jsx)("primitive", {
                        object: o
                    })
                })
            }))
        }
        ))
          , Ko = Object(o.forwardRef)((function(g, I) {
            var C = g.file
              , A = xA()(g, yo)
              , e = Oe(C)
              , i = e.nodes
              , t = e.materials
              , n = Object(o.useCallback)((function(g) {
                return Object(Y.jsxs)("group", {
                    rotation: g,
                    scale: .01,
                    children: [Object(Y.jsx)("mesh", {
                        castShadow: !0,
                        receiveShadow: !0,
                        geometry: i.lines_1.geometry,
                        material: t.connectors
                    }), Object(Y.jsx)("mesh", {
                        castShadow: !0,
                        receiveShadow: !0,
                        geometry: i.lines_2.geometry,
                        material: t.circles,
                        "material-transparent": !0,
                        "material-opacity": .2
                    }), Object(Y.jsx)("mesh", {
                        castShadow: !0,
                        receiveShadow: !0,
                        geometry: i.lines_3.geometry,
                        material: t.lines,
                        "material-transparent": !0,
                        "material-opacity": .2
                    })]
                })
            }
            ), [i, t]);
            return Object(Y.jsx)("group", Vo(Vo({}, A), {}, {
                ref: I,
                children: Object(Y.jsxs)("group", {
                    scale: .08,
                    "rotation-x": .35 * Math.PI,
                    children: [Object(Y.jsx)("mesh", {
                        castShadow: !0,
                        receiveShadow: !0,
                        geometry: i.cpu.geometry,
                        material: t.cpu,
                        rotation: [Math.PI / 2, 0, 0],
                        scale: .01
                    }), n([Math.PI / 2, 0, 0]), n([Math.PI / 2, 0, .5 * Math.PI]), n([Math.PI / 2, 0, Math.PI]), n([Math.PI / 2, 0, 1.5 * Math.PI])]
                })
            }))
        }
        ))
          , Ro = Object(o.forwardRef)((function(g, I) {
            var C = g.file
              , A = xA()(g, Wo);
            return Object(Y.jsx)("group", Vo(Vo({}, A), {}, {
                ref: I,
                children: Object(Y.jsx)(mo, {
                    file: C
                })
            }))
        }
        ))
          , wo = function() {
            var g = Object(J.a)()
              , I = g.stage
              , C = g.model
              , A = g.model0
              , e = g.model1
              , i = g.model2
              , t = g.stage0
              , n = g.stage2
              , l = g.stage3
              , c = Object(r.e)().camera
              , s = Object(o.useRef)()
              , d = Object(o.useRef)()
              , b = Object(o.useRef)()
              , G = Object(o.useRef)()
              , u = {
                duration: 1.2,
                ease: "power3.inOut"
            };
            return Object(o.useEffect)((function() {
                switch (I) {
                case 2:
                    a.a.set(s.current.position, {
                        x: n.cameraPos.x,
                        duration: 3.5,
                        ease: "power3.inOut"
                    }),
                    a.a.to(c.position, {
                        x: n.cameraPos.x,
                        y: n.cameraPos.y,
                        duration: 3.5,
                        ease: "power3.inOut"
                    });
                    break;
                case 3:
                    a.a.to(c.position, {
                        x: l.cameraPos.x,
                        y: l.cameraPos.y,
                        duration: 3.5,
                        delay: .3,
                        ease: "power3.inOut"
                    });
                    break;
                default:
                    a.a.to(c.position, {
                        x: t.cameraPos.x,
                        y: t.cameraPos.y,
                        duration: 3.5,
                        delay: .3,
                        ease: "power3.inOut"
                    })
                }
                switch (C) {
                case 0:
                    a.a.killTweensOf([d.current.scale, b.current.scale, G.current.scale]),
                    a.a.to([d.current.scale], Vo({
                        x: 1,
                        y: 1,
                        z: 1,
                        delay: .5
                    }, u)),
                    a.a.to([b.current.scale, G.current.scale], Vo({
                        x: 0,
                        y: 0,
                        z: 0
                    }, u)),
                    a.a.to([d.current.rotation], Vo({
                        y: 0,
                        delay: .5
                    }, u)),
                    a.a.to([b.current.rotation, G.current.rotation], Vo({
                        y: Math.PI,
                        ease: "power3.inOut"
                    }, u));
                    break;
                case 1:
                    a.a.killTweensOf([d.current.scale, b.current.scale, G.current.scale]),
                    a.a.to(b.current.scale, Vo({
                        x: 1,
                        y: 1,
                        z: 1,
                        delay: .5
                    }, u)),
                    a.a.to([d.current.scale, G.current.scale], Vo({
                        x: 0,
                        y: 0,
                        z: 0
                    }, u)),
                    a.a.to(b.current.rotation, Vo({
                        y: 0,
                        delay: .5
                    }, u)),
                    a.a.to([d.current.rotation, G.current.rotation], Vo({
                        y: Math.PI
                    }, u));
                    break;
                case 2:
                    a.a.killTweensOf([d.current.scale, b.current.scale, G.current.scale]),
                    a.a.to(G.current.scale, Vo({
                        x: 1,
                        y: 1,
                        z: 1,
                        delay: .5
                    }, u)),
                    a.a.to([d.current.scale, b.current.scale], Vo({
                        x: 0,
                        y: 0,
                        z: 0
                    }, u)),
                    a.a.to(G.current.rotation, Vo({
                        y: 0,
                        delay: .5
                    }, u)),
                    a.a.to([d.current.rotation, b.current.rotation], Vo({
                        y: Math.PI
                    }, u));
                    break;
                case -1:
                    a.a.killTweensOf([d.current.scale, b.current.scale, G.current.scale]),
                    a.a.to([d.current.scale, b.current.scale, G.current.scale], Vo({
                        x: 0,
                        y: 0,
                        z: 0,
                        delay: 2
                    }, u))
                }
            }
            ), [I, C]),
            Object(r.c)((function(g) {
                var C = g.mouse;
                2 === I && (s.current.rotation.x = Xo(s.current.rotation.x, .1 * -C.y, .1),
                s.current.rotation.y = Xo(s.current.rotation.y, .1 * (C.x - 1.5), .1))
            }
            )),
            Object(Y.jsx)(Y.Fragment, {
                children: Object(Y.jsxs)("group", {
                    ref: s,
                    position: [0, 0, 0],
                    children: [Object(Y.jsx)(ho, {}), Object(Y.jsx)(Yo, {
                        ref: d,
                        file: A.file,
                        dispose: null,
                        position: [1.5, 0, 0],
                        scale: [0, 0, 0]
                    }), Object(Y.jsx)(Ko, {
                        ref: b,
                        file: e.file,
                        dispose: null,
                        position: [1.5, 0, 0],
                        scale: [0, 0, 0]
                    }), Object(Y.jsx)(Ro, {
                        ref: G,
                        file: i.file,
                        dispose: null,
                        position: [1.6, 0, 0],
                        scale: [0, 0, 0]
                    })]
                })
            })
        }
          , Ho = C(14)
          , Fo = C.n(Ho)
          , No = function(g) {
            var I = g.count
              , C = Object(r.d)(L.TextureLoader, ["".concat(Fo.a.THEME_DIR, "/images/blur-1.png"), "".concat(Fo.a.THEME_DIR, "/images/blur-2.png")])
              , A = e()(C, 2)
              , i = A[0]
              , t = A[1]
              , n = Object(o.useRef)()
              , l = L.MathUtils.randFloat
              , c = L.MathUtils.mapLinear
              , a = Object(o.useMemo)((function() {
                for (var g = new Float32Array(3 * I), C = new Float32Array(I), A = new Float32Array(I), e = new Float32Array(I), o = 0; o < I; o += 1) {
                    var i = l(-14, 8)
                      , t = l(-8, 14)
                      , n = l(-10, -8)
                      , a = l(.03, .4)
                      , s = c(n, -10, -8, 1.5, 5);
                    g.set([i, t, n], 3 * o),
                    C.set([s], o),
                    e.set([o > I / 2], o),
                    A.set([a], o)
                }
                return [g, C, A, e]
            }
            ), [])
              , s = e()(a, 4)
              , d = s[0]
              , b = s[1]
              , G = s[2]
              , u = s[3]
              , B = Object(o.useMemo)((function() {
                return {
                    uniforms: {
                        uTime: {
                            value: 0
                        },
                        uTexture1: {
                            value: i
                        },
                        uTexture2: {
                            value: t
                        }
                    },
                    vertexShader: "\n      attribute float aSize;\n      attribute float aSpeed;\n      attribute float aMaterial;\n      uniform float uTime;\n      varying float vSize;\n      varying float vMaterial;\n      void main() {\n        vSize = aSize;\n        vMaterial = aMaterial;\n        vec3 pos = position;\n        float time = uTime * aSpeed;\n        pos.x += (sin(time + pos.z) + cos(time + pos.y));\n        pos.y += (cos(time + pos.x) + sin(time + pos.z));\n        pos.z += (cos(time + pos.y) + sin(time + pos.x));\n        vec4 mvPosition = modelViewMatrix * vec4( pos, 1.0 );\n        gl_PointSize = aSize * ( 300.0 / -mvPosition.z );\n        gl_Position = projectionMatrix * mvPosition;\n      }\n      ",
                    fragmentShader: "\n      uniform sampler2D uTexture1;\n      uniform sampler2D uTexture2;\n      varying float vSize;\n      varying float vMaterial;\n      void main() {\n        vec2 uv = gl_PointCoord;\n        uv.y = abs(1.-uv.y); // 0 <> 1  =>  1 <> 0\n        vec4 color = texture2D(uTexture1, uv);\n        if (vMaterial == 1.) {\n          color = texture2D(uTexture2, uv);\n        }\n        color.rgb = clamp(color.rgb, 0., 1.);\n        color.a *= vSize - 1.;\n        gl_FragColor = color;\n      }\n      "
                }
            }
            ), []);
            return Object(r.c)((function(g) {
                var I = g.clock.getElapsedTime();
                n.current.material.uniforms.uTime.value = I
            }
            )),
            Object(Y.jsxs)("points", {
                ref: n,
                children: [Object(Y.jsxs)("bufferGeometry", {
                    children: [Object(Y.jsx)("bufferAttribute", {
                        attachObject: ["attributes", "position"],
                        count: I,
                        array: d,
                        itemSize: 3
                    }), Object(Y.jsx)("bufferAttribute", {
                        attachObject: ["attributes", "aSize"],
                        count: I,
                        array: b,
                        itemSize: 1
                    }), Object(Y.jsx)("bufferAttribute", {
                        attachObject: ["attributes", "aSpeed"],
                        count: I,
                        array: G,
                        itemSize: 1
                    }), Object(Y.jsx)("bufferAttribute", {
                        attachObject: ["attributes", "aMaterial"],
                        count: I,
                        array: u,
                        itemSize: 1
                    })]
                }), Object(Y.jsx)("shaderMaterial", {
                    attach: "material",
                    transparent: !0,
                    depthWrite: !1,
                    args: [B]
                })]
            })
        }
          , So = function() {
            return null
        }
          , zo = {
            ssao: !0,
            bgColor: "#2c2a32",
            number: 9,
            fogColor: "#ffffff",
            fogMin: 0,
            fogMax: 50,
            roughness: .5,
            metalness: .4,
            materialEmissive: "#160800",
            materialColor1: "#4d7dd6",
            materialColor2: "#df8141",
            ambientIntensity: .8,
            ambientColor: "#e2edff",
            directionalColor: "#ffd8b8",
            directionalIntensity: 1.5,
            directionalX: -2.2,
            directionalY: 3.7,
            directionalZ: 3.5,
            pointColor: "#ffd4b2",
            pointIntensity: .2,
            shadowColor: "#000000",
            pointX: 1.7,
            pointY: -5.2,
            pointZ: -.9,
            debug: !1
        }
          , fo = function() {
            return Object(Y.jsxs)(Y.Fragment, {
                children: [Object(Y.jsx)(x, {}), Object(Y.jsx)(j, {
                    s: zo
                }), Object(Y.jsxs)(o.Suspense, {
                    fallback: null,
                    children: [Object(Y.jsx)(So, {}), Object(Y.jsx)(JA, {
                        s: zo
                    }), Object(Y.jsx)(wo, {}), Object(Y.jsx)(No, {
                        count: 40
                    })]
                })]
            })
        }
          , ko = function(g) {
            var I = {
                root: {
                    color: g.colors[1],
                    paddingTop: function(g) {
                        return g.headerHeight
                    },
                    position: "fixed",
                    zIndex: 2,
                    top: "50vh",
                    left: 0,
                    width: "100vw",
                    height: function(g) {
                        return g.isMobile && "100vh"
                    },
                    overflow: function(g) {
                        return g.isMobile && "scroll"
                    },
                    overflowX: function(g) {
                        return g.isMobile && "hidden"
                    },
                    background: "rgba(0, 0, 0, 0)",
                    "& *": {
                        userSelect: "none"
                    }
                },
                page: {
                    minHeight: function(g) {
                        return "calc(100vh - ".concat(g.headerHeight, "px)")
                    }
                },
                wrapper: {
                    extend: g.wrapper,
                    position: "relative"
                },
                canvas: {
                    position: "fixed",
                    zIndex: 1,
                    top: 0,
                    left: 0,
                    height: "calc(var(--vh))!important",
                    width: "100vw!important"
                },
                controllers: {
                    position: "fixed",
                    extend: g.wrapper,
                    zIndex: 3,
                    top: 100,
                    bottom: 56,
                    left: "5.5vw",
                    right: "5.5vw",
                    width: "auto",
                    height: "auto",
                    margin: "auto",
                    pointerEvents: "none"
                },
                topRightCorner: {
                    position: "absolute",
                    zIndex: 1,
                    right: 0,
                    top: 0,
                    borderTopRightRadius: 112,
                    border: "1px solid ".concat(g.getRgba(g.colors[1], .15)),
                    borderLeft: 0,
                    borderBottom: 0,
                    height: 150,
                    width: 310,
                    transition: "width .3s ease-out"
                },
                topLeftCorner: {
                    position: "absolute",
                    zIndex: 1,
                    left: 0,
                    top: 0,
                    borderTopLeftRadius: 112,
                    border: "1px solid ".concat(g.getRgba(g.colors[1], .15)),
                    borderRight: 0,
                    borderBottom: 0,
                    height: "calc(100vh - 426px)",
                    width: 150,
                    transition: "width .3s ease-out .15s"
                },
                noBorderRadius: {
                    width: 0,
                    transitionDelay: "0s"
                },
                controllerButtons: {
                    position: "absolute",
                    zIndex: 1,
                    bottom: 48,
                    left: -11,
                    display: "flex",
                    flexDirection: "column",
                    pointerEvents: "all"
                },
                controllerButton: {
                    width: 22,
                    height: 22,
                    display: "block",
                    fontSize: 0,
                    margin: [7, "auto"],
                    background: "transparent",
                    cursor: "pointer",
                    transition: "all .7s ".concat(g.easings["power3.inOut"]),
                    "&:before": {
                        content: '""',
                        display: "inline-block",
                        width: 5,
                        height: 5,
                        boxShadow: "0 0 0 1.5px ".concat(g.getRgba(g.colors[1], .15)),
                        borderRadius: 7,
                        background: "none",
                        margin: [0, "auto"],
                        transition: "all .7s ".concat(g.easings["power3.inOut"])
                    },
                    "&:hover": {
                        "&:before": {
                            boxShadow: "0 0 0 1.5px ".concat(g.getRgba(g.colors[3], .4))
                        }
                    },
                    "&.active": {
                        height: 80,
                        "&:before": {
                            height: 60,
                            border: "none",
                            background: g.colors[3],
                            boxShadow: "0 0 0 .5px ".concat(g.colors[3])
                        }
                    }
                },
                controllersNum: {
                    position: "absolute",
                    zIndex: 1,
                    left: -7,
                    bottom: 0,
                    color: g.colors[3],
                    fontSize: 10,
                    letterSpacing: "0.22em",
                    textAlign: "center"
                },
                slider: {
                    position: "absolute",
                    zIndex: 1,
                    top: 0,
                    left: "5.5vw",
                    width: "78vw",
                    height: "100%",
                    pointerEvents: "none"
                },
                sliderItem: {
                    position: "absolute",
                    zIndex: 1,
                    top: 0,
                    left: 0,
                    width: "100%",
                    height: "100%",
                    display: "flex",
                    flexDirection: "column",
                    justifyContent: "center",
                    pointerEvents: "none"
                },
                sliderItemTitle: {
                    color: g.colors[1],
                    fontFamily: g.fonts[1],
                    fontSize: 73,
                    marginBottom: 55,
                    "& > div:not(:last-child)": {
                        marginBottom: "-.1em"
                    }
                },
                sliderItemText: {
                    color: g.getRgba(g.colors[1], .35),
                    fontSize: 18
                },
                sliderItemLink: {
                    position: "absolute",
                    zIndex: 3,
                    bottom: -4,
                    left: 0,
                    color: g.colors[1],
                    fontSize: 18,
                    paddingBottom: 10,
                    display: "inline-block",
                    opacity: 0,
                    pointerEvents: "none",
                    transition: "opacity 0.3s ease-out .7s",
                    paddingRight: 40,
                    overflow: "hidden",
                    "& *": {
                        cursor: "pointer"
                    },
                    "& svg": {
                        position: "absolute",
                        right: 0,
                        top: 6,
                        width: 8,
                        height: 10,
                        transition: "transform .5s ease-in-out",
                        fill: g.colors[1],
                        transform: "scale(1)"
                    },
                    "&:before": {
                        content: '""',
                        position: "absolute",
                        zIndex: 1,
                        bottom: 0,
                        left: 0,
                        width: "300%",
                        height: 1,
                        background: "linear-gradient(to left, ".concat(g.colors[3], " 33.3%, transparent 33.3%, transparent 66.6%, ").concat(g.colors[3], " 66.6%)"),
                        transition: "transform .7s ease-in-out",
                        transform: "translateX(-66.6%)"
                    },
                    "&:hover": {
                        "&:before": {
                            transform: "translateX(0%)"
                        },
                        "& svg": {
                            transform: "scale(1.2) translateY(0px)"
                        }
                    }
                },
                sliderItemLinkActive: {
                    opacity: 1,
                    pointerEvents: "all"
                },
                sliderItemActive: {
                    "& $sliderButton": {
                        opacity: 1,
                        transition: "opacity .8s ease-out",
                        transitionDelay: "var(--delay)",
                        pointerEvents: "all",
                        "&:before": {
                            transitionDelay: "0s"
                        }
                    }
                },
                sliderButton: {
                    pointerEvents: "none",
                    position: "absolute",
                    zIndex: 2,
                    top: "50%",
                    left: "40%",
                    fontSize: 14,
                    textAlign: "left",
                    padding: [13, 10, 12, 35],
                    textTransform: "uppercase",
                    color: g.colors[1],
                    width: 220,
                    cursor: "pointer",
                    transform: "translateY(-50%)",
                    transition: "opacity .3s ease-out 1s",
                    opacity: 0,
                    "&:before": {
                        content: '""',
                        position: "absolute",
                        zIndex: -1,
                        left: 0,
                        top: 0,
                        width: "100%",
                        height: "100%",
                        borderRadius: 35,
                        background: "var(--color)",
                        boxShadow: "0 10px 20px -10px rgba(0, 0, 0, .4)",
                        transition: "transform .8s ".concat(g.easings["power3.inOut"], " 0.5s"),
                        transform: "scale(0)"
                    },
                    "& strong": {
                        display: "block"
                    },
                    "&.sliderButton-0": {
                        transform: "translateY(-150px)"
                    },
                    "&.sliderButton-1": {
                        left: "38%"
                    },
                    "&.sliderButton-2": {
                        transform: "translateY(100px)"
                    }
                },
                sliderButtonActive: {
                    "&:before": {
                        transform: "scale(1)",
                        transitionDelay: ".1s"
                    }
                },
                scrollIcon: {
                    position: "absolute",
                    zIndex: 1,
                    left: "5.5vw",
                    bottom: -28,
                    pointerEvents: "all"
                },
                newsSection: {
                    position: "relative",
                    zIndex: 1,
                    paddingTop: 180,
                    paddingBottom: 100,
                    marginLeft: "11vw",
                    width: "89vw"
                },
                newsHeader: {
                    display: "flex",
                    marginBottom: 120
                },
                newsTitle: {
                    flex: "0 0 50%"
                },
                newsDesc: {
                    flex: "0 0 50%",
                    display: "flex",
                    flexDirection: "column",
                    justifyContent: "space-between",
                    padding: [28, 0, 74]
                },
                newsPretitle: {
                    fontSize: 15,
                    textTransform: "uppercase"
                },
                newsText: {
                    fontSize: 19
                },
                banner: {
                    marginLeft: "11vw",
                    marginRight: "11vw"
                },
                footerWrapper: {
                    extend: g.wrapper,
                    position: "relative",
                    paddingLeft: "11vw"
                },
                "@media (max-height: 650px)": {
                    sliderItemTitle: {
                        fontSize: 53,
                        marginBottom: 25
                    },
                    newsDesc: {
                        padding: [19, 0, 38]
                    },
                    newsPretitle: {
                        fontSize: 14
                    },
                    newsText: {
                        fontSize: 16
                    }
                },
                "@media (max-height: 550px)": {
                    sliderItemTitle: {
                        fontSize: 33,
                        marginBottom: 25
                    },
                    newsDesc: {
                        padding: [5, 0, 20]
                    },
                    newsPretitle: {
                        fontSize: 12
                    },
                    newsText: {
                        fontSize: 14
                    }
                }
            };
            return I["@media (max-height: 450px) and (min-width: 1280px)"] = {
                topRightCorner: {
                    display: "none"
                },
                topLeftCorner: {
                    display: "none"
                },
                controllers: {
                    bottom: 50
                },
                controllerButtons: {
                    display: "none"
                },
                controllersNum: {
                    display: "none"
                },
                sliderItemTitle: {
                    textAlign: "center",
                    fontSize: 40,
                    marginBottom: 30
                },
                sliderItemText: {
                    textAlign: "center"
                },
                scrollIcon: {
                    left: 0,
                    right: 0,
                    bottom: 0,
                    margin: "auto"
                },
                sliderItemLink: {
                    padding: [15, 40],
                    borderRadius: 30,
                    background: g.colors[1],
                    color: g.colors[0],
                    right: 0,
                    margin: "auto",
                    textAlign: "center",
                    width: 200,
                    "&:before": {
                        display: "none"
                    },
                    "& svg": {
                        display: "none"
                    }
                },
                sliderButton: {
                    display: "none"
                },
                newsSection: {
                    padding: [100, "5.5vw", 30],
                    margin: 0,
                    width: "100%"
                },
                newsTitle: {
                    flex: "0 0 100%"
                },
                newsDesc: {
                    display: "none"
                },
                newsHeader: {
                    marginBottom: 50
                },
                slider: {
                    left: 0,
                    width: "100%"
                },
                sliderItem: {
                    padding: [0, 20]
                }
            },
            I[g.mediaInverse.lg] = {
                topRightCorner: {
                    display: "none"
                },
                topLeftCorner: {
                    display: "none"
                },
                controllers: {
                    bottom: 50
                },
                controllerButtons: {
                    display: "none"
                },
                controllersNum: {
                    display: "none"
                },
                sliderItem: {
                    paddingBottom: 80
                },
                sliderItemTitle: {
                    textAlign: "center",
                    fontSize: 40,
                    marginBottom: 30
                },
                sliderItemText: {
                    textAlign: "center"
                },
                scrollIcon: {
                    left: 0,
                    right: 0,
                    bottom: 0,
                    margin: "auto"
                },
                sliderItemLink: {
                    padding: [15, 40],
                    borderRadius: 30,
                    background: g.colors[1],
                    color: g.colors[0],
                    right: 0,
                    margin: "auto",
                    textAlign: "center",
                    width: 200,
                    "&:before": {
                        display: "none"
                    },
                    "& svg": {
                        display: "none"
                    }
                },
                sliderButton: {
                    display: "none"
                },
                newsSection: {
                    padding: [100, "5.5vw", 30],
                    margin: 0,
                    width: "100%"
                },
                newsTitle: {
                    flex: "0 0 100%"
                },
                newsDesc: {
                    display: "none"
                }
            },
            I[g.mediaInverse.md] = {
                newsHeader: {
                    marginBottom: 50
                },
                slider: {
                    left: 0,
                    width: "100%"
                },
                sliderItem: {
                    padding: [0, 20]
                }
            },
            I
        };
        function Jo(g, I) {
            var C = Object.keys(g);
            if (Object.getOwnPropertySymbols) {
                var A = Object.getOwnPropertySymbols(g);
                I && (A = A.filter((function(I) {
                    return Object.getOwnPropertyDescriptor(g, I).enumerable
                }
                ))),
                C.push.apply(C, A)
            }
            return C
        }
        function Lo(g) {
            for (var I = 1; I < arguments.length; I++) {
                var C = null != arguments[I] ? arguments[I] : {};
                I % 2 ? Jo(Object(C), !0).forEach((function(I) {
                    n()(g, I, C[I])
                }
                )) : Object.getOwnPropertyDescriptors ? Object.defineProperties(g, Object.getOwnPropertyDescriptors(C)) : Jo(Object(C)).forEach((function(I) {
                    Object.defineProperty(g, I, Object.getOwnPropertyDescriptor(C, I))
                }
                ))
            }
            return g
        }
        var xo = Object(l.b)(ko)
          , Mo = function(g) {
            var I = g.stub
              , C = Object(o.useContext)(d.a)
              , A = C.setPageAnimationReady
              , t = C.headerHeight
              , l = Object(o.useContext)(b.a)
              , B = l.setReady
              , p = l.setSiteLoaded
              , y = Object(o.useContext)(G.a)
              , v = y.scrollbar
              , V = y.scroll
              , X = y.direction
              , K = xo({
                headerHeight: t,
                isMobile: null == v ? void 0 : v.scroll.isMobile
            })
              , R = Object(o.useState)(!1)
              , w = e()(R, 2)
              , L = w[0]
              , x = w[1]
              , M = Object(o.useRef)(I)
              , Q = Object(o.useRef)()
              , j = Object(o.useRef)()
              , U = Object(J.a)()
              , D = U.stage
              , T = U.setStage
              , O = U.setModel
              , E = U.model
              , P = U.model0
              , q = U.model1
              , _ = U.model2
              , $ = Object(o.useState)(!1)
              , gg = e()($, 2)
              , Ig = gg[0]
              , Cg = gg[1]
              , Ag = Object(o.useState)(!1)
              , eg = e()(Ag, 2)
              , og = eg[0]
              , ig = eg[1]
              , tg = new s.Lethargy
              , ng = Object(c.c)()
              , lg = Object(i.f)((function(g) {
                var I;
                return {
                    page: g.content.pages[M.current] || {},
                    people: (null === (I = g.content.cpt) || void 0 === I ? void 0 : I._cty_people) || []
                }
            }
            ), i.d)
              , cg = lg.page
              , ag = lg.people;
            Object(o.useEffect)((function() {
                Object.keys(cg).length > 0 && ag.length && (B(!0),
                p(!0),
                x(!0),
                A(!0))
            }
            ), [cg, ag]),
            Object(o.useEffect)((function() {
                return function() {
                    T(0),
                    O(-1)
                }
            }
            ), []);
            Object(o.useEffect)((function() {
                L && (3 === D ? (a.a.to(".pageHome", {
                    top: 0,
                    duration: 2,
                    ease: "power3.inOut",
                    pointerEvents: "all",
                    delay: 1
                }),
                v && v.start()) : (v && (v.stop(),
                v.scrollTo(0, 0)),
                a.a.to(".pageHome", {
                    top: "100vh",
                    duration: 2,
                    ease: "power3.inOut",
                    pointerEvents: "none"
                })))
            }
            ), [D, L, v]);
            var sg = function(g) {
                Ig || (T(g),
                O(2 === g ? 0 : -1),
                Cg(!0))
            }
              , dg = function(g) {
                37 !== g.which && 38 !== g.which || sg(Math.max(0, D - 1)),
                39 !== g.which && 40 !== g.which || sg(Math.min(3, D + 1))
            };
            Object(o.useEffect)((function() {
                return window.addEventListener("keydown", dg),
                function() {
                    window.removeEventListener("keydown", dg)
                }
            }
            ), [Ig]);
            var bg = function(g, I, C, A, e, o) {
                var i = [P.modelColor, q.modelColor, _.modelColor];
                return Object(Y.jsxs)("div", {
                    className: Z()(n()(n()({}, K.sliderItem, !0), K.sliderItemActive, D === g)),
                    children: [Object(Y.jsx)("h1", {
                        className: K.sliderItemTitle,
                        children: Object(k.splitAfterBr)(Object(k.removeParagraph)(I)).map((function(I, C) {
                            return Object(Y.jsx)(m.a, {
                                value: I,
                                tag: "div",
                                type: "chars",
                                lineHeight: 1.1,
                                stagger: .03,
                                duration: 1.3,
                                delayEnter: .3 + .2 * C,
                                delayLeave: .2 * C,
                                visible: D === g
                            }, C.toString())
                        }
                        ))
                    }), Object(Y.jsx)(m.a, {
                        className: K.sliderItemText,
                        value: Object(k.removeParagraph)(C),
                        tag: "div",
                        type: "lines",
                        lineHeight: 1.5,
                        stagger: .1,
                        duration: 1.3,
                        delayEnter: 1,
                        delayLeave: .5,
                        visible: D === g
                    }), o && o.map((function(g, I) {
                        return Object(Y.jsx)("button", {
                            style: {
                                "--color": i[I],
                                "--delay": "".concat(2.4 + .1 * I, "s")
                            },
                            className: Z()(n()(n()(n()({}, K.sliderButton, !0), K.sliderButtonActive, E === I), "sliderButton-".concat(I), !0)),
                            "aria-label": g.label,
                            onClick: function() {
                                O(I)
                            },
                            dangerouslySetInnerHTML: {
                                __html: g.label
                            }
                        }, I.toString())
                    }
                    )), "" !== A && Object(Y.jsxs)(h.a, {
                        to: e,
                        className: Z()(n()(n()({}, K.sliderItemLink, !0), K.sliderItemLinkActive, D === g)),
                        children: [Object(Y.jsx)(m.a, {
                            value: A,
                            tag: "div",
                            type: "chars",
                            stagger: .01,
                            duration: 1.3,
                            delayEnter: .5,
                            delayLeave: 0,
                            visible: D === g
                        }), Object(Y.jsx)("svg", {
                            children: Object(Y.jsx)("use", {
                                xlinkHref: "#ico-arrow"
                            })
                        })]
                    })]
                })
            };
            Object(o.useEffect)((function() {
                Ig && setTimeout((function() {
                    Cg(!1)
                }
                ), 2e3)
            }
            ), [Ig]);
            var Gg = Object(u.b)({
                onDragEnd: function(g) {
                    var I = e()(g.direction, 2)
                      , C = I[0]
                      , A = I[1]
                      , o = g.velocity;
                    if (!Ig && Math.abs(o) > .25 && Math.abs(C) < Math.abs(A)) {
                        var i = A < 0 ? Math.min(3, D + 1) : Math.max(0, D - 1);
                        sg(i)
                    }
                },
                onWheel: function(g) {
                    var I = g.event;
                    if (!Ig && Math.abs(I.deltaY) > 1) {
                        var C = tg.check(I) < 0 ? Math.min(3, D + 1) : Math.max(0, D - 1);
                        sg(C)
                    }
                }
            }, {
                eventOptions: {
                    passive: !1
                }
            })
              , rg = Object(u.b)({
                onDragEnd: function(g) {
                    var I = e()(g.direction, 2)
                      , C = I[0]
                      , A = I[1]
                      , o = g.velocity;
                    if (!Ig && Math.abs(o) > .25 && og && Math.abs(C) < Math.abs(A)) {
                        var i = A < 0 ? Math.min(3, D + 1) : Math.max(0, D - 1);
                        sg(i)
                    }
                },
                onWheel: function(g) {
                    var I = g.event;
                    if (og && Math.abs(I.deltaY) > 1) {
                        var C = tg.check(I) < 0 ? Math.min(3, D + 1) : Math.max(0, D - 1);
                        sg(C)
                    }
                }
            }, {
                eventOptions: {
                    passive: !1
                }
            });
            Object(W.b)((function() {
                3 === D && ig(0 === V.current.y)
            }
            ), [D]);
            var ug, Bg, Zg, mg, hg, pg, yg, Wg, vg, Vg, Xg, Yg, Kg, Rg, wg, Hg, Fg, Ng, Sg, zg, fg, kg, Jg;
            return L && Object(Y.jsxs)(Y.Fragment, {
                children: [Object(Y.jsxs)(F.a, {
                    init: L,
                    className: Z()(n()(n()({
                        page: !0,
                        pageHome: !0
                    }, K.root, !0), K.isMobile, V.isMobile || V.isTablet)),
                    ref: Q,
                    children: [L && Object(Y.jsx)(S.a, {
                        title: cg.title.rendered,
                        meta: cg.yoast_meta,
                        schema: cg.yoast_json_ld
                    }), L && Object(Y.jsxs)(Y.Fragment, {
                        children: [Object(Y.jsxs)("div", {
                            className: K.page,
                            children: [Object(Y.jsxs)("div", {
                                className: K.newsSection,
                                children: [Object(Y.jsxs)("div", Lo(Lo({
                                    className: K.newsHeader
                                }, rg()), {}, {
                                    children: [Object(Y.jsx)("div", {
                                        className: K.newsTitle,
                                        children: Object(Y.jsx)("h2", {
                                            className: K.sliderItemTitle,
                                            children: Object(k.removeParagraph)(null === (Kg = cg.acf) || void 0 === Kg || null === (Rg = Kg.news) || void 0 === Rg ? void 0 : Rg.title)
                                        })
                                    }), Object(Y.jsxs)("div", {
                                        className: K.newsDesc,
                                        children: [Object(Y.jsx)(m.a, {
                                            className: K.newsPretitle,
                                            value: Object(k.removeParagraph)(null === (wg = cg.acf) || void 0 === wg || null === (Hg = wg.news) || void 0 === Hg ? void 0 : Hg.pretitle),
                                            tag: "div",
                                            type: "chars",
                                            lineHeight: 1.1,
                                            duration: 1.3,
                                            delayEnter: 2.2,
                                            delayLeave: 0,
                                            visible: 3 === D
                                        }), Object(Y.jsx)(m.a, {
                                            className: K.newsText,
                                            value: Object(k.removeParagraph)(null === (Fg = cg.acf) || void 0 === Fg || null === (Ng = Fg.news) || void 0 === Ng ? void 0 : Ng.text),
                                            tag: "div",
                                            type: "lines",
                                            lineHeight: 1.4,
                                            duration: 1.3,
                                            delayEnter: 2.4,
                                            delayLeave: 0,
                                            visible: 3 === D
                                        })]
                                    })]
                                })), (kg = {
                                    label: (null === (Sg = cg.acf) || void 0 === Sg ? void 0 : Sg.news?.label) || "Read more",
                                    link: null === (zg = cg.acf) || void 0 === zg ? void 0 : zg.news?.link
                                },
                                Jg = null === (fg = cg.acf) || void 0 === fg ? void 0 : fg.news?.news.map((function(g) {
                                    var I;
                                    return {
                                        title: g.title.rendered,
                                        link: g.link,
                                        image: null === (I = g.featured_image) || void 0 === I ? void 0 : I.src
                                    }
                                }
                                )),
                                Object(Y.jsx)(H, {
                                    items: Jg?.slice(0, 9),
                                    cta: kg
                                }))]
                            }), (null === (Yg = cg.acf) || void 0 === Yg ? void 0 : Yg.banner) && Object(Y.jsx)(f.a, {
                                className: K.banner,
                                title: cg.acf.banner.title,
                                text: cg.acf.banner.text,
                                label: cg.acf.banner.label,
                                link: cg.acf.banner.link,
                                image: cg.acf.banner.image
                            })]
                        }), Object(Y.jsx)("div", {
                            className: K.footerWrapper,
                            children: Object(Y.jsx)(z.a, {})
                        })]
                    })]
                }), L && L && Object(Y.jsxs)("div", {
                    className: K.controllers,
                    children: [Object(Y.jsx)("div", {
                        className: Z()(n()(n()({}, K.topRightCorner, !0), K.noBorderRadius, "down" === X && !og && !ng.detect.isNativeScroll))
                    }), Object(Y.jsx)("div", {
                        className: Z()(n()(n()({}, K.topLeftCorner, !0), K.noBorderRadius, "down" === X && !og && !ng.detect.isNativeScroll))
                    }), Object(Y.jsx)("div", {
                        className: K.controllerButtons,
                        ref: j,
                        children: [0, 1, 2, 3].map((function(g) {
                            return Object(Y.jsx)("button", {
                                className: Z()(n()(n()({}, K.controllerButton, !0), "active", D === g)),
                                onClick: function() {
                                    return sg(g)
                                },
                                children: "0".concat(g + 1)
                            }, g.toString())
                        }
                        ))
                    }), ["01", "02", "03", "04"].map((function(g, I) {
                        return Object(Y.jsx)(m.a, {
                            className: K.controllersNum,
                            value: g,
                            tag: "div",
                            type: "chars",
                            stagger: -.1,
                            duration: 1.3,
                            visible: D === I
                        }, I.toString())
                    }
                    )), Object(Y.jsxs)("div", {
                        className: "".concat(K.slider, " controllersSlider"),
                        children: [bg(0, null === (ug = cg.acf) || void 0 === ug ? void 0 : ug.hero.title, null === (Bg = cg.acf) || void 0 === Bg ? void 0 : Bg.hero.text, "", ""), bg(1, null === (Zg = cg.acf) || void 0 === Zg ? void 0 : Zg.manifesto.title, null === (mg = cg.acf) || void 0 === mg ? void 0 : mg.manifesto.text, null === (hg = cg.acf) || void 0 === hg ? void 0 : hg.manifesto.label, null === (pg = cg.acf) || void 0 === pg ? void 0 : pg.manifesto.link), bg(2, null === (yg = cg.acf) || void 0 === yg ? void 0 : yg.technology.title, null === (Wg = cg.acf) || void 0 === Wg ? void 0 : Wg.technology.text, null === (vg = cg.acf) || void 0 === vg ? void 0 : vg.technology.label, null === (Vg = cg.acf) || void 0 === Vg ? void 0 : Vg.technology.link, null === (Xg = cg.acf) || void 0 === Xg ? void 0 : Xg.technology.products)]
                    }), Object(Y.jsx)(N.a, {
                        event: function() {
                            T(1)
                        },
                        visible: 0 === D,
                        className: K.scrollIcon
                    })]
                }), L && Object(Y.jsx)("div", Lo(Lo({}, Gg()), {}, {
                    children: Object(Y.jsx)(r.a, {
                        className: K.canvas,
                        shadows: !0,
                        dpr: [1, 1.5],
                        camera: {
                            position: [0, 0, 7],
                            fov: 30,
                            far: 50
                        },
                        children: Object(Y.jsx)(fo, {})
                    })
                }))]
            })
        }
          , Qo = C(681)
          , jo = C.n(Qo)
          , Uo = function(g) {
            var I = g.stage
              , C = g.model
              , A = Object(J.a)()
              , e = A.stage0
              , i = A.stage1
              , t = A.stage2
              , n = A.stage3
              , l = A.model0
              , c = A.model1
              , s = A.model2
              , d = Object(r.e)()
              , b = Object(o.useRef)()
              , G = Object(o.useRef)({
                color1: e.bgColor1,
                color2: e.bgColor2
            })
              , u = function(g, I) {
                a.a.killTweensOf(G.current),
                a.a.to(G.current, {
                    color1: g,
                    color2: I,
                    duration: 2
                })
            };
            Object(o.useEffect)((function() {
                switch (I) {
                case 0:
                    u(e.bgColor1, e.bgColor2);
                    break;
                case 1:
                    u(i.bgColor1, i.bgColor2);
                    break;
                case 2:
                    u(t.bgColor1, t.bgColor2);
                    break;
                case 3:
                    u(n.bgColor1, n.bgColor2)
                }
                if (2 === I)
                    switch (C) {
                    case 0:
                        u(l.bgColor1, l.bgColor2);
                        break;
                    case 1:
                        u(c.bgColor1, c.bgColor2);
                        break;
                    case 2:
                        u(s.bgColor1, s.bgColor2)
                    }
            }
            ), [C, I]);
            var B = Object(o.useMemo)((function() {
                return {
                    uniforms: {
                        uTime: {
                            value: 0
                        },
                        uColor1: {
                            value: new L.Color(G.color1)
                        },
                        uColor2: {
                            value: new L.Color(G.color2)
                        }
                    },
                    vertexShader: "\n      varying vec2 vUv;\n      void main() {\n        vUv = uv;\n        vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n        gl_Position = projectionMatrix * mvPosition;\n      }\n      ",
                    fragmentShader: "\n      varying vec2 vUv;\n      uniform float uTime;\n      uniform vec3 uColor1;\n      uniform vec3 uColor2;\n\n      float sphere(vec2 p, vec2 offset) {\n        return 1. - length(p + offset);\n      }\n\n      void main() {\n        float t = uTime * .4;\n        vec2 uv = vUv;\n        uv -= .5;\n        float c = 0.;\n        for (float i = 0.; i < 3.; i++) {\n          c += sphere(uv * 1.5, vec2(\n            sin(t + i * 4. * i + sin(i + t * .5)) * (.5 + i * .21),\n            cos(t + i * 5. * i + sin(i + t * .3)) * (.5 + i * .21)\n          )) * .75;\n        }\n        gl_FragColor = vec4(mix(uColor2, uColor1, clamp(c, 0., 1.)), 1.);\n      }\n      "
                }
            }
            ), []);
            return Object(r.c)((function() {
                b.current.material.uniforms.uColor1.value = new L.Color(G.current.color1),
                b.current.material.uniforms.uColor2.value = new L.Color(G.current.color2)
            }
            )),
            Object(o.useEffect)((function() {
                var g = d.aspect < 1 ? 2 : 1;
                b.current.scale.set(d.viewport.width * d.viewport.distance * 2 * g, d.viewport.height * d.viewport.distance * 2, 1)
            }
            ), [d, I]),
            Object(Y.jsxs)("mesh", {
                ref: b,
                position: [0, 0, -40],
                children: [Object(Y.jsx)("planeBufferGeometry", {
                    attach: "geometry",
                    args: [1, 1]
                }), Object(Y.jsx)("shaderMaterial", {
                    attach: "material",
                    transparent: !0,
                    args: [B]
                })]
            })
        };
        function Do(g, I) {
            var C = Object.keys(g);
            if (Object.getOwnPropertySymbols) {
                var A = Object.getOwnPropertySymbols(g);
                I && (A = A.filter((function(I) {
                    return Object.getOwnPropertyDescriptor(g, I).enumerable
                }
                ))),
                C.push.apply(C, A)
            }
            return C
        }
        function To(g) {
            for (var I = 1; I < arguments.length; I++) {
                var C = null != arguments[I] ? arguments[I] : {};
                I % 2 ? Do(Object(C), !0).forEach((function(I) {
                    n()(g, I, C[I])
                }
                )) : Object.getOwnPropertyDescriptors ? Object.defineProperties(g, Object.getOwnPropertyDescriptors(C)) : Do(Object(C)).forEach((function(I) {
                    Object.defineProperty(g, I, Object.getOwnPropertyDescriptor(C, I))
                }
                ))
            }
            return g
        }
        var Oo = function(g) {
            var I = g.s
              , C = Object(J.a)().fallback
              , A = Object(o.useRef)()
              , e = Object(o.useMemo)((function() {
                return {
                    castShadow: !C,
                    intensity: I.directionalIntensity,
                    "shadow-mapSize-width": 1024,
                    "shadow-mapSize-height": 1024,
                    "shadow-camera-far": 30,
                    "shadow-camera-left": -3,
                    "shadow-camera-right": 3,
                    "shadow-camera-top": 3,
                    "shadow-camera-bottom": -3
                }
            }
            ), [C]);
            return Object(Y.jsxs)(Y.Fragment, {
                children: [Object(Y.jsx)("ambientLight", {
                    intensity: I.ambientIntensity,
                    color: I.ambientColor
                }), Object(Y.jsx)("directionalLight", To(To({
                    ref: A
                }, e), {}, {
                    color: I.directionalColor,
                    position: [I.directionalX, I.directionalY, I.directionalZ],
                    intensity: I.directionalIntensity
                })), Object(Y.jsx)("pointLight", {
                    position: [I.pointX, I.pointY, I.pointZ],
                    color: I.pointColor,
                    intensity: I.pointIntensity
                })]
            })
        };
        function Eo(g, I) {
            var C = Object.keys(g);
            if (Object.getOwnPropertySymbols) {
                var A = Object.getOwnPropertySymbols(g);
                I && (A = A.filter((function(I) {
                    return Object.getOwnPropertyDescriptor(g, I).enumerable
                }
                ))),
                C.push.apply(C, A)
            }
            return C
        }
        function Po(g) {
            for (var I = 1; I < arguments.length; I++) {
                var C = null != arguments[I] ? arguments[I] : {};
                I % 2 ? Eo(Object(C), !0).forEach((function(I) {
                    n()(g, I, C[I])
                }
                )) : Object.getOwnPropertyDescriptors ? Object.defineProperties(g, Object.getOwnPropertyDescriptors(C)) : Eo(Object(C)).forEach((function(I) {
                    Object.defineProperty(g, I, Object.getOwnPropertyDescriptor(C, I))
                }
                ))
            }
            return g
        }
        var qo = L.MathUtils.lerp
          , _o = function(g) {
            var I = Object.assign({}, (FA()(g),
            g))
              , C = Object(r.e)().viewport
              , A = Object(J.a)().stage
              , i = Math.PI
              , t = (Math.sin,
            Math.cos,
            Object(o.useRef)(.5))
              , n = .5 * i
              , l = yA((function() {
                return Po({
                    rotation: [n, 0, 0],
                    position: [0, 2, 0]
                }, I)
            }
            ))
              , c = e()(l, 2)
              , a = (c[0],
            c[1])
              , s = yA((function() {
                return Po({
                    rotation: [-n, 0, 0],
                    position: [0, -2, 0]
                }, I)
            }
            ))
              , d = e()(s, 2)
              , b = (d[0],
            d[1])
              , G = yA((function() {
                return Po({
                    rotation: [0, n, 0],
                    position: [-.5, 0, 0]
                }, I)
            }
            ))
              , u = e()(G, 2)
              , B = (u[0],
            u[1])
              , Z = yA((function() {
                return Po({
                    rotation: [0, -n, 0],
                    position: [.5, 0, 0]
                }, I)
            }
            ))
              , m = e()(Z, 2)
              , h = (m[0],
            m[1])
              , p = yA((function() {
                return Po({
                    rotation: [i, 0, 0],
                    position: [0, 0, .5]
                }, I)
            }
            ))
              , y = e()(p, 2)
              , W = (y[0],
            y[1])
              , v = yA((function() {
                return Po({
                    rotation: [0, 0, 0],
                    position: [0, 0, -.5]
                }, I)
            }
            ))
              , V = e()(v, 2)
              , X = (V[0],
            V[1]);
            return Object(o.useEffect)((function() {
                switch (A) {
                case 0:
                    a.position.set(0, 2, 0),
                    b.position.set(0, -2, 0);
                    break;
                default:
                    a.position.set(0, C.height / 2, 0),
                    b.position.set(0, -C.height / 2, 0)
                }
            }
            ), [A]),
            Object(r.c)((function(g) {
                var I = g.clock;
                switch (A) {
                case 0:
                    t.current = qo(t.current, .4, .08),
                    I.getElapsedTime();
                    break;
                default:
                    t.current = qo(t.current, 5, .02),
                    0
                }
                B.position.set(-t.current, 0, 0),
                h.position.set(t.current, 0, 0),
                W.position.set(0, 0, t.current),
                X.position.set(0, 0, -t.current)
            }
            )),
            null
        };
        function $o(g) {
            var I = g.number
              , C = void 0 === I ? 30 : I
              , A = g.mass
              , i = g.args
              , t = g.visible
              , n = g.materialColor
              , l = g.s
              , c = WA((function() {
                return {
                    mass: A,
                    type: "Dynamic",
                    position: [L.MathUtils.randFloatSpread(1), L.MathUtils.randFloatSpread(4), L.MathUtils.randFloatSpread(1)],
                    fixedRotation: !0,
                    allowSleep: !1,
                    collisionFilterGroup: 2,
                    material: {
                        friction: 0
                    },
                    args: i
                }
            }
            ))
              , a = e()(c, 1)[0]
              , s = Object(o.useMemo)((function() {
                for (var g = new Float32Array(3 * C), I = new L.Color, A = 0; A < C; A += 1)
                    I.set(n).convertSRGBToLinear().toArray(g, 3 * A);
                return g
            }
            ), [C, l]);
            return Object(Y.jsxs)("instancedMesh", {
                receiveShadow: !0,
                castShadow: !0,
                ref: a,
                args: [null, null, C],
                visible: t,
                children: [Object(Y.jsx)("sphereBufferGeometry", {
                    args: i,
                    children: Object(Y.jsx)("instancedBufferAttribute", {
                        attachObject: ["attributes", "color"],
                        args: [s, 3]
                    })
                }), Object(Y.jsx)("meshStandardMaterial", {
                    vertexColors: !0,
                    roughness: l.roughness,
                    metalness: l.metalness,
                    emissive: l.materialEmissive
                })]
            })
        }
        var gi = function(g) {
            var I = g.s
              , C = Object(o.useRef)()
              , A = Object(J.a)().stage;
            return Object(r.c)((function() {
                0 === A && (C.current.rotation.y += .01)
            }
            )),
            Object(Y.jsx)(RA, {
                gravity: [0, 0, 0],
                children: Object(Y.jsx)("group", {
                    rotation: [0, 0, -.26],
                    children: Object(Y.jsxs)("group", {
                        position: [.6, .25, 0],
                        ref: C,
                        children: [Object(Y.jsx)(_o, {}), Object(Y.jsx)($o, {
                            s: I,
                            args: [.04, 20, 20],
                            negative: 0,
                            number: 2,
                            mass: 1e3,
                            materialColor: I.materialColor2
                        }), Object(Y.jsx)($o, {
                            s: I,
                            args: [.08, 20, 20],
                            negative: 0,
                            number: 2,
                            mass: 1e3,
                            materialColor: I.materialColor2
                        }), Object(Y.jsx)($o, {
                            s: I,
                            args: [.12, 20, 20],
                            negative: 0,
                            number: 5,
                            mass: 1e3,
                            materialColor: I.materialColor1
                        }), Object(Y.jsx)($o, {
                            s: I,
                            args: [.2, 20, 20],
                            negative: 0,
                            number: 1,
                            mass: 1e3,
                            materialColor: I.materialColor2
                        }), Object(Y.jsx)($o, {
                            s: I,
                            args: [.25, 20, 20],
                            negative: 0,
                            number: 6,
                            mass: 1e3,
                            materialColor: I.materialColor1
                        }), Object(Y.jsx)($o, {
                            s: I,
                            args: [.36, 20, 20],
                            negative: 0,
                            number: 5,
                            mass: 1e3,
                            materialColor: I.materialColor1
                        }), Object(Y.jsx)($o, {
                            s: I,
                            args: [.14, 20, 20],
                            negative: 0,
                            number: 10,
                            mass: 1e3,
                            visible: !1
                        })]
                    })
                })
            })
        }
          , Ii = {
            ssao: !0,
            bgColor: "#2c2a32",
            number: 9,
            fogColor: "#ffffff",
            fogMin: 0,
            fogMax: 50,
            roughness: .5,
            metalness: .4,
            materialEmissive: "#160800",
            materialColor1: "#4d7dd6",
            materialColor2: "#df8141",
            ambientIntensity: .8,
            ambientColor: "#e2edff",
            directionalColor: "#ffd8b8",
            directionalIntensity: 1.5,
            directionalX: -2.2,
            directionalY: 3.7,
            directionalZ: 3.5,
            pointColor: "#ffd4b2",
            pointIntensity: .2,
            shadowColor: "#000000",
            pointX: 1.7,
            pointY: -5.2,
            pointZ: -.9,
            debug: !1
        }
          , Ci = function() {
            var g = Object(J.a)().stage
              , I = Object(r.e)().camera;
            return Object(o.useEffect)((function() {
                a.a.to(I.position, {
                    y: g < 2 ? 0 : -10,
                    duration: 2,
                    ease: "power3.out"
                })
            }
            ), [g]),
            Object(Y.jsxs)(Y.Fragment, {
                children: [Object(Y.jsx)(Uo, {}), Object(Y.jsx)(Oo, {
                    s: Ii
                }), Object(Y.jsx)(o.Suspense, {
                    fallback: null,
                    children: Object(Y.jsx)(gi, {
                        s: Ii
                    })
                })]
            })
        }
          , Ai = function(g) {
            var I = {
                root: {
                    color: g.colors[1],
                    paddingTop: function(g) {
                        return g.headerHeight
                    },
                    overflowX: "hidden",
                    "& *": {
                        userSelect: "none"
                    }
                },
                page: {
                    minHeight: function(g) {
                        return "calc(calc(100vh - ".concat(g.headerHeight, "px)")
                    },
                    overflowX: "hidden"
                },
                wrapper: {
                    extend: g.wrapper,
                    position: "relative"
                },
                canvas: {
                    position: "fixed!important",
                    zIndex: -1,
                    top: 0,
                    left: 0,
                    height: "calc(100vh + 110px)!important",
                    width: "100vw!important"
                },
                stage: {
                    position: "relative",
                    zIndex: 1,
                    minHeight: function(g) {
                        return "calc(100vh - ".concat(g.headerHeight, "px)")
                    },
                    display: "flex",
                    justifyContent: "center",
                    alignItems: "center",
                    fontSize: 40,
                    marginBottom: 200
                },
                stage2: {
                    marginBottom: 200,
                    flexWrap: "wrap",
                    zIndex: 10,
                    "& $sliderItem": {
                        position: "relative",
                        flex: "0 0 100%"
                    }
                },
                stage3: {
                    display: "block",
                    marginBottom: 200
                },
                controllers: {
                    position: "fixed",
                    extend: g.wrapper,
                    zIndex: 3,
                    top: 100,
                    bottom: 75,
                    left: "5.5vw",
                    right: "5.5vw",
                    width: "auto",
                    height: "auto",
                    margin: "auto",
                    pointerEvents: "none"
                },
                topRightCorner: {
                    position: "absolute",
                    zIndex: 1,
                    right: 0,
                    top: 0,
                    borderTopRightRadius: 112,
                    border: "1px solid ".concat(g.getRgba(g.colors[1], .15)),
                    borderLeft: 0,
                    borderBottom: 0,
                    height: 150,
                    width: 310
                },
                topLeftCorner: {
                    position: "absolute",
                    zIndex: 1,
                    left: 0,
                    top: 0,
                    borderTopLeftRadius: 112,
                    border: "1px solid ".concat(g.getRgba(g.colors[1], .15)),
                    borderRight: 0,
                    borderBottom: 0,
                    height: "calc(calc(100vh - 445px)",
                    width: 150
                },
                controllerButtons: {
                    position: "absolute",
                    zIndex: 1,
                    bottom: 48,
                    left: -11,
                    display: "flex",
                    flexDirection: "column",
                    pointerEvents: "all"
                },
                controllerButton: {
                    width: 22,
                    height: 22,
                    display: "block",
                    fontSize: 0,
                    margin: [7, 0],
                    background: "transparent",
                    cursor: "pointer",
                    transition: "all .7s ".concat(g.easings["power3.inOut"]),
                    "&:before": {
                        content: '""',
                        display: "inline-block",
                        width: 5,
                        height: 5,
                        boxShadow: "0 0 0 1.5px ".concat(g.getRgba(g.colors[1], .15)),
                        borderRadius: 7,
                        background: "none",
                        transition: "all .7s ".concat(g.easings["power3.inOut"])
                    },
                    "&:hover": {
                        "&:before": {
                            boxShadow: "0 0 0 1.5px ".concat(g.getRgba(g.colors[3], .4))
                        }
                    },
                    "&.active": {
                        height: 80,
                        "&:before": {
                            height: 60,
                            border: "none",
                            background: g.colors[3],
                            boxShadow: "0 0 0 .5px ".concat(g.colors[3])
                        }
                    }
                },
                controllersNum: {
                    position: "absolute",
                    zIndex: 1,
                    left: -7,
                    bottom: 0,
                    color: g.colors[3],
                    fontSize: 10,
                    letterSpacing: "0.22em",
                    textAlign: "center"
                },
                slider: {
                    position: "absolute",
                    zIndex: 1,
                    top: 0,
                    left: "5.5vw",
                    width: "78vw",
                    height: "100%"
                },
                sliderItem: {
                    position: "absolute",
                    zIndex: 1,
                    top: 0,
                    left: 0,
                    width: "100%",
                    height: "100%",
                    display: "flex",
                    flexDirection: "column",
                    justifyContent: "center"
                },
                sliderItemTitle: {
                    color: g.colors[1],
                    fontFamily: g.fonts[1],
                    fontSize: 73,
                    marginBottom: 55
                },
                sliderItemText: {
                    color: g.getRgba(g.colors[1], .35),
                    fontSize: 18,
                    marginBottom: 70,
                    "& br": {
                        display: "none"
                    }
                },
                sliderItemLink: {
                    position: "static",
                    color: g.colors[1],
                    fontSize: 18,
                    paddingBottom: 10,
                    display: "block",
                    transition: "opacity 0.3s ease-out .7s",
                    paddingRight: 40,
                    overflow: "hidden",
                    margin: "0 auto",
                    "& *": {
                        cursor: "pointer"
                    },
                    "& svg": {
                        position: "absolute",
                        right: 0,
                        top: 6,
                        width: 8,
                        height: 10,
                        transition: "transform .5s ease-in-out",
                        fill: g.colors[1],
                        transform: "scale(1)"
                    },
                    "&:before": {
                        content: '""',
                        position: "absolute",
                        zIndex: 1,
                        bottom: 0,
                        left: 0,
                        width: "300%",
                        height: 1,
                        background: "linear-gradient(to left, ".concat(g.colors[3], " 33.3%, transparent 33.3%, transparent 66.6%, ").concat(g.colors[3], " 66.6%)"),
                        transition: "transform .7s ease-in-out",
                        transform: "translateX(-66.6%)"
                    },
                    "&:hover": {
                        "&:before": {
                            transform: "translateX(0%)"
                        },
                        "& svg": {
                            transform: "scale(1.2) translateY(0px)"
                        }
                    }
                },
                modelsWrap: {},
                models: {
                    position: "relative",
                    zIndex: 1,
                    overflow: "hidden",
                    marginLeft: "-5.5vw",
                    marginRight: "-5.5vw"
                },
                modelsSlider: {
                    position: "relative",
                    zIndex: 1,
                    display: "flex",
                    transition: "left .9s ".concat(g.easings["power3.inOut"])
                },
                modelImage: {
                    width: "90%",
                    maxWidth: 500,
                    margin: [20, "auto"],
                    display: "flex",
                    position: "relative",
                    "& div": {
                        position: "relative",
                        zIndex: 1,
                        width: "100%",
                        paddingBottom: "100%",
                        display: "flex",
                        justifyContent: "center",
                        alignItems: "center",
                        userSelect: "none",
                        "&:before, &:after": {
                            content: '""',
                            position: "absolute",
                            zIndex: -1,
                            top: "50%",
                            left: "50%",
                            width: "90%",
                            height: "90%",
                            transform: "translate(-50%, -50%)",
                            borderRadius: "50%",
                            background: "radial-gradient(transparent, var(--color))",
                            transition: "width .7s ease-in-out, height .7s ease-in-out",
                            opacity: .3
                        },
                        "&:after": {
                            width: "50%",
                            height: "50%",
                            background: "var(--color)",
                            opacity: 1
                        },
                        "& span, & img": {
                            position: "absolute",
                            zIndex: 1,
                            width: "40%",
                            height: "auto",
                            top: "50%",
                            left: "50%",
                            transform: "translate(-50%, -50%)",
                            transition: "width .7s ease-in-out .1s",
                            pointerEvents: "none"
                        }
                    }
                },
                sliderButton: {
                    position: "relative",
                    zIndex: 2,
                    fontSize: 14,
                    textTransform: "uppercase",
                    color: g.colors[1],
                    flex: "0 0 70vw",
                    textAlign: "center",
                    cursor: "pointer",
                    transition: "opacity .3s ease-out 1s",
                    opacity: 1,
                    "& strong": {
                        display: "block"
                    }
                },
                sliderButtonActive: {
                    "& $modelImage": {
                        "& div": {
                            "&:before": {
                                width: "100%",
                                height: "100%"
                            },
                            "&:after": {
                                width: "60%",
                                height: "60%"
                            },
                            "& span, & img": {
                                width: "80%"
                            }
                        }
                    }
                },
                scrollIcon: {
                    position: "absolute",
                    zIndex: 1,
                    left: "5.5vw",
                    bottom: -28
                },
                arrowWrapper: {
                    position: "relative",
                    display: "flex",
                    justifyContent: "center",
                    top: 30,
                    zIndex: 10,
                    pointerEvents: "all"
                },
                arrow: {
                    position: "relative",
                    top: 0,
                    zIndex: 10,
                    clear: "both",
                    width: "44px",
                    height: "44px",
                    display: "inline-flex",
                    justifyContent: "center",
                    alignItems: "center",
                    background: g.colors[1],
                    borderRadius: "100%",
                    cursor: "pointer",
                    textAlign: "center",
                    fontSize: 10,
                    margin: "8px 0",
                    padding: "0",
                    transition: "opacity 0.3s ease-out",
                    "& svg": {
                        width: "auto",
                        height: "11px",
                        "& path": {
                            stroke: g.colors[0],
                            fill: g.colors[0]
                        }
                    },
                    "&:not(:last-child)": {
                        marginRight: "20px"
                    }
                },
                newsSection: {
                    position: "relative",
                    zIndex: 1,
                    paddingTop: 180,
                    marginLeft: "11vw",
                    width: "89vw"
                },
                newsHeader: {
                    display: "flex",
                    marginBottom: 120
                },
                newsTitle: {
                    flex: "0 0 50%"
                },
                newsDesc: {
                    flex: "0 0 50%",
                    display: "flex",
                    flexDirection: "column",
                    justifyContent: "space-between",
                    padding: [28, 0, 74]
                },
                newsPretitle: {
                    fontSize: 15,
                    textTransform: "uppercase"
                },
                newsText: {
                    fontSize: 19
                },
                banner: {
                    marginLeft: "5.5vw!important",
                    marginRight: "5.5vw!important"
                },
                footerWrapper: {
                    paddingLeft: "5.5vw",
                    paddingRight: "5.5vw"
                },
                "@media (max-height: 650px)": {
                    sliderItemTitle: {
                        fontSize: 53,
                        marginBottom: 25
                    },
                    newsDesc: {
                        padding: [19, 0, 38]
                    },
                    newsPretitle: {
                        fontSize: 14
                    },
                    newsText: {
                        fontSize: 16
                    }
                },
                "@media (max-height: 550px)": {
                    sliderItemTitle: {
                        fontSize: 33,
                        marginBottom: 25
                    },
                    newsDesc: {
                        padding: [5, 0, 20]
                    },
                    newsPretitle: {
                        fontSize: 12
                    },
                    newsText: {
                        fontSize: 14
                    }
                }
            };
            return I["@media (max-height: 450px) and (min-width: 1280px)"] = {
                topRightCorner: {
                    display: "none"
                },
                topLeftCorner: {
                    display: "none"
                },
                controllers: {
                    bottom: 50
                },
                controllerButtons: {
                    display: "none"
                },
                controllersNum: {
                    display: "none"
                },
                sliderItemTitle: {
                    textAlign: "center",
                    fontSize: 40,
                    marginBottom: 30
                },
                sliderItemText: {
                    textAlign: "center"
                },
                scrollIcon: {
                    left: 0,
                    right: 0,
                    bottom: 0,
                    margin: "auto"
                },
                sliderItemLink: {
                    padding: [15, 40],
                    borderRadius: 30,
                    background: g.colors[1],
                    color: g.colors[0],
                    right: 0,
                    margin: "0 auto",
                    textAlign: "center",
                    width: 200,
                    "&:before": {
                        display: "none"
                    },
                    "& svg": {
                        display: "none"
                    }
                },
                newsSection: {
                    padding: [100, "5.5vw", 30],
                    margin: 0,
                    width: "100%"
                },
                newsTitle: {
                    flex: "0 0 100%"
                },
                newsDesc: {
                    display: "none"
                },
                newsHeader: {
                    marginBottom: 50
                },
                slider: {
                    left: 0,
                    width: "100%"
                },
                sliderItem: {
                    padding: [0, 20]
                },
                models: {
                    marginLeft: "calc(-5.5vw - 20px)",
                    marginRight: "calc(-5.5vw - 20px)"
                }
            },
            I[g.mediaInverse.lg] = {
                topRightCorner: {
                    display: "none"
                },
                topLeftCorner: {
                    display: "none"
                },
                controllers: {
                    bottom: 50
                },
                controllerButtons: {
                    display: "none"
                },
                controllersNum: {
                    display: "none"
                },
                sliderItem: {
                    paddingBottom: 80
                },
                sliderItemTitle: {
                    textAlign: "center",
                    fontSize: 40,
                    marginBottom: 30
                },
                sliderItemText: {
                    textAlign: "center"
                },
                scrollIcon: {
                    left: 0,
                    right: 0,
                    bottom: 0,
                    margin: "auto"
                },
                sliderItemLink: {
                    padding: [15, 40],
                    borderRadius: 30,
                    background: g.colors[1],
                    color: g.colors[0],
                    margin: "40px auto",
                    textAlign: "center",
                    width: 200,
                    "&:before": {
                        display: "none"
                    },
                    "& svg": {
                        display: "none"
                    }
                },
                newsSection: {
                    padding: [100, "5.5vw", 70],
                    margin: 0,
                    width: "100%"
                },
                newsTitle: {
                    flex: "0 0 100%"
                },
                newsDesc: {
                    display: "none"
                }
            },
            I[g.mediaInverse.md] = {
                newsHeader: {
                    marginBottom: 50
                },
                slider: {
                    left: 0,
                    width: "100%"
                },
                sliderItem: {
                    padding: [0, 20]
                },
                models: {
                    marginLeft: "calc(-5.5vw - 20px)",
                    marginRight: "calc(-5.5vw - 20px)"
                },
                stage3: {
                    marginBottom: 50
                }
            },
            I[g.mediaInverse.sm] = {
                stage3: {
                    marginBottom: -80
                }
            },
            I
        };
        function ei(g, I) {
            var C = Object.keys(g);
            if (Object.getOwnPropertySymbols) {
                var A = Object.getOwnPropertySymbols(g);
                I && (A = A.filter((function(I) {
                    return Object.getOwnPropertyDescriptor(g, I).enumerable
                }
                ))),
                C.push.apply(C, A)
            }
            return C
        }
        function oi(g) {
            for (var I = 1; I < arguments.length; I++) {
                var C = null != arguments[I] ? arguments[I] : {};
                I % 2 ? ei(Object(C), !0).forEach((function(I) {
                    n()(g, I, C[I])
                }
                )) : Object.getOwnPropertyDescriptors ? Object.defineProperties(g, Object.getOwnPropertyDescriptors(C)) : ei(Object(C)).forEach((function(I) {
                    Object.defineProperty(g, I, Object.getOwnPropertyDescriptor(C, I))
                }
                ))
            }
            return g
        }
        var ii = Object(l.b)(Ai)
          , ti = function(g) {
            var I = g.stub
              , C = Object(o.useContext)(d.a)
              , A = C.setPageAnimationReady
              , t = C.headerHeight
              , l = Object(o.useContext)(b.a)
              , c = l.setReady
              , a = l.setSiteLoaded
              , s = Object(o.useContext)(G.a)
              , B = s.scrollbar
              , m = s.scroll
              , p = ii({
                headerHeight: t,
                isMobile: null == B ? void 0 : B.scroll.isMobile
            })
              , y = Object(o.useState)(!1)
              , W = e()(y, 2)
              , v = W[0]
              , V = W[1]
              , X = Object(o.useRef)(new jo.a.LoadQueue)
              , K = Object(o.useRef)(I)
              , R = Object(o.useRef)()
              , w = Object(o.useState)(0)
              , N = e()(w, 1)[0]
              , L = Object(o.useState)(0)
              , x = e()(L, 2)
              , M = x[0]
              , Q = x[1]
              , j = Object(o.useRef)()
              , U = Object(o.useRef)()
              , D = Object(o.useRef)()
              , T = Object(o.useRef)()
              , O = Object(J.a)()
              , E = O.model0
              , P = O.model1
              , q = O.model2
              , _ = O.setStage
              , $ = Object(i.f)((function(g) {
                var I;
                return {
                    page: g.content.pages[K.current] || {},
                    people: (null === (I = g.content.cpt) || void 0 === I ? void 0 : I._cty_people) || []
                }
            }
            ), i.d)
              , gg = $.page
              , Ig = $.people
              , Cg = function() {
                c(!0),
                a(!0),
                V(!0),
                A(!0)
            };
            Object(o.useEffect)((function() {
                var g, I;
                Object.keys(gg).length > 0 && Ig.length && (X.current.on("complete", Cg),
                null !== (g = gg.featured_image) && void 0 !== g && g.src ? X.current.loadFile({
                    src: null === (I = gg.featured_image) || void 0 === I ? void 0 : I.src
                }) : Cg())
            }
            ), [gg, Ig]),
            Object(o.useEffect)((function() {
                B && (B.scrollTo(0, 0),
                m.current.y = 0,
                U.current && B.on("scroll", (function(g) {
                    Object.keys(g.currentElements).forEach((function(I, C) {
                        var A, e = Object.values(g.currentElements)[C], o = Math.floor(null === (A = e.el.dataset) || void 0 === A ? void 0 : A.stage);
                        e.progress > .1 && _(o)
                    }
                    ))
                }
                )))
            }
            ), [B]);
            var Ag, eg, og, ig, tg, ng, lg, cg, ag, sg, dg, bg, Gg, rg, ug, Bg, Zg, mg, hg, pg, yg, Wg, vg, Vg = Object(u.a)((function(g) {
                Math.abs(g.velocities[0]) < .1 || g.down || (g.movement[0] < 0 ? Q(Math.min(2, M + 1)) : Q(Math.max(0, M - 1)))
            }
            )), Xg = function(g, I, C, A, e, o) {
                var i = [E.modelColor, P.modelColor, q.modelColor];
                return Object(Y.jsxs)("div", {
                    className: Z()(n()(n()({}, p.sliderItem, !0), p.sliderItemActive, N === g)),
                    children: [Object(Y.jsx)("h1", {
                        className: p.sliderItemTitle,
                        style: {
                            lineHeight: 1.1
                        },
                        dangerouslySetInnerHTML: {
                            __html: Object(k.removeParagraph)(I)
                        }
                    }), Object(Y.jsx)("div", {
                        className: p.sliderItemText,
                        style: {
                            lineHeight: 1.4
                        },
                        dangerouslySetInnerHTML: {
                            __html: Object(k.removeParagraph)(C)
                        }
                    }), "" !== A && Object(Y.jsxs)(h.a, {
                        to: e,
                        className: Z()(n()(n()({}, p.sliderItemLink, !0), p.sliderItemLinkActive, N === g)),
                        children: [A, Object(Y.jsx)("svg", {
                            children: Object(Y.jsx)("use", {
                                xlinkHref: "#ico-arrow"
                            })
                        })]
                    }), o && Object(Y.jsxs)("div", {
                        className: p.modelsWrap,
                        children: [Object(Y.jsx)("div", oi(oi({
                            className: p.models
                        }, Vg()), {}, {
                            children: Object(Y.jsx)("div", {
                                className: p.modelsSlider,
                                style: {
                                    left: "".concat(15 - 70 * M, "vw")
                                },
                                children: o.map((function(g, I) {
                                    return Object(Y.jsxs)("button", {
                                        style: {
                                            "--color": i[I],
                                            "--delay": "".concat(2.4 + .1 * I, "s")
                                        },
                                        className: Z()(n()(n()(n()({}, p.sliderButton, !0), p.sliderButtonActive, M === I), "sliderButton-".concat(I), !0)),
                                        "aria-label": g.label,
                                        children: [Object(Y.jsx)("div", {
                                            className: p.modelImage,
                                            style: {
                                                "--color": g.circleColor1
                                            },
                                            children: Object(Y.jsx)("div", {
                                                children: Object(Y.jsx)("img", {
                                                    src: "".concat(Fo.a.THEME_DIR, "/images/").concat(g.model),
                                                    alt: g.label
                                                })
                                            })
                                        }), Object(Y.jsx)("span", {
                                            dangerouslySetInnerHTML: {
                                                __html: g.label
                                            }
                                        })]
                                    }, I.toString())
                                }
                                ))
                            })
                        })), Object(Y.jsxs)("div", {
                            className: p.arrowWrapper,
                            children: [Object(Y.jsx)("button", {
                                "aria-label": "prev",
                                className: p.arrow,
                                onClick: function() {
                                    return Q(Math.max(0, M - 1))
                                },
                                children: Object(Y.jsx)("svg", {
                                    viewBox: "0 0 11 21",
                                    children: Object(Y.jsx)("path", {
                                        fillRule: "evenodd",
                                        d: "M11.000,0.000 L11.000,21.000 L-0.000,10.000 L11.000,0.000 Z"
                                    })
                                })
                            }), Object(Y.jsx)("button", {
                                "aria-label": "next",
                                className: p.arrow,
                                onClick: function() {
                                    return Q(Math.min(2, M + 1))
                                },
                                children: Object(Y.jsx)("svg", {
                                    viewBox: "0 0 11 21",
                                    children: Object(Y.jsx)("path", {
                                        fillRule: "evenodd",
                                        d: "M-0.000,0.000 L-0.000,21.000 L11.000,10.000 L-0.000,0.000 Z"
                                    })
                                })
                            })]
                        })]
                    })]
                })
            };
            return v && Object(Y.jsxs)(Y.Fragment, {
                children: [Object(Y.jsxs)(F.a, {
                    init: v,
                    className: Z()(n()(n()({
                        page: !0,
                        pageHome: !0
                    }, p.root, !0), p.isMobile, m.isMobile || m.isTablet)),
                    ref: R,
                    children: [v && Object(Y.jsx)(S.a, {
                        title: gg.title.rendered,
                        meta: gg.yoast_meta,
                        schema: gg.yoast_json_ld
                    }), v && Object(Y.jsxs)(Y.Fragment, {
                        children: [Object(Y.jsxs)("div", {
                            className: p.page,
                            children: [Object(Y.jsxs)("div", {
                                className: p.wrapper,
                                children: [Object(Y.jsx)("div", {
                                    ref: j,
                                    "data-scroll": !0,
                                    "data-stage": 0,
                                    className: "stage ".concat(p.stage, " ").concat(p.stage0),
                                    children: Xg(0, null === (Ag = gg.acf) || void 0 === Ag ? void 0 : Ag.hero.title, null === (eg = gg.acf) || void 0 === eg ? void 0 : eg.hero.text, "", "")
                                }), Object(Y.jsx)("div", {
                                    ref: U,
                                    "data-scroll": !0,
                                    "data-stage": 1,
                                    className: "stage ".concat(p.stage, " ").concat(p.stage1),
                                    children: Xg(1, null === (og = gg.acf) || void 0 === og ? void 0 : og.manifesto.title, null === (ig = gg.acf) || void 0 === ig ? void 0 : ig.manifesto.text, null === (tg = gg.acf) || void 0 === tg ? void 0 : tg.manifesto.label, null === (ng = gg.acf) || void 0 === ng ? void 0 : ng.manifesto.link)
                                }), Object(Y.jsx)("div", {
                                    ref: D,
                                    "data-scroll": !0,
                                    "data-stage": 2,
                                    className: "stage ".concat(p.stage, " ").concat(p.stage2),
                                    children: Xg(2, null === (lg = gg.acf) || void 0 === lg ? void 0 : lg.technology.title, null === (cg = gg.acf) || void 0 === cg ? void 0 : cg.technology.text, null === (ag = gg.acf) || void 0 === ag ? void 0 : ag.technology.label, null === (sg = gg.acf) || void 0 === sg ? void 0 : sg.technology.link, null === (dg = gg.acf) || void 0 === dg ? void 0 : dg.technology.products)
                                })]
                            }), Object(Y.jsxs)("div", {
                                ref: T,
                                "data-scroll": !0,
                                "data-stage": 3,
                                className: "stage ".concat(p.stage, " ").concat(p.stage3),
                                children: [Object(Y.jsxs)("div", {
                                    className: p.newsSection,
                                    children: [Object(Y.jsxs)("div", {
                                        className: p.newsHeader,
                                        children: [Object(Y.jsx)("div", {
                                            className: p.newsTitle,
                                            children: Object(Y.jsx)("h2", {
                                                className: p.sliderItemTitle,
                                                dangerouslySetInnerHTML: {
                                                    __html: Object(k.removeParagraph)(null === (Gg = gg.acf) || void 0 === Gg || null === (rg = Gg.news) || void 0 === rg ? void 0 : rg.title)
                                                },
                                                style: {
                                                    lineHeight: 1.1
                                                }
                                            })
                                        }), Object(Y.jsxs)("div", {
                                            className: p.newsDesc,
                                            children: [Object(Y.jsx)("div", {
                                                className: p.newsPretitle,
                                                dangerouslySetInnerHTML: {
                                                    __html: Object(k.removeParagraph)(null === (ug = gg.acf) || void 0 === ug || null === (Bg = ug.news) || void 0 === Bg ? void 0 : Bg.pretitle)
                                                },
                                                style: {
                                                    lineHeight: 1.1
                                                }
                                            }), Object(Y.jsx)("div", {
                                                className: p.newsText,
                                                dangerouslySetInnerHTML: {
                                                    __html: Object(k.removeParagraph)(null === (Zg = gg.acf) || void 0 === Zg || null === (mg = Zg.news) || void 0 === mg ? void 0 : mg.text)
                                                },
                                                style: {
                                                    lineHeight: 1.4
                                                }
                                            })]
                                        })]
                                    }), (Wg = {
                                        label: (null === (hg = gg.acf) || void 0 === hg ? void 0 : hg.news?.label) || "Read more",
                                        link: null === (pg = gg.acf) || void 0 === pg ? void 0 : pg.news?.link
                                    },
                                    vg = null === (yg = gg.acf) || void 0 === yg ? void 0 : yg.news?.news.map((function(g) {
                                        var I;
                                        return {
                                            title: g.title.rendered,
                                            link: g.link,
                                            image: null === (I = g.featured_image) || void 0 === I ? void 0 : I.src
                                        }
                                    }
                                    )),
                                    Object(Y.jsx)(H, {
                                        items: vg?.slice(0, 9),
                                        cta: Wg
                                    }))]
                                }), (null === (bg = gg.acf) || void 0 === bg ? void 0 : bg.banner) && Object(Y.jsx)(f.a, {
                                    className: p.banner,
                                    title: gg.acf.banner.title,
                                    text: gg.acf.banner.text,
                                    label: gg.acf.banner.label,
                                    link: gg.acf.banner.link,
                                    image: gg.acf.banner.image,
                                    visible: !0
                                })]
                            })]
                        }), Object(Y.jsx)("div", {
                            className: p.footerWrapper,
                            children: Object(Y.jsx)(z.a, {})
                        })]
                    })]
                }), Object(Y.jsx)(r.a, {
                    className: p.canvas,
                    shadows: !0,
                    dpr: [1, 1.5],
                    camera: {
                        position: [0, 0, 7],
                        fov: 30,
                        far: 50
                    },
                    children: Object(Y.jsx)(Ci, {})
                })]
            })
        }
          , ni = C(207)
          , li = C(130);
        I.default = function(g) {
            var I = g.stub
              , C = Object(ni.a)()
              , A = e()(C, 1)[0]
              , t = Object(o.useRef)(I)
              , n = Object(o.useState)()
              , l = e()(n, 2)
              , c = l[0]
              , a = l[1]
              , s = Object(i.f)((function(g) {
                return {
                    page: g.content.pages[t.current] || {}
                }
            }
            ), i.d).page
              , d = Object(i.e)()
              , b = Object(o.useCallback)((function(g) {
                return d(li.c(g))
            }
            ), [d]);
            return Object(o.useEffect)((function() {
                b(t.current)
            }
            ), []),
            Object(o.useEffect)((function() {
                Object.keys(s).length > 0 && a(!0)
            }
            ), [s]),
            A > 3 && c ? Object(Y.jsx)(Mo, {
                stub: I
            }) : Object(Y.jsx)(ti, {
                stub: I
            })
        }
    }
}]);
//# sourceMappingURL=home.0381.js.map
